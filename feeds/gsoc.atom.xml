<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>/home/adeel - GSoC</title><link href="https://adl1995.github.io/" rel="alternate"></link><link href="https://adl1995.github.io/feeds/gsoc.atom.xml" rel="self"></link><id>https://adl1995.github.io/</id><updated>2018-06-01T15:44:00+05:00</updated><entry><title>Using variadic templates with lambda expressions in C++ for constrained optimization</title><link href="https://adl1995.github.io/using-variadic-templates-with-lambda-expressions-in-c-for-constrained-optimization.html" rel="alternate"></link><published>2018-06-01T15:44:00+05:00</published><updated>2018-06-01T15:44:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2018-06-01:/using-variadic-templates-with-lambda-expressions-in-c-for-constrained-optimization.html</id><summary type="html">&lt;p&gt;Constrained optimization problems are encountered in numerous applications, such as &lt;a href="https://www.princeton.edu/~fhs/paper199/paper199.pdf"&gt;protein folding&lt;/a&gt;, &lt;a href="http://cai2r.net/public/documents/FlorianKnoll_thesis.pdfZ"&gt;Magnetic Resonance Image reconstruction&lt;/a&gt;, and &lt;a href="https://ieeexplore.ieee.org/document/4100822"&gt;radiation therapy&lt;/a&gt;. In this problem, we are given an objective function which is to be minimized or maximized with respect to constraints on some variables. The constraints can either be soft constraints or …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Constrained optimization problems are encountered in numerous applications, such as &lt;a href="https://www.princeton.edu/~fhs/paper199/paper199.pdf"&gt;protein folding&lt;/a&gt;, &lt;a href="http://cai2r.net/public/documents/FlorianKnoll_thesis.pdfZ"&gt;Magnetic Resonance Image reconstruction&lt;/a&gt;, and &lt;a href="https://ieeexplore.ieee.org/document/4100822"&gt;radiation therapy&lt;/a&gt;. In this problem, we are given an objective function which is to be minimized or maximized with respect to constraints on some variables. The constraints can either be soft constraints or hard constraints, which can be specified by boolean operators, such as equality, relational, and conditional. &lt;/p&gt;
&lt;p&gt;This post provides insight on how to model constraints using lambda expressions, and how to pass a varying number of constraints to a function using variadic templates. Before moving on with the C++ implementation, it would be helpful to review how variadic functions were used in C and how they differ from the current standard.&lt;/p&gt;
&lt;h1&gt;C-style variadic functions&lt;/h1&gt;
&lt;p&gt;Support for &lt;a href="https://en.wikipedia.org/wiki/Variadic_macro"&gt;variadic macros&lt;/a&gt; was introduced in C as part of the &lt;a href="https://en.wikipedia.org/wiki/C99"&gt;C99 standard&lt;/a&gt;. This allowed users to define functions that could take a varying number of arguments. A common example of this is the &lt;a href="http://www.cplusplus.com/reference/cstdio/printf"&gt;printf&lt;/a&gt; library function, which can be used to print an arbitrary number of values.&lt;/p&gt;
&lt;p&gt;The &lt;a href="http://www.cplusplus.com/reference/cstdarg"&gt;cstdarg&lt;/a&gt; header file defines the necessary macros to create variadic functions. The syntax requires specifying the function name followed by its arguments. The last argument is always the ellipsis &lt;code&gt;...&lt;/code&gt; operator. An example of this is shown below:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;print_arguments&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;nargs&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;...)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;// (1)&lt;/span&gt;
  &lt;span class="kt"&gt;va_list&lt;/span&gt; &lt;span class="n"&gt;vl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;                          &lt;span class="c1"&gt;// (2)&lt;/span&gt;
  &lt;span class="n"&gt;va_start&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;nargs&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;                 &lt;span class="c1"&gt;// (3)&lt;/span&gt;

  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;nargs&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"%s"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;va_arg&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;   &lt;span class="c1"&gt;// (4)&lt;/span&gt;

  &lt;span class="n"&gt;va_end&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vl&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;                          &lt;span class="c1"&gt;// (5)&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Calling the above function as &lt;code&gt;print_arguments(5, "h", "e", "l", "l", "o")&lt;/code&gt; would produce the output &lt;code&gt;hello&lt;/code&gt;. Let’s go over the function definition step-by-step:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;nargs&lt;/code&gt; is the first argument which, in this case, specifies the argument count this function should expect. The ellipsis &lt;code&gt;...&lt;/code&gt; operator specifies an arbitrary number of arguments.&lt;/li&gt;
&lt;li&gt;An object of &lt;a href="http://www.cplusplus.com/reference/cstdarg/va_list"&gt;va_list&lt;/a&gt; is created to hold information about the variable arguments.&lt;/li&gt;
&lt;li&gt;The variable argument list &lt;code&gt;vl&lt;/code&gt; is initialized using the &lt;a href="http://www.cplusplus.com/reference/cstdarg/va_start"&gt;va_start&lt;/a&gt; macro. Here &lt;code&gt;nargs&lt;/code&gt; specifies the number of arguments.&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.cplusplus.com/reference/cstdarg/va_arg"&gt;va_arg&lt;/a&gt; retrieves the next argument. Each call to this macro modifies the state of &lt;code&gt;vl&lt;/code&gt; to point to the next element. Notice that we had to explicitly pass the function type, so this function is not type agnostic.&lt;/li&gt;
&lt;li&gt;The &lt;a href="http://www.cplusplus.com/reference/cstdarg/va_end"&gt;va_end&lt;/a&gt; macro should be invoked before the function returns. It performs cleanup of the &lt;code&gt;va_list&lt;/code&gt; object so that it’s no longer usable.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Drawbacks&lt;/h3&gt;
&lt;p&gt;There are several drawbacks using the above function. Firstly, we have to specify the number of arguments as part of the function call, although, this is not necessary, as we could pass a token specifying argument end, such as the &lt;code&gt;NULL&lt;/code&gt; operator. The &lt;code&gt;printf&lt;/code&gt; function does this by looking at the formatting specifiers (&lt;code&gt;%s&lt;/code&gt; in this case). This is why it fails if the format string does not match the argument list.&lt;/p&gt;
&lt;p&gt;Another major drawback is that we have to know, in advance, the type of data we’re passing. Passing an incorrect type to &lt;code&gt;va_arg&lt;/code&gt; could result in a segmentation fault. This makes it cumbersome to process data with varying types. Finally, the types are evaluated at run-time, so it can cause a performance overhead.&lt;/p&gt;
&lt;p&gt;C-style variadic functions are discouraged in C++ as they are not type safe, apart from other issues that are mentioned above. In C++, we have the ability to define variadic templates, which are strongly typed. These are discussed in the following section.&lt;/p&gt;
&lt;h1&gt;Variadic templates in C++&lt;/h1&gt;
&lt;p&gt;Variadic templates became part of the C++ standard in August 2011, commonly known as &lt;a href="https://en.wikipedia.org/wiki/C%2B%2B11"&gt;C++11&lt;/a&gt;. They allow a way of writing functions that take a varying number of arguments in a type safe way using &lt;a href="https://en.cppreference.com/w/cpp/language/parameter_pack#Pack_expansion"&gt;pack expansion&lt;/a&gt;. Another advantage they have over the traditional variadic functions is that all argument handling logic is done at compile-time, which leads to better performance.&lt;/p&gt;
&lt;p&gt;The example below defines a variadic function template which returns the number of arguments it gets passed:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="n"&gt;Types&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;        &lt;span class="c1"&gt;// (1)&lt;/span&gt;
&lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="kt"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;nargs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Types&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;// (2)&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;         &lt;span class="c1"&gt;// (3)&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Calling &lt;code&gt;nargs(1, "2", 3.5)&lt;/code&gt; will return &lt;code&gt;3&lt;/code&gt;. The function details are described below:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;We first specify a variadic template using &lt;code&gt;typename... Types&lt;/code&gt;, the contents of which are called parameter packs.&lt;/li&gt;
&lt;li&gt;The parameters packs are unpacked inside the function header. So, in the above case, calling &lt;code&gt;nargs(1, "2", 3.5)&lt;/code&gt; should generate:&lt;/li&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="kt"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;nargs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;param1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;param2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;param3&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;li&gt;The &lt;a href="http://en.cppreference.com/w/cpp/language/sizeof..."&gt;sizeof…&lt;/a&gt; operator queries the number of arguments in a parameter pack.&lt;/li&gt;
&lt;/ol&gt;
&lt;!-- - We first specify a variadic template using `typename... Types`, the contents of which are called parameter packs.
- The parameters packs are unpacked inside the function header. So, in the above case, calling `nargs(1, "2", 3.5)` should generate:

wzxhzdk:2


- The [sizeof...](http://en.cppreference.com/w/cpp/language/sizeof...) operator queries the number of arguments in a parameter pack.
--&gt;
&lt;p&gt;Now let’s look at an example which makes use of pack expansion. The function below returns &lt;code&gt;true&lt;/code&gt; if all the arguments passed to it are &lt;code&gt;true&lt;/code&gt;, that is, it performs an &lt;span class="caps"&gt;AND&lt;/span&gt; operation.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// The base case: just return the passed argument.&lt;/span&gt;
&lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="kt"&gt;bool&lt;/span&gt; &lt;span class="n"&gt;isTrue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;// The recursive case: perform an AND operation. &lt;/span&gt;
&lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;typename&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="n"&gt;Args&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="kt"&gt;bool&lt;/span&gt; &lt;span class="n"&gt;isTrue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Args&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;isTrue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;...);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is important to mention that we cannot use the iterative C++  style here. More precisely, we cannot loop over the passed arguments. Instead, variadic templates require functions to be written recursively, thus a separate function for the base case, and the recursive case, as shown above.&lt;/p&gt;
&lt;p&gt;Let’s trace the above function with the call &lt;code&gt;isTrue(true, false, true)&lt;/code&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Since the number of arguments are greater that one, the second overloaded function, that is, the recursive case is called.&lt;/li&gt;
&lt;li&gt;The compiler deduces the template type to be &lt;code&gt;bool&lt;/code&gt;, so the parameter pack becomes &lt;code&gt;T = bool; Args = {bool, bool}&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;We now use pack expansion &lt;code&gt;...&lt;/code&gt; with &lt;code&gt;isTrue(args...)&lt;/code&gt;. The compiler translates this into &lt;code&gt;isTrue(false, true)&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;The code generated above &lt;code&gt;isTrue(false, true)&lt;/code&gt; again calls the recursive case.&lt;/li&gt;
&lt;li&gt;The compiler deduces the type to be &lt;code&gt;T = bool; Args = {bool}&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;This time &lt;code&gt;isTrue(args...)&lt;/code&gt; is translated into &lt;code&gt;isTrue(true)&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Since there is only one argument passed to &lt;code&gt;isTrue&lt;/code&gt; we have reached the base case, and the recursion is finished.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;This can be confirmed by using the &lt;code&gt;__PRETTY_FUNCTION__&lt;/code&gt; macro, which generates the call stack as listed below:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kt"&gt;bool&lt;/span&gt; &lt;span class="nf"&gt;isTrue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Args&lt;/span&gt; &lt;span class="p"&gt;...)&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;Args&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="kt"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;}]&lt;/span&gt;
&lt;span class="kt"&gt;bool&lt;/span&gt; &lt;span class="n"&gt;isTrue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Args&lt;/span&gt; &lt;span class="p"&gt;...)&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;Args&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="kt"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;}]&lt;/span&gt;
&lt;span class="kt"&gt;bool&lt;/span&gt; &lt;span class="n"&gt;isTrue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Note: Variadic recursion differs from traditional recursion. In traditional recursion a function calls itself a number of times using the same signature, until it reaches its base case. However, in variadic recursion the function signature is always changing, as the number of arguments are decreasing with each call, so the compiler generates a different function for each call.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Constrained optimization problems: a practical use-case&lt;/h1&gt;
&lt;p&gt;A practical use-case where variadic templates can be employed are &lt;a href="https://en.wikipedia.org/wiki/Constrained_optimization#Constraint_optimization_problems"&gt;constrained optimization problems&lt;/a&gt;. They require the state to  satisfy certain constraints for them to be considered eligible. Constraints can be of many types, such as boundary constraints, which can be specified by equality, inequality, and relational operators.&lt;/p&gt;
&lt;p&gt;Let’s consider the constrained variant of &lt;a href="https://en.wikipedia.org/wiki/Particle_swarm_optimization"&gt;particle swarm optimization&lt;/a&gt; (&lt;span class="caps"&gt;PSO&lt;/span&gt;). The details of this algorithm are beyond the scope of this post. Briefly, &lt;span class="caps"&gt;PSO&lt;/span&gt; tries to find the local or global minimum from a given a set of problems, which must satisfy certain constraints. Suppose there is a class &lt;code&gt;PSO&lt;/code&gt; which provides this implementation. We need to create a convenient &lt;span class="caps"&gt;API&lt;/span&gt; through which a user can pass constraints to a class method, say &lt;code&gt;PSO::optimize&lt;/code&gt;. One option is to pass each constraint as an argument to the class method. However, the number of constraints are arbitrary, and can vary from problem to problem. This can be solved using variadic templates.&lt;/p&gt;
&lt;h3&gt;Lambda expressions&lt;/h3&gt;
&lt;p&gt;Ideally, a constraint should be a function that takes data as input and returns a boolean, which indicates whether the given data satisfies the constraint or not. This can be conveniently specified using a &lt;a href="en.cppreference.com/w/cpp/language/lambda"&gt;lambda expression&lt;/a&gt;, which were introduced in C++11.&lt;/p&gt;
&lt;p&gt;A lambda expression is an inline anonymous function that is simple to read and interpret. It can be specified as follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;constraint&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[](&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;a href="http://en.cppreference.com/w/cpp/language/auto"&gt;auto&lt;/a&gt; specifier is also part of the C++11 standard. It allows the compiler to deduce expression type from the &lt;code&gt;return&lt;/code&gt; statement. &lt;code&gt;[]&lt;/code&gt; is the capture list which can take a comma separated list of captures, such as by reference &lt;code&gt;&amp;amp;&lt;/code&gt; or by value &lt;code&gt;=&lt;/code&gt;. In this case, we don’t capture anything, so the list is empty. The argument list and function body are similar to standard C++ functions.&lt;/p&gt;
&lt;h3&gt;Variadic template with lambda expressions&lt;/h3&gt;
&lt;p&gt;We now have to define a variadic template that can take arbitrary number of lambda expressions and return &lt;code&gt;true&lt;/code&gt; if all the constraints are satisfied. This is similar to what we defined above:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt; &lt;span class="n"&gt;Constraint&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="kt"&gt;bool&lt;/span&gt; &lt;span class="n"&gt;evaluateConstraints&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Constraint&lt;/span&gt; &lt;span class="n"&gt;constraint&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;constraint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;typename&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="n"&gt;Args&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="kt"&gt;bool&lt;/span&gt; &lt;span class="n"&gt;evaluateConstraints&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;constraint&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Args&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="n"&gt;constraints&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;constraint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;
         &lt;span class="n"&gt;evaluateConstraints&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;constraints&lt;/span&gt;&lt;span class="p"&gt;...);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first parameter &lt;code&gt;x&lt;/code&gt; is the value on which we want to enforce our constraints. Our class method can now take a varying number of constraints (lambda expressions) using pack expansion and call the &lt;code&gt;evaluateConstraints&lt;/code&gt; function. For the sake of demonstration, this could look something like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="n"&gt;Args&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="kr"&gt;inline&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;PSO&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;optimize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Args&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="n"&gt;constraints&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// In actual implementation the initial starting&lt;/span&gt;
  &lt;span class="c1"&gt;// point can be specified by the user.&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;evaluateConstraints&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;constraints&lt;/span&gt;&lt;span class="p"&gt;...))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// Perform optimization.&lt;/span&gt;

    &lt;span class="c1"&gt;// Update x.&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In conclusion, this post discussed:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Drawbacks of C-style variadic functions which are defined using &lt;code&gt;va_list&lt;/code&gt;, &lt;code&gt;va_start&lt;/code&gt;, &lt;code&gt;va_arg&lt;/code&gt;, and &lt;code&gt;va_end&lt;/code&gt; macros.&lt;/li&gt;
&lt;li&gt;C++ varaidic templates require writing a base case and a recursive case. They are also type safe and provide better performance due to compile time computation.&lt;/li&gt;
&lt;li&gt;Expressing constraints as lambda expressions in constrained optimizations problems.&lt;/li&gt;
&lt;li&gt;Combining variadic templates with lambda expressions for handling multiple constraints.&lt;/li&gt;
&lt;/ul&gt;</content><category term="C++"></category></entry><entry><title>Inaccuracy in Boost Geometry geodesic algorithms for nearly antipodal points</title><link href="https://adl1995.github.io/inaccuracy-in-boost-geometry-geodesic-algorithms-for-nearly-antipodal-points.html" rel="alternate"></link><published>2018-05-10T21:55:00+05:00</published><updated>2018-05-10T21:55:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2018-05-10:/inaccuracy-in-boost-geometry-geodesic-algorithms-for-nearly-antipodal-points.html</id><summary type="html">&lt;p&gt;Nearly antipodal points or antipodes refer to the most geographically distant points on a sphere, that is, the points are diametrically opposite to each other. If a line is drawn between these two points, it passes through the center of the sphere and forms its diameter.&lt;/p&gt;
&lt;p&gt;Computing the great circle …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Nearly antipodal points or antipodes refer to the most geographically distant points on a sphere, that is, the points are diametrically opposite to each other. If a line is drawn between these two points, it passes through the center of the sphere and forms its diameter.&lt;/p&gt;
&lt;p&gt;Computing the great circle distance between these two points is often a corner case for most geodesic computations, and the distance is either overestimated or underestimated. In case of &lt;a href="https://en.wikipedia.org/wiki/Vincenty%27s_formulae"&gt;Vincenty’s formulae&lt;/a&gt;, the solution fails to converge, or provides inaccurate results. This can have major implications in applications which rely on accurate results, such as flight navigation systems. The software can either handle this by doing an error analysis check and providing specific values through which the inaccuracy can be identified, or choose a different method altogether.&lt;/p&gt;
&lt;p&gt;This post provides a general description of geodesic algorithms and shows their inaccuracy for nearly antipodal points in &lt;a href="http://boost.org/libs/geometry"&gt;Boost Geometry&lt;/a&gt; library. A solution is then proposed following the paper &lt;a href="https://arxiv.org/pdf/1109.4448.pdf"&gt;Algorithm for geodesics&lt;/a&gt;, by Charles Karney, the implementation for which is provided in &lt;a href="https://sourceforge.net/projects/geographiclib"&gt;GeographicLib&lt;/a&gt; library.&lt;/p&gt;
&lt;h1&gt;Problem description&lt;/h1&gt;
&lt;p&gt;The algorithms described below model the Earth as an ellipsoid, which is obtained by deforming a sphere by means of directional scalings, or more generally, of an &lt;a href="https://en.wikipedia.org/wiki/Affine_transformation"&gt;affine transformation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Geodesics algorithms are employed for solving the direct and inverse geodetic problems.&lt;/p&gt;
&lt;h3&gt;Direct and inverse geodesic problems&lt;/h3&gt;
&lt;p&gt;Our goal in the direct geodesic problem is to find the longitudinal difference &lt;span class="math"&gt;\(\lambda12\)&lt;/span&gt;, the latitude &lt;span class="math"&gt;\(\phi2\)&lt;/span&gt;, and the azimuth &lt;span class="math"&gt;\(\alpha2\)&lt;/span&gt; for the second point. The information we are provided for solving this is the latitude &lt;span class="math"&gt;\(\phi1\)&lt;/span&gt; and azimuth &lt;span class="math"&gt;\(\alpha1\)&lt;/span&gt; at the first point, and the distance between the two points &lt;span class="math"&gt;\(s12\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;On the contrary, the inverse geodesic problem deals with finding the azimuths for the two points &lt;span class="math"&gt;\(\alpha1\)&lt;/span&gt; and &lt;span class="math"&gt;\(\alpha2\)&lt;/span&gt;, and the distance between them &lt;span class="math"&gt;\(s12\)&lt;/span&gt;. The input data includes the latitudes for the two points &lt;span class="math"&gt;\(\phi1\)&lt;/span&gt; and &lt;span class="math"&gt;\(\phi2\)&lt;/span&gt;, and their longitudinal difference &lt;span class="math"&gt;\(\lambda12\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;The direct or forward geodesic problem is much simpler than the inverse or backward problem because the equatorial azimuth &lt;span class="math"&gt;\(\alpha0\)&lt;/span&gt; can be determined directly from the given quantities &lt;span class="math"&gt;\(\phi1\)&lt;/span&gt; and &lt;span class="math"&gt;\(\alpha1\)&lt;/span&gt;. However, the inverse problem is intrinsically more complex. In this case, the angle given by the longitude of &lt;span class="math"&gt;\(B\)&lt;/span&gt; relative to &lt;span class="math"&gt;\(A\)&lt;/span&gt; (&lt;span class="math"&gt;\(\lambda12\)&lt;/span&gt;) is related to the corresponding angle on the auxiliary sphere &lt;span class="math"&gt;\(\omega12\)&lt;/span&gt; via an unknown equatorial azimuth &lt;span class="math"&gt;\(\alpha0\)&lt;/span&gt;. This is shown in the figure below.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;img alt="geodesic" src="https://adl1995.github.io/images/geodesic-small.png" style="width: 450px; height: auto; max-width: 100%;"/&gt;&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;Over the years, numerous algorithms have been proposed for solving the above problems. The solution provided by &lt;a href="https://www.ngs.noaa.gov/PUBS_LIB/inverse.pdf"&gt;Vincenty (1975)&lt;/a&gt; is based on the &lt;a href="https://en.wikipedia.org/wiki/Series_expansion"&gt;series expansion&lt;/a&gt; carried out to third order in the &lt;a href="https://en.wikipedia.org/wiki/Flattening"&gt;flattening&lt;/a&gt; and provides an accuracy of about 0.1 millimeters for the &lt;a href="https://en.wikipedia.org/wiki/WGS84"&gt;&lt;span class="caps"&gt;WGS84&lt;/span&gt;&lt;/a&gt; ellipsoid, however, as noted above, the inverse method fails to converge for nearly antipodal points.&lt;/p&gt;
&lt;p&gt;In the paper &lt;a href="https://arxiv.org/pdf/1109.4448.pdf"&gt;Algorithm for geodesics&lt;/a&gt; authored by Charles Karney, a solution is provided for direct and inverse methods that is accurate up to 15 nanometers. It continues the series expansions to sixth order &lt;span class="math"&gt;\(O(f^6)\)&lt;/span&gt; which suffices to provide full &lt;a href="https://en.wikipedia.org/wiki/Double_precision"&gt;double precision&lt;/a&gt; accuracy for &lt;span class="math"&gt;\(|f| \leq \frac{1}{50}\)&lt;/span&gt;, where &lt;span class="math"&gt;\(f\)&lt;/span&gt; is the &lt;a href="https://en.wikipedia.org/wiki/Flattening"&gt;flattening of the ellipsoid&lt;/a&gt; and is given by&lt;/p&gt;
&lt;div class="math"&gt;$$f = (a - b) / a.$$&lt;/div&gt;
&lt;p&gt;Where &lt;span class="math"&gt;\(a\)&lt;/span&gt; defines the equatorial radius, and &lt;span class="math"&gt;\(b\)&lt;/span&gt; refers to the polar radius.&lt;/p&gt;
&lt;p&gt;For solving the inverse problem, it employs the &lt;a href="https://en.wikipedia.org/wiki/Newton%27s_method"&gt;Newton’s method&lt;/a&gt; for adjusting &lt;span class="math"&gt;\(\alpha1\)&lt;/span&gt; until the correct &lt;span class="math"&gt;\(\lambda12\)&lt;/span&gt; is obtained. This typically requires two to four iterations and works for all types of input. Whereas, Vincenty’s solution can require thousands of iterations before it converges. &lt;/p&gt;
&lt;h1&gt;Problem demonstration&lt;/h1&gt;
&lt;p&gt;The strategies currently offered by &lt;a href="http://boost.org/libs/geometry"&gt;Boost Geometry&lt;/a&gt;, also known as Generic Geometry Library (&lt;span class="caps"&gt;GGL&lt;/span&gt;) do not correctly handle corner cases for nearly antipodal points. To illustrate this, we select two points and compare their results with &lt;a href="https://sourceforge.net/projects/geographiclib"&gt;GeographicLib&lt;/a&gt; library, which is developed by Charles Karney, the author of the paper &lt;a href="https://arxiv.org/pdf/1109.4448.pdf"&gt;Algorithm for geodesics&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Inaccuracy in inverse problem&lt;/h3&gt;
&lt;p&gt;For comparing the results, we select two geographically distant points on the Earth’s surface which are almost diametrically opposite to each other i.e. they are nearly antipodal. The values below are represented in latitude / longitude pairs (degrees).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;2.179167    -73.787500
-2.162200    106.139064
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using Vincenty’s strategy to compute the distance:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Note: Boost Geometry convention is that coordinate values of 2D tuple are given according to mathematical axis order: X, Y. In terms of geographic coordinate system: longitude, latitude. For a detailed explanation, refer to the &lt;a href="https://www.boost.org/doc/libs/1_67_0/libs/geometry/doc/html/geometry/design.html#geometry.design.axis_order"&gt;Design Rationale&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;boost/geometry.hpp&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="k"&gt;using&lt;/span&gt; &lt;span class="k"&gt;namespace&lt;/span&gt; &lt;span class="n"&gt;boost&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;typedef&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;point&lt;/span&gt;
    &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cs&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;spherical_equatorial&lt;/span&gt;
    &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;degree&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;spherical_point&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;typedef&lt;/span&gt; &lt;span class="n"&gt;srs&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;spheroid&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stype&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c1"&gt;// Define the strategy.&lt;/span&gt;
&lt;span class="k"&gt;typedef&lt;/span&gt; &lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;vincenty&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;stype&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;vincenty_type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="n"&gt;spherical_point&lt;/span&gt; &lt;span class="nf"&gt;point1&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;73.787500&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;2.179167&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
                &lt;span class="n"&gt;point2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;106.139064&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;2.162200&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="c1"&gt;// The distance is returned in meters.&lt;/span&gt;
&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;point1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;point2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;vincenty_type&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The distance is returned as 19963713.360 meters.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Note: The reason we get a result in Boost Geometry is due to the &lt;a href="https://github.com/boostorg/geometry/blob/develop/include/boost/geometry/formulas/vincenty_inverse.hpp#L159"&gt;BOOST_GEOMETRY_DETAIL_VINCENTY_MAX_STEPS&lt;/a&gt; macro which terminates the loop after a certain number of iterations. Otherwise, the solution may never converge.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We compare the previous result with GeographicLib which correctly handles the case for nearly antipodal points.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;GeographicLib/Geodesic.hpp&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="k"&gt;using&lt;/span&gt; &lt;span class="k"&gt;namespace&lt;/span&gt; &lt;span class="n"&gt;GeographicLib&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;Geodesic&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;geod&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Geodesic&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;WGS84&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="n"&gt;geod&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Inverse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;2.179167&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;73.787500&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;2.162200&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;106.13906&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Alternatively, the &lt;span class="caps"&gt;CLI&lt;/span&gt; tool &lt;code&gt;GeodSolve&lt;/code&gt; can be passed the latitude and longitude positions of our two points. The &lt;code&gt;-i&lt;/code&gt; flag refers to the inverse problem.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;GeodSolve -i &lt;span class="o"&gt;&amp;lt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="s2"&gt;"2.179167 -73.787500 -2.162200 106.13906"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This returns the distance as 20001571.083 meters. Thus, the distance computed using Boost Geometry was off my 37857.723 meters.&lt;/p&gt;
&lt;h3&gt;Inaccuracy in direct problem&lt;/h3&gt;
&lt;p&gt;To illustrate the problem with the current implementation of direct Vincenty strategy, we use the latitude and longitude positions of our first pair of points we used earlier, and try to recover the latitude and longitude positions for the second pair or destination.&lt;/p&gt;
&lt;p&gt;In Boost Geometry, the direct strategy can be specified as follows.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;boost/geometry.hpp&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="k"&gt;using&lt;/span&gt; &lt;span class="k"&gt;namespace&lt;/span&gt; &lt;span class="n"&gt;boost&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c1"&gt;// For storing the resulting values.&lt;/span&gt;
&lt;span class="n"&gt;formula&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;result_direct&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c1"&gt;// WGS-84 spheroid.&lt;/span&gt;
&lt;span class="n"&gt;srs&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;spheroid&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;spheroid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;6378137.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;6356752.3142451793&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="c1"&gt;// Define the strategy.&lt;/span&gt;
&lt;span class="k"&gt;typedef&lt;/span&gt; &lt;span class="n"&gt;formula&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;vincenty_direct&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;vincenty_direct_type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vincenty_direct_type&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;73.787500&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;2.179167&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;20001571.135&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;6.80724316&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;spheroid&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This gives us the latitude and longitude positions as 0.962372 and -76.9321, respectively. We again compare this with GeographicLib.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;GeographicLib/Geodesic.hpp&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="k"&gt;using&lt;/span&gt; &lt;span class="k"&gt;namespace&lt;/span&gt; &lt;span class="n"&gt;GeographicLib&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;Geodesic&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;geod&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Geodesic&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;WGS84&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;lat2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lon2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="n"&gt;geod&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Direct&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;2.179167&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;73.787500&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;6.80724316&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;20001571.135&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lat2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lon2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To use the &lt;code&gt;GeodSolve&lt;/code&gt; &lt;span class="caps"&gt;CLI&lt;/span&gt; tool, drop the &lt;code&gt;-i&lt;/code&gt; flag, which then defaults to the direct geodesic problem.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;GeodSolve &lt;span class="o"&gt;&amp;lt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="s2"&gt;"2.179167 -73.787500 6.80724316 20001571.135"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The resulting values for latitude and longitude positions are -2.16220000 and 106.13906400, respectively. Thus, we can see that the result provided by GeographicLib is almost identical to our input points (second pair), whereas, the result provided by Boost Geometry provides incorrect values.&lt;/p&gt;
&lt;h1&gt;Google Summer of Code 2018 project&lt;/h1&gt;
&lt;p&gt;Several issues have been raised over the past few years relating with the inaccuracy of geodesic algorithms implemented in Boost Geometry for nearly antipodal points. The related tickets / issues can be found at Boost &lt;span class="caps"&gt;SVN&lt;/span&gt; (&lt;a href="https://svn.boost.org/trac10/ticket/11917"&gt;#11917&lt;/a&gt;, &lt;a href="https://svn.boost.org/trac10/ticket/11929"&gt;#11929&lt;/a&gt;) and GitHub (&lt;a href="https://github.com/boostorg/geometry/issues/426"&gt;#426&lt;/a&gt;, &lt;a href="https://github.com/boostorg/geometry/issues/449"&gt;#449&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;&lt;a href="https://summerofcode.withgoogle.com/projects/#5333818521681920"&gt;This project&lt;/a&gt; has been selected as part of Google Summer of Code program under the &lt;a href="https://www.boost.org"&gt;Boost C++ organization&lt;/a&gt;. I will work under the supervision of my mentor &lt;a href="https://github.com/vissarion"&gt;Vissarion Fisikopoulos&lt;/a&gt; and co-mentor &lt;a href="https://github.com/awulkiew"&gt;Adam Wulkiewicz&lt;/a&gt;, and implement the method proposed by Charles Karney in his paper &lt;a href="https://arxiv.org/pdf/1109.4448.pdf"&gt;Algorithm for geodesics&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://docs.google.com/document/d/1PlFoX3d_gzhTYTlc8Bk0WGYOrKdGsU6Bb4K1gVKf9b4/edit?usp=sharing"&gt;project proposal&lt;/a&gt; goes into mathematical details of the algorithm along with the proposed timeline. During this period, I will provide my code in &lt;a href="https://github.com/BoostGSoC18/geometry"&gt;BoostGSoC18/geometry&lt;/a&gt; GitHub repository which will be later on merged with &lt;a href="https://github.com/boostorg/geometry"&gt;boostorg/geometry&lt;/a&gt; repository.&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content></entry><entry><title>Parallel tile fetching and CPU-and-memory statistics</title><link href="https://adl1995.github.io/parallel-tile-fetching-and-cpu-and-memory-statistics.html" rel="alternate"></link><published>2017-09-09T10:58:00+05:00</published><updated>2017-09-09T10:58:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2017-09-09:/parallel-tile-fetching-and-cpu-and-memory-statistics.html</id><summary type="html">&lt;p&gt;The &lt;a href="http://hips.readthedocs.io"&gt;hips&lt;/a&gt; package now supports parallel tile fetching. The user can achieve this either using &lt;a href="https://docs.python.org/3/library/urllib.html"&gt;urllib&lt;/a&gt; or &lt;a href="https://aiohttp.readthedocs.io/en/stable"&gt;aiohttp&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In case of &lt;a href="http://aiohttp.readthedocs.io/en/stable/"&gt;aiohttp&lt;/a&gt;, the fetched tile data is coupled with &lt;a href="http://hips.readthedocs.io/en/latest/api/hips.HipsTileMeta.html"&gt;&lt;code&gt;HipsTileMeta&lt;/code&gt;&lt;/a&gt; to create a &lt;a href="http://hips.readthedocs.io/en/latest/api/hips.HipsTile.html"&gt;&lt;code&gt;HipsTile&lt;/code&gt;&lt;/a&gt; object. This ensures there is no misalignment of tile data, otherwise, tiles could be swapped during …&lt;/p&gt;</summary><content type="html">&lt;p&gt;The &lt;a href="http://hips.readthedocs.io"&gt;hips&lt;/a&gt; package now supports parallel tile fetching. The user can achieve this either using &lt;a href="https://docs.python.org/3/library/urllib.html"&gt;urllib&lt;/a&gt; or &lt;a href="https://aiohttp.readthedocs.io/en/stable"&gt;aiohttp&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In case of &lt;a href="http://aiohttp.readthedocs.io/en/stable/"&gt;aiohttp&lt;/a&gt;, the fetched tile data is coupled with &lt;a href="http://hips.readthedocs.io/en/latest/api/hips.HipsTileMeta.html"&gt;&lt;code&gt;HipsTileMeta&lt;/code&gt;&lt;/a&gt; to create a &lt;a href="http://hips.readthedocs.io/en/latest/api/hips.HipsTile.html"&gt;&lt;code&gt;HipsTile&lt;/code&gt;&lt;/a&gt; object. This ensures there is no misalignment of tile data, otherwise, tiles could be swapped during the drawing period.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;async&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fetch_tile_aiohttp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;meta&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;HipsTileMeta&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;float&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;HipsTile&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="sd"&gt;"""Fetch a HiPS tile asynchronously using aiohttp."""&lt;/span&gt;
    &lt;span class="n"&gt;async&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;raw_data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;await&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;HipsTile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;meta&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;raw_data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We also limit the amount of simultaneously opened connections using &lt;a href="http://aiohttp.readthedocs.io/en/stable/client_reference.html#aiohttp.TCPConnector"&gt;&lt;code&gt;aiohttp.TCPConnector&lt;/code&gt;&lt;/a&gt; class. The returned object is passed to &lt;a href="http://aiohttp.readthedocs.io/en/stable/client_reference.html#aiohttp.ClientSession"&gt;&lt;code&gt;aiohttp.ClientSession&lt;/code&gt;&lt;/a&gt;‘s &lt;code&gt;__init__&lt;/code&gt; method. The whole procedure can be understood by the code block below:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;async&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fetch_all_tiles_aiohttp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tile_metas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;HipsTileMeta&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;hips_survey&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;HipsSurveyProperties&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;progress_bar&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;n_parallel&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;float&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;HipsTile&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
    &lt;span class="sd"&gt;"""Fetch HiPS tiles from a remote URL using aiohttp."""&lt;/span&gt;
    &lt;span class="n"&gt;connector&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;aiohttp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;TCPConnector&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;limit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;n_parallel&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;async&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;aiohttp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ClientSession&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;connector&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;connector&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;futures&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;meta&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;tile_metas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hips_survey&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tile_url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;meta&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;future&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;asyncio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ensure_future&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fetch_tile_aiohttp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;meta&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
            &lt;span class="n"&gt;futures&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Another recently added feature is progress bar reporting functionality using the &lt;a href="https://pypi.python.org/pypi/tqdm"&gt;tqdm&lt;/a&gt; package. This is achieved by wrapping &lt;a href="https://docs.python.org/3/library/asyncio-task.html#future"&gt;&lt;code&gt;asyncio.Future&lt;/code&gt;&lt;/a&gt; list in &lt;code&gt;tqdm&lt;/code&gt; function which triggers the progress bar once we &lt;code&gt;await&lt;/code&gt; on the object.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;progress_bar&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;tqdm&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;tqdm&lt;/span&gt;
    &lt;span class="n"&gt;futures&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tqdm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;futures&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tile_metas&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;desc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'Fetching tiles'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;tiles&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;future&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;futures&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;tiles&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;await&lt;/span&gt; &lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using parallel tile fetching, the overall fetch time is reduced by almost 75%**. The statistics shown below are for the high level &lt;a href="http://hips.readthedocs.io/en/latest/api/hips.make_sky_image.html"&gt;&lt;code&gt;make_sky_image&lt;/code&gt;&lt;/a&gt; function, the result of which can be seen on our &lt;a href="http://hips.readthedocs.io/en/latest/getting_started.html#gs"&gt;Getting started page&lt;/a&gt;. The response time using synchronous fetching is:&lt;/p&gt;
&lt;p&gt;&lt;img alt="tile-fetch-async" src="https://adl1995.github.io/images/tile-fetch-sync-scaled2.png" style="width: 760px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;After adding support for asynchronous fetching, the response time has enhanced:&lt;/p&gt;
&lt;p&gt;&lt;img alt="tile-fetch-sync" src="https://adl1995.github.io/images/tile-fetch-async-scaled2.png" style="width: 760px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;To monitor how this affects our &lt;span class="caps"&gt;CPU&lt;/span&gt; and memory usage, we make use of an open source package &lt;a href="https://github.com/astrofrog/psrecord"&gt;psrecord&lt;/a&gt;, which provides functionality on top of &lt;a href="https://github.com/giampaolo/psutil"&gt;psutil&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The package provides a command line interface which requires a process &lt;span class="caps"&gt;ID&lt;/span&gt; (&lt;span class="caps"&gt;PSID&lt;/span&gt;) to monitor its activity. It also provides facility for plotting the result using &lt;a href="http://matplotlib.org"&gt;matplotlib&lt;/a&gt;, in addition to the standard text log.&lt;/p&gt;
&lt;p&gt;&lt;img alt="plt-make-sky-image" src="https://adl1995.github.io/images/plot_make_sky_image.png" style="width: 800px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;To fully understand the above plot for &lt;code&gt;make_sky_image&lt;/code&gt; function, let’s look at the primary steps involved in &lt;a href="http://hips.readthedocs.io/en/latest/api/hips.HipsPainter.html"&gt;&lt;code&gt;HipsPainter&lt;/code&gt;&lt;/a&gt; class.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Asynchronously fetch the HiPS tiles&lt;/li&gt;
&lt;li&gt;Split the parent tile into four children tiles to fix the &lt;a href="https://adl1995.github.io/fixing-tile-distortion-issue-in-hips-package.html"&gt;tile distortion issue&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Apply projective transformation to each tile&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The entire process took around 50 seconds to finish execution, in which almost 40 seconds are dedicated to tile fetching. In the beginning, &lt;span class="caps"&gt;CPU&lt;/span&gt; consumption is high, which is due to the creation of threads and &lt;code&gt;Future&lt;/code&gt; objects. After this, the &lt;span class="caps"&gt;CPU&lt;/span&gt; consumption is almost idle for around 30 seconds, this is when we &lt;code&gt;await&lt;/code&gt; for the result.&lt;/p&gt;
&lt;p&gt;Towards the end, a large rise can be seen in both &lt;span class="caps"&gt;CPU&lt;/span&gt; and memory consumption, this is the drawing phase. As we apply projective transformation on each tile separately, the process is computationally expensive.&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://github.com/adl1995/HIPS-to-Py/blob/master/logs/activity_make_sky_image.txt"&gt;full activity text log&lt;/a&gt; can be viewed for a detailed analysis. A document containing &lt;a href="https://github.com/adl1995/HIPS-to-Py/blob/master/notes/response-times.md"&gt;response time comparison between urllib, grequests, aiohttp, and asyncio&lt;/a&gt; can be viewed as well. These response times were calculated using this &lt;a href="https://github.com/adl1995/HIPS-to-Py/blob/master/examples/fetch-tiles-threaded.py"&gt;Python script&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;** This percentage was calculated using &lt;code&gt;urllib&lt;/code&gt;&lt;/p&gt;</content></entry><entry><title>Google Summer of Code 2017 final evaluation report</title><link href="https://adl1995.github.io/google-summer-of-code-2017-final-evaluation-report.html" rel="alternate"></link><published>2017-08-28T22:35:00+05:00</published><updated>2017-08-28T22:35:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2017-08-28:/google-summer-of-code-2017-final-evaluation-report.html</id><summary type="html">&lt;h4&gt;Link to GitHub repository: &lt;a href="http://github.com/hipspy/hips"&gt;&lt;code&gt;http://github.com/hipspy/hips&lt;/code&gt;&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;In addition to the main &lt;a href="http://github.com/hipspy/hips"&gt;hips&lt;/a&gt; repository, I also maintained my personal &lt;a href="https://github.com/adl1995/HIPS-to-Py"&gt;&lt;span class="caps"&gt;HIPS&lt;/span&gt;-to-Py  repository on GitHub&lt;/a&gt;. This contains Jupyter notebooks which showcase the functionality in &lt;a href="http://github.com/hipspy/hips"&gt;hips&lt;/a&gt; and numerous related Python scripts. The &lt;a href="https://github.com/adl1995/HIPS-to-Py/wiki/HiPS-to-Py"&gt;Wiki page&lt;/a&gt; contains a short description on hips …&lt;/p&gt;</summary><content type="html">&lt;h4&gt;Link to GitHub repository: &lt;a href="http://github.com/hipspy/hips"&gt;&lt;code&gt;http://github.com/hipspy/hips&lt;/code&gt;&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;In addition to the main &lt;a href="http://github.com/hipspy/hips"&gt;hips&lt;/a&gt; repository, I also maintained my personal &lt;a href="https://github.com/adl1995/HIPS-to-Py"&gt;&lt;span class="caps"&gt;HIPS&lt;/span&gt;-to-Py  repository on GitHub&lt;/a&gt;. This contains Jupyter notebooks which showcase the functionality in &lt;a href="http://github.com/hipspy/hips"&gt;hips&lt;/a&gt; and numerous related Python scripts. The &lt;a href="https://github.com/adl1995/HIPS-to-Py/wiki/HiPS-to-Py"&gt;Wiki page&lt;/a&gt; contains a short description on hips. It also contains links to resource documents and telcon notes, which are hosted on Google Docs. &lt;/p&gt;
&lt;h4&gt;List of Pull Requests&lt;/h4&gt;
&lt;h6&gt;Work related with HiPS tile drawing&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/105"&gt;Add progress bar support for fetching and drawing HiPS tiles&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/104"&gt;Add reporting functionality for HipsPainter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/99"&gt;Introduce precise drawing algorithm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/75"&gt;Add methods for drawing markers over sky image&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/91"&gt;Introduce class HipsDrawResult in simple.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/89"&gt;Add method to_split in SimpleTilePainter for checking whether to split a tile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/73"&gt;Fix &lt;span class="caps"&gt;RGB&lt;/span&gt; dtype issue&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/66"&gt;Reformat SimpleTilePainter class&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/30"&gt;High-level function: make_sky_image&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/63"&gt;Add support for &lt;span class="caps"&gt;RGB&lt;/span&gt; tiles&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h6&gt;Work related with HiPS tiles&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/108"&gt;Make improvements to parallel tile fetching&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/106"&gt;Introduce asynchronous fetching of HiPS tiles&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/101"&gt;Fix tile splitting criterion&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/85"&gt;Add property ‘children’ for creating four children tiles from parent tile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/56"&gt;Remove tile_width from HipsTileMeta&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/55"&gt;Add test for &lt;span class="caps"&gt;PNG&lt;/span&gt; tiles&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/37"&gt;Add &lt;span class="caps"&gt;WCS&lt;/span&gt; property in HipsTile class&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/24"&gt;Add HipsTile and HipsTileMeta classes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/21"&gt;Add tiles.hipsdescription module&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/52"&gt;Update tile_access_url method&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/67"&gt;Fix tile width height issue&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h6&gt;Work related with WCSGeometry&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/102"&gt;Reformat docstring for create_from_dict class method&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/100"&gt;Add classmethod create_from_dict in WCSGeometry class&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/49"&gt;Add classmethod create_simple to WCSGeometry&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h6&gt;Work related with HEALPix and HiPS utility functions&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/58"&gt;Add function for computing HiPS order&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/50"&gt;Make improvements to compute_healpix_pixel_indices utility function&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/26"&gt;Add compute_image_pixels function in hips.utils&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/19"&gt;Add utils.healpix module&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h6&gt;Work related with HiPS Surveys&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/95"&gt;Add option to create HipsSurveyProperties from survey name&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/77"&gt;Fix tile_width property in HipsSurveyProperties class&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/60"&gt;Update base_url property in HipsSurveyProperties class&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/27"&gt;Add class HipsSurveyList for parsing list of hips surveys&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h6&gt;Documentation changes&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/68"&gt;Add plot for image in high level docs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/34"&gt;Add documentation on HIPS_EXTRA environment variable&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/22"&gt;Update docstring&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/14"&gt;Update Sphinx docs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/13"&gt;Sphinx update&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/12"&gt;Sphinx update&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h6&gt;Miscellaneous&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/87"&gt;Remove print statement from test case&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/48"&gt;Fix typo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/38"&gt;Rename data to raw_data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/10"&gt;Update Makefile to use python3 command&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/8"&gt;Update simple.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/11"&gt;Add skeleton class TileFileCache&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/pull/33"&gt;Outline first draft of HipsTileCache class&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;List of commits&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/98ff03be7cd921b06f4ebb77fa2cd7db7124e3ca"&gt;&lt;code&gt;Restructure high level function fetch_tiles&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/d7979afd03c5376c4cd1216e6b20c5e2ee3b7627"&gt;&lt;code&gt;Add timeout and n_parallel option to tiles_aiohttp function&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/d27168bce994e772302636facb30fd7482c82023"&gt;&lt;code&gt;Add example section for fetch_tiles function docstring&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/1116a7a81b01295e5aac21cfdd9e044accf258c2"&gt;&lt;code&gt;Update aiohttp dependency config&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/e5118522ba544bab164116a01b1a87a8c3c4f5a2"&gt;&lt;code&gt;Add tqdm progress bar to urllib and aiohttp fetch methods&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/0eba105e1822e0e50645344e1839e8ec48d5d6de"&gt;&lt;code&gt;Add option to fetch tiles asynchronously using urllib&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/6c1295814affecd4abe5e2c6e44e22df24ae3ae6"&gt;&lt;code&gt;Introduce asynchronous fetching of HiPS tiles&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/25dd9ef7f46e21876968ec784a93f2c14df9c0c4"&gt;&lt;code&gt;Update .travis.yml&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/88f4293f12ba0173bc86ad6e39223b5aff04e4ae"&gt;&lt;code&gt;Update getting started example to contain information on progress bar&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/e2c9c69989072fffb6271b43273fee65d186e274"&gt;&lt;code&gt;Make tqdm an optional dependency&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/ba813ef65fe503bb879927fd25f2975c1a735176"&gt;&lt;code&gt;Add progress bar support for fetching and drawing HiPS tiles&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/c026c96aa19e46f66a8e84a1c3429476c2803bb4"&gt;&lt;code&gt;Add reporting functionality for HipsPainter&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/0981f309aade1f33e0586341108dfff0fd108ab2"&gt;&lt;code&gt;Reformat docstring for create_from_dict class method&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/8140f2943de907bc6bd45f6a06d337b781dd6ff1"&gt;&lt;code&gt;Fix tile splitting criterion&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/b447864b37ea070f2b8b2662ac0797cc2f151c76"&gt;&lt;code&gt;Update test case for create_from_dict classmethod&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/651a5ae14a8896ca81558d9f084a9afe764bdd44"&gt;&lt;code&gt;Add classmethod create_from_dict in WCSGeometry class&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/1980881927671773de80051ea78b79bdac61a484"&gt;&lt;code&gt;Introduce precise drawing algorithm&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/09906ec66668c829a9ca0375840e77090d50de2a"&gt;&lt;code&gt;Add option to create HipsSurveyProperties from survey name&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/821f335f3f6c5ba912bcfdbf2ea55e1d51e6be82"&gt;&lt;code&gt;Update high-level docs example&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/c15092b116d5b02b601a2c087ef6a80fb82107d2"&gt;&lt;code&gt;Add method write_image in HipsDrawResult class&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/eddcaaa07028e59d2d8e8567cbf073d30bbd9ada"&gt;&lt;code&gt;Introduce class HipsDrawResult in simple.py&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/808e758d2cd9c04c31e0dc49318cf55d4f92cd18"&gt;&lt;code&gt;Add method to_split in SimpleTilePainter for checking whether to split a tile&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/e08ddcdf3c655021d5a0b96bb26ad50577e0e02a"&gt;&lt;code&gt;Add property 'children' for creating four children tiles from parent tile&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/9005878e851ee8f64ac498599bba8737a1fd83f4"&gt;&lt;code&gt;Add methods for drawing markers over sky image&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/46c78a036dec051bb9e6fb75adbf7fcd6a585301"&gt;&lt;code&gt;Fix tile_width property in HipsSurveyProperties class&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/6139a0bf4047b303a01fefb61ef5288de55486c6"&gt;&lt;code&gt;Fix RGB dtype issue&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/eb5cd378624001de9588a4eb7095361b1f9b94d5"&gt;&lt;code&gt;Reformat SimpleTilePainter class&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/e2541ae378982e9261dde09ed7b389a8d4b1b47b"&gt;&lt;code&gt;Add plot in high level docs&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/af4eb6f7cac27c06f60468912388dd2f33a3b851"&gt;&lt;code&gt;Fix tile width height issue&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/8ca56a7036540d528fb891a811a9bec901086aa3"&gt;&lt;code&gt;Add support for RGB tiles&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/10ada966037b2a71aec42b3c85a9773d2bab6a48"&gt;&lt;code&gt;Update base_url property in HipsSurveyProperties class&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/c853878ab027abf70b2f771796ff7ae98c37c6f3"&gt;&lt;code&gt;Add test case for get_order function&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/e1955f6ef699669ff4209cf9a72d26488af6154e"&gt;&lt;code&gt;Add function for computing HiPS order&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/8cdd34cad90facf9348d9bf7014260e9f75aae77"&gt;&lt;code&gt;Add classmethod create_simple to WCSGeometry&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/439bd58bc190c9d957ce4fce9e0acf9c45a40537"&gt;&lt;code&gt;Remove tile_width from HipsTileMeta&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/18fc6b656fe873955c10d7505c207cfed030615f"&gt;&lt;code&gt;Refactor test cases for HipsTile&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/b0f8d4daa85e32a07677522f948b7a9925b07ef7"&gt;&lt;code&gt;Add test for PNG tiles&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/f7aa6c9aa4e6bee51dab7801d7910f02b69dc0eb"&gt;&lt;code&gt;Update tile_access_url method&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/f746d04e6a3cbe73c4c8ce6b8a32d3020c83bce5"&gt;&lt;code&gt;Make improvements to compute_healpix_pixel_indices utility function&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/3121de53a68eabea67fdce9eae1a26412484edaf"&gt;&lt;code&gt;Fix typo&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/880d4a2e9e9ce31e86b508750bc65ea33f4a3b4b"&gt;&lt;code&gt;Add test case test_wcs_healpix_pixel_indices&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/5fe3ed0aa5be6544a1b71b786f0014df626d1b21"&gt;&lt;code&gt;Some code reformatting&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/145bcafab6c47ced08191a45f1feaa69907da4a8"&gt;&lt;code&gt;Add attribute frames in HipsSurveyProperties&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/5c85e128e37e4c0cc86166e08fc13b1d51e3a5c0"&gt;&lt;code&gt;Add property tile_access_url in HipsSurveyProperties&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/a4b6846ef107572e7b542114b731089346c3b1f5"&gt;&lt;code&gt;Remove attribute self.pt from SimpleTilePainter&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/69e09af162b071c3a1f271883ebf51fd00aceee5"&gt;&lt;code&gt;Skip example from doctest&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/112fb37cd4514e84449be3e3543164cc4f171383"&gt;&lt;code&gt;Update example for HipsTileMeta&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/c34d4061a05eae864ae8de05b7fd639da36910dc"&gt;&lt;code&gt;Update requires_hips_extra decorator function&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/451b32a2985b55fad3bb2a0de8eb25ff3c75b218"&gt;&lt;code&gt;Update read classmethod in HipsTile class&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/186286c3a64f92ee1f9a50b053e5bc9724dd438f"&gt;&lt;code&gt;Update test_skycoord_corners in TestHipsTileMeta&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/de5566394997a6a2d7a87e548f12b3b179aa1f53"&gt;&lt;code&gt;Add function frames in utils/healpix.py&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/a9b0984a670a624b791fc99f11e93972edf97aad"&gt;&lt;code&gt;Rename draw_tile to painter&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/a0ad4cb044373e879a2d88b5559de91c91557e19"&gt;&lt;code&gt;Rename all_sky to sky_sky&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/9b79b9d19c6faa8f1bf5386076af04dc3340e995"&gt;&lt;code&gt;Update test_skycoord_corners in TestHipsTileMeta&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/3c8204abecb09c62748100cdac40d0b33def4513"&gt;&lt;code&gt;Add property projection in SimpleTilePainter&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/a7d4ba4faf0dd826e94181a5ecd092036fdb12bd"&gt;&lt;code&gt;Update test case for HipsTileMeta class&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/2846fca6dd4eb6027b428920f8a81940c1e5a881"&gt;&lt;code&gt;Merge HipsTile and HipsTileMeta within same file&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/309a75a2c1b468dcd7e5969d2bd01f60f6a9005e"&gt;&lt;code&gt;Pass fits_header to fits.PrimaryHDU function&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/a0759cbe24b41ac50a86165db4438d474385291f"&gt;&lt;code&gt;Remove test case for SimpleTilePainter class&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/4571dd88dbd34a408ed934cb47cddfa752642119"&gt;&lt;code&gt;Add comment on data type conversion&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/9e073c9370924fb0651db0c97631e53635b17abd"&gt;&lt;code&gt;Remove docstring&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/9f2e5fac6222fdaa6ddde8a1d6d973fe782968d6"&gt;&lt;code&gt;Add test case for HipsTileMeta&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/69ae7642417b6b76796a448b9b9a3f4b387a9021"&gt;&lt;code&gt;Add function apply_projection in SimpleTilePainter&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/c7d5db5d8c54bb91fd3e91fd24d3991215bcdc1a"&gt;&lt;code&gt;Remove function apply_projection from HipsTileMeta&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/bee4bcd0542657c74b040947ec20a6d9ab41edc3"&gt;&lt;code&gt;Document frame parameter in HipsTileMeta&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/9c5e687cf2948241dd13cedfe0ec79aba0389f38"&gt;&lt;code&gt;Add missing import&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/9c82bc4c642c9417659ade65653490a39294b797"&gt;&lt;code&gt;Use assert_allclose instead of assert&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/8adff08b687c280f302df01bd8d1306a5e0a4008"&gt;&lt;code&gt;Update drawing code&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/1f67310f98e5b873d6309928f428c66245ce3ba9"&gt;&lt;code&gt;Add function apply_projection in HipsTileMeta&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/05b8ac8e97467576883da6c2dbd2be786ead4e73"&gt;&lt;code&gt;Add test case for access_url property&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/f7625a909254992cb4bbd0fc4ba7237bead65e8a"&gt;&lt;code&gt;Add property access_url in HipsSurveyProperties&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/a32ba1b946c22c81d41bc8291206d90134d123d2"&gt;&lt;code&gt;Add example in Getting Started page&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/42ceb7af3d271bf60cd82f6b49136d1fe4bb3920"&gt;&lt;code&gt;Get HiPS order from HipsSurveyProperties class&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/e487e44c68b8b4a8da44fc9fb82d932767abc471"&gt;&lt;code&gt;Update drawing code&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/c3d3d2729a4467667793af560df9b6c371625360"&gt;&lt;code&gt;Fix link to WCSGeometry class in docs&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/1e4bb3b268f7b5893c5279a472d88b26fb4ecafc"&gt;&lt;code&gt;Add property skycoord_corner to HipsTileMeta&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/7897504b97bc594d55aa23182af76dfd29ab152d"&gt;&lt;code&gt;Fix drawing code&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/53a0df576c6f1be0659cd4927609ae134cdb3643"&gt;&lt;code&gt;Reformat some code&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/243ef55f752c701c94f4b3736c20524f62b560a1"&gt;&lt;code&gt;Add dst property in HipsTileMeta class&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/3acf68e070ceeac9cce7e86c89f3c0350ed478aa"&gt;&lt;code&gt;Update corner computation&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/c838f6412cfeddea00d8449ee048d0429ed6a09d"&gt;&lt;code&gt;Update drawing code&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/91e7e394a4f7bf363122703f55048ddcfee5118b"&gt;&lt;code&gt;Store FITS data as float type&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/818a9102b3f12ab61ed13d3987b31b227719a700"&gt;&lt;code&gt;Update drawing function&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/120ff07dd6b4cd13bcd0131927746fab7dbb7f7d"&gt;&lt;code&gt;Add skeleton of drawing code&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/1dcc81164f456a9bd4fa7f7905630c94c429d308"&gt;&lt;code&gt;Merge branch 'master' of https://github.com/hipspy/hips into tiles.draw&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/a3f7261fe255ac8a6904741f576d99bddeba3ffd"&gt;&lt;code&gt;Add documentation on HIPS_EXTRA environment variable&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/8add0250a612c22b9a5ecb5dbd4ce9e4a9369f89"&gt;&lt;code&gt;Add function make_sky_image&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/449e4df92ed21259d527e9b2fb325ae708e46045"&gt;&lt;code&gt;Add class HipsSurveyList for parsing list of hips surveys&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/0bdb052115291c0657841c6becf973cec2ff59d6"&gt;&lt;code&gt;Fix type annotation issue&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/1136490773612a0601b06b5c8a644d728f0f659b"&gt;&lt;code&gt;Update tiles.hips module&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/5db3ef2ae3c3958ae86906e840c4bc4793845adf"&gt;&lt;code&gt;Update tiles.hips module&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/9d2ef083c0dc9b73fb00e4228daf3179ca482348"&gt;&lt;code&gt;Refactor some code&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/616340bd6c87cb070d324b1631ced8cbe76654b8"&gt;&lt;code&gt;Add class HipsTileMeta and update test case&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/6250e9ec0c665151a84403d986a4b71a804ea632"&gt;&lt;code&gt;Minimize HipsTile classs functionality&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/12f0b4fe059cdd29ecb1f37956320570c87791b8"&gt;&lt;code&gt;Use / instead of joinpath&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/2876957883d4eacc7984fa554dc176b75f35c1ad"&gt;&lt;code&gt;Change path opening method&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/b937d1486e2c67c2519c8b572b43e899536ca24c"&gt;&lt;code&gt;Update tiles.hips module&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/7869a5d5e36a1bd2219b5b9212b2dcd68ffc77f9"&gt;&lt;code&gt;Add tile_width property to HipsTile&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/27cca875b322df5a4b0a9caa01d081f9fb3054b0"&gt;&lt;code&gt;Update tiles.hips module&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/b5a268688e48d775a6aceb82898af8fc745c3b9f"&gt;&lt;code&gt;Update tiles.hips module&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/1f0b0dfb873e83e3af0d432e49a245ec650636da"&gt;&lt;code&gt;Remove blank lines and docstring&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/6826c7b9f97f45b2ce62b6f700a7a8758c9661a3"&gt;&lt;code&gt;Update .gitignore to ignore Mypy cache directory&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/a16a78f789b5f96f814a8856f503f979693202cb"&gt;&lt;code&gt;Add tiles.hips package&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/0ffe20e0ea787f11df65cd384c63e03c522aa514"&gt;&lt;code&gt;Update hips.utils package&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/8f3139dfd23e9624e4cd9dafd412889cc49a340e"&gt;&lt;code&gt;Update hips.utils package&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/81d74de79ec5971d0e528a3f5c2d8e0e21fc7e0a"&gt;&lt;code&gt;Add classmethod for creating a WCS object&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/5f52d62d5402080dcd271b106670d86878856f3b"&gt;&lt;code&gt;Add class WCSGeometry&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/6e2dd380d3d397e08a2e0f79489d10756a876787"&gt;&lt;code&gt;Add compute_image_pixels function in hips.utils&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/d369652b5edc9cda4705d0199a862bd8d226f526"&gt;&lt;code&gt;Update class docstring&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/a245521987a4971aaa70f842bb045f72512c760e"&gt;&lt;code&gt;Update tiles.hipsdescription module&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/dae30ac9cff524a0dc64bb638c5e6b62bc4011d4"&gt;&lt;code&gt;Update class docstring&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/fbf89687c9e5f6dab8b0de8a638abaf433ec6a87"&gt;&lt;code&gt;Update tiles.hipsdescription module&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/69a91f0a35369ccd018990746b2f830d0ecb74d8"&gt;&lt;code&gt;Remove whitespace&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/8c235c2ebe5861aa2ea213ff4fe0f5d7f7c89d99"&gt;&lt;code&gt;Update docstring&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/45b4117c3e85bb6fac72aeb790dfa483c03f0b12"&gt;&lt;code&gt;Add entry in api.rst&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/ff3299abeb476ffb1937b6647f6bdae26d659e34"&gt;&lt;code&gt;Add tiles.hipsdescription module&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/0b1359036a1436551234dd21ce47149c533c1bea"&gt;&lt;code&gt;Update utils.healpix module&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/fa832132c016e7285d24abe58d1438fff27e649b"&gt;&lt;code&gt;Add example&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/5de3e05971f7570eeb4402a266e8918b14d9e9ca"&gt;&lt;code&gt;Update test case&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/aca32b631e949222e88bfc48ff25b1ecaa28f3cd"&gt;&lt;code&gt;Update formatting&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/9da1f1fd3e79a552839bff00fc814396dcba7920"&gt;&lt;code&gt;Add newline&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/bbb48be4b0c77180fa34de83a2b6a3614639e3c1"&gt;&lt;code&gt;Update utils.healpix module&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/e4c00b949e0ca03f06c115927256f0539cdde9ad"&gt;&lt;code&gt;Add utils.healpix module&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/53a607b4fa0031fe3fedd0b6bf89ba03436d715a"&gt;&lt;code&gt;Update Sphinx docs&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/c7224fe181a18d041513973f043337e3d5af33fc"&gt;&lt;code&gt;Update Makefile to use python3 command&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/hipspy/hips/commit/c5942b52a60a45dbe05e154dc381dd8ef3d2b46c"&gt;&lt;code&gt;Update simple.py&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;List of commit diffs&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;commit 98ff03be7cd921b06f4ebb77fa2cd7db7124e3ca
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Aug 28 20:49:24 2017 +0500

    Restructure high level function fetch_tiles

&lt;span class="gh"&gt;diff --git a/hips/tiles/fetch.py b/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gh"&gt;index 5c6063a..1af267c 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -75,83 +75,83 @@ def fetch_tiles(tile_metas: List[HipsTileMeta], hips_survey: HipsSurveyPropertie&lt;/span&gt;
     else:
         raise ValueError(f'Invalid package name: {fetch_package}')

&lt;span class="gd"&gt;-    tiles = fetch_fct(tile_metas, hips_survey, progress_bar, n_parallel, timeout)&lt;/span&gt;
&lt;span class="gi"&gt;+    _tile_urls = tile_urls(tile_metas, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    response_all = fetch_fct(_tile_urls, hips_survey, progress_bar, n_parallel, timeout)&lt;/span&gt;

     # Sort tiles to match the tile_meta list
     # TODO: this doesn't seem like a great solution.
     # Use OrderedDict instead?
&lt;span class="gd"&gt;-    out = []&lt;/span&gt;
&lt;span class="gd"&gt;-    for tile_meta in tile_metas:&lt;/span&gt;
&lt;span class="gd"&gt;-        for tile in tiles:&lt;/span&gt;
&lt;span class="gd"&gt;-            if tile.meta == tile_meta:&lt;/span&gt;
&lt;span class="gd"&gt;-                out.append(tile)&lt;/span&gt;
&lt;span class="gd"&gt;-                continue&lt;/span&gt;
&lt;span class="gd"&gt;-    return out&lt;/span&gt;
&lt;span class="gi"&gt;+    tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+    for tile_url in _tile_urls:&lt;/span&gt;
&lt;span class="gi"&gt;+        for idx, response in enumerate(response_all):&lt;/span&gt;
&lt;span class="gi"&gt;+            if response['url'] == tile_url:&lt;/span&gt;
&lt;span class="gi"&gt;+                tiles.append(HipsTile(tile_metas[idx], response['raw_data']))&lt;/span&gt;

&lt;span class="gi"&gt;+    return tiles&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def tile_urls(tile_metas: List[HipsTileMeta], hips_survey: HipsSurveyProperties) -&amp;gt; List[str]:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Retrun list of tile URLs"""&lt;/span&gt;
&lt;span class="gi"&gt;+    return [hips_survey.tile_url(meta) for meta in tile_metas]&lt;/span&gt;

&lt;span class="gd"&gt;-def fetch_tile_urllib(url: str, meta: HipsTileMeta, timeout: float) -&amp;gt; HipsTile:&lt;/span&gt;
&lt;span class="gi"&gt;+def fetch_tile_urllib(url: str, timeout: float) -&amp;gt; dict:&lt;/span&gt;
     """Fetch a HiPS tile asynchronously."""
     with urllib.request.urlopen(url, timeout=timeout) as conn:
&lt;span class="gd"&gt;-        raw_data = conn.read()&lt;/span&gt;
&lt;span class="gd"&gt;-        return HipsTile(meta, raw_data)&lt;/span&gt;
&lt;span class="gi"&gt;+        return {'raw_data': conn.read(), 'url': url}&lt;/span&gt;


&lt;span class="gd"&gt;-def tiles_urllib(tile_metas: List[HipsTileMeta], hips_survey: HipsSurveyProperties,&lt;/span&gt;
&lt;span class="gd"&gt;-                 progress_bar: bool, n_parallel, timeout: float) -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gi"&gt;+def tiles_urllib(tile_urls: List[str], hips_survey: HipsSurveyProperties,&lt;/span&gt;
&lt;span class="gi"&gt;+                 progress_bar: bool, n_parallel, timeout: float) -&amp;gt; List[dict]:&lt;/span&gt;
     """Generator function to fetch HiPS tiles from a remote URL."""
     with concurrent.futures.ThreadPoolExecutor(max_workers=n_parallel) as executor:
         futures = []
&lt;span class="gd"&gt;-        for meta in tile_metas:&lt;/span&gt;
&lt;span class="gd"&gt;-            url = hips_survey.tile_url(meta)&lt;/span&gt;
&lt;span class="gd"&gt;-            future = executor.submit(fetch_tile_urllib, url, meta, timeout)&lt;/span&gt;
&lt;span class="gi"&gt;+        for url in tile_urls:&lt;/span&gt;
&lt;span class="gi"&gt;+            future = executor.submit(fetch_tile_urllib, url, timeout)&lt;/span&gt;
             futures.append(future)

         futures = concurrent.futures.as_completed(futures)
         if progress_bar:
             from tqdm import tqdm
&lt;span class="gd"&gt;-            futures = tqdm(futures, total=len(tile_metas), desc='Fetching tiles')&lt;/span&gt;
&lt;span class="gi"&gt;+            futures = tqdm(futures, total=len(tile_urls), desc='Fetching tiles')&lt;/span&gt;

&lt;span class="gd"&gt;-        tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+        response_all = []&lt;/span&gt;
         for future in futures:
&lt;span class="gd"&gt;-            tiles.append(future.result())&lt;/span&gt;
&lt;span class="gi"&gt;+            response_all.append(future.result())&lt;/span&gt;

&lt;span class="gd"&gt;-    return tiles&lt;/span&gt;
&lt;span class="gi"&gt;+    return response_all&lt;/span&gt;


&lt;span class="gd"&gt;-async def fetch_tile_aiohttp(url: str, meta: HipsTileMeta, session, timeout: float) -&amp;gt; HipsTile:&lt;/span&gt;
&lt;span class="gi"&gt;+async def fetch_tile_aiohttp(url: str, session, timeout: float) -&amp;gt; dict:&lt;/span&gt;
     """Fetch a HiPS tile asynchronously using aiohttp."""
     async with session.get(url, timeout=timeout) as response:
&lt;span class="gd"&gt;-        raw_data = await response.read()&lt;/span&gt;
&lt;span class="gd"&gt;-        return HipsTile(meta, raw_data)&lt;/span&gt;
&lt;span class="gi"&gt;+        return {'raw_data': await response.read(), 'url': url}&lt;/span&gt;


&lt;span class="gd"&gt;-async def fetch_all_tiles_aiohttp(tile_metas: List[HipsTileMeta], hips_survey: HipsSurveyProperties,&lt;/span&gt;
&lt;span class="gd"&gt;-                                  progress_bar: bool, n_parallel: int, timeout: float) -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gi"&gt;+async def fetch_all_tiles_aiohttp(tile_urls: List[str], hips_survey: HipsSurveyProperties,&lt;/span&gt;
&lt;span class="gi"&gt;+                                  progress_bar: bool, n_parallel: int, timeout: float) -&amp;gt; List[dict]:&lt;/span&gt;
     """Generator function to fetch HiPS tiles from a remote URL using aiohttp."""
     import aiohttp

     connector = aiohttp.TCPConnector(limit=n_parallel)
     async with aiohttp.ClientSession(connector=connector) as session:
         futures = []
&lt;span class="gd"&gt;-        for meta in tile_metas:&lt;/span&gt;
&lt;span class="gd"&gt;-            url = hips_survey.tile_url(meta)&lt;/span&gt;
&lt;span class="gd"&gt;-            future = asyncio.ensure_future(fetch_tile_aiohttp(url, meta, session, timeout))&lt;/span&gt;
&lt;span class="gi"&gt;+        for url in tile_urls:&lt;/span&gt;
&lt;span class="gi"&gt;+            future = asyncio.ensure_future(fetch_tile_aiohttp(url, session, timeout))&lt;/span&gt;
             futures.append(future)

         futures = asyncio.as_completed(futures)
         if progress_bar:
             from tqdm import tqdm
&lt;span class="gd"&gt;-            futures = tqdm(futures, total=len(tile_metas), desc='Fetching tiles')&lt;/span&gt;
&lt;span class="gi"&gt;+            futures = tqdm(futures, total=len(tile_urls), desc='Fetching tiles')&lt;/span&gt;

&lt;span class="gd"&gt;-        tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+        response_all = []&lt;/span&gt;
         for future in futures:
&lt;span class="gd"&gt;-            tiles.append(await future)&lt;/span&gt;
&lt;span class="gi"&gt;+            response_all.append(await future)&lt;/span&gt;

&lt;span class="gd"&gt;-    return tiles&lt;/span&gt;
&lt;span class="gi"&gt;+    return response_all&lt;/span&gt;


&lt;span class="gd"&gt;-def tiles_aiohttp(tile_metas: List[HipsTileMeta], hips_survey: HipsSurveyProperties,&lt;/span&gt;
&lt;span class="gd"&gt;-                  progress_bar: bool, n_parallel: int, timeout: float) -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gi"&gt;+def tiles_aiohttp(tile_urls: List[str], hips_survey: HipsSurveyProperties,&lt;/span&gt;
&lt;span class="gi"&gt;+                  progress_bar: bool, n_parallel: int, timeout: float) -&amp;gt; List[dict]:&lt;/span&gt;
     return asyncio.get_event_loop().run_until_complete(
&lt;span class="gd"&gt;-        fetch_all_tiles_aiohttp(tile_metas, hips_survey, progress_bar, n_parallel, timeout)&lt;/span&gt;
&lt;span class="gi"&gt;+        fetch_all_tiles_aiohttp(tile_urls, hips_survey, progress_bar, n_parallel, timeout)&lt;/span&gt;
     )

commit d7979afd03c5376c4cd1216e6b20c5e2ee3b7627
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Aug 25 20:35:59 2017 +0500

    Add timeout and n_parallel option to tiles_aiohttp function

&lt;span class="gh"&gt;diff --git a/hips/tiles/fetch.py b/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8a8c004..54a5729 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -118,40 +118,40 @@ def tiles_urllib(tile_metas: List[HipsTileMeta], hips_survey: HipsSurveyProperti&lt;/span&gt;
     return tiles


&lt;span class="gd"&gt;-async def fetch_tile_aiohttp(url: str, meta: HipsTileMeta, session) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gi"&gt;+async def fetch_tile_aiohttp(url: str, meta: HipsTileMeta, session, timeout: float) -&amp;gt; Generator:&lt;/span&gt;
     """Fetch a HiPS tile asynchronously using aiohttp."""
&lt;span class="gd"&gt;-    async with session.get(url) as response:&lt;/span&gt;
&lt;span class="gi"&gt;+    async with session.get(url, timeout=timeout) as response:&lt;/span&gt;
         raw_data = await response.read()
         return HipsTile(meta, raw_data)


&lt;span class="gd"&gt;-async def fetch_all_tiles_aiohttp(tile_metas: List[HipsTileMeta],&lt;/span&gt;
&lt;span class="gd"&gt;-                                  hips_survey: HipsSurveyProperties, progress_bar: bool) -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gi"&gt;+async def fetch_all_tiles_aiohttp(tile_metas: List[HipsTileMeta], hips_survey: HipsSurveyProperties,&lt;/span&gt;
&lt;span class="gi"&gt;+                                  progress_bar: bool, n_parallel: int, timeout: float) -&amp;gt; List[HipsTile]:&lt;/span&gt;
     """Generator function to fetch HiPS tiles from a remote URL using aiohttp."""
     import aiohttp

&lt;span class="gd"&gt;-    async with aiohttp.ClientSession() as session:&lt;/span&gt;
&lt;span class="gd"&gt;-        futures = []&lt;/span&gt;
&lt;span class="gd"&gt;-        for meta in tile_metas:&lt;/span&gt;
&lt;span class="gd"&gt;-            url = hips_survey.tile_url(meta)&lt;/span&gt;
&lt;span class="gd"&gt;-            future = asyncio.ensure_future(fetch_tile_aiohttp(url, meta, session))&lt;/span&gt;
&lt;span class="gd"&gt;-            futures.append(future)&lt;/span&gt;
&lt;span class="gi"&gt;+    with await asyncio.Semaphore(n_parallel):&lt;/span&gt;
&lt;span class="gi"&gt;+        async with aiohttp.ClientSession() as session:&lt;/span&gt;
&lt;span class="gi"&gt;+            futures = []&lt;/span&gt;
&lt;span class="gi"&gt;+            for meta in tile_metas:&lt;/span&gt;
&lt;span class="gi"&gt;+                url = hips_survey.tile_url(meta)&lt;/span&gt;
&lt;span class="gi"&gt;+                future = asyncio.ensure_future(fetch_tile_aiohttp(url, meta, session, timeout))&lt;/span&gt;
&lt;span class="gi"&gt;+                futures.append(future)&lt;/span&gt;

&lt;span class="gd"&gt;-        futures = asyncio.as_completed(futures)&lt;/span&gt;
&lt;span class="gd"&gt;-        if progress_bar:&lt;/span&gt;
&lt;span class="gd"&gt;-            from tqdm import tqdm&lt;/span&gt;
&lt;span class="gd"&gt;-            futures = tqdm(futures, total=len(tile_metas), desc='Fetching tiles')&lt;/span&gt;
&lt;span class="gi"&gt;+            futures = asyncio.as_completed(futures)&lt;/span&gt;
&lt;span class="gi"&gt;+            if progress_bar:&lt;/span&gt;
&lt;span class="gi"&gt;+                from tqdm import tqdm&lt;/span&gt;
&lt;span class="gi"&gt;+                futures = tqdm(futures, total=len(tile_metas), desc='Fetching tiles')&lt;/span&gt;

&lt;span class="gd"&gt;-        tiles = []&lt;/span&gt;
&lt;span class="gd"&gt;-        for future in futures:&lt;/span&gt;
&lt;span class="gd"&gt;-            tiles.append(await future)&lt;/span&gt;
&lt;span class="gi"&gt;+            tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+            for future in futures:&lt;/span&gt;
&lt;span class="gi"&gt;+                tiles.append(await future)&lt;/span&gt;

     return tiles


 def tiles_aiohttp(tile_metas: List[HipsTileMeta], hips_survey: HipsSurveyProperties,
                   progress_bar: bool, n_parallel: int = 10, timeout: float = 10) -&amp;gt; List[HipsTile]:
&lt;span class="gd"&gt;-    # TODO: implement n_parallel and timeout&lt;/span&gt;
     return asyncio.get_event_loop().run_until_complete(
&lt;span class="gd"&gt;-        fetch_all_tiles_aiohttp(tile_metas, hips_survey, progress_bar)&lt;/span&gt;
&lt;span class="gi"&gt;+        fetch_all_tiles_aiohttp(tile_metas, hips_survey, progress_bar, n_parallel, timeout)&lt;/span&gt;
     )

commit d27168bce994e772302636facb30fd7482c82023
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Aug 22 18:31:40 2017 +0500

    Add example section for fetch_tiles function docstring

&lt;span class="gh"&gt;diff --git a/hips/draw/paint.py b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index 502a9e8..69fbc87 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -37,7 +37,8 @@ class HipsPainter:&lt;/span&gt;
     progress_bar : bool
         Show a progress bar for tile fetching and drawing
     fetch_opts : dict
&lt;span class="gd"&gt;-        Keyword arguments for fetching HiPS tiles&lt;/span&gt;
&lt;span class="gi"&gt;+        Keyword arguments for fetching HiPS tiles. To see the&lt;/span&gt;
&lt;span class="gi"&gt;+        list of passable arguments, refer to `~fetch_tiles`&lt;/span&gt;

     Examples
     --------
&lt;span class="gu"&gt;@@ -127,7 +128,7 @@ class HipsPainter:&lt;/span&gt;

         if self._tiles is None:
             self._tiles = fetch_tiles(tile_metas=tile_metas, hips_survey=self.hips_survey,
&lt;span class="gd"&gt;-                                      progress_bar=self.progress_bar, **self.fetch_opts)&lt;/span&gt;
&lt;span class="gi"&gt;+                                      progress_bar=self.progress_bar, **(self.fetch_opts or {}))&lt;/span&gt;

         return self._tiles

&lt;span class="gh"&gt;diff --git a/hips/draw/ui.py b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gh"&gt;index e950d40..1b25e8e 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -34,7 +34,8 @@ def make_sky_image(geometry: Union[dict, WCSGeometry], hips_survey: Union[str, '&lt;/span&gt;
     progress_bar : bool
         Show a progress bar for tile fetching and drawing
     fetch_opts : dict
&lt;span class="gd"&gt;-        Keyword arguments for fetching HiPS tiles&lt;/span&gt;
&lt;span class="gi"&gt;+        Keyword arguments for fetching HiPS tiles. To see the&lt;/span&gt;
&lt;span class="gi"&gt;+        list of passable arguments, refer to `~hips.fetch_tiles`&lt;/span&gt;

     Returns
     -------
&lt;span class="gh"&gt;diff --git a/hips/tiles/fetch.py b/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gh"&gt;index 28afbf6..a898f78 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -9,8 +9,14 @@ __all__ = [&lt;/span&gt;
     'fetch_tiles',
 ]

&lt;span class="gi"&gt;+__doctest_skip__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'fetch_tiles',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 def fetch_tiles(tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperties,
&lt;span class="gd"&gt;-                progress_bar: bool = False, n_parallel: int = 10,  timeout: int = 10, fetch_package : str = 'urllib') -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gi"&gt;+                progress_bar: bool = False, n_parallel: int = 10,&lt;/span&gt;
&lt;span class="gi"&gt;+                timeout: float = 10, fetch_package : str = 'urllib') -&amp;gt; List[HipsTile]:&lt;/span&gt;
     """Fetch a list of HiPS tiles.

     This function fetches a list of HiPS tiles based
&lt;span class="gu"&gt;@@ -28,10 +34,37 @@ def fetch_tiles(tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperti&lt;/span&gt;
         Show a progress bar for tile fetching and drawing
     n_parallel : int
         Number of threads to use for fetching HiPS tiles
&lt;span class="gd"&gt;-    timeout : int&lt;/span&gt;
&lt;span class="gi"&gt;+    timeout : float&lt;/span&gt;
         Seconds to timeout for fetching a HiPS tile
     fetch_package : {'urllib', 'aiohttp'}
         Package to use for fetching HiPS tiles
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Examples&lt;/span&gt;
&lt;span class="gi"&gt;+    --------&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from hips import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from hips import fetch_tiles&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; tile_indices = [69623, 69627, 69628, 69629, 69630, 69631]&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; tile_metas = []&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; for healpix_pixel_index in tile_indices:&lt;/span&gt;
&lt;span class="gi"&gt;+    ...    tile_meta = HipsTileMeta(&lt;/span&gt;
&lt;span class="gi"&gt;+    ...        order=7,&lt;/span&gt;
&lt;span class="gi"&gt;+    ...        ipix=healpix_pixel_index,&lt;/span&gt;
&lt;span class="gi"&gt;+    ...        frame=hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gi"&gt;+    ...        file_format='fits',&lt;/span&gt;
&lt;span class="gi"&gt;+    ...    )&lt;/span&gt;
&lt;span class="gi"&gt;+    ...    tile_metas.append(tile_meta)&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; tiles = fetch_tiles(tile_metas, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; tiles[0].meta.file_format&lt;/span&gt;
&lt;span class="gi"&gt;+    fits&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; tiles[0].meta.order&lt;/span&gt;
&lt;span class="gi"&gt;+    7&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Returns&lt;/span&gt;
&lt;span class="gi"&gt;+    -------&lt;/span&gt;
&lt;span class="gi"&gt;+    tiles : List[HipsTile]&lt;/span&gt;
&lt;span class="gi"&gt;+        A Python list of HiPS tiles&lt;/span&gt;
     """
     if fetch_package == 'aiohttp':
         return tiles_aiohttp(tile_metas, hips_survey, progress_bar)
&lt;span class="gu"&gt;@@ -40,36 +73,30 @@ def fetch_tiles(tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperti&lt;/span&gt;
     else:
         raise ValueError(f'Invalid package name: {fetch_package}')

&lt;span class="gd"&gt;-def tile_urls(tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperties) -&amp;gt; List[str]:&lt;/span&gt;
&lt;span class="gd"&gt;-    """List of tile URLs"""&lt;/span&gt;
&lt;span class="gd"&gt;-    return [hips_survey.tile_url(meta) for meta in tile_metas]&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-def fetch_tile_urllib(url: str, meta: HipsTileMeta, timeout: int) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gi"&gt;+def fetch_tile_urllib(url: str, meta: HipsTileMeta, timeout: float) -&amp;gt; Generator:&lt;/span&gt;
     """Fetch a HiPS tile asynchronously."""
     with urllib.request.urlopen(url, timeout=timeout) as conn:
         raw_data = conn.read()
         return HipsTile(meta, raw_data)

 def tiles_urllib(tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperties,
&lt;span class="gd"&gt;-                 progress_bar: bool = False, n_parallel: int = 10,  timeout: int = 10) -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gi"&gt;+                 progress_bar: bool = False, n_parallel: int = 10,  timeout: float = 10) -&amp;gt; List[HipsTile]:&lt;/span&gt;
     """Generator function to fetch HiPS tiles from a remote URL."""
     with concurrent.futures.ThreadPoolExecutor(max_workers=n_parallel) as executor:
&lt;span class="gd"&gt;-        future_to_url = {executor.submit(&lt;/span&gt;
&lt;span class="gd"&gt;-            fetch_tile_urllib,&lt;/span&gt;
&lt;span class="gd"&gt;-            url,&lt;/span&gt;
&lt;span class="gd"&gt;-            tile_metas[idx],&lt;/span&gt;
&lt;span class="gd"&gt;-            timeout)&lt;/span&gt;
&lt;span class="gd"&gt;-            : url for idx, url in enumerate(tile_urls(tile_metas, hips_survey))}&lt;/span&gt;
&lt;span class="gi"&gt;+        futures = []&lt;/span&gt;
&lt;span class="gi"&gt;+        for meta in tile_metas:&lt;/span&gt;
&lt;span class="gi"&gt;+            url = hips_survey.tile_url(meta)&lt;/span&gt;
&lt;span class="gi"&gt;+            futures.append(executor.submit(fetch_tile_urllib, url, meta, timeout))&lt;/span&gt;

         if progress_bar:
&lt;span class="gd"&gt;-            from tqdm import tqdm&lt;/span&gt;
&lt;span class="gd"&gt;-            requests = tqdm(future_to_url, total=len(future_to_url), desc='Fetching tiles')&lt;/span&gt;
&lt;span class="gi"&gt;+            from tqdm import tqdm as progress_bar&lt;/span&gt;
         else:
&lt;span class="gd"&gt;-            requests = future_to_url&lt;/span&gt;
&lt;span class="gi"&gt;+            def progress_bar(*args):&lt;/span&gt;
&lt;span class="gi"&gt;+                return args[0]&lt;/span&gt;

         tiles = []
&lt;span class="gd"&gt;-        for request in requests:&lt;/span&gt;
&lt;span class="gd"&gt;-            tiles.append(request.result())&lt;/span&gt;
&lt;span class="gi"&gt;+        for future in progress_bar(concurrent.futures.as_completed(futures), total=len(futures), desc='Fetching tiles'):&lt;/span&gt;
&lt;span class="gi"&gt;+            tiles.append(future.result())&lt;/span&gt;

     return tiles

&lt;span class="gu"&gt;@@ -79,26 +106,31 @@ async def fetch_tile_aiohttp(url: str, meta : HipsTileMeta, session) -&amp;gt; Generato&lt;/span&gt;
         raw_data = await response.read()
         return HipsTile(meta, raw_data)

&lt;span class="gd"&gt;-async def fetch_all_tiles_aiohttp(tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperties, progress_bar: bool) -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gi"&gt;+async def fetch_all_tiles_aiohttp(tile_metas: List[HipsTileMeta],&lt;/span&gt;
&lt;span class="gi"&gt;+                                  hips_survey : HipsSurveyProperties, progress_bar: bool) -&amp;gt; List[HipsTile]:&lt;/span&gt;
     """Generator function to fetch HiPS tiles from a remote URL using aiohttp."""
     import aiohttp

&lt;span class="gd"&gt;-    tasks = []&lt;/span&gt;
     async with aiohttp.ClientSession() as session:
&lt;span class="gd"&gt;-        for idx, url in enumerate(tile_urls(tile_metas, hips_survey)):&lt;/span&gt;
&lt;span class="gd"&gt;-            task = asyncio.ensure_future(fetch_tile_aiohttp(url.format(idx), tile_metas[idx], session))&lt;/span&gt;
&lt;span class="gd"&gt;-            tasks.append(task)&lt;/span&gt;
&lt;span class="gi"&gt;+        futures = []&lt;/span&gt;
&lt;span class="gi"&gt;+        for meta in tile_metas:&lt;/span&gt;
&lt;span class="gi"&gt;+            url = hips_survey.tile_url(meta)&lt;/span&gt;
&lt;span class="gi"&gt;+            futures.append(asyncio.ensure_future(fetch_tile_aiohttp(url, meta, session)))&lt;/span&gt;

         if progress_bar:
&lt;span class="gd"&gt;-            from tqdm import tqdm&lt;/span&gt;
&lt;span class="gd"&gt;-            tiles = []&lt;/span&gt;
&lt;span class="gd"&gt;-            for f in tqdm(tasks, total=len(tasks), desc='Fetching tiles'):&lt;/span&gt;
&lt;span class="gd"&gt;-                tiles.append(await f)&lt;/span&gt;
&lt;span class="gi"&gt;+            from tqdm import tqdm as progress_bar&lt;/span&gt;
         else:
&lt;span class="gd"&gt;-            tiles = await asyncio.gather(*tasks)&lt;/span&gt;
&lt;span class="gi"&gt;+            def progress_bar(*args):&lt;/span&gt;
&lt;span class="gi"&gt;+                return args[0]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+        for future in progress_bar(asyncio.as_completed(futures), total=len(futures), desc='Fetching tiles'):&lt;/span&gt;
&lt;span class="gi"&gt;+            tiles.append(await future)&lt;/span&gt;

     return tiles

 def tiles_aiohttp(tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperties,
                   progress_bar: bool) -&amp;gt; List[HipsTile]:
&lt;span class="gd"&gt;-    return asyncio.get_event_loop().run_until_complete(fetch_all_tiles_aiohttp(tile_metas, hips_survey, progress_bar))&lt;/span&gt;
&lt;span class="gi"&gt;+    return asyncio.get_event_loop().run_until_complete(&lt;/span&gt;
&lt;span class="gi"&gt;+        fetch_all_tiles_aiohttp(tile_metas, hips_survey, progress_bar)&lt;/span&gt;
&lt;span class="gi"&gt;+    )&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_fetch.py b/hips/tiles/tests/test_fetch.py&lt;/span&gt;
&lt;span class="gh"&gt;index 53d7ff6..3ba29d6 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_fetch.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_fetch.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -8,7 +8,7 @@ from ..tile import HipsTileMeta&lt;/span&gt;

 TILE_FETCH_TEST_CASES = [
     dict(
&lt;span class="gd"&gt;-        tile_indices=[69623, 69627, 69628, 69629, 69630, 69631],&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_indices=[69623],&lt;/span&gt;
         tile_format='fits',
         order=7,
         url='http://alasky.unistra.fr/DSS/DSS2Merged/properties',
&lt;span class="gu"&gt;@@ -17,7 +17,7 @@ TILE_FETCH_TEST_CASES = [&lt;/span&gt;
         fetch_package='urllib'
     ),
     dict(
&lt;span class="gd"&gt;-        tile_indices=[69623, 69627, 69628, 69629, 69630, 69631],&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_indices=[69623],&lt;/span&gt;
         tile_format='fits',
         order=7,
         url='http://alasky.unistra.fr/DSS/DSS2Merged/properties',

commit 1116a7a81b01295e5aac21cfdd9e044accf258c2
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Aug 21 22:31:44 2017 +0500

    Update aiohttp dependency config

&lt;span class="gh"&gt;diff --git a/.rtd-environment.yml b/.rtd-environment.yml&lt;/span&gt;
&lt;span class="gh"&gt;index 6c2884b..529543d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/.rtd-environment.yml&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/.rtd-environment.yml&lt;/span&gt;
&lt;span class="gu"&gt;@@ -12,6 +12,7 @@ dependencies:&lt;/span&gt;
     - reproject
     - matplotlib
     - tqdm
&lt;span class="gi"&gt;+    - aiohttp&lt;/span&gt;
     # There's a problem with Sphinx 1.6 with astropy-helpers
     # For now, we pin the Sphinx version to something that works
     - sphinx==1.5.6
&lt;span class="gh"&gt;diff --git a/.travis.yml b/.travis.yml&lt;/span&gt;
&lt;span class="gh"&gt;index a486285..49e12dd 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/.travis.yml&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/.travis.yml&lt;/span&gt;
&lt;span class="gu"&gt;@@ -27,7 +27,7 @@ env:&lt;/span&gt;
         - MAIN_CMD='python setup.py'
         - SETUP_CMD='test'
         - EVENT_TYPE='pull_request push'
&lt;span class="gd"&gt;-        - CONDA_DEPENDENCIES='healpy scikit-image Pillow reproject matplotlib tqdm'&lt;/span&gt;
&lt;span class="gi"&gt;+        - CONDA_DEPENDENCIES='healpy scikit-image Pillow reproject matplotlib tqdm aiohttp'&lt;/span&gt;
         - PIP_DEPENDENCIES=''
         - CONDA_CHANNELS='conda-forge astropy-ci-extras astropy'
         - SETUP_XVFB=True
&lt;span class="gh"&gt;diff --git a/docs/installation.rst b/docs/installation.rst&lt;/span&gt;
&lt;span class="gh"&gt;index 28bdc62..d88d8f4 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/installation.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/installation.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -80,5 +80,6 @@ In addition, the following packages are needed for optional functionality:&lt;/span&gt;

 * `Matplotlib`_ 2.0 or later. Used for plotting in examples.
 * `tqdm`_. Used for showing progress bar either on terminal or in Jupyter notebook.
&lt;span class="gi"&gt;+* `aiohttp`_. Used for fetching HiPS tiles.&lt;/span&gt;

 We have some info at :ref:`py3` on why we don't support legacy Python (Python 2).
\ No newline at end of file
&lt;span class="gh"&gt;diff --git a/docs/references.txt b/docs/references.txt&lt;/span&gt;
&lt;span class="gh"&gt;index 9230626..53d1586 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/references.txt&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/references.txt&lt;/span&gt;
&lt;span class="gu"&gt;@@ -6,4 +6,5 @@&lt;/span&gt;
 .. _HiPS paper: https://www.aanda.org/articles/aa/pdf/2015/06/aa26075-15.pdf
 .. _HiPS IVOA recommendation: http://www.ivoa.net/documents/HiPS/
 .. _HiPS at CDS: http://aladin.u-strasbg.fr/hips/
&lt;span class="gd"&gt;-.. _tqdm: https://pypi.python.org/pypi/tqdm&lt;/span&gt;
\ No newline at end of file
&lt;span class="gi"&gt;+.. _tqdm: https://pypi.python.org/pypi/tqdm&lt;/span&gt;
&lt;span class="gi"&gt;+.. _aiohttp: http://aiohttp.readthedocs.io/en/stable/&lt;/span&gt;
\ No newline at end of file
&lt;span class="gh"&gt;diff --git a/hips/draw/paint.py b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index b76cb59..502a9e8 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -4,7 +4,7 @@ import numpy as np&lt;/span&gt;
 from typing import List, Tuple, Union, Dict, Any
 from astropy.wcs.utils import proj_plane_pixel_scales
 from skimage.transform import ProjectiveTransform, warp
&lt;span class="gd"&gt;-from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta, HipsTileFetcher&lt;/span&gt;
&lt;span class="gi"&gt;+from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta, fetch_tiles&lt;/span&gt;
 from ..tiles.tile import compute_image_shape
 from ..utils import WCSGeometry, healpix_pixels_in_sky_image, hips_order_for_pixel_resolution

&lt;span class="gu"&gt;@@ -36,8 +36,8 @@ class HipsPainter:&lt;/span&gt;
         Use the precise drawing algorithm
     progress_bar : bool
         Show a progress bar for tile fetching and drawing
&lt;span class="gd"&gt;-    fetch_package : {'urllib', 'aiohttp'}&lt;/span&gt;
&lt;span class="gd"&gt;-        Package to use for fetching HiPS tiles&lt;/span&gt;
&lt;span class="gi"&gt;+    fetch_opts : dict&lt;/span&gt;
&lt;span class="gi"&gt;+        Keyword arguments for fetching HiPS tiles&lt;/span&gt;

     Examples
     --------
&lt;span class="gu"&gt;@@ -61,13 +61,13 @@ class HipsPainter:&lt;/span&gt;
     """

     def __init__(self, geometry: Union[dict, WCSGeometry], hips_survey: Union[str, HipsSurveyProperties],
&lt;span class="gd"&gt;-                 tile_format: str, precise: bool = False, progress_bar: bool = True, fetch_package: str = 'urllib') -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+                 tile_format: str, precise: bool = False, progress_bar: bool = True, fetch_opts : dict = None) -&amp;gt; None:&lt;/span&gt;
         self.geometry = WCSGeometry.make(geometry)
         self.hips_survey = HipsSurveyProperties.make(hips_survey)
         self.tile_format = tile_format
         self.precise = precise
         self.progress_bar = progress_bar
&lt;span class="gd"&gt;-        self.fetch_package = fetch_package&lt;/span&gt;
&lt;span class="gi"&gt;+        self.fetch_opts = fetch_opts&lt;/span&gt;
         self._tiles = None
         self.float_image = None
         self._stats: Dict[str, Any] = {}
&lt;span class="gu"&gt;@@ -125,11 +125,9 @@ class HipsPainter:&lt;/span&gt;
             )
             tile_metas.append(tile_meta)

&lt;span class="gd"&gt;-        tile_fetcher = HipsTileFetcher(tile_metas=tile_metas, hips_survey=self.hips_survey,&lt;/span&gt;
&lt;span class="gd"&gt;-                                       progress_bar=self.progress_bar, fetch_package=self.fetch_package)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
         if self._tiles is None:
&lt;span class="gd"&gt;-            self._tiles = tile_fetcher.tiles&lt;/span&gt;
&lt;span class="gi"&gt;+            self._tiles = fetch_tiles(tile_metas=tile_metas, hips_survey=self.hips_survey,&lt;/span&gt;
&lt;span class="gi"&gt;+                                      progress_bar=self.progress_bar, **self.fetch_opts)&lt;/span&gt;

         return self._tiles

&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_paint.py b/hips/draw/tests/test_paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index 0515014..dfb2db8 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -20,7 +20,8 @@ class TestHipsPainter:&lt;/span&gt;
             width=2000, height=1000, fov="3 deg",
             coordsys='icrs', projection='AIT',
         )
&lt;span class="gd"&gt;-        cls.painter = HipsPainter(cls.geometry, cls.hips_survey, 'fits', fetch_package='aiohttp')&lt;/span&gt;
&lt;span class="gi"&gt;+        fetch_opts = dict(fetch_package='urllib', timeout=30, n_parallel=10)&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.painter = HipsPainter(cls.geometry, cls.hips_survey, 'fits', fetch_opts=fetch_opts)&lt;/span&gt;

     def test_draw_hips_order(self):
         assert self.painter.draw_hips_order == 7
&lt;span class="gu"&gt;@@ -43,7 +44,8 @@ class TestHipsPainter:&lt;/span&gt;
             coordsys='icrs', projection='AIT',
         )

&lt;span class="gd"&gt;-        simple_tile_painter = HipsPainter(geometry, self.hips_survey, 'fits', fetch_package='aiohttp')&lt;/span&gt;
&lt;span class="gi"&gt;+        fetch_opts = dict(fetch_package='urllib', timeout=30, n_parallel=10)&lt;/span&gt;
&lt;span class="gi"&gt;+        simple_tile_painter = HipsPainter(geometry, self.hips_survey, 'fits', fetch_opts=fetch_opts)&lt;/span&gt;
         assert simple_tile_painter.draw_hips_order == pars['order']

     def test_run(self):
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_ui.py b/hips/draw/tests/test_ui.py&lt;/span&gt;
&lt;span class="gh"&gt;index 569e047..d699868 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_ui.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_ui.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -61,7 +61,9 @@ def test_make_sky_image(tmpdir, pars):&lt;/span&gt;
     hips_survey = HipsSurveyProperties.fetch(url=pars['url'])
     geometry = make_test_wcs_geometry()

&lt;span class="gd"&gt;-    result = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format=pars['file_format'], precise=pars['precise'])&lt;/span&gt;
&lt;span class="gi"&gt;+    fetch_opts = dict(fetch_package='urllib', timeout=30, n_parallel=10)&lt;/span&gt;
&lt;span class="gi"&gt;+    result = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format=pars['file_format'],&lt;/span&gt;
&lt;span class="gi"&gt;+                            precise=pars['precise'], fetch_opts=fetch_opts)&lt;/span&gt;

     assert result.image.shape == pars['shape']
     assert result.image.dtype == pars['dtype']
&lt;span class="gh"&gt;diff --git a/hips/draw/ui.py b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8d7e1a8..e950d40 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -15,7 +15,7 @@ __all__ = [&lt;/span&gt;


 def make_sky_image(geometry: Union[dict, WCSGeometry], hips_survey: Union[str, 'HipsSurveyProperties'],
&lt;span class="gd"&gt;-                   tile_format: str, precise: bool = False, progress_bar: bool = True, fetch_package: str = 'urllib') -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
&lt;span class="gi"&gt;+                   tile_format: str, precise: bool = False, progress_bar: bool = True, fetch_opts: dict = None) -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
     """Make sky image: fetch tiles and draw.

     The example for this can be found on the :ref:`gs` page.
&lt;span class="gu"&gt;@@ -33,15 +33,15 @@ def make_sky_image(geometry: Union[dict, WCSGeometry], hips_survey: Union[str, '&lt;/span&gt;
         Use the precise drawing algorithm
     progress_bar : bool
         Show a progress bar for tile fetching and drawing
&lt;span class="gd"&gt;-    fetch_package : {'urllib', 'aiohttp'}&lt;/span&gt;
&lt;span class="gd"&gt;-        Package to use for fetching HiPS tiles&lt;/span&gt;
&lt;span class="gi"&gt;+    fetch_opts : dict&lt;/span&gt;
&lt;span class="gi"&gt;+        Keyword arguments for fetching HiPS tiles&lt;/span&gt;

     Returns
     -------
     result : `~hips.HipsDrawResult`
         Result object
     """
&lt;span class="gd"&gt;-    painter = HipsPainter(geometry, hips_survey, tile_format, precise, progress_bar, fetch_package)&lt;/span&gt;
&lt;span class="gi"&gt;+    painter = HipsPainter(geometry, hips_survey, tile_format, precise, progress_bar, fetch_opts)&lt;/span&gt;
     painter.run()
     return HipsDrawResult.from_painter(painter)

&lt;span class="gh"&gt;diff --git a/hips/tiles/fetch.py b/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gh"&gt;index a776ec3..28afbf6 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,18 +1,23 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+import asyncio&lt;/span&gt;
 import urllib.request
 import concurrent.futures
 from typing import Generator, List
 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta

 __all__ = [
&lt;span class="gd"&gt;-    'HipsTileFetcher',&lt;/span&gt;
&lt;span class="gi"&gt;+    'fetch_tiles',&lt;/span&gt;
 ]

&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-class HipsTileFetcher:&lt;/span&gt;
&lt;span class="gi"&gt;+def fetch_tiles(tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperties,&lt;/span&gt;
&lt;span class="gi"&gt;+                progress_bar: bool = False, n_parallel: int = 10,  timeout: int = 10, fetch_package : str = 'urllib') -&amp;gt; List[HipsTile]:&lt;/span&gt;
     """Fetch a list of HiPS tiles.

&lt;span class="gi"&gt;+    This function fetches a list of HiPS tiles based&lt;/span&gt;
&lt;span class="gi"&gt;+    on their URLs, which are generated using `hips_survey`&lt;/span&gt;
&lt;span class="gi"&gt;+    and `tile_metas`. The tiles are then fetched asynchronously&lt;/span&gt;
&lt;span class="gi"&gt;+    using urllib or aiohttp.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
     Parameters
     ----------
     tile_metas : List[HipsTileMeta]
&lt;span class="gu"&gt;@@ -28,86 +33,72 @@ class HipsTileFetcher:&lt;/span&gt;
     fetch_package : {'urllib', 'aiohttp'}
         Package to use for fetching HiPS tiles
     """
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def __init__(self, tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperties,&lt;/span&gt;
&lt;span class="gd"&gt;-                 progress_bar: bool = False, n_parallel: int = 10,  timeout: int = 10, fetch_package : str = 'urllib') -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        self.tile_metas = tile_metas&lt;/span&gt;
&lt;span class="gd"&gt;-        self.hips_survey = hips_survey&lt;/span&gt;
&lt;span class="gd"&gt;-        self.progress_bar = progress_bar&lt;/span&gt;
&lt;span class="gd"&gt;-        self.n_parallel = n_parallel&lt;/span&gt;
&lt;span class="gd"&gt;-        self.timeout = timeout&lt;/span&gt;
&lt;span class="gd"&gt;-        self.fetch_package = fetch_package&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def tile_urls(self) -&amp;gt; List[str]:&lt;/span&gt;
&lt;span class="gd"&gt;-        """List of tile URLs"""&lt;/span&gt;
&lt;span class="gd"&gt;-        tile_urls = []&lt;/span&gt;
&lt;span class="gd"&gt;-        for meta in self.tile_metas:&lt;/span&gt;
&lt;span class="gd"&gt;-            tile_urls.append(self.hips_survey.tile_url(meta))&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        return tile_urls&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def tiles(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        if self.fetch_package == 'aiohttp':&lt;/span&gt;
&lt;span class="gd"&gt;-            return self.tiles_aiohttp&lt;/span&gt;
&lt;span class="gd"&gt;-        elif self.fetch_package == 'urllib':&lt;/span&gt;
&lt;span class="gd"&gt;-            return self.tiles_urllib&lt;/span&gt;
&lt;span class="gi"&gt;+    if fetch_package == 'aiohttp':&lt;/span&gt;
&lt;span class="gi"&gt;+        return tiles_aiohttp(tile_metas, hips_survey, progress_bar)&lt;/span&gt;
&lt;span class="gi"&gt;+    elif fetch_package == 'urllib':&lt;/span&gt;
&lt;span class="gi"&gt;+        return tiles_urllib(tile_metas, hips_survey, progress_bar, n_parallel, timeout)&lt;/span&gt;
&lt;span class="gi"&gt;+    else:&lt;/span&gt;
&lt;span class="gi"&gt;+        raise ValueError(f'Invalid package name: {fetch_package}')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def tile_urls(tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperties) -&amp;gt; List[str]:&lt;/span&gt;
&lt;span class="gi"&gt;+    """List of tile URLs"""&lt;/span&gt;
&lt;span class="gi"&gt;+    return [hips_survey.tile_url(meta) for meta in tile_metas]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def fetch_tile_urllib(url: str, meta: HipsTileMeta, timeout: int) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Fetch a HiPS tile asynchronously."""&lt;/span&gt;
&lt;span class="gi"&gt;+    with urllib.request.urlopen(url, timeout=timeout) as conn:&lt;/span&gt;
&lt;span class="gi"&gt;+        raw_data = conn.read()&lt;/span&gt;
&lt;span class="gi"&gt;+        return HipsTile(meta, raw_data)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def tiles_urllib(tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperties,&lt;/span&gt;
&lt;span class="gi"&gt;+                 progress_bar: bool = False, n_parallel: int = 10,  timeout: int = 10) -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Generator function to fetch HiPS tiles from a remote URL."""&lt;/span&gt;
&lt;span class="gi"&gt;+    with concurrent.futures.ThreadPoolExecutor(max_workers=n_parallel) as executor:&lt;/span&gt;
&lt;span class="gi"&gt;+        future_to_url = {executor.submit(&lt;/span&gt;
&lt;span class="gi"&gt;+            fetch_tile_urllib,&lt;/span&gt;
&lt;span class="gi"&gt;+            url,&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_metas[idx],&lt;/span&gt;
&lt;span class="gi"&gt;+            timeout)&lt;/span&gt;
&lt;span class="gi"&gt;+            : url for idx, url in enumerate(tile_urls(tile_metas, hips_survey))}&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        if progress_bar:&lt;/span&gt;
&lt;span class="gi"&gt;+            from tqdm import tqdm&lt;/span&gt;
&lt;span class="gi"&gt;+            requests = tqdm(future_to_url, total=len(future_to_url), desc='Fetching tiles')&lt;/span&gt;
         else:
&lt;span class="gd"&gt;-            raise ValueError(f'Invalid package name: {self.fetch_package}')&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def fetch_tile_urllib(self, url: str, meta : HipsTileMeta) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Fetch a HiPS tile asynchronously."""&lt;/span&gt;
&lt;span class="gd"&gt;-        with urllib.request.urlopen(url, timeout=self.timeout) as conn:&lt;/span&gt;
&lt;span class="gd"&gt;-            raw_data = conn.read()&lt;/span&gt;
&lt;span class="gd"&gt;-            return HipsTile(meta, raw_data)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def tiles_urllib(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Generator function to fetch HiPS tiles from a remote URL."""&lt;/span&gt;
&lt;span class="gd"&gt;-        with concurrent.futures.ThreadPoolExecutor(max_workers=self.n_parallel) as executor:&lt;/span&gt;
&lt;span class="gd"&gt;-            future_to_url = {executor.submit(self.fetch_tile_urllib, url, self.tile_metas[idx]) : url for idx, url in enumerate(self.tile_urls)}&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-            if self.progress_bar:&lt;/span&gt;
&lt;span class="gd"&gt;-                from tqdm import tqdm&lt;/span&gt;
&lt;span class="gd"&gt;-                requests = tqdm(concurrent.futures.as_completed(future_to_url), total=len(future_to_url), desc='Fetching tiles')&lt;/span&gt;
&lt;span class="gd"&gt;-            else:&lt;/span&gt;
&lt;span class="gd"&gt;-                requests = future_to_url#concurrent.futures.as_completed(future_to_url)&lt;/span&gt;
&lt;span class="gi"&gt;+            requests = future_to_url&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+        for request in requests:&lt;/span&gt;
&lt;span class="gi"&gt;+            tiles.append(request.result())&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    return tiles&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+async def fetch_tile_aiohttp(url: str, meta : HipsTileMeta, session) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Fetch a HiPS tile asynchronously using aiohttp."""&lt;/span&gt;
&lt;span class="gi"&gt;+    async with session.get(url) as response:&lt;/span&gt;
&lt;span class="gi"&gt;+        raw_data = await response.read()&lt;/span&gt;
&lt;span class="gi"&gt;+        return HipsTile(meta, raw_data)&lt;/span&gt;

&lt;span class="gi"&gt;+async def fetch_all_tiles_aiohttp(tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperties, progress_bar: bool) -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Generator function to fetch HiPS tiles from a remote URL using aiohttp."""&lt;/span&gt;
&lt;span class="gi"&gt;+    import aiohttp&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    tasks = []&lt;/span&gt;
&lt;span class="gi"&gt;+    async with aiohttp.ClientSession() as session:&lt;/span&gt;
&lt;span class="gi"&gt;+        for idx, url in enumerate(tile_urls(tile_metas, hips_survey)):&lt;/span&gt;
&lt;span class="gi"&gt;+            task = asyncio.ensure_future(fetch_tile_aiohttp(url.format(idx), tile_metas[idx], session))&lt;/span&gt;
&lt;span class="gi"&gt;+            tasks.append(task)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        if progress_bar:&lt;/span&gt;
&lt;span class="gi"&gt;+            from tqdm import tqdm&lt;/span&gt;
             tiles = []
&lt;span class="gd"&gt;-            for future in requests:&lt;/span&gt;
&lt;span class="gd"&gt;-                tiles.append(future.result())&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        return tiles&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    async def fetch_tile_aiohttp(self, url: str, meta : HipsTileMeta, session) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Fetch a HiPS tile asynchronously using aiohttp."""&lt;/span&gt;
&lt;span class="gd"&gt;-        async with session.get(url) as response:&lt;/span&gt;
&lt;span class="gd"&gt;-            raw_data = await response.read()&lt;/span&gt;
&lt;span class="gd"&gt;-            return HipsTile(meta, raw_data)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    async def fetch_all_tiles_aiohttp(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Generator function to fetch HiPS tiles from a remote URL using aiohttp."""&lt;/span&gt;
&lt;span class="gd"&gt;-        import aiohttp, asyncio&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        tasks = []&lt;/span&gt;
&lt;span class="gd"&gt;-        async with aiohttp.ClientSession() as session:&lt;/span&gt;
&lt;span class="gd"&gt;-            for idx, url in enumerate(self.tile_urls):&lt;/span&gt;
&lt;span class="gd"&gt;-                task = asyncio.ensure_future(self.fetch_tile_aiohttp(url.format(idx), self.tile_metas[idx], session))&lt;/span&gt;
&lt;span class="gd"&gt;-                tasks.append(task)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-            if self.progress_bar:&lt;/span&gt;
&lt;span class="gd"&gt;-                from tqdm import tqdm&lt;/span&gt;
&lt;span class="gd"&gt;-                tiles = []&lt;/span&gt;
&lt;span class="gd"&gt;-                for f in tqdm(tasks, total=len(tasks), desc='Fetching tiles'):&lt;/span&gt;
&lt;span class="gd"&gt;-                    tiles.append(await f)&lt;/span&gt;
&lt;span class="gd"&gt;-            else:&lt;/span&gt;
&lt;span class="gd"&gt;-                tiles = await asyncio.gather(*tasks)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        return tiles&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def tiles_aiohttp(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gd"&gt;-        import asyncio&lt;/span&gt;
&lt;span class="gd"&gt;-        return asyncio.get_event_loop().run_until_complete(self.fetch_all_tiles_aiohttp)&lt;/span&gt;
&lt;span class="gi"&gt;+            for f in tqdm(tasks, total=len(tasks), desc='Fetching tiles'):&lt;/span&gt;
&lt;span class="gi"&gt;+                tiles.append(await f)&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            tiles = await asyncio.gather(*tasks)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    return tiles&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def tiles_aiohttp(tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperties,&lt;/span&gt;
&lt;span class="gi"&gt;+                  progress_bar: bool) -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gi"&gt;+    return asyncio.get_event_loop().run_until_complete(fetch_all_tiles_aiohttp(tile_metas, hips_survey, progress_bar))&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_fetch.py b/hips/tiles/tests/test_fetch.py&lt;/span&gt;
&lt;span class="gh"&gt;index d7956df..53d7ff6 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_fetch.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_fetch.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,34 +1,47 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gi"&gt;+import pytest&lt;/span&gt;
 from astropy.tests.helper import remote_data
 from numpy.testing import assert_allclose
&lt;span class="gd"&gt;-from ..fetch import HipsTileFetcher&lt;/span&gt;
&lt;span class="gi"&gt;+from ..fetch import fetch_tiles&lt;/span&gt;
 from ..survey import HipsSurveyProperties
 from ..tile import HipsTileMeta

&lt;span class="gd"&gt;-class TestHipsTileFetcher:&lt;/span&gt;
&lt;span class="gd"&gt;-    @classmethod&lt;/span&gt;
&lt;span class="gd"&gt;-    def setup_class(cls):&lt;/span&gt;
&lt;span class="gd"&gt;-        url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+TILE_FETCH_TEST_CASES = [&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_indices=[69623, 69627, 69628, 69629, 69630, 69631],&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_format='fits',&lt;/span&gt;
&lt;span class="gi"&gt;+        order=7,&lt;/span&gt;
&lt;span class="gi"&gt;+        url='http://alasky.unistra.fr/DSS/DSS2Merged/properties',&lt;/span&gt;
&lt;span class="gi"&gt;+        progress_bar=True,&lt;/span&gt;
&lt;span class="gi"&gt;+        data=[2101, 1680, 1532, 1625, 2131],&lt;/span&gt;
&lt;span class="gi"&gt;+        fetch_package='urllib'&lt;/span&gt;
&lt;span class="gi"&gt;+    ),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_indices=[69623, 69627, 69628, 69629, 69630, 69631],&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_format='fits',&lt;/span&gt;
&lt;span class="gi"&gt;+        order=7,&lt;/span&gt;
&lt;span class="gi"&gt;+        url='http://alasky.unistra.fr/DSS/DSS2Merged/properties',&lt;/span&gt;
&lt;span class="gi"&gt;+        progress_bar=True,&lt;/span&gt;
&lt;span class="gi"&gt;+        data=[2101, 1680, 1532, 1625, 2131],&lt;/span&gt;
&lt;span class="gi"&gt;+        fetch_package='aiohttp'&lt;/span&gt;
&lt;span class="gi"&gt;+    ),&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;

&lt;span class="gd"&gt;-        tile_metas, tile_indices = [], [69623, 69627, 69628, 69629, 69630, 69631]&lt;/span&gt;
&lt;span class="gd"&gt;-        for healpix_pixel_index in tile_indices:&lt;/span&gt;
&lt;span class="gd"&gt;-            tile_meta = HipsTileMeta(&lt;/span&gt;
&lt;span class="gd"&gt;-                order=7,&lt;/span&gt;
&lt;span class="gd"&gt;-                ipix=healpix_pixel_index,&lt;/span&gt;
&lt;span class="gd"&gt;-                frame=hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gd"&gt;-                file_format='fits',&lt;/span&gt;
&lt;span class="gd"&gt;-            )&lt;/span&gt;
&lt;span class="gd"&gt;-            tile_metas.append(tile_meta)&lt;/span&gt;

&lt;span class="gd"&gt;-        cls.fetcher = HipsTileFetcher(tile_metas, hips_survey, progress_bar=False)&lt;/span&gt;
&lt;span class="gi"&gt;+@pytest.mark.parametrize('pars', TILE_FETCH_TEST_CASES)&lt;/span&gt;
&lt;span class="gi"&gt;+@remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+def test_fetch_tiles(pars):&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey = HipsSurveyProperties.fetch(pars['url'])&lt;/span&gt;

&lt;span class="gd"&gt;-    @remote_data&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_tiles(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        tiles = self.fetcher.tiles&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_allclose(tiles[0].data[0][5:10], [2101, 1680, 1532, 1625, 2131])&lt;/span&gt;
&lt;span class="gi"&gt;+    tile_metas = []&lt;/span&gt;
&lt;span class="gi"&gt;+    for healpix_pixel_index in pars['tile_indices']:&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_meta = HipsTileMeta(&lt;/span&gt;
&lt;span class="gi"&gt;+            order=pars['order'],&lt;/span&gt;
&lt;span class="gi"&gt;+            ipix=healpix_pixel_index,&lt;/span&gt;
&lt;span class="gi"&gt;+            frame=hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gi"&gt;+            file_format=pars['tile_format'],&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_metas.append(tile_meta)&lt;/span&gt;

&lt;span class="gd"&gt;-    @remote_data&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_tiles_aiohttp(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        tiles = self.fetcher.tiles_aiohttp&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_allclose(tiles[0].data[0][5:10], [2101, 1680, 1532, 1625, 2131])&lt;/span&gt;
&lt;span class="gi"&gt;+    tiles = fetch_tiles(tile_metas, hips_survey, progress_bar=pars['progress_bar'], fetch_package=pars['fetch_package'])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(tiles[0].data[0][5:10], [2101, 1680, 1532, 1625, 2131])&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/setup.py b/setup.py&lt;/span&gt;
old mode 100755
new mode 100644
&lt;span class="gh"&gt;index af0099f..3ed902f&lt;/span&gt;
&lt;span class="gd"&gt;--- a/setup.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/setup.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -107,6 +107,7 @@ extras_require = dict(&lt;/span&gt;
         'matplotlib&amp;gt;=2.0',
         'reproject&amp;gt;=0.3.1',
         'tqdm',
&lt;span class="gi"&gt;+        'aiohttp',&lt;/span&gt;
     ],
     develop=[
         'matplotlib&amp;gt;=2.0',
&lt;span class="gu"&gt;@@ -114,6 +115,7 @@ extras_require = dict(&lt;/span&gt;
         'pytest&amp;gt;=3.0',
         'mypy&amp;gt;=0.501',
         'tqdm',
&lt;span class="gi"&gt;+        'aiohttp',&lt;/span&gt;
     ],
 )


commit e5118522ba544bab164116a01b1a87a8c3c4f5a2
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Aug 17 20:47:31 2017 +0500

    Add tqdm progress bar to urllib and aiohttp fetch methods

&lt;span class="gh"&gt;diff --git a/hips/draw/paint.py b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index 07affb9..b76cb59 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,9 +1,7 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 import time
&lt;span class="gd"&gt;-import aiohttp&lt;/span&gt;
&lt;span class="gd"&gt;-import asyncio&lt;/span&gt;
 import numpy as np
&lt;span class="gd"&gt;-from typing import List, Tuple, Union, Dict, Any, Generator&lt;/span&gt;
&lt;span class="gi"&gt;+from typing import List, Tuple, Union, Dict, Any&lt;/span&gt;
 from astropy.wcs.utils import proj_plane_pixel_scales
 from skimage.transform import ProjectiveTransform, warp
 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta, HipsTileFetcher
&lt;span class="gu"&gt;@@ -38,6 +36,8 @@ class HipsPainter:&lt;/span&gt;
         Use the precise drawing algorithm
     progress_bar : bool
         Show a progress bar for tile fetching and drawing
&lt;span class="gi"&gt;+    fetch_package : {'urllib', 'aiohttp'}&lt;/span&gt;
&lt;span class="gi"&gt;+        Package to use for fetching HiPS tiles&lt;/span&gt;

     Examples
     --------
&lt;span class="gu"&gt;@@ -61,12 +61,13 @@ class HipsPainter:&lt;/span&gt;
     """

     def __init__(self, geometry: Union[dict, WCSGeometry], hips_survey: Union[str, HipsSurveyProperties],
&lt;span class="gd"&gt;-                 tile_format: str, precise: bool = False, progress_bar: bool = True) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+                 tile_format: str, precise: bool = False, progress_bar: bool = True, fetch_package: str = 'urllib') -&amp;gt; None:&lt;/span&gt;
         self.geometry = WCSGeometry.make(geometry)
         self.hips_survey = HipsSurveyProperties.make(hips_survey)
         self.tile_format = tile_format
         self.precise = precise
         self.progress_bar = progress_bar
&lt;span class="gi"&gt;+        self.fetch_package = fetch_package&lt;/span&gt;
         self._tiles = None
         self.float_image = None
         self._stats: Dict[str, Any] = {}
&lt;span class="gu"&gt;@@ -111,21 +112,10 @@ class HipsPainter:&lt;/span&gt;
         pt.estimate(src, dst)
         return pt

&lt;span class="gd"&gt;-    async def fetch_tile_threaded(self, url: str, session: aiohttp.client.ClientSession) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Fetch a HiPS tile asynchronously."""&lt;/span&gt;
&lt;span class="gd"&gt;-        async with session.get(url) as response:&lt;/span&gt;
&lt;span class="gd"&gt;-            return await response.read()&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    async def _fetch_tiles(self) -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Generator function to fetch HiPS tiles from a remote URL."""&lt;/span&gt;
&lt;span class="gd"&gt;-        if self.progress_bar:&lt;/span&gt;
&lt;span class="gd"&gt;-            from tqdm import tqdm&lt;/span&gt;
&lt;span class="gd"&gt;-            tile_indices = tqdm(self.tile_indices, desc='Fetching tiles')&lt;/span&gt;
&lt;span class="gd"&gt;-        else:&lt;/span&gt;
&lt;span class="gd"&gt;-            tile_indices = self.tile_indices&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        for healpix_pixel_index in tile_indices:&lt;/span&gt;
&lt;span class="gd"&gt;-        tile_urls, tile_metas = [], []&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def tiles(self) -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gi"&gt;+        """List of `~hips.HipsTile` (cached on multiple access)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_metas = []&lt;/span&gt;
         for healpix_pixel_index in self.tile_indices:
             tile_meta = HipsTileMeta(
                 order=self.draw_hips_order,
&lt;span class="gu"&gt;@@ -133,27 +123,12 @@ class HipsPainter:&lt;/span&gt;
                 frame=self.hips_survey.astropy_frame,
                 file_format=self.tile_format,
             )
&lt;span class="gd"&gt;-            tile_urls.append(self.hips_survey.tile_url(tile_meta))&lt;/span&gt;
             tile_metas.append(tile_meta)

&lt;span class="gd"&gt;-        tasks = []&lt;/span&gt;
&lt;span class="gd"&gt;-        async with aiohttp.ClientSession() as session:&lt;/span&gt;
&lt;span class="gd"&gt;-            for idx, url in enumerate(tile_urls):&lt;/span&gt;
&lt;span class="gd"&gt;-                task = asyncio.ensure_future(self.fetch_tile_threaded(url.format(idx), session))&lt;/span&gt;
&lt;span class="gd"&gt;-                tasks.append(task)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-            raw_responses = await asyncio.gather(*tasks)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        tiles = []&lt;/span&gt;
&lt;span class="gd"&gt;-        for idx, raw_data in enumerate(raw_responses):&lt;/span&gt;
&lt;span class="gd"&gt;-            tiles.append(HipsTile(tile_metas[idx], raw_data))&lt;/span&gt;
&lt;span class="gd"&gt;-        return tiles&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_fetcher = HipsTileFetcher(tile_metas=tile_metas, hips_survey=self.hips_survey,&lt;/span&gt;
&lt;span class="gi"&gt;+                                       progress_bar=self.progress_bar, fetch_package=self.fetch_package)&lt;/span&gt;

&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def tiles(self) -&amp;gt; List[HipsTile]:&lt;/span&gt;
&lt;span class="gd"&gt;-        """List of `~hips.HipsTile` (cached on multiple access)."""&lt;/span&gt;
         if self._tiles is None:
&lt;span class="gd"&gt;-            # self._tiles = asyncio.get_event_loop().run_until_complete(tile_fetcher.tiles)&lt;/span&gt;
             self._tiles = tile_fetcher.tiles

         return self._tiles
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_paint.py b/hips/draw/tests/test_paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index 817e143..0515014 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -20,7 +20,7 @@ class TestHipsPainter:&lt;/span&gt;
             width=2000, height=1000, fov="3 deg",
             coordsys='icrs', projection='AIT',
         )
&lt;span class="gd"&gt;-        cls.painter = HipsPainter(cls.geometry, cls.hips_survey, 'fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.painter = HipsPainter(cls.geometry, cls.hips_survey, 'fits', fetch_package='aiohttp')&lt;/span&gt;

     def test_draw_hips_order(self):
         assert self.painter.draw_hips_order == 7
&lt;span class="gu"&gt;@@ -43,7 +43,7 @@ class TestHipsPainter:&lt;/span&gt;
             coordsys='icrs', projection='AIT',
         )

&lt;span class="gd"&gt;-        simple_tile_painter = HipsPainter(geometry, self.hips_survey, 'fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        simple_tile_painter = HipsPainter(geometry, self.hips_survey, 'fits', fetch_package='aiohttp')&lt;/span&gt;
         assert simple_tile_painter.draw_hips_order == pars['order']

     def test_run(self):
&lt;span class="gh"&gt;diff --git a/hips/draw/ui.py b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gh"&gt;index 47716ea..8d7e1a8 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -15,7 +15,7 @@ __all__ = [&lt;/span&gt;


 def make_sky_image(geometry: Union[dict, WCSGeometry], hips_survey: Union[str, 'HipsSurveyProperties'],
&lt;span class="gd"&gt;-                   tile_format: str, precise: bool = False, progress_bar: bool = True) -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
&lt;span class="gi"&gt;+                   tile_format: str, precise: bool = False, progress_bar: bool = True, fetch_package: str = 'urllib') -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
     """Make sky image: fetch tiles and draw.

     The example for this can be found on the :ref:`gs` page.
&lt;span class="gu"&gt;@@ -33,13 +33,15 @@ def make_sky_image(geometry: Union[dict, WCSGeometry], hips_survey: Union[str, '&lt;/span&gt;
         Use the precise drawing algorithm
     progress_bar : bool
         Show a progress bar for tile fetching and drawing
&lt;span class="gi"&gt;+    fetch_package : {'urllib', 'aiohttp'}&lt;/span&gt;
&lt;span class="gi"&gt;+        Package to use for fetching HiPS tiles&lt;/span&gt;

     Returns
     -------
     result : `~hips.HipsDrawResult`
         Result object
     """
&lt;span class="gd"&gt;-    painter = HipsPainter(geometry, hips_survey, tile_format, precise, progress_bar)&lt;/span&gt;
&lt;span class="gi"&gt;+    painter = HipsPainter(geometry, hips_survey, tile_format, precise, progress_bar, fetch_package)&lt;/span&gt;
     painter.run()
     return HipsDrawResult.from_painter(painter)

&lt;span class="gh"&gt;diff --git a/hips/tiles/fetch.py b/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gh"&gt;index fe5c9ce..a776ec3 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,118 +1,113 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-import aiohttp&lt;/span&gt;
&lt;span class="gd"&gt;-import asyncio&lt;/span&gt;
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;
 import urllib.request
 import concurrent.futures
&lt;span class="gd"&gt;-import numpy as np&lt;/span&gt;
&lt;span class="gd"&gt;-from typing import Generator&lt;/span&gt;
&lt;span class="gi"&gt;+from typing import Generator, List&lt;/span&gt;
 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta

 __all__ = [
     'HipsTileFetcher',
 ]

&lt;span class="gd"&gt;-__doctest_skip__ = [&lt;/span&gt;
&lt;span class="gd"&gt;-    'HipsTileFetcher',&lt;/span&gt;
&lt;span class="gd"&gt;-]&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;

 class HipsTileFetcher:
     """Fetch a list of HiPS tiles.

     Parameters
     ----------
&lt;span class="gd"&gt;-    geometry : dict or `~hips.utils.WCSGeometry`&lt;/span&gt;
&lt;span class="gd"&gt;-        An object of WCSGeometry&lt;/span&gt;
&lt;span class="gd"&gt;-    hips_survey : str or `~hips.HipsSurveyProperties`&lt;/span&gt;
&lt;span class="gi"&gt;+    tile_metas : List[HipsTileMeta]&lt;/span&gt;
&lt;span class="gi"&gt;+        Python list of HipsTileMeta&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey : `~hips.HipsSurveyProperties`&lt;/span&gt;
         HiPS survey properties
&lt;span class="gd"&gt;-    tile_format : {'fits', 'jpg', 'png'}&lt;/span&gt;
&lt;span class="gd"&gt;-        Format of HiPS tile&lt;/span&gt;
&lt;span class="gd"&gt;-    precise : bool&lt;/span&gt;
&lt;span class="gd"&gt;-        Use the precise drawing algorithm&lt;/span&gt;
&lt;span class="gi"&gt;+    progress_bar : bool&lt;/span&gt;
&lt;span class="gi"&gt;+        Show a progress bar for tile fetching and drawing&lt;/span&gt;
&lt;span class="gi"&gt;+    n_parallel : int&lt;/span&gt;
&lt;span class="gi"&gt;+        Number of threads to use for fetching HiPS tiles&lt;/span&gt;
&lt;span class="gi"&gt;+    timeout : int&lt;/span&gt;
&lt;span class="gi"&gt;+        Seconds to timeout for fetching a HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    fetch_package : {'urllib', 'aiohttp'}&lt;/span&gt;
&lt;span class="gi"&gt;+        Package to use for fetching HiPS tiles&lt;/span&gt;
     """

&lt;span class="gd"&gt;-    def __init__(self, tile_indices: np.ndarray, hips_order: int, hips_survey: HipsSurveyProperties, tile_format: str,&lt;/span&gt;
&lt;span class="gd"&gt;-                 progress_bar: bool, use_aiohttp: bool) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        self.tile_indices = tile_indices&lt;/span&gt;
&lt;span class="gd"&gt;-        self.hips_order = hips_order&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, tile_metas: List[HipsTileMeta], hips_survey : HipsSurveyProperties,&lt;/span&gt;
&lt;span class="gi"&gt;+                 progress_bar: bool = False, n_parallel: int = 10,  timeout: int = 10, fetch_package : str = 'urllib') -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.tile_metas = tile_metas&lt;/span&gt;
         self.hips_survey = hips_survey
&lt;span class="gd"&gt;-        self.tile_format = tile_format&lt;/span&gt;
&lt;span class="gi"&gt;+        self.progress_bar = progress_bar&lt;/span&gt;
&lt;span class="gi"&gt;+        self.n_parallel = n_parallel&lt;/span&gt;
&lt;span class="gi"&gt;+        self.timeout = timeout&lt;/span&gt;
&lt;span class="gi"&gt;+        self.fetch_package = fetch_package&lt;/span&gt;

&lt;span class="gd"&gt;-    def fetch_tile_threaded(self, url: str, session: aiohttp.client.ClientSession) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def tile_urls(self) -&amp;gt; List[str]:&lt;/span&gt;
&lt;span class="gi"&gt;+        """List of tile URLs"""&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_urls = []&lt;/span&gt;
&lt;span class="gi"&gt;+        for meta in self.tile_metas:&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_urls.append(self.hips_survey.tile_url(meta))&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        return tile_urls&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def tiles(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.fetch_package == 'aiohttp':&lt;/span&gt;
&lt;span class="gi"&gt;+            return self.tiles_aiohttp&lt;/span&gt;
&lt;span class="gi"&gt;+        elif self.fetch_package == 'urllib':&lt;/span&gt;
&lt;span class="gi"&gt;+            return self.tiles_urllib&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            raise ValueError(f'Invalid package name: {self.fetch_package}')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def fetch_tile_urllib(self, url: str, meta : HipsTileMeta) -&amp;gt; Generator:&lt;/span&gt;
         """Fetch a HiPS tile asynchronously."""
&lt;span class="gd"&gt;-        with urllib.request.urlopen(url, timeout=60) as conn:&lt;/span&gt;
&lt;span class="gd"&gt;-            return conn.read()&lt;/span&gt;
&lt;span class="gi"&gt;+        with urllib.request.urlopen(url, timeout=self.timeout) as conn:&lt;/span&gt;
&lt;span class="gi"&gt;+            raw_data = conn.read()&lt;/span&gt;
&lt;span class="gi"&gt;+            return HipsTile(meta, raw_data)&lt;/span&gt;

     @property
&lt;span class="gd"&gt;-    def tiles(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+    def tiles_urllib(self) -&amp;gt; np.ndarray:&lt;/span&gt;
         """Generator function to fetch HiPS tiles from a remote URL."""
&lt;span class="gd"&gt;-        tile_urls, tile_metas = [], []&lt;/span&gt;
&lt;span class="gd"&gt;-        for healpix_pixel_index in self.tile_indices:&lt;/span&gt;
&lt;span class="gd"&gt;-            tile_meta = HipsTileMeta(&lt;/span&gt;
&lt;span class="gd"&gt;-                order=self.hips_order,&lt;/span&gt;
&lt;span class="gd"&gt;-                ipix=healpix_pixel_index,&lt;/span&gt;
&lt;span class="gd"&gt;-                frame=self.hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gd"&gt;-                file_format=self.tile_format,&lt;/span&gt;
&lt;span class="gd"&gt;-            )&lt;/span&gt;
&lt;span class="gd"&gt;-            tile_urls.append(self.hips_survey.tile_url(tile_meta))&lt;/span&gt;
&lt;span class="gd"&gt;-            tile_metas.append(tile_meta)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        raw_responses = []&lt;/span&gt;
&lt;span class="gd"&gt;-        with concurrent.futures.ThreadPoolExecutor(max_workers=5) as executor:&lt;/span&gt;
&lt;span class="gd"&gt;-            # Start the load operations and mark each future with its URL&lt;/span&gt;
&lt;span class="gd"&gt;-            future_to_url = {executor.submit(self.fetch_tile_threaded, url, 60): url for url in tile_urls}&lt;/span&gt;
&lt;span class="gd"&gt;-            for future in concurrent.futures.as_completed(future_to_url):&lt;/span&gt;
&lt;span class="gd"&gt;-                url = future_to_url[future]&lt;/span&gt;
&lt;span class="gd"&gt;-                # try:&lt;/span&gt;
&lt;span class="gd"&gt;-                raw_responses.append(future.result())&lt;/span&gt;
&lt;span class="gd"&gt;-                # except Exception as exc:&lt;/span&gt;
&lt;span class="gd"&gt;-                #     print('%r generated an exception: %s' % (url, exc))&lt;/span&gt;
&lt;span class="gd"&gt;-                # else:&lt;/span&gt;
&lt;span class="gd"&gt;-                #     print('%r page is %d bytes' % (url, len(future.result())))&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        #&lt;/span&gt;
&lt;span class="gd"&gt;-        # tasks = []&lt;/span&gt;
&lt;span class="gd"&gt;-        # async with aiohttp.ClientSession() as session:&lt;/span&gt;
&lt;span class="gd"&gt;-        #     for idx, url in enumerate(tile_urls):&lt;/span&gt;
&lt;span class="gd"&gt;-        #         task = asyncio.ensure_future(self.fetch_tile_threaded(url.format(idx), session))&lt;/span&gt;
&lt;span class="gd"&gt;-        #         tasks.append(task)&lt;/span&gt;
&lt;span class="gd"&gt;-        #&lt;/span&gt;
&lt;span class="gd"&gt;-        #     raw_responses = await asyncio.gather(*tasks)&lt;/span&gt;
&lt;span class="gd"&gt;-        #&lt;/span&gt;
&lt;span class="gd"&gt;-        tiles = []&lt;/span&gt;
&lt;span class="gd"&gt;-        for idx, raw_data in enumerate(raw_responses):&lt;/span&gt;
&lt;span class="gd"&gt;-            tiles.append(HipsTile(tile_metas[idx], raw_data))&lt;/span&gt;
&lt;span class="gi"&gt;+        with concurrent.futures.ThreadPoolExecutor(max_workers=self.n_parallel) as executor:&lt;/span&gt;
&lt;span class="gi"&gt;+            future_to_url = {executor.submit(self.fetch_tile_urllib, url, self.tile_metas[idx]) : url for idx, url in enumerate(self.tile_urls)}&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+            if self.progress_bar:&lt;/span&gt;
&lt;span class="gi"&gt;+                from tqdm import tqdm&lt;/span&gt;
&lt;span class="gi"&gt;+                requests = tqdm(concurrent.futures.as_completed(future_to_url), total=len(future_to_url), desc='Fetching tiles')&lt;/span&gt;
&lt;span class="gi"&gt;+            else:&lt;/span&gt;
&lt;span class="gi"&gt;+                requests = future_to_url#concurrent.futures.as_completed(future_to_url)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+            tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+            for future in requests:&lt;/span&gt;
&lt;span class="gi"&gt;+                tiles.append(future.result())&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        return tiles&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    async def fetch_tile_aiohttp(self, url: str, meta : HipsTileMeta, session) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Fetch a HiPS tile asynchronously using aiohttp."""&lt;/span&gt;
&lt;span class="gi"&gt;+        async with session.get(url) as response:&lt;/span&gt;
&lt;span class="gi"&gt;+            raw_data = await response.read()&lt;/span&gt;
&lt;span class="gi"&gt;+            return HipsTile(meta, raw_data)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    async def fetch_all_tiles_aiohttp(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Generator function to fetch HiPS tiles from a remote URL using aiohttp."""&lt;/span&gt;
&lt;span class="gi"&gt;+        import aiohttp, asyncio&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        tasks = []&lt;/span&gt;
&lt;span class="gi"&gt;+        async with aiohttp.ClientSession() as session:&lt;/span&gt;
&lt;span class="gi"&gt;+            for idx, url in enumerate(self.tile_urls):&lt;/span&gt;
&lt;span class="gi"&gt;+                task = asyncio.ensure_future(self.fetch_tile_aiohttp(url.format(idx), self.tile_metas[idx], session))&lt;/span&gt;
&lt;span class="gi"&gt;+                tasks.append(task)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+            if self.progress_bar:&lt;/span&gt;
&lt;span class="gi"&gt;+                from tqdm import tqdm&lt;/span&gt;
&lt;span class="gi"&gt;+                tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+                for f in tqdm(tasks, total=len(tasks), desc='Fetching tiles'):&lt;/span&gt;
&lt;span class="gi"&gt;+                    tiles.append(await f)&lt;/span&gt;
&lt;span class="gi"&gt;+            else:&lt;/span&gt;
&lt;span class="gi"&gt;+                tiles = await asyncio.gather(*tasks)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
         return tiles

&lt;span class="gd"&gt;-    # async def fetch_tile_threaded(self, url: str, session: aiohttp.client.ClientSession) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gd"&gt;-    #     """Fetch a HiPS tile asynchronously."""&lt;/span&gt;
&lt;span class="gd"&gt;-    #     async with session.get(url) as response:&lt;/span&gt;
&lt;span class="gd"&gt;-    #         return await response.read()&lt;/span&gt;
&lt;span class="gd"&gt;-    #&lt;/span&gt;
&lt;span class="gd"&gt;-    # @property&lt;/span&gt;
&lt;span class="gd"&gt;-    # async def tiles(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gd"&gt;-    #     """Generator function to fetch HiPS tiles from a remote URL."""&lt;/span&gt;
&lt;span class="gd"&gt;-    #     tile_urls, tile_metas = [], []&lt;/span&gt;
&lt;span class="gd"&gt;-    #     for healpix_pixel_index in self.tile_indices:&lt;/span&gt;
&lt;span class="gd"&gt;-    #         tile_meta = HipsTileMeta(&lt;/span&gt;
&lt;span class="gd"&gt;-    #             order=self.hips_order,&lt;/span&gt;
&lt;span class="gd"&gt;-    #             ipix=healpix_pixel_index,&lt;/span&gt;
&lt;span class="gd"&gt;-    #             frame=self.hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gd"&gt;-    #             file_format=self.tile_format,&lt;/span&gt;
&lt;span class="gd"&gt;-    #         )&lt;/span&gt;
&lt;span class="gd"&gt;-    #         tile_urls.append(self.hips_survey.tile_url(tile_meta))&lt;/span&gt;
&lt;span class="gd"&gt;-    #         tile_metas.append(tile_meta)&lt;/span&gt;
&lt;span class="gd"&gt;-    #&lt;/span&gt;
&lt;span class="gd"&gt;-    #     tasks = []&lt;/span&gt;
&lt;span class="gd"&gt;-    #     async with aiohttp.ClientSession() as session:&lt;/span&gt;
&lt;span class="gd"&gt;-    #         for idx, url in enumerate(tile_urls):&lt;/span&gt;
&lt;span class="gd"&gt;-    #             task = asyncio.ensure_future(self.fetch_tile_threaded(url.format(idx), session))&lt;/span&gt;
&lt;span class="gd"&gt;-    #             tasks.append(task)&lt;/span&gt;
&lt;span class="gd"&gt;-    #&lt;/span&gt;
&lt;span class="gd"&gt;-    #         raw_responses = await asyncio.gather(*tasks)&lt;/span&gt;
&lt;span class="gd"&gt;-    #&lt;/span&gt;
&lt;span class="gd"&gt;-    #     tiles = []&lt;/span&gt;
&lt;span class="gd"&gt;-    #     for idx, raw_data in enumerate(raw_responses):&lt;/span&gt;
&lt;span class="gd"&gt;-    #         tiles.append(HipsTile(tile_metas[idx], raw_data))&lt;/span&gt;
&lt;span class="gd"&gt;-    #     return tiles&lt;/span&gt;
\ No newline at end of file
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def tiles_aiohttp(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+        import asyncio&lt;/span&gt;
&lt;span class="gi"&gt;+        return asyncio.get_event_loop().run_until_complete(self.fetch_all_tiles_aiohttp)&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_fetch.py b/hips/tiles/tests/test_fetch.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..d7956df&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_fetch.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,34 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.tests.helper import remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+from numpy.testing import assert_allclose&lt;/span&gt;
&lt;span class="gi"&gt;+from ..fetch import HipsTileFetcher&lt;/span&gt;
&lt;span class="gi"&gt;+from ..survey import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+from ..tile import HipsTileMeta&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class TestHipsTileFetcher:&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def setup_class(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_metas, tile_indices = [], [69623, 69627, 69628, 69629, 69630, 69631]&lt;/span&gt;
&lt;span class="gi"&gt;+        for healpix_pixel_index in tile_indices:&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_meta = HipsTileMeta(&lt;/span&gt;
&lt;span class="gi"&gt;+                order=7,&lt;/span&gt;
&lt;span class="gi"&gt;+                ipix=healpix_pixel_index,&lt;/span&gt;
&lt;span class="gi"&gt;+                frame=hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gi"&gt;+                file_format='fits',&lt;/span&gt;
&lt;span class="gi"&gt;+            )&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_metas.append(tile_meta)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.fetcher = HipsTileFetcher(tile_metas, hips_survey, progress_bar=False)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_tiles(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        tiles = self.fetcher.tiles&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(tiles[0].data[0][5:10], [2101, 1680, 1532, 1625, 2131])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_tiles_aiohttp(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        tiles = self.fetcher.tiles_aiohttp&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(tiles[0].data[0][5:10], [2101, 1680, 1532, 1625, 2131])&lt;/span&gt;

commit 0eba105e1822e0e50645344e1839e8ec48d5d6de
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Aug 17 19:07:57 2017 +0500

    Add option to fetch tiles asynchronously using urllib

&lt;span class="gh"&gt;diff --git a/hips/draw/paint.py b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index 4a33100..07affb9 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -6,7 +6,7 @@ import numpy as np&lt;/span&gt;
 from typing import List, Tuple, Union, Dict, Any, Generator
 from astropy.wcs.utils import proj_plane_pixel_scales
 from skimage.transform import ProjectiveTransform, warp
&lt;span class="gd"&gt;-from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta&lt;/span&gt;
&lt;span class="gi"&gt;+from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta, HipsTileFetcher&lt;/span&gt;
 from ..tiles.tile import compute_image_shape
 from ..utils import WCSGeometry, healpix_pixels_in_sky_image, hips_order_for_pixel_resolution

&lt;span class="gu"&gt;@@ -153,7 +153,8 @@ class HipsPainter:&lt;/span&gt;
     def tiles(self) -&amp;gt; List[HipsTile]:
         """List of `~hips.HipsTile` (cached on multiple access)."""
         if self._tiles is None:
&lt;span class="gd"&gt;-            self._tiles = asyncio.get_event_loop().run_until_complete(self._fetch_tiles())&lt;/span&gt;
&lt;span class="gi"&gt;+            # self._tiles = asyncio.get_event_loop().run_until_complete(tile_fetcher.tiles)&lt;/span&gt;
&lt;span class="gi"&gt;+            self._tiles = tile_fetcher.tiles&lt;/span&gt;

         return self._tiles

&lt;span class="gh"&gt;diff --git a/hips/tiles/__init__.py b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gh"&gt;index bc0ac4a..0f5268e 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -3,3 +3,4 @@&lt;/span&gt;
 from .tile import *
 from .survey import *
 from .allsky import *
&lt;span class="gi"&gt;+from .fetch import *&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/fetch.py b/hips/tiles/fetch.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..fe5c9ce&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/fetch.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,118 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+import aiohttp&lt;/span&gt;
&lt;span class="gi"&gt;+import asyncio&lt;/span&gt;
&lt;span class="gi"&gt;+import urllib.request&lt;/span&gt;
&lt;span class="gi"&gt;+import concurrent.futures&lt;/span&gt;
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+from typing import Generator&lt;/span&gt;
&lt;span class="gi"&gt;+from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+__all__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'HipsTileFetcher',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+__doctest_skip__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'HipsTileFetcher',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class HipsTileFetcher:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Fetch a list of HiPS tiles.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry : dict or `~hips.utils.WCSGeometry`&lt;/span&gt;
&lt;span class="gi"&gt;+        An object of WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey : str or `~hips.HipsSurveyProperties`&lt;/span&gt;
&lt;span class="gi"&gt;+        HiPS survey properties&lt;/span&gt;
&lt;span class="gi"&gt;+    tile_format : {'fits', 'jpg', 'png'}&lt;/span&gt;
&lt;span class="gi"&gt;+        Format of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    precise : bool&lt;/span&gt;
&lt;span class="gi"&gt;+        Use the precise drawing algorithm&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, tile_indices: np.ndarray, hips_order: int, hips_survey: HipsSurveyProperties, tile_format: str,&lt;/span&gt;
&lt;span class="gi"&gt;+                 progress_bar: bool, use_aiohttp: bool) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.tile_indices = tile_indices&lt;/span&gt;
&lt;span class="gi"&gt;+        self.hips_order = hips_order&lt;/span&gt;
&lt;span class="gi"&gt;+        self.hips_survey = hips_survey&lt;/span&gt;
&lt;span class="gi"&gt;+        self.tile_format = tile_format&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def fetch_tile_threaded(self, url: str, session: aiohttp.client.ClientSession) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Fetch a HiPS tile asynchronously."""&lt;/span&gt;
&lt;span class="gi"&gt;+        with urllib.request.urlopen(url, timeout=60) as conn:&lt;/span&gt;
&lt;span class="gi"&gt;+            return conn.read()&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def tiles(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Generator function to fetch HiPS tiles from a remote URL."""&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_urls, tile_metas = [], []&lt;/span&gt;
&lt;span class="gi"&gt;+        for healpix_pixel_index in self.tile_indices:&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_meta = HipsTileMeta(&lt;/span&gt;
&lt;span class="gi"&gt;+                order=self.hips_order,&lt;/span&gt;
&lt;span class="gi"&gt;+                ipix=healpix_pixel_index,&lt;/span&gt;
&lt;span class="gi"&gt;+                frame=self.hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gi"&gt;+                file_format=self.tile_format,&lt;/span&gt;
&lt;span class="gi"&gt;+            )&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_urls.append(self.hips_survey.tile_url(tile_meta))&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_metas.append(tile_meta)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        raw_responses = []&lt;/span&gt;
&lt;span class="gi"&gt;+        with concurrent.futures.ThreadPoolExecutor(max_workers=5) as executor:&lt;/span&gt;
&lt;span class="gi"&gt;+            # Start the load operations and mark each future with its URL&lt;/span&gt;
&lt;span class="gi"&gt;+            future_to_url = {executor.submit(self.fetch_tile_threaded, url, 60): url for url in tile_urls}&lt;/span&gt;
&lt;span class="gi"&gt;+            for future in concurrent.futures.as_completed(future_to_url):&lt;/span&gt;
&lt;span class="gi"&gt;+                url = future_to_url[future]&lt;/span&gt;
&lt;span class="gi"&gt;+                # try:&lt;/span&gt;
&lt;span class="gi"&gt;+                raw_responses.append(future.result())&lt;/span&gt;
&lt;span class="gi"&gt;+                # except Exception as exc:&lt;/span&gt;
&lt;span class="gi"&gt;+                #     print('%r generated an exception: %s' % (url, exc))&lt;/span&gt;
&lt;span class="gi"&gt;+                # else:&lt;/span&gt;
&lt;span class="gi"&gt;+                #     print('%r page is %d bytes' % (url, len(future.result())))&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        #&lt;/span&gt;
&lt;span class="gi"&gt;+        # tasks = []&lt;/span&gt;
&lt;span class="gi"&gt;+        # async with aiohttp.ClientSession() as session:&lt;/span&gt;
&lt;span class="gi"&gt;+        #     for idx, url in enumerate(tile_urls):&lt;/span&gt;
&lt;span class="gi"&gt;+        #         task = asyncio.ensure_future(self.fetch_tile_threaded(url.format(idx), session))&lt;/span&gt;
&lt;span class="gi"&gt;+        #         tasks.append(task)&lt;/span&gt;
&lt;span class="gi"&gt;+        #&lt;/span&gt;
&lt;span class="gi"&gt;+        #     raw_responses = await asyncio.gather(*tasks)&lt;/span&gt;
&lt;span class="gi"&gt;+        #&lt;/span&gt;
&lt;span class="gi"&gt;+        tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+        for idx, raw_data in enumerate(raw_responses):&lt;/span&gt;
&lt;span class="gi"&gt;+            tiles.append(HipsTile(tile_metas[idx], raw_data))&lt;/span&gt;
&lt;span class="gi"&gt;+        return tiles&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    # async def fetch_tile_threaded(self, url: str, session: aiohttp.client.ClientSession) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gi"&gt;+    #     """Fetch a HiPS tile asynchronously."""&lt;/span&gt;
&lt;span class="gi"&gt;+    #     async with session.get(url) as response:&lt;/span&gt;
&lt;span class="gi"&gt;+    #         return await response.read()&lt;/span&gt;
&lt;span class="gi"&gt;+    #&lt;/span&gt;
&lt;span class="gi"&gt;+    # @property&lt;/span&gt;
&lt;span class="gi"&gt;+    # async def tiles(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+    #     """Generator function to fetch HiPS tiles from a remote URL."""&lt;/span&gt;
&lt;span class="gi"&gt;+    #     tile_urls, tile_metas = [], []&lt;/span&gt;
&lt;span class="gi"&gt;+    #     for healpix_pixel_index in self.tile_indices:&lt;/span&gt;
&lt;span class="gi"&gt;+    #         tile_meta = HipsTileMeta(&lt;/span&gt;
&lt;span class="gi"&gt;+    #             order=self.hips_order,&lt;/span&gt;
&lt;span class="gi"&gt;+    #             ipix=healpix_pixel_index,&lt;/span&gt;
&lt;span class="gi"&gt;+    #             frame=self.hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gi"&gt;+    #             file_format=self.tile_format,&lt;/span&gt;
&lt;span class="gi"&gt;+    #         )&lt;/span&gt;
&lt;span class="gi"&gt;+    #         tile_urls.append(self.hips_survey.tile_url(tile_meta))&lt;/span&gt;
&lt;span class="gi"&gt;+    #         tile_metas.append(tile_meta)&lt;/span&gt;
&lt;span class="gi"&gt;+    #&lt;/span&gt;
&lt;span class="gi"&gt;+    #     tasks = []&lt;/span&gt;
&lt;span class="gi"&gt;+    #     async with aiohttp.ClientSession() as session:&lt;/span&gt;
&lt;span class="gi"&gt;+    #         for idx, url in enumerate(tile_urls):&lt;/span&gt;
&lt;span class="gi"&gt;+    #             task = asyncio.ensure_future(self.fetch_tile_threaded(url.format(idx), session))&lt;/span&gt;
&lt;span class="gi"&gt;+    #             tasks.append(task)&lt;/span&gt;
&lt;span class="gi"&gt;+    #&lt;/span&gt;
&lt;span class="gi"&gt;+    #         raw_responses = await asyncio.gather(*tasks)&lt;/span&gt;
&lt;span class="gi"&gt;+    #&lt;/span&gt;
&lt;span class="gi"&gt;+    #     tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+    #     for idx, raw_data in enumerate(raw_responses):&lt;/span&gt;
&lt;span class="gi"&gt;+    #         tiles.append(HipsTile(tile_metas[idx], raw_data))&lt;/span&gt;
&lt;span class="gi"&gt;+    #     return tiles&lt;/span&gt;
\ No newline at end of file

commit 6c1295814affecd4abe5e2c6e44e22df24ae3ae6
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Aug 15 21:28:00 2017 +0500

    Introduce asynchronous fetching of HiPS tiles

&lt;span class="gh"&gt;diff --git a/hips/draw/paint.py b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index 482b729..4a33100 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,7 +1,9 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 import time
&lt;span class="gi"&gt;+import aiohttp&lt;/span&gt;
&lt;span class="gi"&gt;+import asyncio&lt;/span&gt;
 import numpy as np
&lt;span class="gd"&gt;-from typing import List, Tuple, Union, Dict, Any, Iterator&lt;/span&gt;
&lt;span class="gi"&gt;+from typing import List, Tuple, Union, Dict, Any, Generator&lt;/span&gt;
 from astropy.wcs.utils import proj_plane_pixel_scales
 from skimage.transform import ProjectiveTransform, warp
 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta
&lt;span class="gu"&gt;@@ -109,7 +111,12 @@ class HipsPainter:&lt;/span&gt;
         pt.estimate(src, dst)
         return pt

&lt;span class="gd"&gt;-    def _fetch_tiles(self) -&amp;gt; Iterator[HipsTile]:&lt;/span&gt;
&lt;span class="gi"&gt;+    async def fetch_tile_threaded(self, url: str, session: aiohttp.client.ClientSession) -&amp;gt; Generator:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Fetch a HiPS tile asynchronously."""&lt;/span&gt;
&lt;span class="gi"&gt;+        async with session.get(url) as response:&lt;/span&gt;
&lt;span class="gi"&gt;+            return await response.read()&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    async def _fetch_tiles(self) -&amp;gt; List[HipsTile]:&lt;/span&gt;
         """Generator function to fetch HiPS tiles from a remote URL."""
         if self.progress_bar:
             from tqdm import tqdm
&lt;span class="gu"&gt;@@ -118,21 +125,35 @@ class HipsPainter:&lt;/span&gt;
             tile_indices = self.tile_indices

         for healpix_pixel_index in tile_indices:
&lt;span class="gi"&gt;+        tile_urls, tile_metas = [], []&lt;/span&gt;
&lt;span class="gi"&gt;+        for healpix_pixel_index in self.tile_indices:&lt;/span&gt;
             tile_meta = HipsTileMeta(
                 order=self.draw_hips_order,
                 ipix=healpix_pixel_index,
                 frame=self.hips_survey.astropy_frame,
                 file_format=self.tile_format,
             )
&lt;span class="gd"&gt;-            url = self.hips_survey.tile_url(tile_meta)&lt;/span&gt;
&lt;span class="gd"&gt;-            tile = HipsTile.fetch(tile_meta, url)&lt;/span&gt;
&lt;span class="gd"&gt;-            yield tile&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_urls.append(self.hips_survey.tile_url(tile_meta))&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_metas.append(tile_meta)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        tasks = []&lt;/span&gt;
&lt;span class="gi"&gt;+        async with aiohttp.ClientSession() as session:&lt;/span&gt;
&lt;span class="gi"&gt;+            for idx, url in enumerate(tile_urls):&lt;/span&gt;
&lt;span class="gi"&gt;+                task = asyncio.ensure_future(self.fetch_tile_threaded(url.format(idx), session))&lt;/span&gt;
&lt;span class="gi"&gt;+                tasks.append(task)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+            raw_responses = await asyncio.gather(*tasks)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+        for idx, raw_data in enumerate(raw_responses):&lt;/span&gt;
&lt;span class="gi"&gt;+            tiles.append(HipsTile(tile_metas[idx], raw_data))&lt;/span&gt;
&lt;span class="gi"&gt;+        return tiles&lt;/span&gt;

     @property
     def tiles(self) -&amp;gt; List[HipsTile]:
         """List of `~hips.HipsTile` (cached on multiple access)."""
         if self._tiles is None:
&lt;span class="gd"&gt;-            self._tiles = list(self._fetch_tiles())&lt;/span&gt;
&lt;span class="gi"&gt;+            self._tiles = asyncio.get_event_loop().run_until_complete(self._fetch_tiles())&lt;/span&gt;

         return self._tiles

&lt;span class="gu"&gt;@@ -163,7 +184,6 @@ class HipsPainter:&lt;/span&gt;
             self._stats['consumed_memory'] += len(tile.raw_data)


&lt;span class="gd"&gt;-&lt;/span&gt;
     def make_tile_list(self):
         parent_tiles = self.tiles


commit 25dd9ef7f46e21876968ec784a93f2c14df9c0c4
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Aug 16 22:48:31 2017 +0500

    Update .travis.yml

&lt;span class="gh"&gt;diff --git a/.travis.yml b/.travis.yml&lt;/span&gt;
&lt;span class="gh"&gt;index ebe7b8a..76fea2b 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/.travis.yml&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/.travis.yml&lt;/span&gt;
&lt;span class="gu"&gt;@@ -74,7 +74,7 @@ matrix:&lt;/span&gt;
         # Run static code analysis
         - os: linux
           env: MAIN_CMD='make code-analysis' SETUP_CMD=''
&lt;span class="gd"&gt;-               PIP_DEPENDENCIES='mypy pycodestyle'&lt;/span&gt;
&lt;span class="gi"&gt;+               PIP_DEPENDENCIES='mypy pycodestyle tqdm'&lt;/span&gt;


 install:
&lt;span class="gh"&gt;diff --git a/setup.py b/setup.py&lt;/span&gt;
&lt;span class="gh"&gt;index 3678fa8..4e0cf5d 100755&lt;/span&gt;
&lt;span class="gd"&gt;--- a/setup.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/setup.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -105,6 +105,7 @@ install_requires = [&lt;/span&gt;
 extras_require = dict(
     recommended=[
         'matplotlib&amp;gt;=2.0',
&lt;span class="gi"&gt;+&lt;/span&gt;
         'tqdm&amp;gt;=4.15',
         'reproject&amp;gt;=0.3.1',
     ],
&lt;span class="gu"&gt;@@ -113,6 +114,7 @@ extras_require = dict(&lt;/span&gt;
         'reproject&amp;gt;=0.3.1',
         'pytest&amp;gt;=3.0',
         'mypy&amp;gt;=0.501',
&lt;span class="gi"&gt;+        'tqdm&amp;gt;=4.15',&lt;/span&gt;
     ],
 )


commit 88f4293f12ba0173bc86ad6e39223b5aff04e4ae
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Aug 16 19:33:54 2017 +0500

    Update getting started example to contain information on progress bar

&lt;span class="gh"&gt;diff --git a/docs/getting_started.rst b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gh"&gt;index c308ea1..3ce3d93 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -33,7 +33,10 @@ To draw a sky image from HiPS image tiles with the `hips` package, follow the fo&lt;/span&gt;
     hips_survey = 'CDS/P/DSS2/red'

 3. Call the `~hips.make_sky_image` function to fetch the HiPS data
&lt;span class="gd"&gt;-   and draw it, returning an object of `~hips.HipsDrawResult`::&lt;/span&gt;
&lt;span class="gi"&gt;+   and draw it, returning an object of `~hips.HipsDrawResult`.&lt;/span&gt;
&lt;span class="gi"&gt;+   By default a progress bar is shown for fetching and&lt;/span&gt;
&lt;span class="gi"&gt;+   drawing HiPS tiles. For batch processing, this can be&lt;/span&gt;
&lt;span class="gi"&gt;+   turned off by passing a keyword argument: `progress_bar=False`::&lt;/span&gt;

     from hips import make_sky_image
     result = make_sky_image(geometry, hips_survey, 'fits')
&lt;span class="gh"&gt;diff --git a/docs/installation.rst b/docs/installation.rst&lt;/span&gt;
&lt;span class="gh"&gt;index df4bcda..a1dbe1b 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/installation.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/installation.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -79,5 +79,6 @@ The ``hips`` package has the following requirements:&lt;/span&gt;
 In addition, the following packages are needed for optional functionality:

 * `Matplotlib`_ 2.0 or later. Used for plotting in examples.
&lt;span class="gi"&gt;+* `tqdm`_ 4.15 or later. Used for showing progress bar either on terminal or in Jupyter notebook.&lt;/span&gt;

 We have some info at :ref:`py3` on why we don't support legacy Python (Python 2).
\ No newline at end of file
&lt;span class="gh"&gt;diff --git a/docs/references.txt b/docs/references.txt&lt;/span&gt;
&lt;span class="gh"&gt;index cfe3062..9230626 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/references.txt&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/references.txt&lt;/span&gt;
&lt;span class="gu"&gt;@@ -5,4 +5,5 @@&lt;/span&gt;
 .. _Pillow: https://python-pillow.org/
 .. _HiPS paper: https://www.aanda.org/articles/aa/pdf/2015/06/aa26075-15.pdf
 .. _HiPS IVOA recommendation: http://www.ivoa.net/documents/HiPS/
&lt;span class="gd"&gt;-.. _HiPS at CDS: http://aladin.u-strasbg.fr/hips/&lt;/span&gt;
\ No newline at end of file
&lt;span class="gi"&gt;+.. _HiPS at CDS: http://aladin.u-strasbg.fr/hips/&lt;/span&gt;
&lt;span class="gi"&gt;+.. _tqdm: https://pypi.python.org/pypi/tqdm&lt;/span&gt;
\ No newline at end of file
&lt;span class="gh"&gt;diff --git a/hips/draw/paint.py b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index 18848df..482b729 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -59,7 +59,7 @@ class HipsPainter:&lt;/span&gt;
     """

     def __init__(self, geometry: Union[dict, WCSGeometry], hips_survey: Union[str, HipsSurveyProperties],
&lt;span class="gd"&gt;-                 tile_format: str, precise: bool = False, progress_bar: bool = False) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+                 tile_format: str, precise: bool = False, progress_bar: bool = True) -&amp;gt; None:&lt;/span&gt;
         self.geometry = WCSGeometry.make(geometry)
         self.hips_survey = HipsSurveyProperties.make(hips_survey)
         self.tile_format = tile_format
&lt;span class="gu"&gt;@@ -113,7 +113,7 @@ class HipsPainter:&lt;/span&gt;
         """Generator function to fetch HiPS tiles from a remote URL."""
         if self.progress_bar:
             from tqdm import tqdm
&lt;span class="gd"&gt;-            tile_indices = tqdm(self.tile_indices, desc='Fetching tiles', disable=not self.progress_bar)&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_indices = tqdm(self.tile_indices, desc='Fetching tiles')&lt;/span&gt;
         else:
             tile_indices = self.tile_indices

&lt;span class="gu"&gt;@@ -196,7 +196,7 @@ class HipsPainter:&lt;/span&gt;
         image = self._make_empty_sky_image()
         if self.progress_bar:
             from tqdm import tqdm
&lt;span class="gd"&gt;-            tiles = tqdm(self.draw_tiles, desc='Drawing tiles', disable=not self.progress_bar)&lt;/span&gt;
&lt;span class="gi"&gt;+            tiles = tqdm(self.draw_tiles, desc='Drawing tiles')&lt;/span&gt;
         else:
             tiles = self.draw_tiles

&lt;span class="gh"&gt;diff --git a/hips/draw/ui.py b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gh"&gt;index b608ac9..47716ea 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -15,7 +15,7 @@ __all__ = [&lt;/span&gt;


 def make_sky_image(geometry: Union[dict, WCSGeometry], hips_survey: Union[str, 'HipsSurveyProperties'],
&lt;span class="gd"&gt;-                   tile_format: str, precise: bool = False, progress_bar: bool = False) -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
&lt;span class="gi"&gt;+                   tile_format: str, precise: bool = False, progress_bar: bool = True) -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
     """Make sky image: fetch tiles and draw.

     The example for this can be found on the :ref:`gs` page.
&lt;span class="gh"&gt;diff --git a/setup.py b/setup.py&lt;/span&gt;
&lt;span class="gh"&gt;index c517001..3678fa8 100755&lt;/span&gt;
&lt;span class="gd"&gt;--- a/setup.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/setup.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -105,6 +105,7 @@ install_requires = [&lt;/span&gt;
 extras_require = dict(
     recommended=[
         'matplotlib&amp;gt;=2.0',
&lt;span class="gi"&gt;+        'tqdm&amp;gt;=4.15',&lt;/span&gt;
         'reproject&amp;gt;=0.3.1',
     ],
     develop=[

commit e2c9c69989072fffb6271b43273fee65d186e274
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Aug 16 18:15:08 2017 +0500

    Make tqdm an optional dependency

&lt;span class="gh"&gt;diff --git a/hips/draw/paint.py b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index d227364..18848df 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,7 +1,6 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 import time
 import numpy as np
&lt;span class="gd"&gt;-from tqdm import tqdm&lt;/span&gt;
 from typing import List, Tuple, Union, Dict, Any, Iterator
 from astropy.wcs.utils import proj_plane_pixel_scales
 from skimage.transform import ProjectiveTransform, warp
&lt;span class="gu"&gt;@@ -112,7 +111,13 @@ class HipsPainter:&lt;/span&gt;

     def _fetch_tiles(self) -&amp;gt; Iterator[HipsTile]:
         """Generator function to fetch HiPS tiles from a remote URL."""
&lt;span class="gd"&gt;-        for healpix_pixel_index in tqdm(self.tile_indices, desc='Fetching tiles', disable=not self.progress_bar):&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.progress_bar:&lt;/span&gt;
&lt;span class="gi"&gt;+            from tqdm import tqdm&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_indices = tqdm(self.tile_indices, desc='Fetching tiles', disable=not self.progress_bar)&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_indices = self.tile_indices&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        for healpix_pixel_index in tile_indices:&lt;/span&gt;
             tile_meta = HipsTileMeta(
                 order=self.draw_hips_order,
                 ipix=healpix_pixel_index,
&lt;span class="gu"&gt;@@ -189,8 +194,13 @@ class HipsPainter:&lt;/span&gt;
     def draw_all_tiles(self):
         """Make an empty sky image and draw all the tiles."""
         image = self._make_empty_sky_image()
&lt;span class="gi"&gt;+        if self.progress_bar:&lt;/span&gt;
&lt;span class="gi"&gt;+            from tqdm import tqdm&lt;/span&gt;
&lt;span class="gi"&gt;+            tiles = tqdm(self.draw_tiles, desc='Drawing tiles', disable=not self.progress_bar)&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            tiles = self.draw_tiles&lt;/span&gt;

&lt;span class="gd"&gt;-        for tile in tqdm(self.draw_tiles, desc='Drawing tiles', disable=not self.progress_bar):&lt;/span&gt;
&lt;span class="gi"&gt;+        for tile in tiles:&lt;/span&gt;
             tile_image = self.warp_image(tile)
             # TODO: put better algorithm here instead of summing pixels
             # this can lead to pixels that are painted twice and become to bright

commit ba813ef65fe503bb879927fd25f2975c1a735176
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Aug 11 18:48:03 2017 +0500

    Add progress bar support for fetching and drawing HiPS tiles

&lt;span class="gh"&gt;diff --git a/hips/draw/paint.py b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index f0120c6..d227364 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,6 +1,7 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 import time
 import numpy as np
&lt;span class="gi"&gt;+from tqdm import tqdm&lt;/span&gt;
 from typing import List, Tuple, Union, Dict, Any, Iterator
 from astropy.wcs.utils import proj_plane_pixel_scales
 from skimage.transform import ProjectiveTransform, warp
&lt;span class="gu"&gt;@@ -34,6 +35,8 @@ class HipsPainter:&lt;/span&gt;
         Format of HiPS tile
     precise : bool
         Use the precise drawing algorithm
&lt;span class="gi"&gt;+    progress_bar : bool&lt;/span&gt;
&lt;span class="gi"&gt;+        Show a progress bar for tile fetching and drawing&lt;/span&gt;

     Examples
     --------
&lt;span class="gu"&gt;@@ -56,11 +59,13 @@ class HipsPainter:&lt;/span&gt;
     (1000, 2000)
     """

&lt;span class="gd"&gt;-    def __init__(self, geometry: Union[dict, WCSGeometry], hips_survey: Union[str, HipsSurveyProperties], tile_format: str, precise: bool = False) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, geometry: Union[dict, WCSGeometry], hips_survey: Union[str, HipsSurveyProperties],&lt;/span&gt;
&lt;span class="gi"&gt;+                 tile_format: str, precise: bool = False, progress_bar: bool = False) -&amp;gt; None:&lt;/span&gt;
         self.geometry = WCSGeometry.make(geometry)
         self.hips_survey = HipsSurveyProperties.make(hips_survey)
         self.tile_format = tile_format
         self.precise = precise
&lt;span class="gi"&gt;+        self.progress_bar = progress_bar&lt;/span&gt;
         self._tiles = None
         self.float_image = None
         self._stats: Dict[str, Any] = {}
&lt;span class="gu"&gt;@@ -107,7 +112,7 @@ class HipsPainter:&lt;/span&gt;

     def _fetch_tiles(self) -&amp;gt; Iterator[HipsTile]:
         """Generator function to fetch HiPS tiles from a remote URL."""
&lt;span class="gd"&gt;-        for healpix_pixel_index in self.tile_indices:&lt;/span&gt;
&lt;span class="gi"&gt;+        for healpix_pixel_index in tqdm(self.tile_indices, desc='Fetching tiles', disable=not self.progress_bar):&lt;/span&gt;
             tile_meta = HipsTileMeta(
                 order=self.draw_hips_order,
                 ipix=healpix_pixel_index,
&lt;span class="gu"&gt;@@ -121,12 +126,6 @@ class HipsPainter:&lt;/span&gt;
     @property
     def tiles(self) -&amp;gt; List[HipsTile]:
         """List of `~hips.HipsTile` (cached on multiple access)."""
&lt;span class="gd"&gt;-        # TODO: add progress bar reporting here???&lt;/span&gt;
&lt;span class="gd"&gt;-        # Do it in a separate pull request&lt;/span&gt;
&lt;span class="gd"&gt;-        # It has to work in the terminal and Jupyter notebook&lt;/span&gt;
&lt;span class="gd"&gt;-        # Users have to be able to turn it off&lt;/span&gt;
&lt;span class="gd"&gt;-        # So you have an option for it.&lt;/span&gt;
&lt;span class="gd"&gt;-        # Maybe if you add it now, make it off by default.&lt;/span&gt;
         if self._tiles is None:
             self._tiles = list(self._fetch_tiles())

&lt;span class="gu"&gt;@@ -159,6 +158,7 @@ class HipsPainter:&lt;/span&gt;
             self._stats['consumed_memory'] += len(tile.raw_data)


&lt;span class="gi"&gt;+&lt;/span&gt;
     def make_tile_list(self):
         parent_tiles = self.tiles

&lt;span class="gu"&gt;@@ -190,9 +190,7 @@ class HipsPainter:&lt;/span&gt;
         """Make an empty sky image and draw all the tiles."""
         image = self._make_empty_sky_image()

&lt;span class="gd"&gt;-        # TODO: this is the second place where we should add&lt;/span&gt;
&lt;span class="gd"&gt;-        # progress reporting&lt;/span&gt;
&lt;span class="gd"&gt;-        for tile in self.draw_tiles:&lt;/span&gt;
&lt;span class="gi"&gt;+        for tile in tqdm(self.draw_tiles, desc='Drawing tiles', disable=not self.progress_bar):&lt;/span&gt;
             tile_image = self.warp_image(tile)
             # TODO: put better algorithm here instead of summing pixels
             # this can lead to pixels that are painted twice and become to bright
&lt;span class="gh"&gt;diff --git a/hips/draw/ui.py b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gh"&gt;index fb56b4e..b608ac9 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -15,7 +15,7 @@ __all__ = [&lt;/span&gt;


 def make_sky_image(geometry: Union[dict, WCSGeometry], hips_survey: Union[str, 'HipsSurveyProperties'],
&lt;span class="gd"&gt;-                   tile_format: str, precise: bool = False) -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
&lt;span class="gi"&gt;+                   tile_format: str, precise: bool = False, progress_bar: bool = False) -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
     """Make sky image: fetch tiles and draw.

     The example for this can be found on the :ref:`gs` page.
&lt;span class="gu"&gt;@@ -31,13 +31,15 @@ def make_sky_image(geometry: Union[dict, WCSGeometry], hips_survey: Union[str, '&lt;/span&gt;
         (some surveys are available in several formats, so this extra argument is needed)
     precise : bool
         Use the precise drawing algorithm
&lt;span class="gi"&gt;+    progress_bar : bool&lt;/span&gt;
&lt;span class="gi"&gt;+        Show a progress bar for tile fetching and drawing&lt;/span&gt;

     Returns
     -------
     result : `~hips.HipsDrawResult`
         Result object
     """
&lt;span class="gd"&gt;-    painter = HipsPainter(geometry, hips_survey, tile_format, precise)&lt;/span&gt;
&lt;span class="gi"&gt;+    painter = HipsPainter(geometry, hips_survey, tile_format, precise, progress_bar)&lt;/span&gt;
     painter.run()
     return HipsDrawResult.from_painter(painter)


commit c026c96aa19e46f66a8e84a1c3429476c2803bb4
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Aug 9 21:45:14 2017 +0500

    Add reporting functionality for HipsPainter

&lt;span class="gh"&gt;diff --git a/hips/draw/paint.py b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index efaa251..142f4b8 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -153,13 +153,11 @@ class HipsPainter:&lt;/span&gt;
         t1 = time.time()
         self._stats['draw_time'] = t1 - t0

&lt;span class="gd"&gt;-        # Todo for Adeel: copy over the stats dir to the DrawResult&lt;/span&gt;
&lt;span class="gd"&gt;-        # and print it out nicely for the user in the report.&lt;/span&gt;
&lt;span class="gd"&gt;-        # TODO: could add more code here that e.g. tries to measure memory usage&lt;/span&gt;
&lt;span class="gd"&gt;-        # this could be done with https://pypi.python.org/pypi/psutil&lt;/span&gt;
&lt;span class="gd"&gt;-        # or you could just compute the size of `raw_data` and `data` for each tile and sum them up&lt;/span&gt;
&lt;span class="gd"&gt;-        # and also measure the memory used by the output sky image in MB&lt;/span&gt;
&lt;span class="gd"&gt;-        # Other useful info: number of tiles fetched&lt;/span&gt;
&lt;span class="gi"&gt;+        self._stats['tile_count'] = len(self.draw_tiles)&lt;/span&gt;
&lt;span class="gi"&gt;+        self._stats['consumed_memory'] = 0&lt;/span&gt;
&lt;span class="gi"&gt;+        for tile in self.draw_tiles:&lt;/span&gt;
&lt;span class="gi"&gt;+            self._stats['consumed_memory'] += len(tile.raw_data)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;

     def make_tile_list(self):
         parent_tiles = self.tiles
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_ui.py b/hips/draw/tests/test_ui.py&lt;/span&gt;
&lt;span class="gh"&gt;index dc8238d..569e047 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_ui.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_ui.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -71,3 +71,4 @@ def test_make_sky_image(tmpdir, pars):&lt;/span&gt;
     assert_allclose(result.image[200, 995], pars['data_2'])
     result.write_image(str(tmpdir / 'test.' + pars['file_format']))
     result.plot()
&lt;span class="gi"&gt;+    result.report()&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/draw/ui.py b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gh"&gt;index a7857c1..fb56b4e 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -55,13 +55,16 @@ class HipsDrawResult:&lt;/span&gt;
         Format of HiPS tile
     tiles : list
         Python list of `~hips.HipsTile` objects that were used
&lt;span class="gi"&gt;+    stats : dict&lt;/span&gt;
&lt;span class="gi"&gt;+        Information including time for fetching and drawing HiPS tiles&lt;/span&gt;
     """

&lt;span class="gd"&gt;-    def __init__(self, image: np.ndarray, geometry: WCSGeometry, tile_format: str, tiles: List[HipsTile]) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, image: np.ndarray, geometry: WCSGeometry, tile_format: str, tiles: List[HipsTile], stats: dict) -&amp;gt; None:&lt;/span&gt;
         self.image = image
         self.geometry = geometry
         self.tile_format = tile_format
         self.tiles = tiles
&lt;span class="gi"&gt;+        self.stats = stats&lt;/span&gt;

     def __str__(self):
         return (
&lt;span class="gu"&gt;@@ -89,6 +92,7 @@ class HipsDrawResult:&lt;/span&gt;
             geometry=painter.geometry,
             tile_format=painter.tile_format,
             tiles=painter.tiles,
&lt;span class="gi"&gt;+            stats=painter._stats,&lt;/span&gt;
         )

     def write_image(self, filename: str) -&amp;gt; None:
&lt;span class="gu"&gt;@@ -120,3 +124,13 @@ class HipsDrawResult:&lt;/span&gt;
             ax.plot(corners.data.lon.deg, corners.data.lat.deg,
                     transform=ax.get_transform('world'), **opts)
         ax.imshow(self.image, origin='lower')
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def report(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Print a brief report for the fetched data."""&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        print (&lt;/span&gt;
&lt;span class="gi"&gt;+            f"Time for fetching tiles = {self.stats['fetch_time']} seconds\n"&lt;/span&gt;
&lt;span class="gi"&gt;+            f"Time for drawing tiles = {self.stats['draw_time']} seconds\n"&lt;/span&gt;
&lt;span class="gi"&gt;+            f"Total memory consumed = {self.stats['consumed_memory'] / 1e6} MB\n"&lt;/span&gt;
&lt;span class="gi"&gt;+            f"Total tiles fetched = {self.stats['tile_count']}\n"&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;

commit 0981f309aade1f33e0586341108dfff0fd108ab2
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Aug 8 13:59:32 2017 +0500

    Reformat docstring for create_from_dict class method

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_allsky.py b/hips/tiles/tests/test_allsky.py&lt;/span&gt;
&lt;span class="gh"&gt;index d933938..625281a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_allsky.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_allsky.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -11,7 +11,7 @@ TEST_CASES = [&lt;/span&gt;
     dict(
         label='fits',
         meta=dict(order=3, ipix=-1, file_format='fits'),
&lt;span class="gd"&gt;-        url='http://alasky.unistra.fr/IRAC4/Norder3/Allsky.fits',&lt;/span&gt;
&lt;span class="gi"&gt;+        url='https://github.com/hipspy/hips-extra/blob/master/datasets/samples/IRAC4/Norder3/Allsky.fits?raw=true',&lt;/span&gt;
         filename='datasets/samples/IRAC4/Norder3/Allsky.fits',

         repr="HipsTileAllskyArray(format='fits', order=3, width=1728, "
&lt;span class="gh"&gt;diff --git a/hips/utils/wcs.py b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index b052dec..5e6c240 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -98,7 +98,7 @@ class WCSGeometry:&lt;/span&gt;
             Sky coordinate of the WCS reference point
         width, height : int
             Width and height of the image in pixels
&lt;span class="gd"&gt;-        fov: str or `~astropy.coordinates.Angle`&lt;/span&gt;
&lt;span class="gi"&gt;+        fov : str or `~astropy.coordinates.Angle`&lt;/span&gt;
             Field of view
         coordsys : {'icrs', 'galactic'}
             Coordinate system
&lt;span class="gu"&gt;@@ -160,9 +160,20 @@ class WCSGeometry:&lt;/span&gt;

     @classmethod
     def create_from_dict(cls, params: dict) -&amp;gt; 'WCSGeometry':
&lt;span class="gd"&gt;-        """Create WCS object from a dictionary (`WCSGeometry`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        """Create WCS object from a dictionary (`WCSGeometry`).&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        The extra options are passed to the ``create`` class method, it can take the following parameters:&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        * target&lt;/span&gt;
&lt;span class="gi"&gt;+        * width&lt;/span&gt;
&lt;span class="gi"&gt;+        * height&lt;/span&gt;
&lt;span class="gi"&gt;+        * fov&lt;/span&gt;
&lt;span class="gi"&gt;+        * coordsys&lt;/span&gt;
&lt;span class="gi"&gt;+        * projection&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        For detailed description, see the ``create`` class method's docstring.&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
         skycoord = SkyCoord.from_name(params.pop('target'), frame=params['coordsys'])
&lt;span class="gd"&gt;-        # print(**params)&lt;/span&gt;
         return cls.create(skycoord, **params)

     @classmethod

commit 8140f2943de907bc6bd45f6a06d337b781dd6ff1
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Aug 7 09:33:55 2017 +0500

    Fix tile splitting criterion

&lt;span class="gh"&gt;diff --git a/hips/draw/paint.py b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index efaa251..9f647a8 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -260,8 +260,8 @@ def is_tile_distorted(corners: tuple) -&amp;gt; bool:&lt;/span&gt;

     return bool(
         max(edges) &amp;gt; 300 or
&lt;span class="gd"&gt;-        max(diagonals) &amp;gt; 150 or&lt;/span&gt;
&lt;span class="gd"&gt;-        diagonal_ratio &amp;lt; 0.7&lt;/span&gt;
&lt;span class="gi"&gt;+        (max(diagonals) &amp;gt; 150 and&lt;/span&gt;
&lt;span class="gi"&gt;+        diagonal_ratio &amp;lt; 0.7)&lt;/span&gt;
     )


&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_allsky.py b/hips/tiles/tests/test_allsky.py&lt;/span&gt;
&lt;span class="gh"&gt;index d933938..625281a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_allsky.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_allsky.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -11,7 +11,7 @@ TEST_CASES = [&lt;/span&gt;
     dict(
         label='fits',
         meta=dict(order=3, ipix=-1, file_format='fits'),
&lt;span class="gd"&gt;-        url='http://alasky.unistra.fr/IRAC4/Norder3/Allsky.fits',&lt;/span&gt;
&lt;span class="gi"&gt;+        url='https://github.com/hipspy/hips-extra/blob/master/datasets/samples/IRAC4/Norder3/Allsky.fits?raw=true',&lt;/span&gt;
         filename='datasets/samples/IRAC4/Norder3/Allsky.fits',

         repr="HipsTileAllskyArray(format='fits', order=3, width=1728, "
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_wcs.py b/hips/utils/tests/test_wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index cbab50f..26cf46f 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,4 +1,5 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gi"&gt;+from astropy.tests.helper import remote_data&lt;/span&gt;
 from numpy.testing import assert_allclose
 from astropy.coordinates import SkyCoord
 from ..wcs import WCSGeometry
&lt;span class="gu"&gt;@@ -35,6 +36,7 @@ class TestWCSGeometry:&lt;/span&gt;
         assert_allclose(self.geometry.wcs.wcs.crpix, [1000., 500.])
         assert_allclose(self.geometry.wcs.wcs.cdelt, [-0.0015, 0.0015])

&lt;span class="gi"&gt;+    @remote_data&lt;/span&gt;
     def test_create_from_dict(self):
         params = dict(target='crab', width=2000, height=1000, fov='3 deg',
                       coordsys='galactic', projection='AIT')
&lt;span class="gh"&gt;diff --git a/hips/utils/wcs.py b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index b052dec..f47bb6b 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -98,7 +98,7 @@ class WCSGeometry:&lt;/span&gt;
             Sky coordinate of the WCS reference point
         width, height : int
             Width and height of the image in pixels
&lt;span class="gd"&gt;-        fov: str or `~astropy.coordinates.Angle`&lt;/span&gt;
&lt;span class="gi"&gt;+        fov : str or `~astropy.coordinates.Angle`&lt;/span&gt;
             Field of view
         coordsys : {'icrs', 'galactic'}
             Coordinate system
&lt;span class="gu"&gt;@@ -162,7 +162,6 @@ class WCSGeometry:&lt;/span&gt;
     def create_from_dict(cls, params: dict) -&amp;gt; 'WCSGeometry':
         """Create WCS object from a dictionary (`WCSGeometry`)."""
         skycoord = SkyCoord.from_name(params.pop('target'), frame=params['coordsys'])
&lt;span class="gd"&gt;-        # print(**params)&lt;/span&gt;
         return cls.create(skycoord, **params)

     @classmethod

commit b447864b37ea070f2b8b2662ac0797cc2f151c76
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Aug 2 16:36:27 2017 +0500

    Update test case for create_from_dict classmethod

&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_wcs.py b/hips/utils/tests/test_wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index 7c72be6..cbab50f 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -40,5 +40,9 @@ class TestWCSGeometry:&lt;/span&gt;
                       coordsys='galactic', projection='AIT')
         geometry = WCSGeometry.create_from_dict(params)

&lt;span class="gd"&gt;-        c = self.geometry.center_skycoord&lt;/span&gt;
&lt;span class="gi"&gt;+        c = geometry.center_skycoord&lt;/span&gt;
         assert c.frame.name == 'galactic'
&lt;span class="gi"&gt;+        assert_allclose(c.l.deg, 184.55, atol=1e-2)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(c.b.deg, -5.78, atol=1e-2)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.geometry.wcs.wcs.crpix, [1000., 500.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.geometry.wcs.wcs.cdelt, [-0.0015, 0.0015])&lt;/span&gt;

commit 651a5ae14a8896ca81558d9f084a9afe764bdd44
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Aug 2 13:29:26 2017 +0500

    Add classmethod create_from_dict in WCSGeometry class

&lt;span class="gh"&gt;diff --git a/hips/draw/paint.py b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index 7ea03b1..efaa251 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -26,7 +26,7 @@ class HipsPainter:&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gd"&gt;-    geometry : `~hips.utils.WCSGeometry`&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry : dict or `~hips.utils.WCSGeometry`&lt;/span&gt;
         An object of WCSGeometry
     hips_survey : str or `~hips.HipsSurveyProperties`
         HiPS survey properties
&lt;span class="gu"&gt;@@ -56,8 +56,8 @@ class HipsPainter:&lt;/span&gt;
     (1000, 2000)
     """

&lt;span class="gd"&gt;-    def __init__(self, geometry: WCSGeometry, hips_survey: Union[str, HipsSurveyProperties], tile_format: str, precise: bool = False) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        self.geometry = geometry&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, geometry: Union[dict, WCSGeometry], hips_survey: Union[str, HipsSurveyProperties], tile_format: str, precise: bool = False) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.geometry = WCSGeometry.make(geometry)&lt;/span&gt;
         self.hips_survey = HipsSurveyProperties.make(hips_survey)
         self.tile_format = tile_format
         self.precise = precise
&lt;span class="gh"&gt;diff --git a/hips/draw/ui.py b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8a1db36..a7857c1 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -14,7 +14,7 @@ __all__ = [&lt;/span&gt;
 ]


&lt;span class="gd"&gt;-def make_sky_image(geometry: WCSGeometry, hips_survey: Union[str, 'HipsSurveyProperties'],&lt;/span&gt;
&lt;span class="gi"&gt;+def make_sky_image(geometry: Union[dict, WCSGeometry], hips_survey: Union[str, 'HipsSurveyProperties'],&lt;/span&gt;
                    tile_format: str, precise: bool = False) -&amp;gt; 'HipsDrawResult':
     """Make sky image: fetch tiles and draw.

&lt;span class="gu"&gt;@@ -22,7 +22,7 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: Union[str, 'HipsSurveyPro&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gd"&gt;-    geometry : `~hips.utils.WCSGeometry`&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry : dict or `~hips.utils.WCSGeometry`&lt;/span&gt;
         Geometry of the output image
     hips_survey : str or `~hips.HipsSurveyProperties`
         HiPS survey properties
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_wcs.py b/hips/utils/tests/test_wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index 22832f7..7c72be6 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -34,3 +34,11 @@ class TestWCSGeometry:&lt;/span&gt;
         assert_allclose(c.dec.deg, 0.00075, atol=1e-2)
         assert_allclose(self.geometry.wcs.wcs.crpix, [1000., 500.])
         assert_allclose(self.geometry.wcs.wcs.cdelt, [-0.0015, 0.0015])
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_create_from_dict(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        params = dict(target='crab', width=2000, height=1000, fov='3 deg',&lt;/span&gt;
&lt;span class="gi"&gt;+                      coordsys='galactic', projection='AIT')&lt;/span&gt;
&lt;span class="gi"&gt;+        geometry = WCSGeometry.create_from_dict(params)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        c = self.geometry.center_skycoord&lt;/span&gt;
&lt;span class="gi"&gt;+        assert c.frame.name == 'galactic'&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/wcs.py b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index bf2574e..b052dec 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -158,6 +158,23 @@ class WCSGeometry:&lt;/span&gt;

         return cls(w, width, height)

&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def create_from_dict(cls, params: dict) -&amp;gt; 'WCSGeometry':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Create WCS object from a dictionary (`WCSGeometry`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        skycoord = SkyCoord.from_name(params.pop('target'), frame=params['coordsys'])&lt;/span&gt;
&lt;span class="gi"&gt;+        # print(**params)&lt;/span&gt;
&lt;span class="gi"&gt;+        return cls.create(skycoord, **params)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def make(cls, geometry: Union[dict, 'WCSGeometry']) -&amp;gt; 'WCSGeometry':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Convenience constructor for create_from_dict classmethod or existing object (`WCSGeometry`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        if isinstance(geometry, str):&lt;/span&gt;
&lt;span class="gi"&gt;+            return WCSGeometry.create_from_dict(geometry)&lt;/span&gt;
&lt;span class="gi"&gt;+        elif isinstance(geometry, WCSGeometry):&lt;/span&gt;
&lt;span class="gi"&gt;+            return geometry&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            raise TypeError(f'geometry must be of type dict or `WCSGeometry`. You gave {type(geometry)}')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
     @property
     def celestial_frame(self) -&amp;gt; str:
         """Celestial frame for the given WCS (str).

commit 1980881927671773de80051ea78b79bdac61a484
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Aug 1 16:03:48 2017 +0500

    Introduce precise drawing algorithm

&lt;span class="gh"&gt;diff --git a/hips/draw/paint.py b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8114b02..7ea03b1 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/paint.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -17,8 +17,6 @@ __doctest_skip__ = [&lt;/span&gt;
 ]


&lt;span class="gd"&gt;-# TODO for Adeel: add option "precise".&lt;/span&gt;
&lt;span class="gd"&gt;-# Should be default "true" eventually, for now, can use "false" if it's very slow.&lt;/span&gt;
 class HipsPainter:
     """Paint a sky image from HiPS image tiles.

&lt;span class="gu"&gt;@@ -34,6 +32,8 @@ class HipsPainter:&lt;/span&gt;
         HiPS survey properties
     tile_format : {'fits', 'jpg', 'png'}
         Format of HiPS tile
&lt;span class="gi"&gt;+    precise : bool&lt;/span&gt;
&lt;span class="gi"&gt;+        Use the precise drawing algorithm&lt;/span&gt;

     Examples
     --------
&lt;span class="gu"&gt;@@ -56,10 +56,11 @@ class HipsPainter:&lt;/span&gt;
     (1000, 2000)
     """

&lt;span class="gd"&gt;-    def __init__(self, geometry: WCSGeometry, hips_survey: Union[str, HipsSurveyProperties], tile_format: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, geometry: WCSGeometry, hips_survey: Union[str, HipsSurveyProperties], tile_format: str, precise: bool = False) -&amp;gt; None:&lt;/span&gt;
         self.geometry = geometry
         self.hips_survey = HipsSurveyProperties.make(hips_survey)
         self.tile_format = tile_format
&lt;span class="gi"&gt;+        self.precise = precise&lt;/span&gt;
         self._tiles = None
         self.float_image = None
         self._stats: Dict[str, Any] = {}
&lt;span class="gu"&gt;@@ -161,21 +162,23 @@ class HipsPainter:&lt;/span&gt;
         # Other useful info: number of tiles fetched

     def make_tile_list(self):
&lt;span class="gd"&gt;-        # Fetch all tiles needed&lt;/span&gt;
         parent_tiles = self.tiles

&lt;span class="gd"&gt;-        # TODO for Adeel: implement distortion correction here.&lt;/span&gt;
&lt;span class="gd"&gt;-        # Create new list of tiles, where some have been replaced by 4 children.&lt;/span&gt;
         # Suggestion: for now, just split once, no recursion.
         # Leave TODO, to discuss with Thomas next week.
         # See also: https://github.com/hipspy/hips/issues/92

&lt;span class="gd"&gt;-        # For now, we just create a 1:1 copy&lt;/span&gt;
&lt;span class="gd"&gt;-        tiles = []&lt;/span&gt;
&lt;span class="gd"&gt;-        for tile in parent_tiles:&lt;/span&gt;
&lt;span class="gd"&gt;-            tiles.append(tile)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        self.draw_tiles = tiles&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.precise == True:&lt;/span&gt;
&lt;span class="gi"&gt;+            tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+            for tile in parent_tiles:&lt;/span&gt;
&lt;span class="gi"&gt;+                corners = tile.meta.skycoord_corners.to_pixel(self.geometry.wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+                if is_tile_distorted(corners):&lt;/span&gt;
&lt;span class="gi"&gt;+                    tiles.append(tile.children)&lt;/span&gt;
&lt;span class="gi"&gt;+                else:&lt;/span&gt;
&lt;span class="gi"&gt;+                    tiles.append(tile)&lt;/span&gt;
&lt;span class="gi"&gt;+            self.draw_tiles = [tile for children in tiles for tile in children]&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            self.draw_tiles = parent_tiles&lt;/span&gt;

     def _make_empty_sky_image(self):
         shape = compute_image_shape(
&lt;span class="gu"&gt;@@ -207,7 +210,8 @@ class HipsPainter:&lt;/span&gt;
         not something end-users will call or need to know about.
         """
         import matplotlib.pyplot as plt
&lt;span class="gd"&gt;-        for tile in self.tiles:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.make_tile_list()&lt;/span&gt;
&lt;span class="gi"&gt;+        for tile in self.draw_tiles:&lt;/span&gt;
             corners = tile.meta.skycoord_corners.transform_to(self.geometry.celestial_frame)
             ax = plt.subplot(projection=self.geometry.wcs)
             opts = dict(color='red', lw=1, )
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_ui.py b/hips/draw/tests/test_ui.py&lt;/span&gt;
&lt;span class="gh"&gt;index 401874c..dc8238d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_ui.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_ui.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -16,7 +16,8 @@ make_sky_image_pars = [&lt;/span&gt;
         data_2=2296,
         data_sum=8756493140,
         dtype='&amp;gt;i2',
&lt;span class="gd"&gt;-        repr='HipsDrawResult(width=1000, height=2000, channels=2, dtype=&amp;gt;i2, format=fits)'&lt;/span&gt;
&lt;span class="gi"&gt;+        repr='HipsDrawResult(width=1000, height=2000, channels=2, dtype=&amp;gt;i2, format=fits)',&lt;/span&gt;
&lt;span class="gi"&gt;+        precise=False&lt;/span&gt;
     ),
     dict(
         file_format='jpg',
&lt;span class="gu"&gt;@@ -26,7 +27,19 @@ make_sky_image_pars = [&lt;/span&gt;
         data_2=[137, 116, 114],
         data_sum=828908873,
         dtype='uint8',
&lt;span class="gd"&gt;-        repr='HipsDrawResult(width=1000, height=2000, channels=3, dtype=uint8, format=jpg)'&lt;/span&gt;
&lt;span class="gi"&gt;+        repr='HipsDrawResult(width=1000, height=2000, channels=3, dtype=uint8, format=jpg)',&lt;/span&gt;
&lt;span class="gi"&gt;+        precise=False&lt;/span&gt;
&lt;span class="gi"&gt;+    ),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(&lt;/span&gt;
&lt;span class="gi"&gt;+        file_format='jpg',&lt;/span&gt;
&lt;span class="gi"&gt;+        shape=(1000, 2000, 3),&lt;/span&gt;
&lt;span class="gi"&gt;+        url='https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/FermiColor/properties',&lt;/span&gt;
&lt;span class="gi"&gt;+        data_1=[139, 114, 115],&lt;/span&gt;
&lt;span class="gi"&gt;+        data_2=[142, 113, 110],&lt;/span&gt;
&lt;span class="gi"&gt;+        data_sum=825148172,&lt;/span&gt;
&lt;span class="gi"&gt;+        dtype='uint8',&lt;/span&gt;
&lt;span class="gi"&gt;+        repr='HipsDrawResult(width=1000, height=2000, channels=3, dtype=uint8, format=jpg)',&lt;/span&gt;
&lt;span class="gi"&gt;+        precise=True&lt;/span&gt;
     ),
     dict(
         file_format='png',
&lt;span class="gu"&gt;@@ -36,7 +49,8 @@ make_sky_image_pars = [&lt;/span&gt;
         data_2=[227, 217, 205, 255],
         data_sum=1635622838,
         dtype='uint8',
&lt;span class="gd"&gt;-        repr='HipsDrawResult(width=1000, height=2000, channels=3, dtype=uint8, format=png)'&lt;/span&gt;
&lt;span class="gi"&gt;+        repr='HipsDrawResult(width=1000, height=2000, channels=3, dtype=uint8, format=png)',&lt;/span&gt;
&lt;span class="gi"&gt;+        precise=False&lt;/span&gt;
     ),
 ]

&lt;span class="gu"&gt;@@ -47,7 +61,7 @@ def test_make_sky_image(tmpdir, pars):&lt;/span&gt;
     hips_survey = HipsSurveyProperties.fetch(url=pars['url'])
     geometry = make_test_wcs_geometry()

&lt;span class="gd"&gt;-    result = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format=pars['file_format'])&lt;/span&gt;
&lt;span class="gi"&gt;+    result = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format=pars['file_format'], precise=pars['precise'])&lt;/span&gt;

     assert result.image.shape == pars['shape']
     assert result.image.dtype == pars['dtype']
&lt;span class="gh"&gt;diff --git a/hips/draw/ui.py b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gh"&gt;index 11facac..8a1db36 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/ui.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -15,7 +15,7 @@ __all__ = [&lt;/span&gt;


 def make_sky_image(geometry: WCSGeometry, hips_survey: Union[str, 'HipsSurveyProperties'],
&lt;span class="gd"&gt;-                   tile_format: str) -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
&lt;span class="gi"&gt;+                   tile_format: str, precise: bool = False) -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
     """Make sky image: fetch tiles and draw.

     The example for this can be found on the :ref:`gs` page.
&lt;span class="gu"&gt;@@ -29,13 +29,15 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: Union[str, 'HipsSurveyPro&lt;/span&gt;
     tile_format : {'fits', 'jpg', 'png'}
         Format of HiPS tile to use
         (some surveys are available in several formats, so this extra argument is needed)
&lt;span class="gi"&gt;+    precise : bool&lt;/span&gt;
&lt;span class="gi"&gt;+        Use the precise drawing algorithm&lt;/span&gt;

     Returns
     -------
     result : `~hips.HipsDrawResult`
         Result object
     """
&lt;span class="gd"&gt;-    painter = HipsPainter(geometry, hips_survey, tile_format)&lt;/span&gt;
&lt;span class="gi"&gt;+    painter = HipsPainter(geometry, hips_survey, tile_format, precise)&lt;/span&gt;
     painter.run()
     return HipsDrawResult.from_painter(painter)

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index eeef134..c2712f7 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -82,7 +82,7 @@ HIPS_TILE_TEST_CASES = [&lt;/span&gt;
         child_shape=(256, 256),
         child_ipix=[1852, 1853, 1854, 1855],
         child_pix_idx=[[255], [255]],
&lt;span class="gd"&gt;-        child_pix_val=[2153, 2418, 2437, 2124],&lt;/span&gt;
&lt;span class="gi"&gt;+        child_pix_val=[2437, 2153, 2124, 2418],&lt;/span&gt;
     ),
     dict(
         label='jpg',
&lt;span class="gu"&gt;@@ -99,7 +99,7 @@ HIPS_TILE_TEST_CASES = [&lt;/span&gt;
         child_shape=(256, 256, 3),
         child_ipix=[1852, 1853, 1854, 1855],
         child_pix_idx=[[255], [255]],
&lt;span class="gd"&gt;-        child_pix_val=[[[245, 214, 211]], [[137, 97, 87]], [[255, 241, 225]], [[109, 95, 86]]],&lt;/span&gt;
&lt;span class="gi"&gt;+        child_pix_val=[[[255, 241, 225]], [[245, 214, 211]], [[109, 95, 86]], [[137, 97, 87]]],&lt;/span&gt;
     ),
     dict(
         label='png',
&lt;span class="gu"&gt;@@ -116,7 +116,7 @@ HIPS_TILE_TEST_CASES = [&lt;/span&gt;
         child_shape=(256, 256, 4),
         child_ipix=[24448, 24449, 24450, 24451],
         child_pix_idx=[[255], [255]],
&lt;span class="gd"&gt;-        child_pix_val=[[[17, 17, 17, 255]], [[13, 13, 13, 255]], [[15, 15, 15, 255]], [[20, 20, 20, 255]]],&lt;/span&gt;
&lt;span class="gi"&gt;+        child_pix_val=[[[15,  15,  15, 255]], [[17, 17, 17, 255]], [[20, 20, 20, 255]], [[13, 13, 13, 255]]],&lt;/span&gt;
     ),
 ]

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index eebaeb7..88ae6ca 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -231,10 +231,10 @@ class HipsTile:&lt;/span&gt;
         """Create four children tiles from parent tile."""
         w = self.data.shape[0] // 2
         data = [
&lt;span class="gd"&gt;-            self.data[0: w, 0: w],&lt;/span&gt;
&lt;span class="gd"&gt;-            self.data[0: w, w: w * 2],&lt;/span&gt;
             self.data[w: w * 2, 0: w],
&lt;span class="gd"&gt;-            self.data[w: w * 2, w: w * 2]&lt;/span&gt;
&lt;span class="gi"&gt;+            self.data[0: w, 0: w],&lt;/span&gt;
&lt;span class="gi"&gt;+            self.data[w: w * 2, w: w * 2],&lt;/span&gt;
&lt;span class="gi"&gt;+            self.data[0: w, w: w * 2]&lt;/span&gt;
         ]

         tiles = []
&lt;span class="gu"&gt;@@ -243,7 +243,8 @@ class HipsTile:&lt;/span&gt;
                 self.meta.order + 1,
                 self.meta.ipix * 4 + idx,
                 self.meta.file_format,
&lt;span class="gd"&gt;-                self.meta.frame&lt;/span&gt;
&lt;span class="gi"&gt;+                self.meta.frame,&lt;/span&gt;
&lt;span class="gi"&gt;+                len(data[0])&lt;/span&gt;
             )
             tile = self.from_numpy(meta, data[idx])
             tiles.append(tile)

commit 09906ec66668c829a9ca0375840e77090d50de2a
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jul 27 18:19:06 2017 +0500

    Add option to create HipsSurveyProperties from survey name

&lt;span class="gh"&gt;diff --git a/docs/getting_started.rst b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gh"&gt;index 88cdf06..c308ea1 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -26,21 +26,16 @@ To draw a sky image from HiPS image tiles with the `hips` package, follow the fo&lt;/span&gt;
          coordsys='galactic', projection='AIT',
     )

&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-2. Specify the HiPS survey you want by creating a `~hips.HipsSurveyProperties` object.&lt;/span&gt;
&lt;span class="gi"&gt;+2. Specify the HiPS survey you want. You just need to provide a valid HiPS survey ID.&lt;/span&gt;

    A good address that lists available HiPS data is http://aladin.u-strasbg.fr/hips/list ::

&lt;span class="gd"&gt;-    from hips import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gd"&gt;-    url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'&lt;/span&gt;
&lt;span class="gd"&gt;-    hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey = 'CDS/P/DSS2/red'&lt;/span&gt;

 3. Call the `~hips.make_sky_image` function to fetch the HiPS data
    and draw it, returning an object of `~hips.HipsDrawResult`::

     from hips import make_sky_image
&lt;span class="gd"&gt;-&lt;/span&gt;
     result = make_sky_image(geometry, hips_survey, 'fits')

 Of course, you could change the parameters to chose any sky image geometry and
&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 5f06e9d..a8fe05f 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -4,7 +4,7 @@ import time&lt;/span&gt;
 import numpy as np
 from PIL import Image
 from astropy.io import fits
&lt;span class="gd"&gt;-from typing import List, Tuple&lt;/span&gt;
&lt;span class="gi"&gt;+from typing import List, Tuple, Union&lt;/span&gt;
 from astropy.wcs.utils import proj_plane_pixel_scales
 from skimage.transform import ProjectiveTransform, warp
 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta
&lt;span class="gu"&gt;@@ -61,7 +61,7 @@ class HipsPainter:&lt;/span&gt;
     (1000, 2000)
     """

&lt;span class="gd"&gt;-    def __init__(self, geometry: WCSGeometry, hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, geometry: WCSGeometry, hips_survey: Union[str, HipsSurveyProperties], tile_format: str) -&amp;gt; None:&lt;/span&gt;
         self.geometry = geometry
         self.hips_survey = HipsSurveyProperties.make(hips_survey)
         self.tile_format = tile_format
&lt;span class="gu"&gt;@@ -382,7 +382,7 @@ def plot_mpl_single_tile(geometry: WCSGeometry, tile: HipsTile, image: np.ndarra&lt;/span&gt;
     ax.imshow(image, origin='lower')


&lt;span class="gd"&gt;-def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
&lt;span class="gi"&gt;+def make_sky_image(geometry: WCSGeometry, hips_survey: Union[str, 'HipsSurveyProperties'], tile_format: str) -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
     """Make sky image: fetch tiles and draw.

     The example for this can be found on the :ref:`gs` page.
&lt;span class="gu"&gt;@@ -399,8 +399,8 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties, til&lt;/span&gt;

     Returns
     -------
&lt;span class="gd"&gt;-    image : `~numpy.ndarray`&lt;/span&gt;
&lt;span class="gd"&gt;-        Output image pixels&lt;/span&gt;
&lt;span class="gi"&gt;+    result : `~hips.HipsDrawResult`&lt;/span&gt;
&lt;span class="gi"&gt;+        Result object&lt;/span&gt;
     """
     painter = HipsPainter(geometry, hips_survey, tile_format)
     painter.run()
&lt;span class="gh"&gt;diff --git a/hips/tiles/surveys.py b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gh"&gt;index 614ce1f..41165f4 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -3,7 +3,7 @@ from collections import OrderedDict&lt;/span&gt;
 from io import StringIO
 from csv import DictWriter
 import urllib.request
&lt;span class="gd"&gt;-from typing import List&lt;/span&gt;
&lt;span class="gi"&gt;+from typing import List, Union&lt;/span&gt;
 from astropy.table import Table
 from .tile import HipsTileMeta

&lt;span class="gu"&gt;@@ -44,33 +44,22 @@ class HipsSurveyProperties:&lt;/span&gt;
     def __init__(self, data: OrderedDict) -&amp;gt; None:
         self.data = data

&lt;span class="gd"&gt;-    # TODO for Adeel: implement this (add docstring &amp;amp; test)&lt;/span&gt;
     @classmethod
&lt;span class="gd"&gt;-    def from_name(cls, name):&lt;/span&gt;
&lt;span class="gd"&gt;-        """&lt;/span&gt;
&lt;span class="gd"&gt;-        """&lt;/span&gt;
&lt;span class="gi"&gt;+    def from_name(cls, name: str) -&amp;gt; 'HipsSurveyProperties':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Create object from Survey ID (`HipsSurveyProperties`)."""&lt;/span&gt;
         # TODO: implement some kind of caching for HipsSurveyPropertiesList
&lt;span class="gd"&gt;-        # Also update the getting started example to use this simple solution.&lt;/span&gt;
&lt;span class="gd"&gt;-        # Discuss with Thomas how to do it.&lt;/span&gt;
&lt;span class="gd"&gt;-        # See https://github.com/hipspy/hips/issues/81&lt;/span&gt;
         surveys = HipsSurveyPropertiesList.fetch()
&lt;span class="gd"&gt;-        for survey in surveys.data:&lt;/span&gt;
&lt;span class="gd"&gt;-            if survey.data['ID'].strip() == name.strip():&lt;/span&gt;
&lt;span class="gd"&gt;-                return survey&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        raise KeyError(f'Survey not found: {name}')&lt;/span&gt;
&lt;span class="gi"&gt;+        return surveys.from_name(name)&lt;/span&gt;

     @classmethod
&lt;span class="gd"&gt;-    def make(cls, hips_survey):&lt;/span&gt;
&lt;span class="gd"&gt;-        """Convenience constructor from string or existing object."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return hips_survey&lt;/span&gt;
&lt;span class="gd"&gt;-        # TODO for Adeel: Implement the `HipsSurveyProperties.from_name` and add a test for this lookup by name&lt;/span&gt;
&lt;span class="gd"&gt;-        # if isinstance(hips_survey, str):&lt;/span&gt;
&lt;span class="gd"&gt;-        #     hips_survey = HipsSurveyProperties.from_name(hips_survey)&lt;/span&gt;
&lt;span class="gd"&gt;-        # elif isinstance(hips_survey, HipsSurveyProperties):&lt;/span&gt;
&lt;span class="gd"&gt;-        #     pass&lt;/span&gt;
&lt;span class="gd"&gt;-        # else:&lt;/span&gt;
&lt;span class="gd"&gt;-        #     raise TypeError(f'hips_survey must be str or HipsSurveyProperties. You gave {type(hips_survey)}')&lt;/span&gt;
&lt;span class="gi"&gt;+    def make(cls, hips_survey: Union[str, 'HipsSurveyProperties']) -&amp;gt; 'HipsSurveyProperties':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Convenience constructor for from_string classmethod or existing object (`HipsSurveyProperties`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        if isinstance(hips_survey, str):&lt;/span&gt;
&lt;span class="gi"&gt;+            return HipsSurveyProperties.from_name(hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+        elif isinstance(hips_survey, HipsSurveyProperties):&lt;/span&gt;
&lt;span class="gi"&gt;+            return hips_survey&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            raise TypeError(f'hips_survey must be of type str or `HipsSurveyProperties`. You gave {type(hips_survey)}')&lt;/span&gt;

     @classmethod
     def read(cls, filename: str) -&amp;gt; 'HipsSurveyProperties':
&lt;span class="gu"&gt;@@ -294,3 +283,11 @@ class HipsSurveyPropertiesList:&lt;/span&gt;
         writer.writeheader()
         writer.writerows(rows)
         return Table.read(buffer.getvalue(), format='ascii.csv', guess=False)
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def from_name(self, name: str) -&amp;gt; 'HipsSurveyProperties':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Return a matching HiPS survey (`HipsSurveyProperties`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        for survey in self.data:&lt;/span&gt;
&lt;span class="gi"&gt;+            if survey.data['ID'].strip() == name.strip():&lt;/span&gt;
&lt;span class="gi"&gt;+                return survey&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        raise KeyError(f'Survey not found: {name}')&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_surveys.py b/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gh"&gt;index b6d6a94..e8fb0be 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,4 +1,5 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gi"&gt;+import pytest&lt;/span&gt;
 from numpy.testing import assert_allclose
 from astropy.utils.data import get_pkg_data_filename
 from astropy.tests.helper import remote_data
&lt;span class="gu"&gt;@@ -11,33 +12,44 @@ class TestHipsSurveyProperties:&lt;/span&gt;
     @classmethod
     def setup_class(cls):
         filename = get_pkg_data_filename('data/properties.txt')
&lt;span class="gd"&gt;-        cls.hips_survey = HipsSurveyProperties.read(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.survey = HipsSurveyProperties.read(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_from_name(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        survey = HipsSurveyProperties.from_name('CDS/P/2MASS/color')&lt;/span&gt;
&lt;span class="gi"&gt;+        assert survey.title == '2MASS color J (1.23 microns), H (1.66 microns), K (2.16 microns)'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_make(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        survey = HipsSurveyProperties.make('CDS/P/EGRET/Dif/300-500')&lt;/span&gt;
&lt;span class="gi"&gt;+        assert survey.title == 'EGRET Dif 300-500'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.survey is HipsSurveyProperties.make(self.survey)&lt;/span&gt;

     def test_title(self):
&lt;span class="gd"&gt;-        assert self.hips_survey.title == 'DSS colored'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.survey.title == 'DSS colored'&lt;/span&gt;

     def test_hips_version(self):
&lt;span class="gd"&gt;-        assert self.hips_survey.hips_version == '1.31'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.survey.hips_version == '1.31'&lt;/span&gt;

     def test_hips_frame(self):
&lt;span class="gd"&gt;-        assert self.hips_survey.hips_frame == 'equatorial'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.survey.hips_frame == 'equatorial'&lt;/span&gt;

     def test_astropy_frame(self):
&lt;span class="gd"&gt;-        assert self.hips_survey.astropy_frame == 'icrs'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.survey.astropy_frame == 'icrs'&lt;/span&gt;

     def test_hips_order(self):
&lt;span class="gd"&gt;-        assert self.hips_survey.hips_order == 9&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.survey.hips_order == 9&lt;/span&gt;

     def test_tile_format(self):
&lt;span class="gd"&gt;-        assert self.hips_survey.tile_format == 'jpeg'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.survey.tile_format == 'jpeg'&lt;/span&gt;

     def test_base_url(self):
         expected = 'http://alasky.u-strasbg.fr/DSS/DSSColor'
&lt;span class="gd"&gt;-        assert self.hips_survey.base_url == expected&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.survey.base_url == expected&lt;/span&gt;

     def test_tile_default_url(self):
         tile_meta = HipsTileMeta(order=9, ipix=54321, file_format='fits')
&lt;span class="gd"&gt;-        url = self.hips_survey.tile_url(tile_meta)&lt;/span&gt;
&lt;span class="gi"&gt;+        url = self.survey.tile_url(tile_meta)&lt;/span&gt;
         assert url == 'http://alasky.u-strasbg.fr/DSS/DSSColor/Norder9/Dir50000/Npix54321.fits'

     @staticmethod
&lt;span class="gu"&gt;@@ -85,8 +97,12 @@ class TestHipsSurveyPropertiesList:&lt;/span&gt;
         surveys = HipsSurveyPropertiesList.fetch()
         assert len(surveys.data) &amp;gt; 3

&lt;span class="gd"&gt;-        # TODO: look up survey by name here&lt;/span&gt;
&lt;span class="gd"&gt;-        # Otherwise this will break when the list changes&lt;/span&gt;
&lt;span class="gd"&gt;-        survey = surveys.data[0]&lt;/span&gt;
&lt;span class="gi"&gt;+        survey = surveys.from_name('CDS/P/2MASS/H')&lt;/span&gt;
         assert survey.title == '2MASS H (1.66 microns)'
         assert survey.hips_order == 9
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_key_error(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        with pytest.raises(KeyError):&lt;/span&gt;
&lt;span class="gi"&gt;+            surveys = HipsSurveyPropertiesList.fetch()&lt;/span&gt;
&lt;span class="gi"&gt;+            surveys.from_name('Kronka Lonka')&lt;/span&gt;

commit 821f335f3f6c5ba912bcfdbf2ea55e1d51e6be82
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jul 25 19:30:10 2017 +0500

    Update high-level docs example

&lt;span class="gh"&gt;diff --git a/docs/getting_started.rst b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gh"&gt;index ac958e1..0771e95 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -37,22 +37,34 @@ To make a sky image with the `hips` package, follow the following three steps:&lt;/span&gt;


 3. Call the `~hips.make_sky_image` function to fetch the HiPS data
&lt;span class="gd"&gt;-   and draw it, returning the sky image pixel data as a Numpy array::&lt;/span&gt;
&lt;span class="gi"&gt;+   and draw it, returning an object of `~hips.HipsDrawResult`::&lt;/span&gt;

     from hips import make_sky_image

&lt;span class="gd"&gt;-    data = make_sky_image(geometry, hips_survey, 'fits')&lt;/span&gt;
&lt;span class="gi"&gt;+    result = make_sky_image(geometry, hips_survey, 'fits')&lt;/span&gt;


 That's it. Go ahead and try it out for your favourite sky region and survey.

 Now you can then save the sky image to local disk e.g. FITS file format::

&lt;span class="gd"&gt;-    from astropy.io import fits&lt;/span&gt;
&lt;span class="gd"&gt;-    hdu = fits.PrimaryHDU(data=data, header=geometry.fits_header)&lt;/span&gt;
&lt;span class="gd"&gt;-    hdu.writeto('my_image.fits')&lt;/span&gt;
&lt;span class="gi"&gt;+    result.write_image('my_image.fits')&lt;/span&gt;

&lt;span class="gd"&gt;-or plot and analyse the sky image however you like.&lt;/span&gt;
&lt;span class="gi"&gt;+The ``result`` object also contains other useful information, such as::&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    result.image&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+will return a NumPy array containing pixel data, you can also get the WCS information using::&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    result.geometry&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+If you want, you could also print out information about the ``result``::&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    print(result)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+or plot and analyse the sky image using::&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    result.plot()&lt;/span&gt;

 If you execute the example above, you will get this sky image which was plotted using `astropy.visualization.wcsaxes`

&lt;span class="gh"&gt;diff --git a/docs/plot_fits.py b/docs/plot_fits.py&lt;/span&gt;
&lt;span class="gh"&gt;index 14bcb18..bc1f860 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/plot_fits.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/plot_fits.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -10,11 +10,11 @@ geometry = WCSGeometry.create(&lt;/span&gt;
     width=2000, height=1000, fov="3 deg",
     coordsys='galactic', projection='AIT',
 )
&lt;span class="gd"&gt;-image = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format='fits')&lt;/span&gt;
&lt;span class="gi"&gt;+result = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format='fits')&lt;/span&gt;

 # Draw the sky image
 import matplotlib.pyplot as plt
 from astropy.visualization.mpl_normalize import simple_norm
 ax = plt.subplot(projection=geometry.wcs)
&lt;span class="gd"&gt;-norm = simple_norm(image, 'sqrt', min_percent=1, max_percent=99)&lt;/span&gt;
&lt;span class="gd"&gt;-ax.imshow(image, origin='lower', norm=norm, cmap='gray')&lt;/span&gt;
&lt;span class="gi"&gt;+norm = simple_norm(result.image, 'sqrt', min_percent=1, max_percent=99)&lt;/span&gt;
&lt;span class="gi"&gt;+ax.imshow(result.image, origin='lower', norm=norm, cmap='gray')&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/docs/plot_jpg.py b/docs/plot_jpg.py&lt;/span&gt;
&lt;span class="gh"&gt;index ba3b852..1eb111b 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/plot_jpg.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/plot_jpg.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -10,9 +10,9 @@ geometry = WCSGeometry.create(&lt;/span&gt;
     width=2000, height=1000, fov="3 deg",
     coordsys='galactic', projection='AIT',
 )
&lt;span class="gd"&gt;-image = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format='jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+result = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format='jpg')&lt;/span&gt;

 # Draw the sky image
 import matplotlib.pyplot as plt
 ax = plt.subplot(projection=geometry.wcs)
&lt;span class="gd"&gt;-ax.imshow(image, origin='lower')&lt;/span&gt;
&lt;span class="gi"&gt;+ax.imshow(result.image, origin='lower')&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 2539df3..a6dc4d7 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -129,7 +129,8 @@ class SimpleTilePainter:&lt;/span&gt;

     @property
     def result(self) -&amp;gt; 'HipsDrawResult':
&lt;span class="gd"&gt;-        return HipsDrawResult(self.image, self.geometry, self.tile_format)&lt;/span&gt;
&lt;span class="gi"&gt;+        """Return an object of `~hips.HipsDrawResult` class."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return HipsDrawResult(self.image, self.geometry, self.tile_format, self.tiles)&lt;/span&gt;

     def warp_image(self, tile: HipsTile) -&amp;gt; np.ndarray:
         """Warp a HiPS tile and a sky image."""
&lt;span class="gu"&gt;@@ -189,25 +190,31 @@ class HipsDrawResult:&lt;/span&gt;
         An object of WCSGeometry
     tile_format : {'fits', 'jpg', 'png'}
         Format of HiPS tile
&lt;span class="gi"&gt;+    tiles: List[HipsTile]&lt;/span&gt;
     """

&lt;span class="gd"&gt;-    def __init__(self, image: np.ndarray, geometry: WCSGeometry, tile_format: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, image: np.ndarray, geometry: WCSGeometry, tile_format: str, tiles: List[HipsTile]) -&amp;gt; None:&lt;/span&gt;
         self.image = image
         self.geometry = geometry
         self.tile_format = tile_format
&lt;span class="gi"&gt;+        self.tiles = tiles&lt;/span&gt;

     def __str__(self):
         return (
&lt;span class="gd"&gt;-            'This class object contains two attributes: image and geometry'&lt;/span&gt;
&lt;span class="gi"&gt;+            'HiPS draw result:\n'&lt;/span&gt;
&lt;span class="gi"&gt;+            f'Sky image: shape={self.image.shape}, dtype={self.image.dtype}\n'&lt;/span&gt;
&lt;span class="gi"&gt;+            f'WCS geometry: {self.geometry}\n'&lt;/span&gt;
         )

     def __repr__(self):
         return (
&lt;span class="gi"&gt;+            'HipsDrawResult('&lt;/span&gt;
             f'width={self.image.shape[0]}, '
             f'height={self.image.shape[1]}, '
             f'channels={self.image.ndim}, '
             f'dtype={self.image.dtype}, '
             f'format={self.tile_format}'
&lt;span class="gi"&gt;+            ')'&lt;/span&gt;
         )

     def write_image(self, filename: str) -&amp;gt; None:
&lt;span class="gu"&gt;@@ -219,12 +226,24 @@ class HipsDrawResult:&lt;/span&gt;
             Filename
         """
         if self.tile_format == 'fits':
&lt;span class="gd"&gt;-            hdu = fits.PrimaryHDU(self.image)&lt;/span&gt;
&lt;span class="gi"&gt;+            hdu = fits.PrimaryHDU(data=self.image, header=self.geometry.fits_header)&lt;/span&gt;
             hdu.writeto(filename)
         else:
             image = Image.fromarray(self.image)
             image.save(filename)

&lt;span class="gi"&gt;+    def plot(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Plot the all sky image using `astropy.visualization.wcsaxes` and showing the HEALPix grid."""&lt;/span&gt;
&lt;span class="gi"&gt;+        import matplotlib.pyplot as plt&lt;/span&gt;
&lt;span class="gi"&gt;+        for tile in self.tiles:&lt;/span&gt;
&lt;span class="gi"&gt;+            corners = tile.meta.skycoord_corners.transform_to(self.geometry.celestial_frame)&lt;/span&gt;
&lt;span class="gi"&gt;+            ax = plt.subplot(projection=self.geometry.wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+            opts = dict(color='red', lw=1, )&lt;/span&gt;
&lt;span class="gi"&gt;+            ax.plot(corners.data.lon.deg, corners.data.lat.deg,&lt;/span&gt;
&lt;span class="gi"&gt;+                    transform=ax.get_transform('world'), **opts)&lt;/span&gt;
&lt;span class="gi"&gt;+        ax.imshow(self.image, origin='lower')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 def measure_tile_shape(corners: tuple) -&amp;gt; Tuple[List[float]]:
     """Compute length of tile edges and diagonals."""
     x, y = corners
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index d038f43..4287862 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -19,7 +19,7 @@ make_sky_image_pars = [&lt;/span&gt;
         data_2=2296,
         data_sum=8756493140,
         dtype='&amp;gt;i2',
&lt;span class="gd"&gt;-        repr='width=1000, height=2000, channels=2, dtype=&amp;gt;i2, format=fits'&lt;/span&gt;
&lt;span class="gi"&gt;+        repr='HipsDrawResult(width=1000, height=2000, channels=2, dtype=&amp;gt;i2, format=fits)'&lt;/span&gt;
     ),
     dict(
         file_format='jpg',
&lt;span class="gu"&gt;@@ -29,7 +29,7 @@ make_sky_image_pars = [&lt;/span&gt;
         data_2=[137, 116, 114],
         data_sum=828908873,
         dtype='uint8',
&lt;span class="gd"&gt;-        repr='width=1000, height=2000, channels=3, dtype=uint8, format=jpg'&lt;/span&gt;
&lt;span class="gi"&gt;+        repr='HipsDrawResult(width=1000, height=2000, channels=3, dtype=uint8, format=jpg)'&lt;/span&gt;
     ),
     dict(
         file_format='png',
&lt;span class="gu"&gt;@@ -39,24 +39,25 @@ make_sky_image_pars = [&lt;/span&gt;
         data_2=[227, 217, 205, 255],
         data_sum=1635622838,
         dtype='uint8',
&lt;span class="gd"&gt;-        repr='width=1000, height=2000, channels=3, dtype=uint8, format=png'&lt;/span&gt;
&lt;span class="gi"&gt;+        repr='HipsDrawResult(width=1000, height=2000, channels=3, dtype=uint8, format=png)'&lt;/span&gt;
     ),
 ]


 @remote_data
 @pytest.mark.parametrize('pars', make_sky_image_pars)
&lt;span class="gd"&gt;-def test_make_sky_image(pars):&lt;/span&gt;
&lt;span class="gi"&gt;+def test_make_sky_image(tmpdir, pars):&lt;/span&gt;
     hips_survey = HipsSurveyProperties.fetch(url=pars['url'])
     geometry = make_test_wcs_geometry()
     result = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format=pars['file_format'])
     assert result.image.shape == pars['shape']
     assert result.image.dtype == pars['dtype']
&lt;span class="gi"&gt;+    assert repr(result) == pars['repr']&lt;/span&gt;
     assert_allclose(np.sum(result.image), pars['data_sum'])
     assert_allclose(result.image[200, 994], pars['data_1'])
     assert_allclose(result.image[200, 995], pars['data_2'])
&lt;span class="gd"&gt;-    # result.write_image('test.' + pars['file_format'])&lt;/span&gt;
&lt;span class="gd"&gt;-    assert repr(result) == pars['repr']&lt;/span&gt;
&lt;span class="gi"&gt;+    result.write_image(str(tmpdir / 'test.' + pars['file_format']))&lt;/span&gt;
&lt;span class="gi"&gt;+    result.plot()&lt;/span&gt;

 @remote_data
 class TestSimpleTilePainter:
&lt;span class="gh"&gt;diff --git a/hips/utils/wcs.py b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index 6268dc8..e43b049 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -58,6 +58,13 @@ class WCSGeometry:&lt;/span&gt;
         self.wcs = wcs
         self.shape = Shape(width=width, height=height)

&lt;span class="gi"&gt;+    def __str__(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        return (&lt;/span&gt;
&lt;span class="gi"&gt;+            'WCSGeometry data:\n'&lt;/span&gt;
&lt;span class="gi"&gt;+            f'WCS: {self.wcs}\n'&lt;/span&gt;
&lt;span class="gi"&gt;+            f'Shape: {self.shape}\n'&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
     @property
     def center_pix(self) -&amp;gt; Tuple[float, float]:
         """Image center in pixel coordinates (tuple of x, y)."""

commit c15092b116d5b02b601a2c087ef6a80fb82107d2
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jul 25 19:24:10 2017 +0500

    Add method write_image in HipsDrawResult class

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index c47eaa0..2539df3 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,6 +1,8 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 """HiPS tile drawing -- simple method."""
 import numpy as np
&lt;span class="gi"&gt;+from PIL import Image&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.io import fits&lt;/span&gt;
 from typing import List, Tuple
 from astropy.wcs.utils import proj_plane_pixel_scales
 from skimage.transform import ProjectiveTransform, warp
&lt;span class="gu"&gt;@@ -127,7 +129,7 @@ class SimpleTilePainter:&lt;/span&gt;

     @property
     def result(self) -&amp;gt; 'HipsDrawResult':
&lt;span class="gd"&gt;-        return HipsDrawResult(self.image, self.geometry)&lt;/span&gt;
&lt;span class="gi"&gt;+        return HipsDrawResult(self.image, self.geometry, self.tile_format)&lt;/span&gt;

     def warp_image(self, tile: HipsTile) -&amp;gt; np.ndarray:
         """Warp a HiPS tile and a sky image."""
&lt;span class="gu"&gt;@@ -177,12 +179,51 @@ class SimpleTilePainter:&lt;/span&gt;


 class HipsDrawResult:
&lt;span class="gd"&gt;-    """Container class for reporting information related with fetching / drawing of HiPS tiles."""&lt;/span&gt;
&lt;span class="gi"&gt;+    """Container class for reporting information related with fetching / drawing of HiPS tiles.&lt;/span&gt;

&lt;span class="gd"&gt;-    def __init__(self, image: np.ndarray, geometry: WCSGeometry) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    image: `~numpy.ndarray`&lt;/span&gt;
&lt;span class="gi"&gt;+        Container for HiPS tile data&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry : `~hips.utils.WCSGeometry`&lt;/span&gt;
&lt;span class="gi"&gt;+        An object of WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+    tile_format : {'fits', 'jpg', 'png'}&lt;/span&gt;
&lt;span class="gi"&gt;+        Format of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, image: np.ndarray, geometry: WCSGeometry, tile_format: str) -&amp;gt; None:&lt;/span&gt;
         self.image = image
         self.geometry = geometry
&lt;span class="gi"&gt;+        self.tile_format = tile_format&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __str__(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        return (&lt;/span&gt;
&lt;span class="gi"&gt;+            'This class object contains two attributes: image and geometry'&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;

&lt;span class="gi"&gt;+    def __repr__(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        return (&lt;/span&gt;
&lt;span class="gi"&gt;+            f'width={self.image.shape[0]}, '&lt;/span&gt;
&lt;span class="gi"&gt;+            f'height={self.image.shape[1]}, '&lt;/span&gt;
&lt;span class="gi"&gt;+            f'channels={self.image.ndim}, '&lt;/span&gt;
&lt;span class="gi"&gt;+            f'dtype={self.image.dtype}, '&lt;/span&gt;
&lt;span class="gi"&gt;+            f'format={self.tile_format}'&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def write_image(self, filename: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Write image to file.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        filename : str&lt;/span&gt;
&lt;span class="gi"&gt;+            Filename&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.tile_format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+            hdu = fits.PrimaryHDU(self.image)&lt;/span&gt;
&lt;span class="gi"&gt;+            hdu.writeto(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            image = Image.fromarray(self.image)&lt;/span&gt;
&lt;span class="gi"&gt;+            image.save(filename)&lt;/span&gt;

 def measure_tile_shape(corners: tuple) -&amp;gt; Tuple[List[float]]:
     """Compute length of tile edges and diagonals."""
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8985954..d038f43 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -19,6 +19,7 @@ make_sky_image_pars = [&lt;/span&gt;
         data_2=2296,
         data_sum=8756493140,
         dtype='&amp;gt;i2',
&lt;span class="gi"&gt;+        repr='width=1000, height=2000, channels=2, dtype=&amp;gt;i2, format=fits'&lt;/span&gt;
     ),
     dict(
         file_format='jpg',
&lt;span class="gu"&gt;@@ -28,6 +29,7 @@ make_sky_image_pars = [&lt;/span&gt;
         data_2=[137, 116, 114],
         data_sum=828908873,
         dtype='uint8',
&lt;span class="gi"&gt;+        repr='width=1000, height=2000, channels=3, dtype=uint8, format=jpg'&lt;/span&gt;
     ),
     dict(
         file_format='png',
&lt;span class="gu"&gt;@@ -37,6 +39,7 @@ make_sky_image_pars = [&lt;/span&gt;
         data_2=[227, 217, 205, 255],
         data_sum=1635622838,
         dtype='uint8',
&lt;span class="gi"&gt;+        repr='width=1000, height=2000, channels=3, dtype=uint8, format=png'&lt;/span&gt;
     ),
 ]

&lt;span class="gu"&gt;@@ -52,7 +55,8 @@ def test_make_sky_image(pars):&lt;/span&gt;
     assert_allclose(np.sum(result.image), pars['data_sum'])
     assert_allclose(result.image[200, 994], pars['data_1'])
     assert_allclose(result.image[200, 995], pars['data_2'])
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+    # result.write_image('test.' + pars['file_format'])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert repr(result) == pars['repr']&lt;/span&gt;

 @remote_data
 class TestSimpleTilePainter:

commit eddcaaa07028e59d2d8e8567cbf073d30bbd9ada
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jul 25 16:45:32 2017 +0500

    Introduce class HipsDrawResult in simple.py

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index b53bad8..c47eaa0 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -125,6 +125,10 @@ class SimpleTilePainter:&lt;/span&gt;

         return self._tiles

&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def result(self) -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
&lt;span class="gi"&gt;+        return HipsDrawResult(self.image, self.geometry)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
     def warp_image(self, tile: HipsTile) -&amp;gt; np.ndarray:
         """Warp a HiPS tile and a sky image."""
         return warp(
&lt;span class="gu"&gt;@@ -172,6 +176,14 @@ class SimpleTilePainter:&lt;/span&gt;
         ax.imshow(self.image, origin='lower')


&lt;span class="gi"&gt;+class HipsDrawResult:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Container class for reporting information related with fetching / drawing of HiPS tiles."""&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, image: np.ndarray, geometry: WCSGeometry) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.image = image&lt;/span&gt;
&lt;span class="gi"&gt;+        self.geometry = geometry&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 def measure_tile_shape(corners: tuple) -&amp;gt; Tuple[List[float]]:
     """Compute length of tile edges and diagonals."""
     x, y = corners
&lt;span class="gu"&gt;@@ -268,7 +280,7 @@ def plot_mpl_single_tile(geometry: WCSGeometry, tile: HipsTile, image: np.ndarra&lt;/span&gt;
     ax.imshow(image, origin='lower')


&lt;span class="gd"&gt;-def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; 'HipsDrawResult':&lt;/span&gt;
     """Make sky image: fetch tiles and draw.

     The example for this can be found on the :ref:`gs` page.
&lt;span class="gu"&gt;@@ -291,4 +303,4 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties, til&lt;/span&gt;
     painter = SimpleTilePainter(geometry, hips_survey, tile_format)
     painter.run()

&lt;span class="gd"&gt;-    return painter.image&lt;/span&gt;
&lt;span class="gi"&gt;+    return painter.result&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 6dbf340..8985954 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -46,12 +46,12 @@ make_sky_image_pars = [&lt;/span&gt;
 def test_make_sky_image(pars):
     hips_survey = HipsSurveyProperties.fetch(url=pars['url'])
     geometry = make_test_wcs_geometry()
&lt;span class="gd"&gt;-    image = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format=pars['file_format'])&lt;/span&gt;
&lt;span class="gd"&gt;-    assert image.shape == pars['shape']&lt;/span&gt;
&lt;span class="gd"&gt;-    assert image.dtype == pars['dtype']&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(np.sum(image), pars['data_sum'])&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(image[200, 994], pars['data_1'])&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(image[200, 995], pars['data_2'])&lt;/span&gt;
&lt;span class="gi"&gt;+    result = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format=pars['file_format'])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert result.image.shape == pars['shape']&lt;/span&gt;
&lt;span class="gi"&gt;+    assert result.image.dtype == pars['dtype']&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(np.sum(result.image), pars['data_sum'])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(result.image[200, 994], pars['data_1'])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(result.image[200, 995], pars['data_2'])&lt;/span&gt;


 @remote_data

commit 808e758d2cd9c04c31e0dc49318cf55d4f92cd18
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jul 24 14:09:33 2017 +0500

    Add method to_split in SimpleTilePainter for checking whether to split a tile

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index e9237e0..862f9e8 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -172,6 +172,29 @@ class SimpleTilePainter:&lt;/span&gt;
         ax.imshow(self.image, origin='lower')


&lt;span class="gi"&gt;+def _measure_tile_shape(corners: tuple) -&amp;gt; List[list]:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Compute length of tile edges and diagonals."""&lt;/span&gt;
&lt;span class="gi"&gt;+    x, y = corners&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def compute_distance(i: int, j: int) -&amp;gt; float:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Compute distance between two points."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return np.sqrt((x[i] - x[j]) ** 2 + (y[i] - y[j]) ** 2)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    edges = [compute_distance((i + 1) % 4, i) for i in range(4)]&lt;/span&gt;
&lt;span class="gi"&gt;+    diagonals = [compute_distance(0, 2), compute_distance(1, 3)]&lt;/span&gt;
&lt;span class="gi"&gt;+    ratio = float(np.min(diagonals) / np.max(diagonals))&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    return [edges, diagonals, ratio]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def _is_tile_distorted(corners: tuple) -&amp;gt; bool:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Implement tile splitting criteria as mentioned in :ref:`drawing_algo` page."""&lt;/span&gt;
&lt;span class="gi"&gt;+    edges, diagonals, ratio = _measure_tile_shape(corners)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    return max(edges) &amp;gt; 300 or \&lt;/span&gt;
&lt;span class="gi"&gt;+           max(diagonals) &amp;gt; 150 or \&lt;/span&gt;
&lt;span class="gi"&gt;+           ratio &amp;lt; 0.7&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 def tile_corner_pixel_coordinates(width, file_format) -&amp;gt; np.ndarray:
     """Tile corner pixel coordinates for projective transform.

&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index d3368f7..85e2d78 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -5,7 +5,7 @@ from numpy.testing import assert_allclose&lt;/span&gt;
 from astropy.coordinates import SkyCoord
 from astropy.tests.helper import remote_data
 from ...tiles import HipsSurveyProperties
&lt;span class="gd"&gt;-from ..simple import make_sky_image, SimpleTilePainter, plot_mpl_single_tile&lt;/span&gt;
&lt;span class="gi"&gt;+from ..simple import make_sky_image, SimpleTilePainter, plot_mpl_single_tile, _is_tile_distorted, _measure_tile_shape&lt;/span&gt;
 from ...utils.wcs import WCSGeometry
 from ...utils.testing import make_test_wcs_geometry, requires_hips_extra

&lt;span class="gu"&gt;@@ -86,6 +86,7 @@ class TestSimpleTilePainter:&lt;/span&gt;
             width=2000, height=1000, fov=pars['fov'],
             coordsys='icrs', projection='AIT',
         )
&lt;span class="gi"&gt;+&lt;/span&gt;
         simple_tile_painter = SimpleTilePainter(geometry, self.hips_survey, 'fits')
         assert simple_tile_painter.draw_hips_order == pars['order']

&lt;span class="gu"&gt;@@ -101,3 +102,28 @@ class TestSimpleTilePainter:&lt;/span&gt;
         tile = self.painter.tiles[3]
         image = self.painter.image
         plot_mpl_single_tile(self.geometry, tile, image)
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_corners(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        tile = self.painter.tiles[3]&lt;/span&gt;
&lt;span class="gi"&gt;+        x, y = tile.meta.skycoord_corners.to_pixel(self.geometry.wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(x, [764.627476, 999., 764.646551, 530.26981])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(y, [300.055412, 101.107245, -97.849955, 101.105373])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_is_tile_distorted(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        tile = self.painter.tiles[3]&lt;/span&gt;
&lt;span class="gi"&gt;+        corners = tile.meta.skycoord_corners.to_pixel(self.geometry.wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert _is_tile_distorted(corners) == True&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_measure_tile_shape(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        tile = self.painter.tiles[3]&lt;/span&gt;
&lt;span class="gi"&gt;+        corners = tile.meta.skycoord_corners.to_pixel(self.geometry.wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+        edges, diagonals, ratio = _measure_tile_shape(corners)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        edges_precomp = [307.426175, 307.417479, 307.434024, 307.41606]&lt;/span&gt;
&lt;span class="gi"&gt;+        diagonals_precomp = [397.905367, 468.73019]&lt;/span&gt;
&lt;span class="gi"&gt;+        ratio_precomp = 0.848900658905216&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(edges_precomp, edges)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(diagonals_precomp, diagonals)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(ratio_precomp, ratio)&lt;/span&gt;

commit e08ddcdf3c655021d5a0b96bb26ad50577e0e02a
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jul 20 12:32:51 2017 +0500

    Add property 'children' for creating four children tiles from parent tile

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index f8f156b..2957e40 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -59,8 +59,13 @@ HIPS_TILE_TEST_CASES = [&lt;/span&gt;

         dtype='int16',
         shape=(512, 512),
&lt;span class="gi"&gt;+        child_order=4,&lt;/span&gt;
&lt;span class="gi"&gt;+        child_shape=(256, 256),&lt;/span&gt;
         pix_idx=[[510], [5]],
         pix_val=[3047],
&lt;span class="gi"&gt;+        child_ipix=[1852, 1853, 1854, 1855],&lt;/span&gt;
&lt;span class="gi"&gt;+        child_pix_idx=[[0], [255]],&lt;/span&gt;
&lt;span class="gi"&gt;+        child_pix_val=[2407, 2321, 2465, 2835],&lt;/span&gt;
     ),
     dict(
         meta=dict(order=3, ipix=463, file_format='jpg'),
&lt;span class="gu"&gt;@@ -69,8 +74,13 @@ HIPS_TILE_TEST_CASES = [&lt;/span&gt;

         dtype='uint8',
         shape=(512, 512, 3),
&lt;span class="gi"&gt;+        child_order=4,&lt;/span&gt;
&lt;span class="gi"&gt;+        child_shape=(256, 256, 3),&lt;/span&gt;
         pix_idx=[[510], [5]],
         pix_val=[[116, 81, 61]],
&lt;span class="gi"&gt;+        child_ipix=[1852, 1853, 1854, 1855],&lt;/span&gt;
&lt;span class="gi"&gt;+        child_pix_idx=[[0], [255]],&lt;/span&gt;
&lt;span class="gi"&gt;+        child_pix_val=[[[255, 241, 225]], [[109, 95, 86]], [[245, 214, 211]], [[137, 97, 87]]],&lt;/span&gt;
     ),
     dict(
         meta=dict(order=6, ipix=6112, file_format='png'),
&lt;span class="gu"&gt;@@ -79,8 +89,13 @@ HIPS_TILE_TEST_CASES = [&lt;/span&gt;

         dtype='uint8',
         shape=(512, 512, 4),
&lt;span class="gi"&gt;+        child_order=7,&lt;/span&gt;
&lt;span class="gi"&gt;+        child_shape=(256, 256, 4),&lt;/span&gt;
         pix_idx=[[253], [5]],
         pix_val=[[19, 19, 19, 255]],
&lt;span class="gi"&gt;+        child_ipix=[24448, 24449, 24450, 24451],&lt;/span&gt;
&lt;span class="gi"&gt;+        child_pix_idx=[[0], [255]],&lt;/span&gt;
&lt;span class="gi"&gt;+        child_pix_val=[[[15, 15, 15, 255]], [[20, 20, 20, 255]], [[17, 17, 17, 255]], [[13, 13, 13, 255]]],&lt;/span&gt;
     ),
 ]

&lt;span class="gu"&gt;@@ -117,7 +132,19 @@ class TestHipsTile:&lt;/span&gt;
         data = tile.data
         assert data.shape == pars['shape']
         assert data.dtype.name == pars['dtype']
&lt;span class="gd"&gt;-        assert_equal(tile.data[pars['pix_idx']], pars['pix_val'])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_equal(data[pars['pix_idx']], pars['pix_val'])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @requires_hips_extra()&lt;/span&gt;
&lt;span class="gi"&gt;+    @pytest.mark.parametrize('pars', HIPS_TILE_TEST_CASES)&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_children(self, pars):&lt;/span&gt;
&lt;span class="gi"&gt;+        tile = self._read_tile(pars)&lt;/span&gt;
&lt;span class="gi"&gt;+        child_data = [_.data[pars['child_pix_idx']] for _ in tile.children]&lt;/span&gt;
&lt;span class="gi"&gt;+        child_ipix = [_.meta.ipix for _ in tile.children]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        assert tile.children[0].meta.order == pars['child_order']&lt;/span&gt;
&lt;span class="gi"&gt;+        assert tile.children[0].data.shape == pars['child_shape']&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_equal(child_ipix, pars['child_ipix'])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_equal(child_data, pars['child_pix_val'])&lt;/span&gt;

     @remote_data
     @requires_hips_extra()
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 2a86467..32f98c2 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -11,6 +11,7 @@ from astropy.coordinates import SkyCoord&lt;/span&gt;
 from astropy.io import fits
 from ..utils import healpix_pixel_corners
 from .io import tile_default_url, tile_default_path
&lt;span class="gi"&gt;+from typing import List&lt;/span&gt;

 __all__ = [
     'HipsTileMeta',
&lt;span class="gu"&gt;@@ -167,6 +168,29 @@ class HipsTile:&lt;/span&gt;
         return cls(meta, raw_data)

     @property
&lt;span class="gi"&gt;+    def children(self) -&amp;gt; List['HipsTile']:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Create four children tiles from parent tile."""&lt;/span&gt;
&lt;span class="gi"&gt;+        children_tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+        w = self.data.shape[0] // 2&lt;/span&gt;
&lt;span class="gi"&gt;+        child_data = [&lt;/span&gt;
&lt;span class="gi"&gt;+            self.data[0: w, 0: w],&lt;/span&gt;
&lt;span class="gi"&gt;+            self.data[0: w, w: w * 2],&lt;/span&gt;
&lt;span class="gi"&gt;+            self.data[w: w * 2, 0: w],&lt;/span&gt;
&lt;span class="gi"&gt;+            self.data[w: w * 2, w: w * 2]&lt;/span&gt;
&lt;span class="gi"&gt;+        ]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        for index, data in enumerate(child_data):&lt;/span&gt;
&lt;span class="gi"&gt;+            meta = HipsTileMeta(&lt;/span&gt;
&lt;span class="gi"&gt;+                self.meta.order + 1,&lt;/span&gt;
&lt;span class="gi"&gt;+                self.meta.ipix * 4 + index,&lt;/span&gt;
&lt;span class="gi"&gt;+                self.meta.file_format,&lt;/span&gt;
&lt;span class="gi"&gt;+                self.meta.frame&lt;/span&gt;
&lt;span class="gi"&gt;+            )&lt;/span&gt;
&lt;span class="gi"&gt;+            children_tiles.append(self.from_numpy(meta, data))&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        return children_tiles&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
     def data(self) -&amp;gt; np.ndarray:
         """Tile pixel data (`~numpy.ndarray`)."""
         fmt = self.meta.file_format

commit 9005878e851ee8f64ac498599bba8737a1fd83f4
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jul 18 13:31:41 2017 +0500

    Add methods for drawing markers over sky image

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index ae2dfc9..9811238 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,7 +1,7 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 """HiPS tile drawing -- simple method."""
&lt;span class="gd"&gt;-from typing import Tuple, List&lt;/span&gt;
 import numpy as np
&lt;span class="gi"&gt;+from typing import Tuple, List&lt;/span&gt;
 from astropy.wcs.utils import proj_plane_pixel_scales
 from skimage.transform import ProjectiveTransform, warp
 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta
&lt;span class="gu"&gt;@@ -9,8 +9,7 @@ from ..utils import WCSGeometry, compute_healpix_pixel_indices, get_hips_order_f&lt;/span&gt;

 __all__ = [
     'make_sky_image',
&lt;span class="gd"&gt;-    'SimpleTilePainter',&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+    'SimpleTilePainter'&lt;/span&gt;
 ]

 __doctest_skip__ = [
&lt;span class="gu"&gt;@@ -178,11 +177,49 @@ class SimpleTilePainter:&lt;/span&gt;

         return image

&lt;span class="gi"&gt;+    def draw_hips_tile_grid(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Draw lines on the output image (mainly used for debugging)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        import matplotlib.pyplot as plt&lt;/span&gt;
&lt;span class="gi"&gt;+        for tile in self.tiles:&lt;/span&gt;
&lt;span class="gi"&gt;+            corners = tile.meta.skycoord_corners.transform_to(self.geometry.celestial_frame)&lt;/span&gt;
&lt;span class="gi"&gt;+            ax = plt.subplot(projection=self.geometry.wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+            ax.plot(corners.data.lon.deg, corners.data.lat.deg,&lt;/span&gt;
&lt;span class="gi"&gt;+                    'red', lw=1, transform=ax.get_transform('icrs'))&lt;/span&gt;
&lt;span class="gi"&gt;+        ax.imshow(self.image, origin='lower')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
     def run(self) -&amp;gt; None:
         """Run all steps of the naive algorithm."""
         self.float_image = self.draw_tiles()


&lt;span class="gi"&gt;+def draw_debug_image(geometry: WCSGeometry, tile: HipsTile, image: np.ndarray) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Draw markers on the output image (mainly used for debugging).&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    The following denotes their correspondence:&lt;/span&gt;
&lt;span class="gi"&gt;+    * red &amp;lt;=&amp;gt; North&lt;/span&gt;
&lt;span class="gi"&gt;+    * green &amp;lt;=&amp;gt; West&lt;/span&gt;
&lt;span class="gi"&gt;+    * blue &amp;lt;=&amp;gt; South&lt;/span&gt;
&lt;span class="gi"&gt;+    * yellow &amp;lt;=&amp;gt; East&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry : `~hips.utils.WCSGeometry`&lt;/span&gt;
&lt;span class="gi"&gt;+        Geometry of the output image&lt;/span&gt;
&lt;span class="gi"&gt;+    tile : HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+        HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    image : np.ndarray&lt;/span&gt;
&lt;span class="gi"&gt;+        Image containing HiPS tiles&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+    import matplotlib.pyplot as plt&lt;/span&gt;
&lt;span class="gi"&gt;+    corners = tile.meta.skycoord_corners.transform_to(geometry.celestial_frame)&lt;/span&gt;
&lt;span class="gi"&gt;+    colors = ['red', 'green', 'blue', 'yellow']&lt;/span&gt;
&lt;span class="gi"&gt;+    ax = plt.subplot(projection=geometry.wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+    for index, corner in enumerate(corners):&lt;/span&gt;
&lt;span class="gi"&gt;+        ax.scatter(corner.data.lon.deg, corner.data.lat.deg,&lt;/span&gt;
&lt;span class="gi"&gt;+                   s=80, transform=ax.get_transform('icrs'), color=colors[index])&lt;/span&gt;
&lt;span class="gi"&gt;+    ax.imshow(image, origin='lower')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; np.ndarray:
     """Make sky image: fetch tiles and draw.

&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 22150ce..7e8faa2 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -5,7 +5,7 @@ from numpy.testing import assert_allclose&lt;/span&gt;
 from astropy.coordinates import SkyCoord
 from astropy.tests.helper import remote_data
 from ...tiles import HipsSurveyProperties
&lt;span class="gd"&gt;-from ..simple import make_sky_image, SimpleTilePainter&lt;/span&gt;
&lt;span class="gi"&gt;+from ..simple import make_sky_image, SimpleTilePainter, draw_debug_image&lt;/span&gt;
 from ...utils.wcs import WCSGeometry
 from ...utils.testing import make_test_wcs_geometry, requires_hips_extra

&lt;span class="gu"&gt;@@ -95,3 +95,9 @@ class TestSimpleTilePainter:&lt;/span&gt;
     def test_run(self):
         self.simple_tile_painter.run()
         assert_allclose(self.simple_tile_painter.image[200, 994], 2120)
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_draw_hips_tile_grid(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        self.simple_tile_painter.draw_hips_tile_grid()&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_draw_debug_image(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        draw_debug_image(self.geometry, self.simple_tile_painter.tiles[3], self.simple_tile_painter.image)&lt;/span&gt;

commit 46c78a036dec051bb9e6fb75adbf7fcd6a585301
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jul 18 20:16:34 2017 +0500

    Fix tile_width property in HipsSurveyProperties class

&lt;span class="gh"&gt;diff --git a/hips/tiles/surveys.py b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gh"&gt;index 28bc65b..f5c462b 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -128,7 +128,10 @@ class HipsSurveyProperties:&lt;/span&gt;
     @property
     def tile_width(self) -&amp;gt; int:
         """HiPS tile width"""
&lt;span class="gd"&gt;-        return int(self.data['hips_tile_width']) or 512&lt;/span&gt;
&lt;span class="gi"&gt;+        try:&lt;/span&gt;
&lt;span class="gi"&gt;+            return int(self.data['hips_tile_width'])&lt;/span&gt;
&lt;span class="gi"&gt;+        except KeyError:&lt;/span&gt;
&lt;span class="gi"&gt;+            return 512&lt;/span&gt;

     @property
     def tile_format(self) -&amp;gt; str:

commit 6139a0bf4047b303a01fefb61ef5288de55486c6
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jul 17 14:13:40 2017 +0500

    Fix RGB dtype issue

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 235b235..f144533 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -63,6 +63,11 @@ class SimpleTilePainter:&lt;/span&gt;
         self._tiles = None

     @property
&lt;span class="gi"&gt;+    def image(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+        """All sky image converted to HiPS tile format."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.float_image.astype(self.tiles[0].data.dtype)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
     def draw_hips_order(self) -&amp;gt; int:
         """Compute HiPS tile order matching a given image pixel size."""
         # Sky image angular resolution (pixel size in degrees)
&lt;span class="gu"&gt;@@ -159,7 +164,7 @@ class SimpleTilePainter:&lt;/span&gt;
         """Draw HiPS tiles onto an empty image."""
         tiles = self.tiles

&lt;span class="gd"&gt;-        image = np.zeros(self.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        image = np.zeros(self.shape, dtype=np.float32)&lt;/span&gt;
         for tile in tiles:
             tile_image = self.warp_image(tile)
             # TODO: put better algorithm here instead of summing pixels
&lt;span class="gu"&gt;@@ -170,7 +175,7 @@ class SimpleTilePainter:&lt;/span&gt;

     def run(self) -&amp;gt; None:
         """Run all steps of the naive algorithm."""
&lt;span class="gd"&gt;-        self.image = self.draw_tiles()&lt;/span&gt;
&lt;span class="gi"&gt;+        self.float_image = self.draw_tiles()&lt;/span&gt;


 def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; np.ndarray:
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 7ec0e2a..22150ce 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -14,25 +14,28 @@ make_sky_image_pars = [&lt;/span&gt;
         file_format='fits',
         shape=(1000, 2000),
         url='http://alasky.unistra.fr/DSS/DSS2Merged/properties',
&lt;span class="gd"&gt;-        data_1=2213.30874796,&lt;/span&gt;
&lt;span class="gd"&gt;-        data_2=2296.93885940,&lt;/span&gt;
&lt;span class="gd"&gt;-        data_sum=8757489268.044867,&lt;/span&gt;
&lt;span class="gi"&gt;+        data_1=2213,&lt;/span&gt;
&lt;span class="gi"&gt;+        data_2=2296,&lt;/span&gt;
&lt;span class="gi"&gt;+        data_sum=8756493140,&lt;/span&gt;
&lt;span class="gi"&gt;+        dtype='&amp;gt;i2'&lt;/span&gt;
     ),
     dict(
         file_format='jpg',
         shape=(1000, 2000, 3),
         url='https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/FermiColor/properties',
&lt;span class="gd"&gt;-        data_1=[145.388459, 98.579295, 49.792577],&lt;/span&gt;
&lt;span class="gd"&gt;-        data_2=[146.197811, 99.531895, 56.889927],&lt;/span&gt;
&lt;span class="gd"&gt;-        data_sum=813159920.0305891,&lt;/span&gt;
&lt;span class="gi"&gt;+        data_1=[145, 98, 49],&lt;/span&gt;
&lt;span class="gi"&gt;+        data_2=[146, 99, 56],&lt;/span&gt;
&lt;span class="gi"&gt;+        data_sum=808113247,&lt;/span&gt;
&lt;span class="gi"&gt;+        dtype='uint8'&lt;/span&gt;
     ),
     dict(
         file_format='png',
         shape=(1000, 2000, 4),
         url='https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/AKARI-FIS/properties',
&lt;span class="gd"&gt;-        data_1=[249.064796, 237.805612, 190.408181, 255.],&lt;/span&gt;
&lt;span class="gd"&gt;-        data_2=[249.013527, 238.79403, 195.793398, 255.],&lt;/span&gt;
&lt;span class="gd"&gt;-        data_sum=1645783166.1630714&lt;/span&gt;
&lt;span class="gi"&gt;+        data_1=[249, 237, 190, 255.],&lt;/span&gt;
&lt;span class="gi"&gt;+        data_2=[249, 238, 195, 255.],&lt;/span&gt;
&lt;span class="gi"&gt;+        data_sum=1632505453,&lt;/span&gt;
&lt;span class="gi"&gt;+        dtype='uint8'&lt;/span&gt;
     ),
 ]

&lt;span class="gu"&gt;@@ -44,7 +47,7 @@ def test_make_sky_image(pars):&lt;/span&gt;
     geometry = make_test_wcs_geometry(case=2)
     image = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format=pars['file_format'])
     assert image.shape == pars['shape']
&lt;span class="gd"&gt;-    assert image.dtype == np.float64&lt;/span&gt;
&lt;span class="gi"&gt;+    assert image.dtype == pars['dtype']&lt;/span&gt;
     assert_allclose(np.sum(image), pars['data_sum'])
     assert_allclose(image[200, 994], pars['data_1'])
     assert_allclose(image[200, 995], pars['data_2'])
&lt;span class="gu"&gt;@@ -91,4 +94,4 @@ class TestSimpleTilePainter:&lt;/span&gt;

     def test_run(self):
         self.simple_tile_painter.run()
&lt;span class="gd"&gt;-        assert_allclose(self.simple_tile_painter.image[200, 994], 2120.9609175)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.simple_tile_painter.image[200, 994], 2120)&lt;/span&gt;

commit eb5cd378624001de9588a4eb7095361b1f9b94d5
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jul 11 20:29:14 2017 +0500

    Reformat SimpleTilePainter class

&lt;span class="gh"&gt;diff --git a/docs/plot_fits.py b/docs/plot_fits.py&lt;/span&gt;
&lt;span class="gh"&gt;index 67b03d9..70cac7a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/plot_fits.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/plot_fits.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -6,7 +6,6 @@ from astropy.visualization.mpl_normalize import simple_norm&lt;/span&gt;
 from hips import HipsSurveyProperties
 from hips import make_sky_image
 from hips.utils import WCSGeometry
&lt;span class="gd"&gt;-import numpy as np&lt;/span&gt;
 url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'
 hips_survey = HipsSurveyProperties.fetch(url)
 geometry = WCSGeometry.create_simple(
&lt;span class="gu"&gt;@@ -14,7 +13,7 @@ geometry = WCSGeometry.create_simple(&lt;/span&gt;
     width=2000, height=1000, fov="3 deg",
     coordsys='galactic', projection='AIT'
 )
&lt;span class="gd"&gt;-data = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format='fits')&lt;/span&gt;
&lt;span class="gi"&gt;+image = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format='fits')&lt;/span&gt;
 ax = plt.subplot(projection=geometry.wcs)
&lt;span class="gd"&gt;-norm = simple_norm(data, 'sqrt')&lt;/span&gt;
&lt;span class="gd"&gt;-ax.imshow(data, origin='lower', norm=norm, cmap='gray')&lt;/span&gt;
&lt;span class="gi"&gt;+norm = simple_norm(image, 'sqrt')&lt;/span&gt;
&lt;span class="gi"&gt;+ax.imshow(image, origin='lower', norm=norm, cmap='gray')&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 2664a59..b0c4ed9 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,80 +1,90 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 """HiPS tile drawing -- simple method."""
&lt;span class="gd"&gt;-from typing import Generator, Any&lt;/span&gt;
 import numpy as np
&lt;span class="gi"&gt;+from typing import Tuple&lt;/span&gt;
 from astropy.wcs.utils import proj_plane_pixel_scales
 from skimage.transform import ProjectiveTransform, warp
 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta
&lt;span class="gd"&gt;-from ..utils import WCSGeometry, compute_healpix_pixel_indices&lt;/span&gt;
&lt;span class="gi"&gt;+from ..utils import WCSGeometry, compute_healpix_pixel_indices, get_hips_order_for_resolution&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;

 __all__ = [
&lt;span class="gd"&gt;-    'draw_sky_image',&lt;/span&gt;
     'make_sky_image',
     'SimpleTilePainter',
&lt;span class="gd"&gt;-    'compute_matching_hips_order'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 ]

 __doctest_skip__ = [
&lt;span class="gd"&gt;-    'compute_matching_hips_order',&lt;/span&gt;
&lt;span class="gi"&gt;+    'SimpleTilePainter'&lt;/span&gt;
 ]


&lt;span class="gd"&gt;-# TODO: Fix type annotation issue&lt;/span&gt;
&lt;span class="gd"&gt;-def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any],&lt;/span&gt;
&lt;span class="gd"&gt;-                   hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+class SimpleTilePainter:&lt;/span&gt;
     """Draw sky image using the simple and quick method.

&lt;span class="gi"&gt;+    Paint HiPS tiles onto an all-sky image using a simple projective&lt;/span&gt;
&lt;span class="gi"&gt;+    transformation method. The algorithm implemented is described&lt;/span&gt;
&lt;span class="gi"&gt;+    here: :ref:`drawing_algo`.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
     Parameters
     ----------
     geometry : `~hips.utils.WCSGeometry`
         An object of WCSGeometry
&lt;span class="gd"&gt;-    tiles : List[HipsTile]&lt;/span&gt;
&lt;span class="gd"&gt;-        A list of HipsTile&lt;/span&gt;
     hips_survey : `~hips.HipsSurveyProperties`
         HiPS survey properties
     tile_format : `str`
         Format of HiPS tile

&lt;span class="gd"&gt;-    Returns&lt;/span&gt;
&lt;span class="gd"&gt;-    -------&lt;/span&gt;
&lt;span class="gd"&gt;-    np.ndarray&lt;/span&gt;
&lt;span class="gd"&gt;-        Returns a numpy array containing all HiPS tiles projected onto it&lt;/span&gt;
&lt;span class="gd"&gt;-    """&lt;/span&gt;
&lt;span class="gd"&gt;-    if tile_format == 'jpg':&lt;/span&gt;
&lt;span class="gd"&gt;-        shape = (geometry.shape.height, geometry.shape.width, 3)&lt;/span&gt;
&lt;span class="gd"&gt;-    elif tile_format == 'png':&lt;/span&gt;
&lt;span class="gd"&gt;-        shape = (geometry.shape.height, geometry.shape.width, 4)&lt;/span&gt;
&lt;span class="gd"&gt;-    else:&lt;/span&gt;
&lt;span class="gd"&gt;-        shape = (geometry.shape.height, geometry.shape.width)&lt;/span&gt;
&lt;span class="gd"&gt;-    image = np.zeros(shape)&lt;/span&gt;
&lt;span class="gd"&gt;-    for tile in tiles:&lt;/span&gt;
&lt;span class="gd"&gt;-        painter = SimpleTilePainter(geometry, hips_survey, tile)&lt;/span&gt;
&lt;span class="gd"&gt;-        image += painter.warp_image()&lt;/span&gt;
&lt;span class="gd"&gt;-    return image&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-class SimpleTilePainter:&lt;/span&gt;
&lt;span class="gd"&gt;-    """Paint a single tile using a simple projective transformation method.&lt;/span&gt;
&lt;span class="gd"&gt;-    The algorithm implemented is described here: :ref:`drawing_algo`.&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    Parameters&lt;/span&gt;
&lt;span class="gd"&gt;-    ----------&lt;/span&gt;
&lt;span class="gd"&gt;-    geometry : `~hips.utils.WCSGeometry`&lt;/span&gt;
&lt;span class="gd"&gt;-        An object of WCSGeometry&lt;/span&gt;
&lt;span class="gd"&gt;-    hips_survey : `~hips.HipsSurveyProperties`&lt;/span&gt;
&lt;span class="gd"&gt;-        HiPS survey properties&lt;/span&gt;
&lt;span class="gd"&gt;-    tile : `HipsTile`&lt;/span&gt;
&lt;span class="gd"&gt;-       An object of HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+    Examples&lt;/span&gt;
&lt;span class="gi"&gt;+    --------&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from hips.utils import WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from hips.draw import SimpleTilePainter&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; geometry = WCSGeometry.create_simple(&lt;/span&gt;
&lt;span class="gi"&gt;+    ...     skydir=SkyCoord(0, 0, unit='deg', frame='icrs'),&lt;/span&gt;
&lt;span class="gi"&gt;+    ...     width=2000, height=1000, fov="3 deg",&lt;/span&gt;
&lt;span class="gi"&gt;+    ...     coordsys='icrs', projection='AIT'&lt;/span&gt;
&lt;span class="gi"&gt;+    ... )&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; painter = SimpleTilePainter(geometry, hips_survey, 'fits')&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; painter.draw_hips_order&lt;/span&gt;
&lt;span class="gi"&gt;+    7&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; painter.run()&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; painter.image.shape&lt;/span&gt;
&lt;span class="gi"&gt;+    (1000, 2000)&lt;/span&gt;
     """

&lt;span class="gd"&gt;-    def __init__(self, geometry: WCSGeometry, hips_survey: HipsSurveyProperties, tile: HipsTile) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, geometry: WCSGeometry, hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; None:&lt;/span&gt;
         self.geometry = geometry
         self.hips_survey = hips_survey
&lt;span class="gd"&gt;-        self.tile = tile&lt;/span&gt;
&lt;span class="gi"&gt;+        self.tile_format = tile_format&lt;/span&gt;
&lt;span class="gi"&gt;+        self._tiles = None&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def draw_hips_order(self) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Compute HiPS tile order matching a given image pixel size."""&lt;/span&gt;
&lt;span class="gi"&gt;+        # Sky image angular resolution (pixel size in degrees)&lt;/span&gt;
&lt;span class="gi"&gt;+        resolution = np.min(proj_plane_pixel_scales(self.geometry.wcs))&lt;/span&gt;
&lt;span class="gi"&gt;+        desired_order = get_hips_order_for_resolution(self.hips_survey.tile_width, resolution)&lt;/span&gt;
&lt;span class="gi"&gt;+        # Return the desired order, or the highest resolution available.&lt;/span&gt;
&lt;span class="gi"&gt;+        # Note that HiPS never has resolution less than 3,&lt;/span&gt;
&lt;span class="gi"&gt;+        # and that limit is handled in _get_hips_order_for_resolution&lt;/span&gt;
&lt;span class="gi"&gt;+        return np.min([desired_order, self.hips_survey.hips_order])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def tile_indices(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        """Get list of index values for HiPS tiles."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return compute_healpix_pixel_indices(&lt;/span&gt;
&lt;span class="gi"&gt;+            wcs_geometry=self.geometry,&lt;/span&gt;
&lt;span class="gi"&gt;+            order=self.draw_hips_order,&lt;/span&gt;
&lt;span class="gi"&gt;+            healpix_frame=self.hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;

     @property
     def dst(self) -&amp;gt; np.ndarray:
&lt;span class="gd"&gt;-        """Destination array for projective transform"""&lt;/span&gt;
&lt;span class="gi"&gt;+        """Destination array for projective transform."""&lt;/span&gt;
         width = self.hips_survey.tile_width
         return np.array(
             [[width - 1, 0],
&lt;span class="gu"&gt;@@ -83,112 +93,74 @@ class SimpleTilePainter:&lt;/span&gt;
              [0, 0]],
         )

&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def projection(self) -&amp;gt; ProjectiveTransform:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Estimate projective transformation on a HiPS tile"""&lt;/span&gt;
&lt;span class="gd"&gt;-        corners = self.tile.meta.skycoord_corners.to_pixel(self.geometry.wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+    def projection(self, tile: HipsTile) -&amp;gt; ProjectiveTransform:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Estimate projective transformation on a HiPS tile."""&lt;/span&gt;
&lt;span class="gi"&gt;+        corners = tile.meta.skycoord_corners.to_pixel(self.geometry.wcs)&lt;/span&gt;
         src = np.array(corners).T.reshape((4, 2))
         dst = self.dst
         pt = ProjectiveTransform()
         pt.estimate(src, dst)
         return pt

&lt;span class="gd"&gt;-    def warp_image(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Warp a HiPS tile and a sky image"""&lt;/span&gt;
&lt;span class="gi"&gt;+    def _fetch_tiles(self) -&amp;gt; 'HipsTile':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Generator function to fetch HiPS tiles from a remote URL."""&lt;/span&gt;
&lt;span class="gi"&gt;+        for healpix_pixel_index in self.tile_indices:&lt;/span&gt;
&lt;span class="gi"&gt;+            tile_meta = HipsTileMeta(&lt;/span&gt;
&lt;span class="gi"&gt;+                order=self.draw_hips_order,&lt;/span&gt;
&lt;span class="gi"&gt;+                ipix=healpix_pixel_index,&lt;/span&gt;
&lt;span class="gi"&gt;+                frame=self.hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gi"&gt;+                file_format=self.tile_format,&lt;/span&gt;
&lt;span class="gi"&gt;+            )&lt;/span&gt;
&lt;span class="gi"&gt;+            url = self.hips_survey.tile_access_url(order=self.draw_hips_order, ipix=healpix_pixel_index) + tile_meta.filename&lt;/span&gt;
&lt;span class="gi"&gt;+            tile = HipsTile.fetch(tile_meta, url)&lt;/span&gt;
&lt;span class="gi"&gt;+            yield tile&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def tiles(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        if self._tiles is None:&lt;/span&gt;
&lt;span class="gi"&gt;+            self._tiles = list(self._fetch_tiles())&lt;/span&gt;
&lt;span class="gi"&gt;+        return self._tiles&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def shape(self) -&amp;gt; Tuple[int]:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Shape of the output image.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        The shape will be two dimensional in case of FITS file format,&lt;/span&gt;
&lt;span class="gi"&gt;+        three dimensions (RGB) in case of JPG, and four channels (RGBA)&lt;/span&gt;
&lt;span class="gi"&gt;+        in case of PNG tile. We follow the same axis order and coordinate&lt;/span&gt;
&lt;span class="gi"&gt;+        conventions that are used by others for grayscale and RGB images.&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.tile_format == 'jpg':&lt;/span&gt;
&lt;span class="gi"&gt;+            return self.geometry.shape.height, self.geometry.shape.width, 3&lt;/span&gt;
&lt;span class="gi"&gt;+        elif self.tile_format == 'png':&lt;/span&gt;
&lt;span class="gi"&gt;+            return self.geometry.shape.height, self.geometry.shape.width, 4&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            return self.geometry.shape.height, self.geometry.shape.width&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def warp_image(self, tile: HipsTile) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Warp a HiPS tile and a sky image."""&lt;/span&gt;
         return warp(
&lt;span class="gd"&gt;-            self.tile.data,&lt;/span&gt;
&lt;span class="gd"&gt;-            self.projection,&lt;/span&gt;
&lt;span class="gi"&gt;+            tile.data,&lt;/span&gt;
&lt;span class="gi"&gt;+            self.projection(tile),&lt;/span&gt;
             output_shape=self.geometry.shape,
             preserve_range=True,
         )

&lt;span class="gi"&gt;+    def draw_tiles(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        """Draw HiPS tiles onto an empty image."""&lt;/span&gt;
&lt;span class="gi"&gt;+        image = np.zeros(self.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        for tile in self.tiles:&lt;/span&gt;
&lt;span class="gi"&gt;+            image += self.warp_image(tile)&lt;/span&gt;
&lt;span class="gi"&gt;+        return image&lt;/span&gt;

&lt;span class="gd"&gt;-def fetch_tiles(healpix_pixel_indices: np.ndarray, order: int,&lt;/span&gt;
&lt;span class="gd"&gt;-                hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; 'HipsTile':&lt;/span&gt;
&lt;span class="gd"&gt;-    """Fetch HiPS tiles from a remote URL.&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    Parameters&lt;/span&gt;
&lt;span class="gd"&gt;-    ----------&lt;/span&gt;
&lt;span class="gd"&gt;-    healpix_pixel_indices : np.ndarray&lt;/span&gt;
&lt;span class="gd"&gt;-        A list of HEALPix pixel indices&lt;/span&gt;
&lt;span class="gd"&gt;-    order : int&lt;/span&gt;
&lt;span class="gd"&gt;-        Order of the HEALPix map&lt;/span&gt;
&lt;span class="gd"&gt;-    hips_survey : HipsSurveyProperties&lt;/span&gt;
&lt;span class="gd"&gt;-        An object of HipsSurveyProperties&lt;/span&gt;
&lt;span class="gd"&gt;-    tile_format : `str`&lt;/span&gt;
&lt;span class="gd"&gt;-        Format of HiPS tile&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    Returns&lt;/span&gt;
&lt;span class="gd"&gt;-    -------&lt;/span&gt;
&lt;span class="gd"&gt;-    'HipsTile'&lt;/span&gt;
&lt;span class="gd"&gt;-        Returns an object of HipsTile&lt;/span&gt;
&lt;span class="gd"&gt;-    """&lt;/span&gt;
&lt;span class="gd"&gt;-    for healpix_pixel_index in healpix_pixel_indices:&lt;/span&gt;
&lt;span class="gd"&gt;-        tile_meta = HipsTileMeta(&lt;/span&gt;
&lt;span class="gd"&gt;-            order=order,&lt;/span&gt;
&lt;span class="gd"&gt;-            ipix=healpix_pixel_index,&lt;/span&gt;
&lt;span class="gd"&gt;-            frame=hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gd"&gt;-            file_format=tile_format,&lt;/span&gt;
&lt;span class="gd"&gt;-        )&lt;/span&gt;
&lt;span class="gd"&gt;-        tile = HipsTile.fetch(tile_meta, hips_survey.tile_access_url(order=order, ipix=healpix_pixel_index) + tile_meta.filename)&lt;/span&gt;
&lt;span class="gd"&gt;-        yield tile&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-def compute_matching_hips_order(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gd"&gt;-    """Compute HiPS tile order matching a given image pixel size.&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    Parameters&lt;/span&gt;
&lt;span class="gd"&gt;-    ----------&lt;/span&gt;
&lt;span class="gd"&gt;-    geometry : WCSGeometry&lt;/span&gt;
&lt;span class="gd"&gt;-        Geometry of the output image&lt;/span&gt;
&lt;span class="gd"&gt;-    hips_survey : HipsSurveyProperties&lt;/span&gt;
&lt;span class="gd"&gt;-        An object of HipsSurveyProperties&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    Returns&lt;/span&gt;
&lt;span class="gd"&gt;-    -------&lt;/span&gt;
&lt;span class="gd"&gt;-    'int'&lt;/span&gt;
&lt;span class="gd"&gt;-        Returns HiPS order&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    Examples&lt;/span&gt;
&lt;span class="gd"&gt;-    --------&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; from hips.draw import compute_matching_hips_order&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; geometry = WCSGeometry.create_simple(&lt;/span&gt;
&lt;span class="gd"&gt;-    ...     skydir=SkyCoord(0, 0, unit='deg', frame='icrs'),&lt;/span&gt;
&lt;span class="gd"&gt;-    ...     width=2000, height=1000, fov="3 deg",&lt;/span&gt;
&lt;span class="gd"&gt;-    ...     coordsys='icrs', projection='AIT'&lt;/span&gt;
&lt;span class="gd"&gt;-    ... )&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; compute_matching_hips_order(geometry, hips_survey)&lt;/span&gt;
&lt;span class="gd"&gt;-    7&lt;/span&gt;
&lt;span class="gd"&gt;-    """&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    # Sky image angular resolution (pixel size in degree)&lt;/span&gt;
&lt;span class="gd"&gt;-    resolution = np.min(proj_plane_pixel_scales(geometry.wcs))&lt;/span&gt;
&lt;span class="gd"&gt;-    desired_order = _get_hips_order_for_resolution(hips_survey.tile_width, resolution)&lt;/span&gt;
&lt;span class="gd"&gt;-    # Return the desired order, or the highest resolution available.&lt;/span&gt;
&lt;span class="gd"&gt;-    # Note that HiPS never has resolution less than 3,&lt;/span&gt;
&lt;span class="gd"&gt;-    # and that limit is handled in _get_hips_order_for_resolution&lt;/span&gt;
&lt;span class="gd"&gt;-    return np.min([desired_order, hips_survey.hips_order])&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-def _get_hips_order_for_resolution(tile_width, resolution):&lt;/span&gt;
&lt;span class="gd"&gt;-    """Finding the best HiPS order by looping through all possible options."""&lt;/span&gt;
&lt;span class="gd"&gt;-    tile_order = np.log2(tile_width)&lt;/span&gt;
&lt;span class="gd"&gt;-    full_sphere_area = 4 * np.pi * np.square(180 / np.pi)&lt;/span&gt;
&lt;span class="gd"&gt;-    # 29 is the maximum order supported by healpy and 3 is the minimum order&lt;/span&gt;
&lt;span class="gd"&gt;-    for candidate_tile_order in range(3, 29 + 1):&lt;/span&gt;
&lt;span class="gd"&gt;-        tile_resolution = np.sqrt(full_sphere_area / 12 / 4 ** (candidate_tile_order + tile_order))&lt;/span&gt;
&lt;span class="gd"&gt;-        # Finding the smaller tile order with a resolution equal or better than geometric resolution&lt;/span&gt;
&lt;span class="gd"&gt;-        if tile_resolution &amp;lt;= resolution:&lt;/span&gt;
&lt;span class="gd"&gt;-            break&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    return candidate_tile_order&lt;/span&gt;
&lt;span class="gi"&gt;+    def run(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Run all steps of the naive algorithm."""&lt;/span&gt;
&lt;span class="gi"&gt;+        self.image = self.draw_tiles()&lt;/span&gt;


 def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; np.ndarray:
     """Make sky image: fetch tiles and draw.
&lt;span class="gi"&gt;+&lt;/span&gt;
     The example for this can be found on the :ref:`gs` page.

     Parameters
&lt;span class="gu"&gt;@@ -202,18 +174,11 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties, til&lt;/span&gt;

     Returns
     -------
&lt;span class="gd"&gt;-    data : `~numpy.ndarray`&lt;/span&gt;
&lt;span class="gi"&gt;+    image : `~numpy.ndarray`&lt;/span&gt;
         Output image pixels
     """
&lt;span class="gd"&gt;-    order = compute_matching_hips_order(geometry, hips_survey)&lt;/span&gt;
&lt;span class="gd"&gt;-    healpix_pixel_indices = compute_healpix_pixel_indices(&lt;/span&gt;
&lt;span class="gd"&gt;-        wcs_geometry=geometry,&lt;/span&gt;
&lt;span class="gd"&gt;-        order=order,&lt;/span&gt;
&lt;span class="gd"&gt;-        healpix_frame=hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gd"&gt;-    )&lt;/span&gt;
&lt;span class="gd"&gt;-    # TODO: this isn't a good API. Will become better when we have a cache.&lt;/span&gt;
&lt;span class="gd"&gt;-    tiles = fetch_tiles(healpix_pixel_indices, order, hips_survey, tile_format)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    image_data = draw_sky_image(geometry, tiles, hips_survey, tile_format)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    return image_data&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    painter = SimpleTilePainter(geometry, hips_survey, tile_format)&lt;/span&gt;
&lt;span class="gi"&gt;+    painter.run()&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    return painter.image&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 4614d9e..7a9dba0 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,102 +1,76 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 import pytest
 import numpy as np
&lt;span class="gd"&gt;-import healpy as hp&lt;/span&gt;
&lt;span class="gd"&gt;-from astropy.coordinates import SkyCoord&lt;/span&gt;
 from numpy.testing import assert_allclose
&lt;span class="gi"&gt;+from astropy.coordinates import SkyCoord&lt;/span&gt;
 from astropy.tests.helper import remote_data
&lt;span class="gd"&gt;-from ..simple import make_sky_image, draw_sky_image, compute_matching_hips_order, _get_hips_order_for_resolution&lt;/span&gt;
&lt;span class="gd"&gt;-from ...tiles import HipsSurveyProperties, HipsTileMeta, HipsTile&lt;/span&gt;
&lt;span class="gd"&gt;-from ...utils import WCSGeometry&lt;/span&gt;
&lt;span class="gd"&gt;-from ...utils.testing import get_hips_extra_file, make_test_wcs_geometry, requires_hips_extra&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-def get_test_tiles(file_format, survey, order, ipix_list):&lt;/span&gt;
&lt;span class="gd"&gt;-    filename = get_hips_extra_file('datasets/samples/' + survey + '/properties')&lt;/span&gt;
&lt;span class="gd"&gt;-    hips_survey = HipsSurveyProperties.read(filename)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    tiles = []&lt;/span&gt;
&lt;span class="gd"&gt;-    for ipix in ipix_list:&lt;/span&gt;
&lt;span class="gd"&gt;-        tiles.append(HipsTile.read(&lt;/span&gt;
&lt;span class="gd"&gt;-            meta=HipsTileMeta(order=order, ipix=ipix, file_format=file_format, frame=hips_survey.astropy_frame),&lt;/span&gt;
&lt;span class="gd"&gt;-            full_path=get_hips_extra_file('datasets/samples/' + survey + hips_survey.tile_path(order=order, ipix=ipix, tile_format=file_format)),&lt;/span&gt;
&lt;span class="gd"&gt;-        ))&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    return tiles&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-draw_sky_image_pars = [&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(file_format='fits', shape=(1000, 2000), survey='DSS2Red', data_1=2866.0101409848185,&lt;/span&gt;
&lt;span class="gd"&gt;-         data_2=2563.6916727348043, data_sum=4575235421.512643, order=3, ipix_list=[450, 451]),&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(file_format='jpg', shape=(1000, 2000, 3), survey='DSS2Red', data_1=[13.040878, 13.040878, 13.040878],&lt;/span&gt;
&lt;span class="gd"&gt;-         data_2=[17.235874, 17.235874, 17.235874], data_sum=243177268.56158745, order=3, ipix_list=[450, 451]),&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(file_format='png', shape=(1000, 2000, 4), survey='AKARI-FIS', data_1=[254., 254., 254., 255.],&lt;/span&gt;
&lt;span class="gd"&gt;-         data_2=[254., 254., 254., 255.], data_sum=946809963.7487414, order=3, ipix_list=[450, 451])&lt;/span&gt;
&lt;span class="gi"&gt;+from ...tiles import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+from ..simple import make_sky_image, SimpleTilePainter&lt;/span&gt;
&lt;span class="gi"&gt;+from ...utils.wcs import WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+from ...utils.testing import make_test_wcs_geometry, requires_hips_extra&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+make_sky_image_pars = [&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(file_format='fits', shape=(1000, 2000), url='http://alasky.unistra.fr/DSS/DSS2Merged/properties',&lt;/span&gt;
&lt;span class="gi"&gt;+         data_1=2213.30874796, data_2=2296.93885940, data_sum=8757489268.044867),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(file_format='jpg', shape=(1000, 2000, 3), url='https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/FermiColor/properties',&lt;/span&gt;
&lt;span class="gi"&gt;+         data_1=[145.388459, 98.579295, 49.792577], data_2=[146.197811, 99.531895, 56.889927], data_sum=813159920.0305891),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(file_format='png', shape=(1000, 2000, 4), url='https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/AKARI-FIS/properties',&lt;/span&gt;
&lt;span class="gi"&gt;+         data_1=[249.064796, 237.805612, 190.408181, 255.], data_2=[249.013527, 238.79403, 195.793398, 255.], data_sum=1645783166.1630714)&lt;/span&gt;
 ]


 @remote_data
&lt;span class="gd"&gt;-@requires_hips_extra()&lt;/span&gt;
&lt;span class="gd"&gt;-@pytest.mark.parametrize('pars', draw_sky_image_pars)&lt;/span&gt;
&lt;span class="gd"&gt;-def test_draw_sky_image(pars):&lt;/span&gt;
&lt;span class="gi"&gt;+@pytest.mark.parametrize('pars', make_sky_image_pars)&lt;/span&gt;
&lt;span class="gi"&gt;+def test_make_sky_image(pars):&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey = HipsSurveyProperties.fetch(url=pars['url'])&lt;/span&gt;
     geometry = make_test_wcs_geometry(case=2)
&lt;span class="gd"&gt;-    tiles = get_test_tiles(file_format=pars['file_format'], survey=pars['survey'], order=pars['order'], ipix_list=pars['ipix_list'])&lt;/span&gt;
&lt;span class="gd"&gt;-    url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/' + pars['survey'] + '/properties'&lt;/span&gt;
&lt;span class="gd"&gt;-    hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    data = draw_sky_image(geometry=geometry, tiles=tiles, hips_survey=hips_survey, tile_format=pars['file_format'])&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    assert data.shape == pars['shape']&lt;/span&gt;
&lt;span class="gd"&gt;-    assert data.dtype == np.float64&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(np.sum(data), pars['data_sum'])&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(data[400, 500], pars['data_1'])&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(data[400, 501], pars['data_2'])&lt;/span&gt;
&lt;span class="gi"&gt;+    image = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format=pars['file_format'])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert image.shape == pars['shape']&lt;/span&gt;
&lt;span class="gi"&gt;+    assert image.dtype == np.float64&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(np.sum(image), pars['data_sum'])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(image[200, 994], pars['data_1'])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(image[200, 995], pars['data_2'])&lt;/span&gt;


 @remote_data
&lt;span class="gd"&gt;-def test_make_sky_image():&lt;/span&gt;
&lt;span class="gd"&gt;-    # The same example is used in the high level docs getting started page&lt;/span&gt;
&lt;span class="gd"&gt;-    url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'&lt;/span&gt;
&lt;span class="gd"&gt;-    hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gd"&gt;-    geometry = make_test_wcs_geometry(case=2)&lt;/span&gt;
&lt;span class="gd"&gt;-    data = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format='fits')&lt;/span&gt;
&lt;span class="gd"&gt;-    assert data.shape == geometry.shape&lt;/span&gt;
&lt;span class="gd"&gt;-    assert data.dtype == np.float64&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(np.sum(data), 8757489268.044867)&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(data[200, 994], 2213.30874796)&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(data[200, 995], 2296.93885940)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-hips_order_pars = [&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(order=7, fov="3 deg"),&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(order=5, fov="10 deg"),&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(order=4, fov="15 deg"),&lt;/span&gt;
&lt;span class="gd"&gt;-]&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-@requires_hips_extra()&lt;/span&gt;
&lt;span class="gd"&gt;-@pytest.mark.parametrize('pars', hips_order_pars)&lt;/span&gt;
&lt;span class="gd"&gt;-def test_compute_matching_hips_order(pars):&lt;/span&gt;
&lt;span class="gd"&gt;-    full_path = get_hips_extra_file('datasets/samples/2MASS6XH/properties')&lt;/span&gt;
&lt;span class="gd"&gt;-    hips_survey = HipsSurveyProperties.read(filename=full_path)&lt;/span&gt;
&lt;span class="gd"&gt;-    geometry = WCSGeometry.create_simple(&lt;/span&gt;
&lt;span class="gd"&gt;-        skydir=SkyCoord(0, 0, unit='deg', frame='icrs'),&lt;/span&gt;
&lt;span class="gd"&gt;-        width=2000, height=1000, fov=pars['fov'],&lt;/span&gt;
&lt;span class="gd"&gt;-        coordsys='icrs', projection='AIT'&lt;/span&gt;
&lt;span class="gd"&gt;-    )&lt;/span&gt;
&lt;span class="gd"&gt;-    assert compute_matching_hips_order(geometry, hips_survey) == pars['order']&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-get_hips_order_for_resolution_pars = [&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(tile_width=512, resolution=0.01232, resolution_res=0.06395791924665553, order=4),&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(tile_width=256, resolution=0.0016022, resolution_res=0.003997369952915971, order=8),&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(tile_width=128, resolution=0.00009032, resolution_res=0.00012491781102862408, order=13),&lt;/span&gt;
&lt;span class="gd"&gt;-]&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-@pytest.mark.parametrize('pars', get_hips_order_for_resolution_pars)&lt;/span&gt;
&lt;span class="gd"&gt;-def test_get_hips_order_for_resolution(pars):&lt;/span&gt;
&lt;span class="gd"&gt;-    hips_order = _get_hips_order_for_resolution(pars['tile_width'], pars['resolution'])&lt;/span&gt;
&lt;span class="gd"&gt;-    assert hips_order == pars['order']&lt;/span&gt;
&lt;span class="gd"&gt;-    hips_resolution = hp.nside2resol(hp.order2nside(hips_order))&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(hips_resolution, pars['resolution_res'])&lt;/span&gt;
&lt;span class="gd"&gt;-# TODO: add tests for SimpleTilePainter with asserts on the intermediate computed things.&lt;/span&gt;
&lt;span class="gi"&gt;+class TestSimpleTilePainter:&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def setup_class(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.geometry = WCSGeometry.create_simple(&lt;/span&gt;
&lt;span class="gi"&gt;+            skydir=SkyCoord(0, 0, unit='deg', frame='icrs'),&lt;/span&gt;
&lt;span class="gi"&gt;+            width=2000, height=1000, fov="3 deg",&lt;/span&gt;
&lt;span class="gi"&gt;+            coordsys='icrs', projection='AIT'&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.simple_tile_painter = SimpleTilePainter(cls.geometry, cls.hips_survey, 'fits')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_draw_hips_order(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.simple_tile_painter.draw_hips_order == 7&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_shape(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.simple_tile_painter.shape == (1000, 2000)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_tile_indices(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert list(self.simple_tile_painter.tile_indices)[:4] == [69623, 69627, 69628, 69629]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    draw_hips_order_pars = [&lt;/span&gt;
&lt;span class="gi"&gt;+        dict(order=7, fov="3 deg"),&lt;/span&gt;
&lt;span class="gi"&gt;+        dict(order=5, fov="10 deg"),&lt;/span&gt;
&lt;span class="gi"&gt;+        dict(order=4, fov="15 deg"),&lt;/span&gt;
&lt;span class="gi"&gt;+    ]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @requires_hips_extra()&lt;/span&gt;
&lt;span class="gi"&gt;+    @pytest.mark.parametrize('pars', draw_hips_order_pars)&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_compute_matching_hips_order(self, pars):&lt;/span&gt;
&lt;span class="gi"&gt;+        geometry = WCSGeometry.create_simple(&lt;/span&gt;
&lt;span class="gi"&gt;+            skydir=SkyCoord(0, 0, unit='deg', frame='icrs'),&lt;/span&gt;
&lt;span class="gi"&gt;+            width=2000, height=1000, fov=pars['fov'],&lt;/span&gt;
&lt;span class="gi"&gt;+            coordsys='icrs', projection='AIT'&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;
&lt;span class="gi"&gt;+        simple_tile_painter = SimpleTilePainter(geometry, self.hips_survey, 'fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        assert simple_tile_painter.draw_hips_order == pars['order']&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_run(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        self.simple_tile_painter.run()&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.simple_tile_painter.image[200, 994], 2120.9609175)&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 6e8213f..50e314e 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -13,7 +13,8 @@ from .wcs import WCSGeometry&lt;/span&gt;

 __all__ = [
     'boundaries',
&lt;span class="gd"&gt;-    'compute_healpix_pixel_indices'&lt;/span&gt;
&lt;span class="gi"&gt;+    'compute_healpix_pixel_indices',&lt;/span&gt;
&lt;span class="gi"&gt;+    'get_hips_order_for_resolution'&lt;/span&gt;
 ]

 __doctest_skip__ = ['boundaries', 'compute_healpix_pixel_indices']
&lt;span class="gu"&gt;@@ -109,3 +110,30 @@ def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, order: int, healpix&lt;/span&gt;
     theta, phi = _skycoord_to_theta_phi(pixel_coords)
     ipix = hp.ang2pix(nside, theta, phi, nest=True)
     return np.unique(ipix)
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def get_hips_order_for_resolution(tile_width: int, resolution: int) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Find the best HiPS order by looping through all possible options.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    tile_width : int&lt;/span&gt;
&lt;span class="gi"&gt;+        HiPS tile width&lt;/span&gt;
&lt;span class="gi"&gt;+    resolution : int&lt;/span&gt;
&lt;span class="gi"&gt;+        Sky image angular resolution (pixel size in degrees)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Returns&lt;/span&gt;
&lt;span class="gi"&gt;+    -------&lt;/span&gt;
&lt;span class="gi"&gt;+    candidate_tile_order : int&lt;/span&gt;
&lt;span class="gi"&gt;+        Best HiPS tile order&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+    tile_order = np.log2(tile_width)&lt;/span&gt;
&lt;span class="gi"&gt;+    full_sphere_area = 4 * np.pi * np.square(180 / np.pi)&lt;/span&gt;
&lt;span class="gi"&gt;+    # 29 is the maximum order supported by healpy and 3 is the minimum order&lt;/span&gt;
&lt;span class="gi"&gt;+    for candidate_tile_order in range(3, 29 + 1):&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_resolution = np.sqrt(full_sphere_area / 12 / 4 ** (candidate_tile_order + tile_order))&lt;/span&gt;
&lt;span class="gi"&gt;+        # Finding the smaller tile order with a resolution equal to or better than geometric resolution&lt;/span&gt;
&lt;span class="gi"&gt;+        if tile_resolution &amp;lt;= resolution:&lt;/span&gt;
&lt;span class="gi"&gt;+            break&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    return candidate_tile_order&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index aff6dc3..6c8b231 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -4,7 +4,7 @@ import numpy as np&lt;/span&gt;
 from numpy.testing import assert_allclose
 from astropy.coordinates import SkyCoord
 import healpy as hp
&lt;span class="gd"&gt;-from ..healpix import boundaries, compute_healpix_pixel_indices&lt;/span&gt;
&lt;span class="gi"&gt;+from ..healpix import boundaries, compute_healpix_pixel_indices, get_hips_order_for_resolution&lt;/span&gt;
 from ..testing import make_test_wcs_geometry


&lt;span class="gu"&gt;@@ -33,3 +33,17 @@ def test_wcs_healpix_pixel_indices(pars):&lt;/span&gt;
     geometry = make_test_wcs_geometry(case=2)
     healpix_pixel_indices = compute_healpix_pixel_indices(geometry, order=3, healpix_frame=pars['frame'])
     assert list(healpix_pixel_indices) == pars['ipix']
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+hips_order_for_resolution_pars = [&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(tile_width=512, resolution=0.01232, resolution_res=0.06395791924665553, order=4),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(tile_width=256, resolution=0.0016022, resolution_res=0.003997369952915971, order=8),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(tile_width=128, resolution=0.00009032, resolution_res=0.00012491781102862408, order=13),&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+@pytest.mark.parametrize('pars', hips_order_for_resolution_pars)&lt;/span&gt;
&lt;span class="gi"&gt;+def test_get_hips_order_for_resolution(pars):&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_order = get_hips_order_for_resolution(pars['tile_width'], pars['resolution'])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert hips_order == pars['order']&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_resolution = hp.nside2resol(hp.order2nside(hips_order))&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(hips_resolution, pars['resolution_res'])&lt;/span&gt;

commit e2541ae378982e9261dde09ed7b389a8d4b1b47b
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jul 12 12:07:34 2017 +0500

    Add plot in high level docs

&lt;span class="gh"&gt;diff --git a/docs/getting_started.rst b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gh"&gt;index 05e9d49..bf8ff0d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -54,7 +54,9 @@ Now you can then save the sky image to local disk e.g. FITS file format::&lt;/span&gt;

 or plot and analyse the sky image however you like.

&lt;span class="gd"&gt;-TODO: show how to plot the image with `astropy.visualization.wcsaxes`.&lt;/span&gt;
&lt;span class="gi"&gt;+If you execute the example above, you will get this sky image which was plotted using `astropy.visualization.wcsaxes`&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+.. plot:: plot_fits.py&lt;/span&gt;

 HiPS data
 ---------
&lt;span class="gh"&gt;diff --git a/docs/plot_fits.py b/docs/plot_fits.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..67b03d9&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/plot_fits.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,20 @@&lt;/span&gt;
&lt;span class="gi"&gt;+"""This script plots the all-sky image following the example on getting started page"""&lt;/span&gt;
&lt;span class="gi"&gt;+import matplotlib.pyplot as plt&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.visualization.mpl_normalize import simple_norm&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from hips import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+from hips import make_sky_image&lt;/span&gt;
&lt;span class="gi"&gt;+from hips.utils import WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+geometry = WCSGeometry.create_simple(&lt;/span&gt;
&lt;span class="gi"&gt;+    skydir=SkyCoord(0, 0, unit='deg', frame='galactic'),&lt;/span&gt;
&lt;span class="gi"&gt;+    width=2000, height=1000, fov="3 deg",&lt;/span&gt;
&lt;span class="gi"&gt;+    coordsys='galactic', projection='AIT'&lt;/span&gt;
&lt;span class="gi"&gt;+)&lt;/span&gt;
&lt;span class="gi"&gt;+data = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format='fits')&lt;/span&gt;
&lt;span class="gi"&gt;+ax = plt.subplot(projection=geometry.wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+norm = simple_norm(data, 'sqrt')&lt;/span&gt;
&lt;span class="gi"&gt;+ax.imshow(data, origin='lower', norm=norm, cmap='gray')&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/setup.cfg b/setup.cfg&lt;/span&gt;
&lt;span class="gh"&gt;index 36b3fd1..02f3659 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/setup.cfg&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/setup.cfg&lt;/span&gt;
&lt;span class="gu"&gt;@@ -11,6 +11,7 @@ show-response = 1&lt;/span&gt;
 minversion = 3.0
 norecursedirs = build docs/_build
 doctest_plus = enabled
&lt;span class="gi"&gt;+doctest_norecursedirs = docs/plot_fits.py&lt;/span&gt;

 [ah_bootstrap]
 auto_use = True

commit af4eb6f7cac27c06f60468912388dd2f33a3b851
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jul 12 10:17:36 2017 +0500

    Fix tile width height issue

&lt;span class="gh"&gt;diff --git a/docs/getting_started.rst b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gh"&gt;index 9248dd4..05e9d49 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -41,7 +41,7 @@ To make a sky image with the `hips` package, follow the following three steps:&lt;/span&gt;

     from hips.draw import make_sky_image

&lt;span class="gd"&gt;-    data = make_sky_image(geometry, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    data = make_sky_image(geometry, hips_survey, 'fits')&lt;/span&gt;


 That's it. Go ahead and try it out for your favourite sky region and survey.
&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index c6d2ad5..2664a59 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -41,11 +41,11 @@ def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any],&lt;/span&gt;
         Returns a numpy array containing all HiPS tiles projected onto it
     """
     if tile_format == 'jpg':
&lt;span class="gd"&gt;-        shape = (geometry.shape.width, geometry.shape.height, 3)&lt;/span&gt;
&lt;span class="gi"&gt;+        shape = (geometry.shape.height, geometry.shape.width, 3)&lt;/span&gt;
     elif tile_format == 'png':
&lt;span class="gd"&gt;-        shape = (geometry.shape.width, geometry.shape.height, 4)&lt;/span&gt;
&lt;span class="gi"&gt;+        shape = (geometry.shape.height, geometry.shape.width, 4)&lt;/span&gt;
     else:
&lt;span class="gd"&gt;-        shape = (geometry.shape.width, geometry.shape.height)&lt;/span&gt;
&lt;span class="gi"&gt;+        shape = (geometry.shape.height, geometry.shape.width)&lt;/span&gt;
     image = np.zeros(shape)
     for tile in tiles:
         painter = SimpleTilePainter(geometry, hips_survey, tile)
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index b910517..4614d9e 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -26,12 +26,12 @@ def get_test_tiles(file_format, survey, order, ipix_list):&lt;/span&gt;


 draw_sky_image_pars = [
&lt;span class="gd"&gt;-    dict(file_format='fits', shape=(2000, 1000), survey='DSS2Red', data_1=2866.0101409848185,&lt;/span&gt;
&lt;span class="gd"&gt;-         data_2=2563.6916727348043, data_sum=2992643842.729775, order=3, ipix_list=[450, 451]),&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(file_format='jpg', shape=(2000, 1000, 3), survey='DSS2Red', data_1=[13.040878, 13.040878, 13.040878],&lt;/span&gt;
&lt;span class="gd"&gt;-         data_2=[17.235874, 17.235874, 17.235874], data_sum=155233709.20236143, order=3, ipix_list=[450, 451]),&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(file_format='png', shape=(2000, 1000, 4), survey='AKARI-FIS', data_1=[254., 254., 254., 255.],&lt;/span&gt;
&lt;span class="gd"&gt;-         data_2=[254., 254., 254., 255.], data_sum=586208559.2450126, order=3, ipix_list=[450, 451])&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(file_format='fits', shape=(1000, 2000), survey='DSS2Red', data_1=2866.0101409848185,&lt;/span&gt;
&lt;span class="gi"&gt;+         data_2=2563.6916727348043, data_sum=4575235421.512643, order=3, ipix_list=[450, 451]),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(file_format='jpg', shape=(1000, 2000, 3), survey='DSS2Red', data_1=[13.040878, 13.040878, 13.040878],&lt;/span&gt;
&lt;span class="gi"&gt;+         data_2=[17.235874, 17.235874, 17.235874], data_sum=243177268.56158745, order=3, ipix_list=[450, 451]),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(file_format='png', shape=(1000, 2000, 4), survey='AKARI-FIS', data_1=[254., 254., 254., 255.],&lt;/span&gt;
&lt;span class="gi"&gt;+         data_2=[254., 254., 254., 255.], data_sum=946809963.7487414, order=3, ipix_list=[450, 451])&lt;/span&gt;
 ]


&lt;span class="gu"&gt;@@ -62,7 +62,8 @@ def test_make_sky_image():&lt;/span&gt;
     data = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format='fits')
     assert data.shape == geometry.shape
     assert data.dtype == np.float64
&lt;span class="gd"&gt;-    assert_allclose(np.sum(data), 7615817463.1612253)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(np.sum(data), 8757489268.044867)&lt;/span&gt;
     assert_allclose(data[200, 994], 2213.30874796)
     assert_allclose(data[200, 995], 2296.93885940)

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_surveys.py b/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gh"&gt;index ee1d856..47aab83 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -5,6 +5,7 @@ from astropy.tests.helper import remote_data&lt;/span&gt;
 from ..surveys import HipsSurveyProperties, HipsSurveyPropertiesList
 from ...utils.testing import get_hips_extra_file, requires_hips_extra

&lt;span class="gi"&gt;+&lt;/span&gt;
 class TestHipsSurveyProperties:
     @classmethod
     def setup_class(cls):
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 9d0dd47..aff6dc3 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -23,8 +23,8 @@ def test_boundaries():&lt;/span&gt;


 compute_healpix_pixel_indices_pars = [
&lt;span class="gd"&gt;-    dict(frame='galactic', ipix=[269, 271, 280, 282, 283, 304, 305, 307, 308, 310]),&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(frame='icrs', ipix=[448, 449, 450, 451, 454, 456, 457, 458, 459, 460]),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(frame='galactic', ipix=[269, 270, 271, 280, 282, 283, 292, 293, 295, 304, 305, 306]),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(frame='icrs', ipix=[448, 449, 450, 451, 454, 456, 457, 460, 661, 663, 669]),&lt;/span&gt;
 ]


&lt;span class="gh"&gt;diff --git a/hips/utils/wcs.py b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index 7dd3db2..305092b 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -15,7 +15,7 @@ __doctest_skip__ = [&lt;/span&gt;
     '*',
 ]

&lt;span class="gd"&gt;-Shape = namedtuple('Shape', ['width', 'height'])&lt;/span&gt;
&lt;span class="gi"&gt;+Shape = namedtuple('Shape', ['height', 'width'])&lt;/span&gt;
 """Helper for 2-dim image shape, to make it clearer what value is width and height."""



commit 8ca56a7036540d528fb891a811a9bec901086aa3
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jul 10 19:33:10 2017 +0500

    Add support for RGB tiles

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index bcac055..c6d2ad5 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -18,8 +18,10 @@ __doctest_skip__ = [&lt;/span&gt;
     'compute_matching_hips_order',
 ]

&lt;span class="gi"&gt;+&lt;/span&gt;
 # TODO: Fix type annotation issue
&lt;span class="gd"&gt;-def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any], hips_survey: HipsSurveyProperties) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any],&lt;/span&gt;
&lt;span class="gi"&gt;+                   hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; np.ndarray:&lt;/span&gt;
     """Draw sky image using the simple and quick method.

     Parameters
&lt;span class="gu"&gt;@@ -30,13 +32,21 @@ def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any],&lt;/span&gt;
         A list of HipsTile
     hips_survey : `~hips.HipsSurveyProperties`
         HiPS survey properties
&lt;span class="gi"&gt;+    tile_format : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+        Format of HiPS tile&lt;/span&gt;

     Returns
     -------
     np.ndarray
         Returns a numpy array containing all HiPS tiles projected onto it
     """
&lt;span class="gd"&gt;-    image = np.zeros(geometry.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+    if tile_format == 'jpg':&lt;/span&gt;
&lt;span class="gi"&gt;+        shape = (geometry.shape.width, geometry.shape.height, 3)&lt;/span&gt;
&lt;span class="gi"&gt;+    elif tile_format == 'png':&lt;/span&gt;
&lt;span class="gi"&gt;+        shape = (geometry.shape.width, geometry.shape.height, 4)&lt;/span&gt;
&lt;span class="gi"&gt;+    else:&lt;/span&gt;
&lt;span class="gi"&gt;+        shape = (geometry.shape.width, geometry.shape.height)&lt;/span&gt;
&lt;span class="gi"&gt;+    image = np.zeros(shape)&lt;/span&gt;
     for tile in tiles:
         painter = SimpleTilePainter(geometry, hips_survey, tile)
         image += painter.warp_image()
&lt;span class="gu"&gt;@@ -45,7 +55,6 @@ def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any],&lt;/span&gt;

 class SimpleTilePainter:
     """Paint a single tile using a simple projective transformation method.
&lt;span class="gd"&gt;-&lt;/span&gt;
     The algorithm implemented is described here: :ref:`drawing_algo`.

     Parameters
&lt;span class="gu"&gt;@@ -73,6 +82,7 @@ class SimpleTilePainter:&lt;/span&gt;
              [0, width - 1],
              [0, 0]],
         )
&lt;span class="gi"&gt;+&lt;/span&gt;
     @property
     def projection(self) -&amp;gt; ProjectiveTransform:
         """Estimate projective transformation on a HiPS tile"""
&lt;span class="gu"&gt;@@ -93,7 +103,8 @@ class SimpleTilePainter:&lt;/span&gt;
         )


&lt;span class="gd"&gt;-def fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: HipsSurveyProperties) -&amp;gt; 'HipsTile':&lt;/span&gt;
&lt;span class="gi"&gt;+def fetch_tiles(healpix_pixel_indices: np.ndarray, order: int,&lt;/span&gt;
&lt;span class="gi"&gt;+                hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; 'HipsTile':&lt;/span&gt;
     """Fetch HiPS tiles from a remote URL.

     Parameters
&lt;span class="gu"&gt;@@ -104,18 +115,20 @@ def fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: Hips&lt;/span&gt;
         Order of the HEALPix map
     hips_survey : HipsSurveyProperties
         An object of HipsSurveyProperties
&lt;span class="gi"&gt;+    tile_format : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+        Format of HiPS tile&lt;/span&gt;

     Returns
     -------
     'HipsTile'
&lt;span class="gd"&gt;-        Returns an object of  HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+        Returns an object of HipsTile&lt;/span&gt;
     """
     for healpix_pixel_index in healpix_pixel_indices:
         tile_meta = HipsTileMeta(
             order=order,
             ipix=healpix_pixel_index,
             frame=hips_survey.astropy_frame,
&lt;span class="gd"&gt;-            file_format='fits',&lt;/span&gt;
&lt;span class="gi"&gt;+            file_format=tile_format,&lt;/span&gt;
         )
         tile = HipsTile.fetch(tile_meta, hips_survey.tile_access_url(order=order, ipix=healpix_pixel_index) + tile_meta.filename)
         yield tile
&lt;span class="gu"&gt;@@ -174,9 +187,8 @@ def _get_hips_order_for_resolution(tile_width, resolution):&lt;/span&gt;
     return candidate_tile_order


&lt;span class="gd"&gt;-def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties, tile_format: str) -&amp;gt; np.ndarray:&lt;/span&gt;
     """Make sky image: fetch tiles and draw.
&lt;span class="gd"&gt;-&lt;/span&gt;
     The example for this can be found on the :ref:`gs` page.

     Parameters
&lt;span class="gu"&gt;@@ -185,6 +197,8 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt;&lt;/span&gt;
         Geometry of the output image
     hips_survey : `~hips.HipsSurveyProperties`
         HiPS survey properties
&lt;span class="gi"&gt;+    tile_format : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+        Format of HiPS tile&lt;/span&gt;

     Returns
     -------
&lt;span class="gu"&gt;@@ -198,8 +212,8 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt;&lt;/span&gt;
         healpix_frame=hips_survey.astropy_frame,
     )
     # TODO: this isn't a good API. Will become better when we have a cache.
&lt;span class="gd"&gt;-    tiles = fetch_tiles(healpix_pixel_indices, order, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    tiles = fetch_tiles(healpix_pixel_indices, order, hips_survey, tile_format)&lt;/span&gt;

&lt;span class="gd"&gt;-    image_data = draw_sky_image(geometry, tiles, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    image_data = draw_sky_image(geometry, tiles, hips_survey, tile_format)&lt;/span&gt;

     return image_data
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 249d77e..b910517 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -4,45 +4,53 @@ import numpy as np&lt;/span&gt;
 import healpy as hp
 from astropy.coordinates import SkyCoord
 from numpy.testing import assert_allclose
&lt;span class="gd"&gt;-from astropy.utils.data import get_pkg_data_filename&lt;/span&gt;
 from astropy.tests.helper import remote_data
 from ..simple import make_sky_image, draw_sky_image, compute_matching_hips_order, _get_hips_order_for_resolution
 from ...tiles import HipsSurveyProperties, HipsTileMeta, HipsTile
 from ...utils import WCSGeometry
 from ...utils.testing import get_hips_extra_file, make_test_wcs_geometry, requires_hips_extra

&lt;span class="gd"&gt;-def get_test_tiles():&lt;/span&gt;
&lt;span class="gd"&gt;-    filename = get_pkg_data_filename('../../tiles/tests/data/properties.txt')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def get_test_tiles(file_format, survey, order, ipix_list):&lt;/span&gt;
&lt;span class="gi"&gt;+    filename = get_hips_extra_file('datasets/samples/' + survey + '/properties')&lt;/span&gt;
     hips_survey = HipsSurveyProperties.read(filename)

&lt;span class="gd"&gt;-    tile1 = HipsTile.read(&lt;/span&gt;
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=450, file_format='fits', frame=hips_survey.astropy_frame),&lt;/span&gt;
&lt;span class="gd"&gt;-        full_path=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix450.fits'),&lt;/span&gt;
&lt;span class="gd"&gt;-    )&lt;/span&gt;
&lt;span class="gi"&gt;+    tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+    for ipix in ipix_list:&lt;/span&gt;
&lt;span class="gi"&gt;+        tiles.append(HipsTile.read(&lt;/span&gt;
&lt;span class="gi"&gt;+            meta=HipsTileMeta(order=order, ipix=ipix, file_format=file_format, frame=hips_survey.astropy_frame),&lt;/span&gt;
&lt;span class="gi"&gt;+            full_path=get_hips_extra_file('datasets/samples/' + survey + hips_survey.tile_path(order=order, ipix=ipix, tile_format=file_format)),&lt;/span&gt;
&lt;span class="gi"&gt;+        ))&lt;/span&gt;

&lt;span class="gd"&gt;-    tile2 = HipsTile.read(&lt;/span&gt;
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=451, file_format='fits', frame=hips_survey.astropy_frame),&lt;/span&gt;
&lt;span class="gd"&gt;-        full_path=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix451.fits'),&lt;/span&gt;
&lt;span class="gd"&gt;-    )&lt;/span&gt;
&lt;span class="gi"&gt;+    return tiles&lt;/span&gt;

&lt;span class="gd"&gt;-    return [tile1, tile2]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+draw_sky_image_pars = [&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(file_format='fits', shape=(2000, 1000), survey='DSS2Red', data_1=2866.0101409848185,&lt;/span&gt;
&lt;span class="gi"&gt;+         data_2=2563.6916727348043, data_sum=2992643842.729775, order=3, ipix_list=[450, 451]),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(file_format='jpg', shape=(2000, 1000, 3), survey='DSS2Red', data_1=[13.040878, 13.040878, 13.040878],&lt;/span&gt;
&lt;span class="gi"&gt;+         data_2=[17.235874, 17.235874, 17.235874], data_sum=155233709.20236143, order=3, ipix_list=[450, 451]),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(file_format='png', shape=(2000, 1000, 4), survey='AKARI-FIS', data_1=[254., 254., 254., 255.],&lt;/span&gt;
&lt;span class="gi"&gt;+         data_2=[254., 254., 254., 255.], data_sum=586208559.2450126, order=3, ipix_list=[450, 451])&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;


 @remote_data
 @requires_hips_extra()
&lt;span class="gd"&gt;-def test_draw_sky_image():&lt;/span&gt;
&lt;span class="gi"&gt;+@pytest.mark.parametrize('pars', draw_sky_image_pars)&lt;/span&gt;
&lt;span class="gi"&gt;+def test_draw_sky_image(pars):&lt;/span&gt;
     geometry = make_test_wcs_geometry(case=2)
&lt;span class="gd"&gt;-    tiles = get_test_tiles()&lt;/span&gt;
&lt;span class="gd"&gt;-    url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+    tiles = get_test_tiles(file_format=pars['file_format'], survey=pars['survey'], order=pars['order'], ipix_list=pars['ipix_list'])&lt;/span&gt;
&lt;span class="gi"&gt;+    url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/' + pars['survey'] + '/properties'&lt;/span&gt;
     hips_survey = HipsSurveyProperties.fetch(url)

&lt;span class="gd"&gt;-    data = draw_sky_image(geometry, tiles, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    data = draw_sky_image(geometry=geometry, tiles=tiles, hips_survey=hips_survey, tile_format=pars['file_format'])&lt;/span&gt;

&lt;span class="gd"&gt;-    assert data.shape == geometry.shape&lt;/span&gt;
&lt;span class="gi"&gt;+    assert data.shape == pars['shape']&lt;/span&gt;
     assert data.dtype == np.float64
&lt;span class="gd"&gt;-    assert_allclose(np.sum(data), 2992643842.729775)&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(data[400, 500], 2866.0101409848185)&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(data[400, 501], 2563.6916727348043)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(np.sum(data), pars['data_sum'])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(data[400, 500], pars['data_1'])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(data[400, 501], pars['data_2'])&lt;/span&gt;


 @remote_data
&lt;span class="gu"&gt;@@ -51,9 +59,10 @@ def test_make_sky_image():&lt;/span&gt;
     url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'
     hips_survey = HipsSurveyProperties.fetch(url)
     geometry = make_test_wcs_geometry(case=2)
&lt;span class="gd"&gt;-    data = make_sky_image(geometry, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    data = make_sky_image(geometry=geometry, hips_survey=hips_survey, tile_format='fits')&lt;/span&gt;
     assert data.shape == geometry.shape
     assert data.dtype == np.float64
&lt;span class="gi"&gt;+    assert_allclose(np.sum(data), 7615817463.1612253)&lt;/span&gt;
     assert_allclose(data[200, 994], 2213.30874796)
     assert_allclose(data[200, 995], 2296.93885940)

&lt;span class="gh"&gt;diff --git a/hips/tiles/surveys.py b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gh"&gt;index e93a579..bfe814d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -150,6 +150,20 @@ class HipsSurveyProperties:&lt;/span&gt;
         """
         return self.base_url + '/Norder' + str(order) + '/Dir' + str(self.directory(ipix)) + '/'

&lt;span class="gi"&gt;+    def tile_path(self, order: int, ipix: int, tile_format: str) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Tile access URL&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        order : int&lt;/span&gt;
&lt;span class="gi"&gt;+            HiPS order&lt;/span&gt;
&lt;span class="gi"&gt;+        ipix : int&lt;/span&gt;
&lt;span class="gi"&gt;+            Index of the HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_format : str&lt;/span&gt;
&lt;span class="gi"&gt;+            HiPS tile URL&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        return '/Norder' + str(order) + '/Dir' + str(self.directory(ipix)) + '/Npix' + str(ipix) + '.' + tile_format&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
     @property
     def hips_service_url(self) -&amp;gt; str:
         """HiPS service base URL (`str`)."""

commit 10ada966037b2a71aec42b3c85a9773d2bab6a48
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Sun Jul 9 11:23:26 2017 +0500

    Update base_url property in HipsSurveyProperties class

&lt;span class="gh"&gt;diff --git a/hips/tiles/surveys.py b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gh"&gt;index e93a579..248b112 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -69,16 +69,18 @@ class HipsSurveyProperties:&lt;/span&gt;

         with urllib.request.urlopen(url) as response:
             text = response.read().decode('utf-8')
&lt;span class="gd"&gt;-        return cls.parse(text)&lt;/span&gt;
&lt;span class="gi"&gt;+        return cls.parse(text, url)&lt;/span&gt;

     @classmethod
&lt;span class="gd"&gt;-    def parse(cls, text: str) -&amp;gt; 'HipsSurveyProperties':&lt;/span&gt;
&lt;span class="gi"&gt;+    def parse(cls, text: str, url: str = None) -&amp;gt; 'HipsSurveyProperties':&lt;/span&gt;
         """Parse HiPS survey description text (`HipsSurveyProperties`).

         Parameters
         ----------
         text : str
             Text containing HiPS survey properties
&lt;span class="gi"&gt;+        url : str&lt;/span&gt;
&lt;span class="gi"&gt;+            Properties URL of HiPS&lt;/span&gt;
         """
         data = OrderedDict()
         for line in text.split('\n'):
&lt;span class="gu"&gt;@@ -92,6 +94,9 @@ class HipsSurveyProperties:&lt;/span&gt;
                 # Skip bad lines (silently, might not be a good idea to do this)
                 continue

&lt;span class="gi"&gt;+        if url is not None:&lt;/span&gt;
&lt;span class="gi"&gt;+            data['properties_url'] = url.rsplit('/', 1)[0]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
         return cls(data)

     @property
&lt;span class="gu"&gt;@@ -127,7 +132,16 @@ class HipsSurveyProperties:&lt;/span&gt;
     @property
     def base_url(self) -&amp;gt; str:
         """HiPS access url"""
&lt;span class="gd"&gt;-        return self.data['moc_access_url'].rsplit('/', 1)[0]&lt;/span&gt;
&lt;span class="gi"&gt;+        try:&lt;/span&gt;
&lt;span class="gi"&gt;+            return self.data['hips_service_url']&lt;/span&gt;
&lt;span class="gi"&gt;+        except KeyError:&lt;/span&gt;
&lt;span class="gi"&gt;+            try:&lt;/span&gt;
&lt;span class="gi"&gt;+                return self.data['moc_access_url'].rsplit('/', 1)[0]&lt;/span&gt;
&lt;span class="gi"&gt;+            except KeyError:&lt;/span&gt;
&lt;span class="gi"&gt;+                try:&lt;/span&gt;
&lt;span class="gi"&gt;+                    return self.data['properties_url']&lt;/span&gt;
&lt;span class="gi"&gt;+                except:&lt;/span&gt;
&lt;span class="gi"&gt;+                    return ValueError('URL does not exist!')&lt;/span&gt;

     @property
     def tile_width(self) -&amp;gt; int:
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_surveys.py b/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gh"&gt;index f1a031e..ee1d856 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -36,6 +36,13 @@ class TestHipsSurveyProperties:&lt;/span&gt;
         assert self.hips_survey_property.tile_access_url(order=9, ipix=54321) == 'http://alasky.u-strasbg.fr/DSS/DSSColor/Norder9/Dir50000/'


&lt;span class="gi"&gt;+@remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+def test_base_url():&lt;/span&gt;
&lt;span class="gi"&gt;+    url = 'http://alasky.u-strasbg.fr/DSS/DSS2-NIR/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+    survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    assert survey.base_url == 'http://alasky.u-strasbg.fr/DSS/DSS2-NIR'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
     @requires_hips_extra()
     def test_tile_width(self):
         filename = get_hips_extra_file('datasets/samples/Planck-HFI143/properties')

commit c853878ab027abf70b2f771796ff7ae98c37c6f3
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jul 6 23:03:54 2017 +0500

    Add test case for get_order function

&lt;span class="gh"&gt;diff --git a/.travis.yml b/.travis.yml&lt;/span&gt;
&lt;span class="gh"&gt;index 3cbe1ae..ebe7b8a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/.travis.yml&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/.travis.yml&lt;/span&gt;
&lt;span class="gu"&gt;@@ -46,7 +46,7 @@ matrix:&lt;/span&gt;
     include:
         # Main build -- used for coverage
         - os: linux
&lt;span class="gd"&gt;-          env: SETUP_CMD='test --coverage'&lt;/span&gt;
&lt;span class="gi"&gt;+          env: SETUP_CMD='test --coverage --remote-data -V'&lt;/span&gt;

         # Docs build
         - os: linux
&lt;span class="gu"&gt;@@ -55,7 +55,7 @@ matrix:&lt;/span&gt;

         # Check that install / tests work with minimal required dependencies
         - os: linux
&lt;span class="gd"&gt;-          env: SETUP_CMD='test'&lt;/span&gt;
&lt;span class="gi"&gt;+          env: SETUP_CMD='test -V'&lt;/span&gt;
                CONDA_DEPENDENCIES='healpy scikit-image Pillow'

         # Try MacOS X
&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 2fb930e..bcac055 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -10,9 +10,13 @@ from ..utils import WCSGeometry, compute_healpix_pixel_indices&lt;/span&gt;
 __all__ = [
     'draw_sky_image',
     'make_sky_image',
&lt;span class="gd"&gt;-    'SimpleTilePainter'&lt;/span&gt;
&lt;span class="gi"&gt;+    'SimpleTilePainter',&lt;/span&gt;
&lt;span class="gi"&gt;+    'compute_matching_hips_order'&lt;/span&gt;
 ]

&lt;span class="gi"&gt;+__doctest_skip__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'compute_matching_hips_order',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;

 # TODO: Fix type annotation issue
 def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any], hips_survey: HipsSurveyProperties) -&amp;gt; np.ndarray:
&lt;span class="gu"&gt;@@ -117,20 +121,57 @@ def fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: Hips&lt;/span&gt;
         yield tile


&lt;span class="gd"&gt;-def get_order(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gd"&gt;-    """Compute the tile order suited for the given geometry and hips_survey"""&lt;/span&gt;
&lt;span class="gi"&gt;+def compute_matching_hips_order(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Compute HiPS tile order matching a given image pixel size.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry : WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+        Geometry of the output image&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey : HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+        An object of HipsSurveyProperties&lt;/span&gt;

&lt;span class="gi"&gt;+    Returns&lt;/span&gt;
&lt;span class="gi"&gt;+    -------&lt;/span&gt;
&lt;span class="gi"&gt;+    'int'&lt;/span&gt;
&lt;span class="gi"&gt;+        Returns HiPS order&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Examples&lt;/span&gt;
&lt;span class="gi"&gt;+    --------&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from hips.draw import compute_matching_hips_order&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; geometry = WCSGeometry.create_simple(&lt;/span&gt;
&lt;span class="gi"&gt;+    ...     skydir=SkyCoord(0, 0, unit='deg', frame='icrs'),&lt;/span&gt;
&lt;span class="gi"&gt;+    ...     width=2000, height=1000, fov="3 deg",&lt;/span&gt;
&lt;span class="gi"&gt;+    ...     coordsys='icrs', projection='AIT'&lt;/span&gt;
&lt;span class="gi"&gt;+    ... )&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; compute_matching_hips_order(geometry, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    7&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    # Sky image angular resolution (pixel size in degree)&lt;/span&gt;
     resolution = np.min(proj_plane_pixel_scales(geometry.wcs))
&lt;span class="gi"&gt;+    desired_order = _get_hips_order_for_resolution(hips_survey.tile_width, resolution)&lt;/span&gt;
&lt;span class="gi"&gt;+    # Return the desired order, or the highest resolution available.&lt;/span&gt;
&lt;span class="gi"&gt;+    # Note that HiPS never has resolution less than 3,&lt;/span&gt;
&lt;span class="gi"&gt;+    # and that limit is handled in _get_hips_order_for_resolution&lt;/span&gt;
&lt;span class="gi"&gt;+    return np.min([desired_order, hips_survey.hips_order])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;

&lt;span class="gd"&gt;-    tile_order = np.log2(hips_survey.tile_width)&lt;/span&gt;
&lt;span class="gi"&gt;+def _get_hips_order_for_resolution(tile_width, resolution):&lt;/span&gt;
&lt;span class="gi"&gt;+    """Finding the best HiPS order by looping through all possible options."""&lt;/span&gt;
&lt;span class="gi"&gt;+    tile_order = np.log2(tile_width)&lt;/span&gt;
     full_sphere_area = 4 * np.pi * np.square(180 / np.pi)
&lt;span class="gi"&gt;+    # 29 is the maximum order supported by healpy and 3 is the minimum order&lt;/span&gt;
     for candidate_tile_order in range(3, 29 + 1):
&lt;span class="gd"&gt;-        tile_resolution = np.sqrt(full_sphere_area / 12 / 4**(candidate_tile_order + tile_order))&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_resolution = np.sqrt(full_sphere_area / 12 / 4 ** (candidate_tile_order + tile_order))&lt;/span&gt;
&lt;span class="gi"&gt;+        # Finding the smaller tile order with a resolution equal or better than geometric resolution&lt;/span&gt;
         if tile_resolution &amp;lt;= resolution:
             break

&lt;span class="gd"&gt;-    return np.min([candidate_tile_order, hips_survey.hips_order])&lt;/span&gt;
&lt;span class="gi"&gt;+    return candidate_tile_order&lt;/span&gt;


 def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt; np.ndarray:
&lt;span class="gu"&gt;@@ -150,7 +191,7 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt;&lt;/span&gt;
     data : `~numpy.ndarray`
         Output image pixels
     """
&lt;span class="gd"&gt;-    order = get_order(geometry, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    order = compute_matching_hips_order(geometry, hips_survey)&lt;/span&gt;
     healpix_pixel_indices = compute_healpix_pixel_indices(
         wcs_geometry=geometry,
         order=order,
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 68b7855..249d77e 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,13 +1,16 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gi"&gt;+import pytest&lt;/span&gt;
 import numpy as np
&lt;span class="gi"&gt;+import healpy as hp&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.coordinates import SkyCoord&lt;/span&gt;
 from numpy.testing import assert_allclose
 from astropy.utils.data import get_pkg_data_filename
 from astropy.tests.helper import remote_data
&lt;span class="gd"&gt;-from ..simple import make_sky_image, draw_sky_image&lt;/span&gt;
&lt;span class="gi"&gt;+from ..simple import make_sky_image, draw_sky_image, compute_matching_hips_order, _get_hips_order_for_resolution&lt;/span&gt;
 from ...tiles import HipsSurveyProperties, HipsTileMeta, HipsTile
&lt;span class="gi"&gt;+from ...utils import WCSGeometry&lt;/span&gt;
 from ...utils.testing import get_hips_extra_file, make_test_wcs_geometry, requires_hips_extra

&lt;span class="gd"&gt;-&lt;/span&gt;
 def get_test_tiles():
     filename = get_pkg_data_filename('../../tiles/tests/data/properties.txt')
     hips_survey = HipsSurveyProperties.read(filename)
&lt;span class="gu"&gt;@@ -44,14 +47,46 @@ def test_draw_sky_image():&lt;/span&gt;

 @remote_data
 def test_make_sky_image():
&lt;span class="gd"&gt;-    url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+    # The same example is used in the high level docs getting started page&lt;/span&gt;
&lt;span class="gi"&gt;+    url = 'http://alasky.unistra.fr/DSS/DSS2Merged/properties'&lt;/span&gt;
     hips_survey = HipsSurveyProperties.fetch(url)
     geometry = make_test_wcs_geometry(case=2)
     data = make_sky_image(geometry, hips_survey)
     assert data.shape == geometry.shape
     assert data.dtype == np.float64
&lt;span class="gd"&gt;-    assert_allclose(data[200, 994], 3717.10091363)&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(data[200, 995], 3402.55292158)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(data[200, 994], 2213.30874796)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(data[200, 995], 2296.93885940)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+hips_order_pars = [&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(order=7, fov="3 deg"),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(order=5, fov="10 deg"),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(order=4, fov="15 deg"),&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+@requires_hips_extra()&lt;/span&gt;
&lt;span class="gi"&gt;+@pytest.mark.parametrize('pars', hips_order_pars)&lt;/span&gt;
&lt;span class="gi"&gt;+def test_compute_matching_hips_order(pars):&lt;/span&gt;
&lt;span class="gi"&gt;+    full_path = get_hips_extra_file('datasets/samples/2MASS6XH/properties')&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey = HipsSurveyProperties.read(filename=full_path)&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry = WCSGeometry.create_simple(&lt;/span&gt;
&lt;span class="gi"&gt;+        skydir=SkyCoord(0, 0, unit='deg', frame='icrs'),&lt;/span&gt;
&lt;span class="gi"&gt;+        width=2000, height=1000, fov=pars['fov'],&lt;/span&gt;
&lt;span class="gi"&gt;+        coordsys='icrs', projection='AIT'&lt;/span&gt;
&lt;span class="gi"&gt;+    )&lt;/span&gt;
&lt;span class="gi"&gt;+    assert compute_matching_hips_order(geometry, hips_survey) == pars['order']&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+get_hips_order_for_resolution_pars = [&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(tile_width=512, resolution=0.01232, resolution_res=0.06395791924665553, order=4),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(tile_width=256, resolution=0.0016022, resolution_res=0.003997369952915971, order=8),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(tile_width=128, resolution=0.00009032, resolution_res=0.00012491781102862408, order=13),&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;


&lt;span class="gi"&gt;+@pytest.mark.parametrize('pars', get_hips_order_for_resolution_pars)&lt;/span&gt;
&lt;span class="gi"&gt;+def test_get_hips_order_for_resolution(pars):&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_order = _get_hips_order_for_resolution(pars['tile_width'], pars['resolution'])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert hips_order == pars['order']&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_resolution = hp.nside2resol(hp.order2nside(hips_order))&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(hips_resolution, pars['resolution_res'])&lt;/span&gt;
 # TODO: add tests for SimpleTilePainter with asserts on the intermediate computed things.

commit e1955f6ef699669ff4209cf9a72d26488af6154e
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jul 6 21:48:05 2017 +0500

    Add function for computing HiPS order

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index c912b62..2fb930e 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -2,6 +2,7 @@&lt;/span&gt;
 """HiPS tile drawing -- simple method."""
 from typing import Generator, Any
 import numpy as np
&lt;span class="gi"&gt;+from astropy.wcs.utils import proj_plane_pixel_scales&lt;/span&gt;
 from skimage.transform import ProjectiveTransform, warp
 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta
 from ..utils import WCSGeometry, compute_healpix_pixel_indices
&lt;span class="gu"&gt;@@ -116,6 +117,22 @@ def fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: Hips&lt;/span&gt;
         yield tile


&lt;span class="gi"&gt;+def get_order(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Compute the tile order suited for the given geometry and hips_survey"""&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    resolution = np.min(proj_plane_pixel_scales(geometry.wcs))&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    tile_order = np.log2(hips_survey.tile_width)&lt;/span&gt;
&lt;span class="gi"&gt;+    full_sphere_area = 4 * np.pi * np.square(180 / np.pi)&lt;/span&gt;
&lt;span class="gi"&gt;+    for candidate_tile_order in range(3, 29 + 1):&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_resolution = np.sqrt(full_sphere_area / 12 / 4**(candidate_tile_order + tile_order))&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        if tile_resolution &amp;lt;= resolution:&lt;/span&gt;
&lt;span class="gi"&gt;+            break&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    return np.min([candidate_tile_order, hips_survey.hips_order])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt; np.ndarray:
     """Make sky image: fetch tiles and draw.

&lt;span class="gu"&gt;@@ -133,13 +150,14 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt;&lt;/span&gt;
     data : `~numpy.ndarray`
         Output image pixels
     """
&lt;span class="gi"&gt;+    order = get_order(geometry, hips_survey)&lt;/span&gt;
     healpix_pixel_indices = compute_healpix_pixel_indices(
         wcs_geometry=geometry,
&lt;span class="gd"&gt;-        order=hips_survey.hips_order,&lt;/span&gt;
&lt;span class="gi"&gt;+        order=order,&lt;/span&gt;
         healpix_frame=hips_survey.astropy_frame,
     )
     # TODO: this isn't a good API. Will become better when we have a cache.
&lt;span class="gd"&gt;-    tiles = fetch_tiles(healpix_pixel_indices, hips_survey.hips_order, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    tiles = fetch_tiles(healpix_pixel_indices, order, hips_survey)&lt;/span&gt;

     image_data = draw_sky_image(geometry, tiles, hips_survey)


commit 8cdd34cad90facf9348d9bf7014260e9f75aae77
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jul 3 15:11:40 2017 +0500

    Add classmethod create_simple to WCSGeometry

&lt;span class="gh"&gt;diff --git a/docs/getting_started.rst b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gh"&gt;index 3133c61..9248dd4 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -20,10 +20,10 @@ To make a sky image with the `hips` package, follow the following three steps:&lt;/span&gt;
     from astropy.coordinates import SkyCoord
     from hips.utils import WCSGeometry

&lt;span class="gd"&gt;-    geometry = WCSGeometry.create(&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry = WCSGeometry.create_simple(&lt;/span&gt;
          skydir=SkyCoord(0, 0, unit='deg', frame='galactic'),
&lt;span class="gd"&gt;-         shape=(1000, 2000), coordsys='GAL',&lt;/span&gt;
&lt;span class="gd"&gt;-         projection='AIT', cdelt=0.01, crpix=(1000, 500),&lt;/span&gt;
&lt;span class="gi"&gt;+         width=2000, height=1000, fov="3 deg",&lt;/span&gt;
&lt;span class="gi"&gt;+         coordsys='galactic', projection='AIT'&lt;/span&gt;
     )


&lt;span class="gh"&gt;diff --git a/hips/utils/testing.py b/hips/utils/testing.py&lt;/span&gt;
&lt;span class="gh"&gt;index 0563f7a..cdbbbcf 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/testing.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/testing.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -28,7 +28,6 @@ def has_hips_extra():&lt;/span&gt;
         path = Path(os.environ['HIPS_EXTRA']) / 'datasets/samples/DSS2Red/properties'
         if path.is_file():
             return True
&lt;span class="gd"&gt;-&lt;/span&gt;
     return False


&lt;span class="gu"&gt;@@ -43,19 +42,19 @@ def make_test_wcs_geometry(case=0):&lt;/span&gt;
     if case == 0:
         return WCSGeometry.create(
             skydir=SkyCoord(3, 4, unit='deg', frame='galactic'),
&lt;span class="gd"&gt;-            shape=(2, 3), coordsys='GAL',&lt;/span&gt;
&lt;span class="gi"&gt;+            width=2, height=3, coordsys='galactic',&lt;/span&gt;
             projection='CAR', cdelt=1.0, crpix=(1, 1),
         )
     elif case == 1:
         return WCSGeometry.create(
             skydir=SkyCoord(10, 20, unit='deg', frame='galactic'),
&lt;span class="gd"&gt;-            shape=(10, 20), coordsys='GAL',&lt;/span&gt;
&lt;span class="gi"&gt;+            width=20, height=10, coordsys='galactic',&lt;/span&gt;
             projection='CAR', cdelt=1.0, crpix=(1, 1),
         )
     elif case == 2:
         return WCSGeometry.create(
             skydir=SkyCoord(0, 0, unit='deg', frame='galactic'),
&lt;span class="gd"&gt;-            shape=(1000, 2000), coordsys='GAL',&lt;/span&gt;
&lt;span class="gi"&gt;+            width=2000, height=1000, coordsys='galactic',&lt;/span&gt;
             projection='AIT', cdelt=0.01, crpix=(1000, 500),
         )
     else:
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 9094894..9d0dd47 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -5,7 +5,7 @@ from numpy.testing import assert_allclose&lt;/span&gt;
 from astropy.coordinates import SkyCoord
 import healpy as hp
 from ..healpix import boundaries, compute_healpix_pixel_indices
&lt;span class="gd"&gt;-from .test_wcs import make_test_wcs_geometry&lt;/span&gt;
&lt;span class="gi"&gt;+from ..testing import make_test_wcs_geometry&lt;/span&gt;


 def test_boundaries():
&lt;span class="gu"&gt;@@ -23,8 +23,8 @@ def test_boundaries():&lt;/span&gt;


 compute_healpix_pixel_indices_pars = [
&lt;span class="gd"&gt;-    dict(frame='galactic', ipix=[269, 270, 271, 280, 282, 283, 292, 293, 295, 304, 305, 306]),&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(frame='icrs', ipix=[448, 449, 450, 451, 454, 456, 457, 460, 661, 663, 669]),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(frame='galactic', ipix=[269, 271, 280, 282, 283, 304, 305, 307, 308, 310]),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(frame='icrs', ipix=[448, 449, 450, 451, 454, 456, 457, 458, 459, 460]),&lt;/span&gt;
 ]


&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_wcs.py b/hips/utils/tests/test_wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index e4f6749..6673f69 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,18 +1,39 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 from numpy.testing import assert_allclose
&lt;span class="gd"&gt;-from ..testing import make_test_wcs_geometry&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gi"&gt;+from ..wcs import WCSGeometry&lt;/span&gt;

 class TestWCSGeometry:
     def setup(self):
&lt;span class="gd"&gt;-        self.wcs_geometry = make_test_wcs_geometry(case=0)&lt;/span&gt;
&lt;span class="gi"&gt;+        self.wcs_geometry = WCSGeometry.create_simple(&lt;/span&gt;
&lt;span class="gi"&gt;+            skydir=SkyCoord(0, 0, unit='deg', frame='galactic'),&lt;/span&gt;
&lt;span class="gi"&gt;+            width=2000, height=1000, fov="3 deg",&lt;/span&gt;
&lt;span class="gi"&gt;+            coordsys='galactic', projection='AIT'&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;

&lt;span class="gd"&gt;-    def test_center(self):&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_galactic_frame_center(self):&lt;/span&gt;
         c = self.wcs_geometry.center_skycoord
&lt;span class="gi"&gt;+&lt;/span&gt;
         assert c.frame.name == 'galactic'
&lt;span class="gd"&gt;-        assert_allclose(c.l.deg, 2, atol=1e-2)&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_allclose(c.b.deg, 4.5, atol=1e-2)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(c.l.deg, 359.99, atol=1e-2)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(c.b.deg, 0.00075, atol=1e-2)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.wcs_geometry.wcs.wcs.crpix, [1000., 500.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.wcs_geometry.wcs.wcs.cdelt, [-0.0015, 0.0015])&lt;/span&gt;

     def test_celestial_frame(self):
&lt;span class="gd"&gt;-        pass&lt;/span&gt;
&lt;span class="gd"&gt;-        # TODO (Adeel): add a test&lt;/span&gt;
&lt;span class="gi"&gt;+        wcs_geometry = WCSGeometry.create_simple(&lt;/span&gt;
&lt;span class="gi"&gt;+            skydir=SkyCoord(0, 0, unit='deg', frame='icrs'),&lt;/span&gt;
&lt;span class="gi"&gt;+            width=2000, height=1000, fov="3 deg",&lt;/span&gt;
&lt;span class="gi"&gt;+            coordsys='icrs', projection='AIT'&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;
&lt;span class="gi"&gt;+        c = wcs_geometry.center_skycoord&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        assert c.frame.name == 'icrs'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(c.ra.deg, 359.99, atol=1e-2)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(c.dec.deg, 0.00075, atol=1e-2)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.wcs_geometry.wcs.wcs.crpix, [1000., 500.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.wcs_geometry.wcs.wcs.cdelt, [-0.0015, 0.0015])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def skycoord_separation(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        skydir=SkyCoord(0, 0, unit='deg', frame='icrs')&lt;/span&gt;
&lt;span class="gi"&gt;+        skydir.separation(skydir).degree == 2&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/wcs.py b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index 5e43f6f..31e2e9b 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -4,16 +4,19 @@ from typing import Tuple&lt;/span&gt;
 import numpy as np
 from astropy.coordinates import SkyCoord
 from astropy.wcs import WCS
&lt;span class="gi"&gt;+from astropy.coordinates import Angle&lt;/span&gt;
 from astropy.wcs.utils import pixel_to_skycoord, wcs_to_celestial_frame

 __all__ = [
     'WCSGeometry',
 ]

&lt;span class="gd"&gt;-__doctest_skip__ = ['WCSGeometry']&lt;/span&gt;
&lt;span class="gi"&gt;+__doctest_skip__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    '*',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;

&lt;span class="gd"&gt;-Shape = namedtuple('Shape', ['ny', 'nx'])&lt;/span&gt;
&lt;span class="gd"&gt;-"""Helper for 2-dim image shape, to make it clearer what value is x and y."""&lt;/span&gt;
&lt;span class="gi"&gt;+Shape = namedtuple('Shape', ['width', 'height'])&lt;/span&gt;
&lt;span class="gi"&gt;+"""Helper for 2-dim image shape, to make it clearer what value is width and height."""&lt;/span&gt;


 class WCSGeometry:
&lt;span class="gu"&gt;@@ -23,8 +26,10 @@ class WCSGeometry:&lt;/span&gt;
     ----------
     wcs : `~astropy.wcs.WCS`
         WCS projection object
&lt;span class="gd"&gt;-    shape : tuple&lt;/span&gt;
&lt;span class="gd"&gt;-        Shape of the image&lt;/span&gt;
&lt;span class="gi"&gt;+    width : int&lt;/span&gt;
&lt;span class="gi"&gt;+        Width of the image in pixels&lt;/span&gt;
&lt;span class="gi"&gt;+    height : int&lt;/span&gt;
&lt;span class="gi"&gt;+        Height of the image in pixels&lt;/span&gt;

     Examples
     --------
&lt;span class="gu"&gt;@@ -32,7 +37,7 @@ class WCSGeometry:&lt;/span&gt;
     &amp;gt;&amp;gt;&amp;gt; from hips.utils import WCSGeometry
     &amp;gt;&amp;gt;&amp;gt; skycoord = SkyCoord(10, 20, unit='deg')
     &amp;gt;&amp;gt;&amp;gt; wcs_geometry = WCSGeometry.create(
&lt;span class="gd"&gt;-    ...     skydir=skycoord, shape=(10, 20),&lt;/span&gt;
&lt;span class="gi"&gt;+    ...     skydir=skycoord, width=20, height=10,&lt;/span&gt;
     ...     coordsys='CEL', projection='AIT',
     ...     cdelt=1.0, crpix=(1., 1.),
     ... )
&lt;span class="gu"&gt;@@ -46,20 +51,20 @@ class WCSGeometry:&lt;/span&gt;
     CDELT : -1.0  1.0
     NAXIS : 0  0
     &amp;gt;&amp;gt;&amp;gt; wcs_geometry.shape
&lt;span class="gd"&gt;-    Shape(ny=10, nx=20)&lt;/span&gt;
&lt;span class="gi"&gt;+    Shape(width=20, height=10)&lt;/span&gt;
     """
     WCS_ORIGIN_DEFAULT = 0
     """Default WCS transform origin, to be used in all WCS pix &amp;lt;-&amp;gt; world calls."""

&lt;span class="gd"&gt;-    def __init__(self, wcs: WCS, shape: tuple) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, wcs: WCS, width: int, height: int) -&amp;gt; None:&lt;/span&gt;
         self.wcs = wcs
&lt;span class="gd"&gt;-        self.shape = Shape(*shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        self.shape = Shape(*(width, height))&lt;/span&gt;

     @property
     def center_pix(self) -&amp;gt; Tuple[float, float]:
         """Image center in pixel coordinates (tuple of x, y)."""
&lt;span class="gd"&gt;-        x = float(self.shape.nx - 1) / 2&lt;/span&gt;
&lt;span class="gd"&gt;-        y = float(self.shape.ny - 1) / 2&lt;/span&gt;
&lt;span class="gi"&gt;+        x = float(self.shape.width - 1) / 2&lt;/span&gt;
&lt;span class="gi"&gt;+        y = float(self.shape.height - 1) / 2&lt;/span&gt;
         return x, y

     @property
&lt;span class="gu"&gt;@@ -78,7 +83,7 @@ class WCSGeometry:&lt;/span&gt;
         return pixel_to_skycoord(x, y, self.wcs, self.WCS_ORIGIN_DEFAULT)

     @classmethod
&lt;span class="gd"&gt;-    def create(cls, skydir: SkyCoord, shape: tuple, coordsys: str = 'CEL',&lt;/span&gt;
&lt;span class="gi"&gt;+    def create(cls, skydir: SkyCoord, width: int, height: int, coordsys: str = 'icrs',&lt;/span&gt;
                projection: str = 'AIT', cdelt: float = 1.0, crpix: tuple = (1., 1.)) -&amp;gt; 'WCSGeometry':
         """Create WCS object programmatically (`WCSGeometry`).

&lt;span class="gu"&gt;@@ -86,27 +91,30 @@ class WCSGeometry:&lt;/span&gt;
         ----------
         skydir : `~astropy.coordinates.SkyCoord`
             Sky coordinate of the WCS reference point
&lt;span class="gd"&gt;-        shape : `tuple`&lt;/span&gt;
&lt;span class="gd"&gt;-            Shape of the image (Numpy axis order: y, x)&lt;/span&gt;
&lt;span class="gd"&gt;-        coordsys : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+        width : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+            Width of the image in pixels&lt;/span&gt;
&lt;span class="gi"&gt;+        height : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+            Height of the image in pixels&lt;/span&gt;
&lt;span class="gi"&gt;+        coordsys : {'icrs', 'galactic'}&lt;/span&gt;
             Coordinate system
         projection : `str`
&lt;span class="gd"&gt;-            Projection of the WCS object&lt;/span&gt;
&lt;span class="gi"&gt;+            Projection of the WCS object.&lt;/span&gt;
&lt;span class="gi"&gt;+            To see list of supported projections&lt;/span&gt;
&lt;span class="gi"&gt;+            visit: http://docs.astropy.org/en/stable/wcs/#supported-projections&lt;/span&gt;
         cdelt : `float`
             Coordinate increment at reference point
         crpix : `tuple`
             Pixel coordinates of reference point
             (WCS axis order: x, y and FITS convention origin=1)
         """
&lt;span class="gd"&gt;-&lt;/span&gt;
         w = WCS(naxis=2)

&lt;span class="gd"&gt;-        if coordsys == 'CEL':&lt;/span&gt;
&lt;span class="gi"&gt;+        if coordsys == 'icrs':&lt;/span&gt;
             w.wcs.ctype[0] = f'RA---{projection}'
             w.wcs.ctype[1] = f'DEC--{projection}'
             w.wcs.crval[0] = skydir.icrs.ra.deg
             w.wcs.crval[1] = skydir.icrs.dec.deg
&lt;span class="gd"&gt;-        elif coordsys == 'GAL':&lt;/span&gt;
&lt;span class="gi"&gt;+        elif coordsys == 'galactic':&lt;/span&gt;
             w.wcs.ctype[0] = f'GLON-{projection}'
             w.wcs.ctype[1] = f'GLAT-{projection}'
             w.wcs.crval[0] = skydir.galactic.l.deg
&lt;span class="gu"&gt;@@ -122,7 +130,57 @@ class WCSGeometry:&lt;/span&gt;

         w = WCS(w.to_header())

&lt;span class="gd"&gt;-        return cls(w, shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        return cls(w, width, height)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def create_simple(cls, skydir: SkyCoord, width: int, height: int, fov: {str, Angle},&lt;/span&gt;
&lt;span class="gi"&gt;+                      coordsys: str = 'icrs', projection: str = 'AIT') -&amp;gt; 'WCSGeometry':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Create WCS object programmatically using field of view (`WCSGeometry`).&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        skydir : `~astropy.coordinates.SkyCoord`&lt;/span&gt;
&lt;span class="gi"&gt;+            Sky coordinate of the WCS reference point&lt;/span&gt;
&lt;span class="gi"&gt;+        width : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+            Width of the image in pixels&lt;/span&gt;
&lt;span class="gi"&gt;+        height : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+            Height of the image in pixels&lt;/span&gt;
&lt;span class="gi"&gt;+        fov: `str` or Angle&lt;/span&gt;
&lt;span class="gi"&gt;+            Field of view&lt;/span&gt;
&lt;span class="gi"&gt;+        coordsys : {'icrs', 'galactic'}&lt;/span&gt;
&lt;span class="gi"&gt;+            Coordinate system&lt;/span&gt;
&lt;span class="gi"&gt;+        projection : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+            Projection of the WCS object.&lt;/span&gt;
&lt;span class="gi"&gt;+            To see list of supported projections&lt;/span&gt;
&lt;span class="gi"&gt;+            visit: http://docs.astropy.org/en/stable/wcs/#supported-projections&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Examples&lt;/span&gt;
&lt;span class="gi"&gt;+        --------&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from hips.utils import WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; skycoord = SkyCoord(10, 20, unit='deg')&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; wcs_geometry = WCSGeometry.create_simple(&lt;/span&gt;
&lt;span class="gi"&gt;+        ...     skydir=SkyCoord(0, 0, unit='deg', frame='galactic'),&lt;/span&gt;
&lt;span class="gi"&gt;+        ...     width=2000, height=1000, fov="3 deg",&lt;/span&gt;
&lt;span class="gi"&gt;+        ...     coordsys='galactic', projection='AIT'&lt;/span&gt;
&lt;span class="gi"&gt;+        ... )&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; wcs_geometry.wcs&lt;/span&gt;
&lt;span class="gi"&gt;+        Number of WCS axes: 2&lt;/span&gt;
&lt;span class="gi"&gt;+        CTYPE : 'GLON-AIT'  'GLAT-AIT'&lt;/span&gt;
&lt;span class="gi"&gt;+        CRVAL : 0.0  0.0&lt;/span&gt;
&lt;span class="gi"&gt;+        CRPIX : 500.0  1000.0&lt;/span&gt;
&lt;span class="gi"&gt;+        PC1_1 PC1_2  : 1.0  0.0&lt;/span&gt;
&lt;span class="gi"&gt;+        PC2_1 PC2_2  : 0.0  1.0&lt;/span&gt;
&lt;span class="gi"&gt;+        CDELT : -0.0015  0.0015&lt;/span&gt;
&lt;span class="gi"&gt;+        NAXIS : 0  0&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; wcs_geometry.shape&lt;/span&gt;
&lt;span class="gi"&gt;+        Shape(width=2000, height=1000)&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        fov = Angle(fov)&lt;/span&gt;
&lt;span class="gi"&gt;+        crpix = (float(width / 2), float(height / 2))&lt;/span&gt;
&lt;span class="gi"&gt;+        cdelt = float(fov.degree) / float(max(width, height))&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        return cls.create(skydir, width, height, coordsys, projection, cdelt, crpix)&lt;/span&gt;

     @property
     def celestial_frame(self) -&amp;gt; str:

commit 439bd58bc190c9d957ce4fce9e0acf9c45a40537
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jul 5 14:40:03 2017 +0500

    Remove tile_width from HipsTileMeta

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index eb28f51..c912b62 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -14,7 +14,7 @@ __all__ = [&lt;/span&gt;


 # TODO: Fix type annotation issue
&lt;span class="gd"&gt;-def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any]) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any], hips_survey: HipsSurveyProperties) -&amp;gt; np.ndarray:&lt;/span&gt;
     """Draw sky image using the simple and quick method.

     Parameters
&lt;span class="gu"&gt;@@ -23,6 +23,8 @@ def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any])&lt;/span&gt;
         An object of WCSGeometry
     tiles : List[HipsTile]
         A list of HipsTile
&lt;span class="gi"&gt;+    hips_survey : `~hips.HipsSurveyProperties`&lt;/span&gt;
&lt;span class="gi"&gt;+        HiPS survey properties&lt;/span&gt;

     Returns
     -------
&lt;span class="gu"&gt;@@ -31,7 +33,7 @@ def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any])&lt;/span&gt;
     """
     image = np.zeros(geometry.shape)
     for tile in tiles:
&lt;span class="gd"&gt;-        painter = SimpleTilePainter(geometry, tile)&lt;/span&gt;
&lt;span class="gi"&gt;+        painter = SimpleTilePainter(geometry, hips_survey, tile)&lt;/span&gt;
         image += painter.warp_image()
     return image

&lt;span class="gu"&gt;@@ -45,20 +47,33 @@ class SimpleTilePainter:&lt;/span&gt;
     ----------
     geometry : `~hips.utils.WCSGeometry`
         An object of WCSGeometry
&lt;span class="gi"&gt;+    hips_survey : `~hips.HipsSurveyProperties`&lt;/span&gt;
&lt;span class="gi"&gt;+        HiPS survey properties&lt;/span&gt;
     tile : `HipsTile`
        An object of HipsTile
     """

&lt;span class="gd"&gt;-    def __init__(self, geometry: WCSGeometry, tile: HipsTile) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, geometry: WCSGeometry, hips_survey: HipsSurveyProperties, tile: HipsTile) -&amp;gt; None:&lt;/span&gt;
         self.geometry = geometry
&lt;span class="gi"&gt;+        self.hips_survey = hips_survey&lt;/span&gt;
         self.tile = tile

     @property
&lt;span class="gi"&gt;+    def dst(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Destination array for projective transform"""&lt;/span&gt;
&lt;span class="gi"&gt;+        width = self.hips_survey.tile_width&lt;/span&gt;
&lt;span class="gi"&gt;+        return np.array(&lt;/span&gt;
&lt;span class="gi"&gt;+            [[width - 1, 0],&lt;/span&gt;
&lt;span class="gi"&gt;+             [width - 1, width - 1],&lt;/span&gt;
&lt;span class="gi"&gt;+             [0, width - 1],&lt;/span&gt;
&lt;span class="gi"&gt;+             [0, 0]],&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
     def projection(self) -&amp;gt; ProjectiveTransform:
         """Estimate projective transformation on a HiPS tile"""
         corners = self.tile.meta.skycoord_corners.to_pixel(self.geometry.wcs)
         src = np.array(corners).T.reshape((4, 2))
&lt;span class="gd"&gt;-        dst = self.tile.meta.dst&lt;/span&gt;
&lt;span class="gi"&gt;+        dst = self.dst&lt;/span&gt;
         pt = ProjectiveTransform()
         pt.estimate(src, dst)
         return pt
&lt;span class="gu"&gt;@@ -126,6 +141,6 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt;&lt;/span&gt;
     # TODO: this isn't a good API. Will become better when we have a cache.
     tiles = fetch_tiles(healpix_pixel_indices, hips_survey.hips_order, hips_survey)

&lt;span class="gd"&gt;-    image_data = draw_sky_image(geometry, tiles)&lt;/span&gt;
&lt;span class="gi"&gt;+    image_data = draw_sky_image(geometry, tiles, hips_survey)&lt;/span&gt;

     return image_data
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index ec6bf1a..276c301 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -13,25 +13,27 @@ def get_test_tiles():&lt;/span&gt;
     hips_survey = HipsSurveyProperties.read(filename)

     tile1 = HipsTile.read(
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=450, file_format='fits', frame=hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gd"&gt;-                          tile_width=512),&lt;/span&gt;
&lt;span class="gi"&gt;+        meta=HipsTileMeta(order=3, ipix=450, file_format='fits', frame=hips_survey.astropy_frame),&lt;/span&gt;
         full_path=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix450.fits'),
     )

     tile2 = HipsTile.read(
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=451, file_format='fits', frame=hips_survey.astropy_frame,&lt;/span&gt;
&lt;span class="gd"&gt;-                          tile_width=512),&lt;/span&gt;
&lt;span class="gi"&gt;+        meta=HipsTileMeta(order=3, ipix=451, file_format='fits', frame=hips_survey.astropy_frame),&lt;/span&gt;
         full_path=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix451.fits'),
     )

     return [tile1, tile2]


&lt;span class="gi"&gt;+@remote_data&lt;/span&gt;
 @requires_hips_extra()
 def test_draw_sky_image():
     geometry = make_test_wcs_geometry(case=2)
     tiles = get_test_tiles()
&lt;span class="gd"&gt;-    data = draw_sky_image(geometry, tiles)&lt;/span&gt;
&lt;span class="gi"&gt;+    url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    data = draw_sky_image(geometry, tiles, hips_survey)&lt;/span&gt;

     assert data.shape == geometry.shape
     assert data.dtype == np.float64
&lt;span class="gh"&gt;diff --git a/hips/tiles/surveys.py b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8013ef5..0190a06 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -128,7 +128,13 @@ class HipsSurveyProperties:&lt;/span&gt;
         """HiPS access url"""
         return self.data['moc_access_url'].rsplit('/', 1)[0]

&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def tile_width(self) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gi"&gt;+        """HiPS tile width"""&lt;/span&gt;
&lt;span class="gi"&gt;+        return int(self.data['hips_tile_width']) or 512&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
     def directory(self, ipix: int) -&amp;gt; int:
&lt;span class="gi"&gt;+        """Directory index containing HiPS tile(s)"""&lt;/span&gt;
         return (ipix // 10000) * 10000

     def tile_access_url(self, order: int, ipix: int) -&amp;gt; str:
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_surveys.py b/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gh"&gt;index df4e812..5192f45 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -2,7 +2,7 @@&lt;/span&gt;
 from astropy.utils.data import get_pkg_data_filename
 from astropy.tests.helper import remote_data
 from ..surveys import HipsSurveyProperties, HipsSurveyPropertiesList
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+from ...utils.testing import get_hips_extra_file, requires_hips_extra&lt;/span&gt;

 class TestHipsSurveyProperties:
     @classmethod
&lt;span class="gu"&gt;@@ -35,6 +35,13 @@ class TestHipsSurveyProperties:&lt;/span&gt;
         assert self.hips_survey_property.tile_access_url(order=9, ipix=54321) == 'http://alasky.u-strasbg.fr/DSS/DSSColor/Norder9/Dir50000/'


&lt;span class="gi"&gt;+    @requires_hips_extra()&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_tile_width(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        filename = get_hips_extra_file('datasets/samples/Planck-HFI143/properties')&lt;/span&gt;
&lt;span class="gi"&gt;+        survey = HipsSurveyProperties.read(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert survey.tile_width == 256&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 class TestHipsSurveyPropertiesList:
     @classmethod
     def setup_class(cls):
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 62aa85d..022ad92 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -69,7 +69,7 @@ class TestHipsTile:&lt;/span&gt;
 class TestHipsTileMeta:
     @classmethod
     def setup_class(cls):
&lt;span class="gd"&gt;-        cls.meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='icrs', tile_width=512)&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='icrs')&lt;/span&gt;

     def test_path(self):
         assert str(self.meta.path) == 'hips/tiles/tests/data'
&lt;span class="gu"&gt;@@ -83,16 +83,12 @@ class TestHipsTileMeta:&lt;/span&gt;
     def test_nside(self):
         assert self.meta.nside == 8

&lt;span class="gd"&gt;-    def test_dst(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        dst = np.array([[511, 0], [511, 511], [0, 511], [0, 0]])&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_allclose(self.meta.dst, dst)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
     def test_skycoord_corners(self):
         assert_allclose(self.meta.skycoord_corners.data.lat.deg, [-24.624318, -30., -35.685335, -30.])
         assert_allclose(self.meta.skycoord_corners.data.lon.deg, [264.375, 258.75, 264.375, 270.])
         assert self.meta.skycoord_corners.frame.name == 'icrs'

&lt;span class="gd"&gt;-        meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='galactic', tile_width=512)&lt;/span&gt;
&lt;span class="gi"&gt;+        meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='galactic')&lt;/span&gt;
         assert_allclose(meta.skycoord_corners.data.lat.deg, [-24.624318, -30., -35.685335, -30.])
         assert_allclose(meta.skycoord_corners.data.lon.deg, [264.375, 258.75, 264.375, 270.])
         assert meta.skycoord_corners.frame.name == 'galactic'
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 550969c..1868daf 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -34,32 +34,28 @@ class HipsTileMeta:&lt;/span&gt;
         File format
     frame : {'icrs', 'galactic', 'ecliptic'}
         Sky coordinate frame
&lt;span class="gd"&gt;-    tile_width : `int`&lt;/span&gt;
&lt;span class="gd"&gt;-        Tile width (in pixels)&lt;/span&gt;

     Examples
     --------
     &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTileMeta
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; tile_meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='icrs', tile_width=512)&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; tile_meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='icrs')&lt;/span&gt;
     &amp;gt;&amp;gt;&amp;gt; tile_meta.skycoord_corners
     &amp;lt;SkyCoord (ICRS): (ra, dec) in deg
     [( 264.375, -24.62431835), ( 258.75 , -30.        ),
     ( 264.375, -35.68533471), ( 270.   , -30.        )]&amp;gt;
     """

&lt;span class="gd"&gt;-    def __init__(self, order: int, ipix: int, file_format: str, frame: str = 'galactic', tile_width: int = 512) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, order: int, ipix: int, file_format: str, frame: str = 'galactic') -&amp;gt; None:&lt;/span&gt;
         self.order = order
         self.ipix = ipix
         self.file_format = file_format
         self.frame = frame
&lt;span class="gd"&gt;-        self.tile_width = tile_width&lt;/span&gt;

     def __eq__(self, other: 'HipsTileMeta') -&amp;gt; bool:
         return (
             self.order == other.order and
             self.ipix == other.ipix and
&lt;span class="gd"&gt;-            self.file_format == other.file_format and&lt;/span&gt;
&lt;span class="gd"&gt;-            self.tile_width == other.tile_width&lt;/span&gt;
&lt;span class="gi"&gt;+            self.file_format == other.file_format&lt;/span&gt;
         )

     @property
&lt;span class="gu"&gt;@@ -83,16 +79,6 @@ class HipsTileMeta:&lt;/span&gt;
         return hp.order2nside(self.order)

     @property
&lt;span class="gd"&gt;-    def dst(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Destination array for projective transform"""&lt;/span&gt;
&lt;span class="gd"&gt;-        return np.array(&lt;/span&gt;
&lt;span class="gd"&gt;-            [[self.tile_width - 1, 0],&lt;/span&gt;
&lt;span class="gd"&gt;-             [self.tile_width - 1, self.tile_width - 1],&lt;/span&gt;
&lt;span class="gd"&gt;-             [0, self.tile_width - 1],&lt;/span&gt;
&lt;span class="gd"&gt;-             [0, 0]],&lt;/span&gt;
&lt;span class="gd"&gt;-        )&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
     def skycoord_corners(self) -&amp;gt; SkyCoord:
         """Corner values for a HiPS tile"""
         theta, phi = boundaries(self.nside, self.ipix)

commit 18fc6b656fe873955c10d7505c207cfed030615f
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jul 5 13:26:31 2017 +0500

    Refactor test cases for HipsTile

&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index e6324bf..ec6bf1a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -15,13 +15,13 @@ def get_test_tiles():&lt;/span&gt;
     tile1 = HipsTile.read(
         meta=HipsTileMeta(order=3, ipix=450, file_format='fits', frame=hips_survey.astropy_frame,
                           tile_width=512),
&lt;span class="gd"&gt;-        filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix450.fits'),&lt;/span&gt;
&lt;span class="gi"&gt;+        full_path=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix450.fits'),&lt;/span&gt;
     )

     tile2 = HipsTile.read(
         meta=HipsTileMeta(order=3, ipix=451, file_format='fits', frame=hips_survey.astropy_frame,
                           tile_width=512),
&lt;span class="gd"&gt;-        filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix451.fits'),&lt;/span&gt;
&lt;span class="gi"&gt;+        full_path=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix451.fits'),&lt;/span&gt;
     )

     return [tile1, tile2]
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index a3e972d..62aa85d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,62 +1,70 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gi"&gt;+import pytest&lt;/span&gt;
 import numpy as np
 from astropy.tests.helper import remote_data
 from numpy.testing import assert_allclose
 from numpy.testing import assert_equal
 from ..tile import HipsTile, HipsTileMeta
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+from ...utils.testing import get_hips_extra_file, requires_hips_extra&lt;/span&gt;

 class TestHipsTile:
&lt;span class="gd"&gt;-    @remote_data&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_fetch_read_write_fits(self, tmpdir):&lt;/span&gt;
&lt;span class="gd"&gt;-        meta = HipsTileMeta(order=6, ipix=30889, file_format='fits')&lt;/span&gt;
&lt;span class="gd"&gt;-        url = 'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.fits'&lt;/span&gt;
&lt;span class="gd"&gt;-        tile = HipsTile.fetch(meta, url)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        assert tile.data.shape == (512, 512)&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_equal(tile.data[510][5:7], [1, 0])&lt;/span&gt;

&lt;span class="gd"&gt;-        filename = str(tmpdir / 'Npix30889.fits')&lt;/span&gt;
&lt;span class="gd"&gt;-        tile.write(filename)&lt;/span&gt;
&lt;span class="gd"&gt;-        tile2 = HipsTile.read(meta, filename=filename)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        assert tile == tile2&lt;/span&gt;
&lt;span class="gi"&gt;+    fetch_read_pars = [&lt;/span&gt;
&lt;span class="gi"&gt;+        dict(url='http://alasky.unistra.fr/DSS/DSS2Merged/Norder3/Dir0/Npix463.fits',&lt;/span&gt;
&lt;span class="gi"&gt;+             full_path='datasets/samples/DSS2Red/Norder3/Dir0/Npix463.fits',&lt;/span&gt;
&lt;span class="gi"&gt;+             file_name='Npix463.fits', file_format='fits', order=3, ipix=463),&lt;/span&gt;
&lt;span class="gi"&gt;+        dict(url='http://alasky.unistra.fr/DSS/DSS2Merged/Norder3/Dir0/Npix463.jpg',&lt;/span&gt;
&lt;span class="gi"&gt;+             full_path='datasets/samples/DSS2Red/Norder3/Dir0/Npix463.jpg',&lt;/span&gt;
&lt;span class="gi"&gt;+             file_name='Npix463.jpg', file_format='jpg', order=3, ipix=463),&lt;/span&gt;
&lt;span class="gi"&gt;+        dict(url='http://alasky.unistra.fr/2MASS6X/2MASS6X_H/Norder6/Dir0/Npix6112.png',&lt;/span&gt;
&lt;span class="gi"&gt;+             full_path='datasets/samples/2MASS6XH/Norder6/Dir0/Npix6112.png',&lt;/span&gt;
&lt;span class="gi"&gt;+             file_name='Npix6112.png', file_format='png', order=6, ipix=6112)&lt;/span&gt;
&lt;span class="gi"&gt;+    ]&lt;/span&gt;

     @remote_data
&lt;span class="gd"&gt;-    def test_fetch_read_write_jpg(self, tmpdir):&lt;/span&gt;
&lt;span class="gd"&gt;-        meta = HipsTileMeta(order=6, ipix=30889, file_format='jpg')&lt;/span&gt;
&lt;span class="gd"&gt;-        url = 'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.jpg'&lt;/span&gt;
&lt;span class="gd"&gt;-        tile = HipsTile.fetch(meta, url)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        assert tile.data.shape == (512, 512, 3)&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_equal(tile.data[510][5:7], [[0, 0, 0], [1, 1, 1]])&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        filename = str(tmpdir / 'Npix30889.jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+    @requires_hips_extra()&lt;/span&gt;
&lt;span class="gi"&gt;+    @pytest.mark.parametrize('pars', fetch_read_pars)&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_fetch_read(self, pars):&lt;/span&gt;
&lt;span class="gi"&gt;+        meta = HipsTileMeta(order=pars['order'], ipix=pars['ipix'], file_format=pars['file_format'])&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_fetched = HipsTile.fetch(meta, url=pars['url'])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        full_path = get_hips_extra_file(pars['full_path'])&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_local = HipsTile.read(meta, full_path=full_path)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        assert tile_fetched == tile_local&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    read_write_pars = [&lt;/span&gt;
&lt;span class="gi"&gt;+        dict(full_path='datasets/samples/DSS2Red/Norder3/Dir0/Npix463.fits', file_name='Npix463.fits',&lt;/span&gt;
&lt;span class="gi"&gt;+             file_format='fits', order=3, ipix=463, shape=(512, 512), tile_data=[3047], index=[[510], [5]]),&lt;/span&gt;
&lt;span class="gi"&gt;+        dict(full_path='datasets/samples/DSS2Red/Norder3/Dir0/Npix463.jpg', file_name='Npix463.jpg',&lt;/span&gt;
&lt;span class="gi"&gt;+             file_format='jpg', order=3, ipix=463, shape=(512, 512, 3), tile_data=[[10, 10, 10]], index=[[510], [5]]),&lt;/span&gt;
&lt;span class="gi"&gt;+        dict(full_path='datasets/samples/2MASS6XH/Norder6/Dir0/Npix6112.png', file_name='Npix6112.png',&lt;/span&gt;
&lt;span class="gi"&gt;+             file_format='png', order=6, ipix=6112, shape=(512, 512, 4), tile_data=[[19, 19, 19, 255]], index=[[253], [5]])&lt;/span&gt;
&lt;span class="gi"&gt;+    ]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @requires_hips_extra()&lt;/span&gt;
&lt;span class="gi"&gt;+    @pytest.mark.parametrize('pars', read_write_pars)&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_read_write(self, tmpdir, pars):&lt;/span&gt;
&lt;span class="gi"&gt;+        meta = HipsTileMeta(order=pars['order'], ipix=pars['ipix'], file_format=pars['file_format'])&lt;/span&gt;
&lt;span class="gi"&gt;+        full_path = get_hips_extra_file(pars['full_path'])&lt;/span&gt;
&lt;span class="gi"&gt;+        tile = HipsTile.read(meta, full_path)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        assert tile.data.shape == pars['shape']&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_equal(tile.data[pars['index']], pars['tile_data'])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        filename = str(tmpdir / pars['file_name'])&lt;/span&gt;
         tile.write(filename)
&lt;span class="gd"&gt;-        tile2 = HipsTile.read(meta, filename=filename)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        # The following assert fails, because on JPEG write / read&lt;/span&gt;
&lt;span class="gd"&gt;-        # the data is different (for unknown reasons).&lt;/span&gt;
&lt;span class="gd"&gt;-        # TODO: Figure out what's wrong here and fix!&lt;/span&gt;
&lt;span class="gd"&gt;-        # print(tile.data.sum())&lt;/span&gt;
&lt;span class="gd"&gt;-        # print(tile2.data.sum())&lt;/span&gt;
&lt;span class="gd"&gt;-        # print((tile == tile2).all())&lt;/span&gt;
&lt;span class="gd"&gt;-        # assert tile == tile2&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @remote_data&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_fetch_read_write_png(self, tmpdir):&lt;/span&gt;
&lt;span class="gd"&gt;-        meta = HipsTileMeta(order=6, ipix=463, file_format='png')&lt;/span&gt;
&lt;span class="gd"&gt;-        url = 'http://alasky.unistra.fr/2MASS6X/2MASS6X_H/Norder6/Dir0/Npix463.png'&lt;/span&gt;
&lt;span class="gd"&gt;-        tile = HipsTile.fetch(meta, url)&lt;/span&gt;
&lt;span class="gi"&gt;+        tile2 = HipsTile.read(meta, full_path=filename)&lt;/span&gt;

&lt;span class="gd"&gt;-        assert tile.data.shape == (512, 512, 4)&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_equal(tile.data[510][5:7], [[17, 17, 17, 255], [18, 18, 18, 255]])&lt;/span&gt;
&lt;span class="gi"&gt;+        # TODO: Fix JPG write issue&lt;/span&gt;
&lt;span class="gi"&gt;+        # assert tile == tile2&lt;/span&gt;

&lt;span class="gd"&gt;-        filename = str(tmpdir / 'Npix463.png')&lt;/span&gt;
&lt;span class="gd"&gt;-        tile.write(filename)&lt;/span&gt;
&lt;span class="gd"&gt;-        tile2 = HipsTile.read(meta, filename=filename)&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_value_error(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        with pytest.raises(ValueError):&lt;/span&gt;
&lt;span class="gi"&gt;+            meta = HipsTileMeta(order=3, ipix=463, file_format='jpeg')&lt;/span&gt;
&lt;span class="gi"&gt;+            full_path = get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix463.jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+            HipsTile.read(meta, full_path)&lt;/span&gt;

&lt;span class="gd"&gt;-        assert tile == tile2&lt;/span&gt;

 class TestHipsTileMeta:
     @classmethod
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 4a3373c..550969c 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -159,17 +159,17 @@ class HipsTile:&lt;/span&gt;
         return cls._from_raw_data(meta, raw_data)

     @classmethod
&lt;span class="gd"&gt;-    def read(cls, meta: HipsTileMeta, filename: str = None) -&amp;gt; 'HipsTile':&lt;/span&gt;
&lt;span class="gi"&gt;+    def read(cls, meta: HipsTileMeta, full_path: str = None) -&amp;gt; 'HipsTile':&lt;/span&gt;
         """Read HiPS tile data from a directory and load into memory (`HipsTile`).

         Parameters
         ----------
         meta : `HipsTileMeta`
             Metadata of HiPS tile
&lt;span class="gd"&gt;-        filename : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+        full_path : `str`&lt;/span&gt;
             File path to store a HiPS tile
         """
&lt;span class="gd"&gt;-        path = Path(filename) if filename else meta.full_path&lt;/span&gt;
&lt;span class="gi"&gt;+        path = Path(full_path) or meta.full_path&lt;/span&gt;
         with path.open(mode='rb') as fh:
             raw_data = BytesIO(fh.read())

&lt;span class="gu"&gt;@@ -197,15 +197,15 @@ class HipsTile:&lt;/span&gt;
             raise ValueError(f'Tile file format not supported: {meta.file_format}. '
                               'Supported formats: fits, jpg, png')

&lt;span class="gd"&gt;-    def write(self, filename: str = None) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def write(self, full_path: str = None) -&amp;gt; None:&lt;/span&gt;
         """Write HiPS tile by a given filename.

         Parameters
         ----------
&lt;span class="gd"&gt;-        filename : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+        full_path : `str`&lt;/span&gt;
             Name of the file
         """
&lt;span class="gd"&gt;-        path = Path(filename) if filename else self.meta.full_path&lt;/span&gt;
&lt;span class="gi"&gt;+        path = Path(full_path) or meta.full_path&lt;/span&gt;
         file_format = self.meta.file_format

         if file_format == 'fits':
&lt;span class="gu"&gt;@@ -218,5 +218,5 @@ class HipsTile:&lt;/span&gt;
             image = Image.fromarray(self.data)
             image.save(str(path))
         else:
&lt;span class="gd"&gt;-            raise ValueError(f'Tile file format not supported: {meta.file_format}. '&lt;/span&gt;
&lt;span class="gd"&gt;-                              'Supported formats: fits, jpg, png')&lt;/span&gt;
&lt;span class="gi"&gt;+            raise ValueError(f'Tile file format not supported: {file_format}. '&lt;/span&gt;
&lt;span class="gi"&gt;+                              'Supported formats: fits, jpg, png')  # pragma: no cover&lt;/span&gt;

commit b0f8d4daa85e32a07677522f948b7a9925b07ef7
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jul 5 12:20:03 2017 +0500

    Add test for PNG tiles

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 2f3b909..a3e972d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -43,6 +43,20 @@ class TestHipsTile:&lt;/span&gt;
         # print((tile == tile2).all())
         # assert tile == tile2

&lt;span class="gi"&gt;+    @remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_fetch_read_write_png(self, tmpdir):&lt;/span&gt;
&lt;span class="gi"&gt;+        meta = HipsTileMeta(order=6, ipix=463, file_format='png')&lt;/span&gt;
&lt;span class="gi"&gt;+        url = 'http://alasky.unistra.fr/2MASS6X/2MASS6X_H/Norder6/Dir0/Npix463.png'&lt;/span&gt;
&lt;span class="gi"&gt;+        tile = HipsTile.fetch(meta, url)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        assert tile.data.shape == (512, 512, 4)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_equal(tile.data[510][5:7], [[17, 17, 17, 255], [18, 18, 18, 255]])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        filename = str(tmpdir / 'Npix463.png')&lt;/span&gt;
&lt;span class="gi"&gt;+        tile.write(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+        tile2 = HipsTile.read(meta, filename=filename)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        assert tile == tile2&lt;/span&gt;

 class TestHipsTileMeta:
     @classmethod
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index f337e67..4a3373c 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -189,15 +189,13 @@ class HipsTile:&lt;/span&gt;
                     data = hdu_list[0].data
                     header = hdu_list[0].header
             return cls(meta, data, header)
&lt;span class="gd"&gt;-        elif meta.file_format == 'jpg':&lt;/span&gt;
&lt;span class="gi"&gt;+        elif meta.file_format in {'jpg', 'png'}:&lt;/span&gt;
             with Image.open(raw_data) as image:
                 data = np.array(image)
             return cls(meta, data)
&lt;span class="gd"&gt;-        elif meta.file_format == 'png':&lt;/span&gt;
&lt;span class="gd"&gt;-            raise NotImplementedError()&lt;/span&gt;
         else:
             raise ValueError(f'Tile file format not supported: {meta.file_format}. '
&lt;span class="gd"&gt;-                             'Supported formats: fits, jpg, png')&lt;/span&gt;
&lt;span class="gi"&gt;+                              'Supported formats: fits, jpg, png')&lt;/span&gt;

     def write(self, filename: str = None) -&amp;gt; None:
         """Write HiPS tile by a given filename.
&lt;span class="gu"&gt;@@ -216,11 +214,9 @@ class HipsTile:&lt;/span&gt;
                 warnings.simplefilter('ignore', VerifyWarning)
                 hdu = fits.PrimaryHDU(self.data, header=self.header)
                 hdu.writeto(str(path))
&lt;span class="gd"&gt;-        elif file_format == 'jpg':&lt;/span&gt;
&lt;span class="gi"&gt;+        elif file_format in {'jpg', 'png'}:&lt;/span&gt;
             image = Image.fromarray(self.data)
             image.save(str(path))
&lt;span class="gd"&gt;-        elif file_format == 'png':&lt;/span&gt;
&lt;span class="gd"&gt;-            raise NotImplementedError()&lt;/span&gt;
         else:
             raise ValueError(f'Tile file format not supported: {meta.file_format}. '
&lt;span class="gd"&gt;-                             'Supported formats: fits, jpg, png')&lt;/span&gt;
&lt;span class="gi"&gt;+                              'Supported formats: fits, jpg, png')&lt;/span&gt;

commit f7aa6c9aa4e6bee51dab7801d7910f02b69dc0eb
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jul 3 22:29:06 2017 +0500

    Update tile_access_url method

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 6f23f60..eb28f51 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -97,7 +97,7 @@ def fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: Hips&lt;/span&gt;
             frame=hips_survey.astropy_frame,
             file_format='fits',
         )
&lt;span class="gd"&gt;-        tile = HipsTile.fetch(tile_meta, hips_survey.tile_access_url + tile_meta.filename)&lt;/span&gt;
&lt;span class="gi"&gt;+        tile = HipsTile.fetch(tile_meta, hips_survey.tile_access_url(order=order, ipix=healpix_pixel_index) + tile_meta.filename)&lt;/span&gt;
         yield tile


&lt;span class="gh"&gt;diff --git a/hips/tiles/surveys.py b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gh"&gt;index 1bfd784..8013ef5 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,5 +1,6 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 from collections import OrderedDict
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;
 import urllib.request
 from typing import List
 from astropy.table import Table
&lt;span class="gu"&gt;@@ -123,14 +124,24 @@ class HipsSurveyProperties:&lt;/span&gt;
         return self.data['hips_tile_format']

     @property
&lt;span class="gd"&gt;-    def base_url(self):&lt;/span&gt;
&lt;span class="gi"&gt;+    def base_url(self) -&amp;gt; str:&lt;/span&gt;
         """HiPS access url"""
         return self.data['moc_access_url'].rsplit('/', 1)[0]

&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def tile_access_url(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        """Tile access URL for a HiPS surveys"""&lt;/span&gt;
&lt;span class="gd"&gt;-        return self.base_url + '/Norder' + str(self.hips_order) + '/Dir0/'&lt;/span&gt;
&lt;span class="gi"&gt;+    def directory(self, ipix: int) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gi"&gt;+        return (ipix // 10000) * 10000&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def tile_access_url(self, order: int, ipix: int) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Tile access URL&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        order : int&lt;/span&gt;
&lt;span class="gi"&gt;+            HiPS order&lt;/span&gt;
&lt;span class="gi"&gt;+        ipix : int&lt;/span&gt;
&lt;span class="gi"&gt;+            Index of the HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.base_url + '/Norder' + str(order) + '/Dir' + str(self.directory(ipix)) + '/'&lt;/span&gt;

     @property
     def hips_service_url(self) -&amp;gt; str:
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_surveys.py b/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gh"&gt;index 1130fd9..df4e812 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -32,7 +32,7 @@ class TestHipsSurveyProperties:&lt;/span&gt;
         assert self.hips_survey_property.base_url == 'http://alasky.u-strasbg.fr/DSS/DSSColor'

     def test_tile_access_url(self):
&lt;span class="gd"&gt;-        assert self.hips_survey_property.tile_access_url == 'http://alasky.u-strasbg.fr/DSS/DSSColor/Norder9/Dir0/'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_property.tile_access_url(order=9, ipix=54321) == 'http://alasky.u-strasbg.fr/DSS/DSSColor/Norder9/Dir50000/'&lt;/span&gt;


 class TestHipsSurveyPropertiesList:

commit f746d04e6a3cbe73c4c8ce6b8a32d3020c83bce5
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jul 3 18:33:27 2017 +0500

    Make improvements to compute_healpix_pixel_indices utility function

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 0849789..6e8213f 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -69,11 +69,12 @@ def boundaries(nside: int, pix: int, nest: bool = True) -&amp;gt; tuple:&lt;/span&gt;
     return theta, phi


&lt;span class="gd"&gt;-def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, order: int, healpix_frame: str = None) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, order: int, healpix_frame: str) -&amp;gt; np.ndarray:&lt;/span&gt;
     """Compute HEALPix pixels within a minimal disk covering a given WCSGeometry.

&lt;span class="gd"&gt;-    This function calls `healpy.pixelfunc.ang2vec` and `healpy.query_disc`&lt;/span&gt;
&lt;span class="gd"&gt;-    to compute the HEALPix pixel indices, which will be used in tile drawing.&lt;/span&gt;
&lt;span class="gi"&gt;+    This function computes pixel coordinates for the given WCS object and&lt;/span&gt;
&lt;span class="gi"&gt;+    then calls `healpy.pixelfunc.ang2pix` and `numpy.unique` to compute&lt;/span&gt;
&lt;span class="gi"&gt;+    HEALPix pixel indices, which will be used in tile drawing.&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gu"&gt;@@ -82,8 +83,7 @@ def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, order: int, healpix&lt;/span&gt;
     order : int
         The order of the HEALPix
     healpix_frame : {'icrs', 'galactic', 'ecliptic'}
&lt;span class="gd"&gt;-        Coordinate system frame in which to compute the HEALPix pixel indices.&lt;/span&gt;
&lt;span class="gd"&gt;-        The default ``None`` means: take the frame from ``geometry``.&lt;/span&gt;
&lt;span class="gi"&gt;+        Coordinate system frame in which to compute the HEALPix pixel indices&lt;/span&gt;

     Returns
     -------
&lt;span class="gu"&gt;@@ -101,19 +101,11 @@ def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, order: int, healpix&lt;/span&gt;
     ...     coordsys='CEL', projection='AIT',
     ...     cdelt=1.0, crpix=(1., 1.),
     ... )
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; compute_healpix_pixel_indices(wcs_geometry, order=3)&lt;/span&gt;
&lt;span class="gd"&gt;-    array([176, 207, 208, 239, 240, 271, 272])&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; compute_healpix_pixel_indices(wcs_geometry, order=3, healpix_frame='galactic')&lt;/span&gt;
&lt;span class="gi"&gt;+    array([321, 611, 614, 615, 617, 618, 619, 620, 621, 622])&lt;/span&gt;
     """
&lt;span class="gd"&gt;-    healpix_frame = healpix_frame or wcs_geometry.celestial_frame&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    center_coord = wcs_geometry.center_skycoord.transform_to(healpix_frame)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    pixel_coords = wcs_geometry.pixel_skycoords&lt;/span&gt;
&lt;span class="gd"&gt;-    separation = center_coord.separation(pixel_coords)&lt;/span&gt;
&lt;span class="gd"&gt;-    radius = np.nanmax(separation.rad)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    vec = _skycoord_to_vec(center_coord)&lt;/span&gt;
     nside = hp.order2nside(order)
&lt;span class="gd"&gt;-    ipix = hp.query_disc(nside, vec, radius, nest=True)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    return ipix&lt;/span&gt;
&lt;span class="gi"&gt;+    pixel_coords = wcs_geometry.pixel_skycoords.transform_to(healpix_frame)&lt;/span&gt;
&lt;span class="gi"&gt;+    theta, phi = _skycoord_to_theta_phi(pixel_coords)&lt;/span&gt;
&lt;span class="gi"&gt;+    ipix = hp.ang2pix(nside, theta, phi, nest=True)&lt;/span&gt;
&lt;span class="gi"&gt;+    return np.unique(ipix)&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 65b8632..9094894 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -23,8 +23,8 @@ def test_boundaries():&lt;/span&gt;


 compute_healpix_pixel_indices_pars = [
&lt;span class="gd"&gt;-    dict(frame=None, ipix=[269, 270, 271, 282, 293, 304, 305, 306]),&lt;/span&gt;
&lt;span class="gd"&gt;-    dict(frame='icrs', ipix=[448, 449, 450, 451, 456, 457, 663]),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(frame='galactic', ipix=[269, 270, 271, 280, 282, 283, 292, 293, 295, 304, 305, 306]),&lt;/span&gt;
&lt;span class="gi"&gt;+    dict(frame='icrs', ipix=[448, 449, 450, 451, 454, 456, 457, 460, 661, 663, 669]),&lt;/span&gt;
 ]



commit 3121de53a68eabea67fdce9eae1a26412484edaf
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jul 3 14:00:17 2017 +0500

    Fix typo

&lt;span class="gh"&gt;diff --git a/docs/getting_started.rst b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gh"&gt;index 9e2e621..3133c61 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -79,5 +79,5 @@ What next?&lt;/span&gt;
 That's it, now you've seen the main features of the `hips` package.
 Note that there is API documentation explaining all available functions, classes and parameters.

&lt;span class="gd"&gt;-If you have any questions, or find something now working or a missing feature,&lt;/span&gt;
&lt;span class="gi"&gt;+If you have any questions, or find something not working or a missing feature,&lt;/span&gt;
 please get in touch by posting on our Github issue tracker.

commit 880d4a2e9e9ce31e86b508750bc65ea33f4a3b4b
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 18:32:43 2017 +0500

    Add test case test_wcs_healpix_pixel_indices

&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 2d47d4c..a0931bc 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -7,7 +7,7 @@ from numpy.testing import assert_allclose&lt;/span&gt;
 from ..simple import make_sky_image, draw_sky_image
 from ...tiles import HipsSurveyProperties, HipsTileMeta, HipsTile
 from ...utils.testing import get_hips_extra_file, make_test_wcs_geometry, requires_hips_extra
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+from ...utils import compute_healpix_pixel_indices&lt;/span&gt;

 def get_test_tiles():
     filename = get_pkg_data_filename('../../tiles/tests/data/properties.txt')
&lt;span class="gu"&gt;@@ -51,3 +51,11 @@ def test_make_sky_image():&lt;/span&gt;
     assert data.dtype == np.float64
     assert_allclose(data[200, 994], 3717.10091363)
     assert_allclose(data[200, 995], 3402.55292158)
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def test_wcs_healpix_pixel_indices():&lt;/span&gt;
&lt;span class="gi"&gt;+    url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry = make_test_wcs_geometry(case=2)&lt;/span&gt;
&lt;span class="gi"&gt;+    healpix_pixel_indices = compute_healpix_pixel_indices(geometry, hips_survey.hips_order)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert list(healpix_pixel_indices) == [450, 451]&lt;/span&gt;

commit 5fe3ed0aa5be6544a1b71b786f0014df626d1b21
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 15:58:32 2017 +0500

    Some code reformatting

&lt;span class="gh"&gt;diff --git a/docs/getting_started.rst b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gh"&gt;index e730eac..57274f7 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,7 +1,7 @@&lt;/span&gt;
 .. include:: references.txt

&lt;span class="gd"&gt;-.. _gs:&lt;/span&gt;
 .. doctest-skip-all
&lt;span class="gi"&gt;+.. _gs:&lt;/span&gt;

 ***************
 Getting started
&lt;span class="gu"&gt;@@ -25,7 +25,7 @@ Then it saves it on local disk in FITS file format.&lt;/span&gt;
          projection='AIT', cdelt=0.01, crpix=(1000, 500),
     )
     url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'
&lt;span class="gd"&gt;-    hips_survey = HipsSurveyProperties.fetch(url)  # doctest: +REMOTE_DATA&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
     data = make_sky_image(geometry, hips_survey)
     hdu = fits.PrimaryHDU(data=data, header=geometry.fits_header)
     hdu.writeto('my_image.fits')
&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index f93d9f4..55798b4 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -67,7 +67,8 @@ class SimpleTilePainter:&lt;/span&gt;

     def warp_image(self) -&amp;gt; np.ndarray:
         """Warp a HiPS tile and a sky image"""
&lt;span class="gd"&gt;-        return tf.warp(self.tile.data, self.projection, output_shape=self.geometry.shape, preserve_range=True)&lt;/span&gt;
&lt;span class="gi"&gt;+        return tf.warp(self.tile.data, self.projection,&lt;/span&gt;
&lt;span class="gi"&gt;+                       output_shape=self.geometry.shape, preserve_range=True)&lt;/span&gt;


 def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: HipsSurveyProperties) -&amp;gt; 'HipsTile':

commit 145bcafab6c47ced08191a45f1feaa69907da4a8
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 15:54:01 2017 +0500

    Add attribute frames in HipsSurveyProperties

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 6918052..f93d9f4 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -6,7 +6,7 @@ from skimage import transform as tf&lt;/span&gt;
 from typing import List, Generator, Any

 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta
&lt;span class="gd"&gt;-from ..utils import WCSGeometry, compute_healpix_pixel_indices, frames&lt;/span&gt;
&lt;span class="gi"&gt;+from ..utils import WCSGeometry, compute_healpix_pixel_indices&lt;/span&gt;

 __all__ = [
     'draw_sky_image',
&lt;span class="gu"&gt;@@ -89,7 +89,7 @@ def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: Hip&lt;/span&gt;
     """
     for healpix_pixel_index in healpix_pixel_indices:
         tile_meta = HipsTileMeta(order=order, ipix=healpix_pixel_index,
&lt;span class="gd"&gt;-                                 frame=frames()[hips_survey.hips_frame], file_format='fits')&lt;/span&gt;
&lt;span class="gi"&gt;+                                 frame=hips_survey.frames[hips_survey.hips_frame], file_format='fits')&lt;/span&gt;
         tile = HipsTile.fetch(tile_meta, hips_survey.tile_access_url + tile_meta.filename)
         yield tile

&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index e4608ca..2d47d4c 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -6,7 +6,6 @@ from numpy.testing import assert_allclose&lt;/span&gt;

 from ..simple import make_sky_image, draw_sky_image
 from ...tiles import HipsSurveyProperties, HipsTileMeta, HipsTile
&lt;span class="gd"&gt;-from ...utils import frames&lt;/span&gt;
 from ...utils.testing import get_hips_extra_file, make_test_wcs_geometry, requires_hips_extra


&lt;span class="gu"&gt;@@ -15,13 +14,13 @@ def get_test_tiles():&lt;/span&gt;
     hips_survey = HipsSurveyProperties.read(filename)

     tile1 = HipsTile.read(
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=450, file_format='fits', frame=frames()[hips_survey.hips_frame],&lt;/span&gt;
&lt;span class="gi"&gt;+        meta=HipsTileMeta(order=3, ipix=450, file_format='fits', frame=hips_survey.frames[hips_survey.hips_frame],&lt;/span&gt;
                           tile_width=512),
         filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix450.fits'),
     )

     tile2 = HipsTile.read(
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=451, file_format='fits', frame=frames()[hips_survey.hips_frame],&lt;/span&gt;
&lt;span class="gi"&gt;+        meta=HipsTileMeta(order=3, ipix=451, file_format='fits', frame=hips_survey.frames[hips_survey.hips_frame],&lt;/span&gt;
                           tile_width=512),
         filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix451.fits'),
     )
&lt;span class="gh"&gt;diff --git a/hips/tiles/description.py b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gh"&gt;index 90c4bca..c8792e0 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -27,6 +27,7 @@ class HipsSurveyProperties:&lt;/span&gt;

     def __init__(self, data: OrderedDict) -&amp;gt; None:
         self.data = data
&lt;span class="gi"&gt;+        self.frames = dict({'equatorial': 'icrs', 'galactic': 'galactic', 'ecliptic': 'ecliptic'})&lt;/span&gt;

     @classmethod
     def read(cls, filename: str) -&amp;gt; 'HipsSurveyProperties':
&lt;span class="gu"&gt;@@ -116,4 +117,5 @@ class HipsSurveyProperties:&lt;/span&gt;

     @property
     def tile_access_url(self):
&lt;span class="gi"&gt;+        """Tile access URL for a HiPS surveys"""&lt;/span&gt;
         return self.access_url + '/Norder' + str(self.hips_order) + '/Dir0/'
&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 9eaffad..8e84629 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -13,8 +13,7 @@ from .wcs import WCSGeometry&lt;/span&gt;

 __all__ = [
     'boundaries',
&lt;span class="gd"&gt;-    'compute_healpix_pixel_indices',&lt;/span&gt;
&lt;span class="gd"&gt;-    'frames'&lt;/span&gt;
&lt;span class="gi"&gt;+    'compute_healpix_pixel_indices'&lt;/span&gt;
 ]

 __doctest_skip__ = ['boundaries', 'compute_healpix_pixel_indices']
&lt;span class="gu"&gt;@@ -110,7 +109,3 @@ def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, order: int) -&amp;gt; np.n&lt;/span&gt;
     vec = _skycoord_to_vec(center_coord)
     nside = hp.order2nside(order)
     return hp.query_disc(nside, vec, radius)
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-def frames() -&amp;gt; dict:&lt;/span&gt;
&lt;span class="gd"&gt;-    """A dictionary mapping commonly used frames"""&lt;/span&gt;
&lt;span class="gd"&gt;-    return dict({'equatorial': 'icrs', 'galactic': 'galactic', 'ecliptic': 'ecliptic'})&lt;/span&gt;

commit 5c85e128e37e4c0cc86166e08fc13b1d51e3a5c0
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 15:42:16 2017 +0500

    Add property tile_access_url in HipsSurveyProperties

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index feae223..6918052 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -87,11 +87,10 @@ def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: Hip&lt;/span&gt;
     'HipsTile'
         Returns an object of  HipsTile
     """
&lt;span class="gd"&gt;-    base_url = hips_survey.access_url + '/Norder' + str(hips_survey.hips_order) + '/Dir0/'&lt;/span&gt;
     for healpix_pixel_index in healpix_pixel_indices:
         tile_meta = HipsTileMeta(order=order, ipix=healpix_pixel_index,
                                  frame=frames()[hips_survey.hips_frame], file_format='fits')
&lt;span class="gd"&gt;-        tile = HipsTile.fetch(tile_meta, base_url + tile_meta.filename)&lt;/span&gt;
&lt;span class="gi"&gt;+        tile = HipsTile.fetch(tile_meta, hips_survey.tile_access_url + tile_meta.filename)&lt;/span&gt;
         yield tile


&lt;span class="gh"&gt;diff --git a/hips/tiles/description.py b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gh"&gt;index 15d5a9a..90c4bca 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -113,3 +113,7 @@ class HipsSurveyProperties:&lt;/span&gt;
     def access_url(self):
         """HiPS access url"""
         return self.data['moc_access_url'].rsplit('/', 1)[0]
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def tile_access_url(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.access_url + '/Norder' + str(self.hips_order) + '/Dir0/'&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_description.py b/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gh"&gt;index d0e87dc..9874916 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -29,3 +29,6 @@ class TestHipsSurveyProperties:&lt;/span&gt;

     def test_access_url(self):
         assert self.hips_survey_property.access_url == 'http://alasky.u-strasbg.fr/DSS/DSSColor'
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_tile_access_url(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_property.tile_access_url == 'http://alasky.u-strasbg.fr/DSS/DSSColor/Norder9/Dir0/'&lt;/span&gt;

commit a4b6846ef107572e7b542114b731089346c3b1f5
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 15:24:59 2017 +0500

    Remove attribute self.pt from SimpleTilePainter

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index d29f619..feae223 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -54,7 +54,6 @@ class SimpleTilePainter:&lt;/span&gt;
     def __init__(self, geometry: WCSGeometry, tile: HipsTile) -&amp;gt; None:
         self.geometry = geometry
         self.tile = tile
&lt;span class="gd"&gt;-        self.pt = None&lt;/span&gt;

     @property
     def projection(self) -&amp;gt; tf.ProjectiveTransform:
&lt;span class="gu"&gt;@@ -62,9 +61,9 @@ class SimpleTilePainter:&lt;/span&gt;
         corners = self.tile.meta.skycoord_corners.to_pixel(self.geometry.wcs)
         src = np.array(corners).T.reshape((4, 2))
         dst = self.tile.meta.dst
&lt;span class="gd"&gt;-        self.pt = tf.ProjectiveTransform()&lt;/span&gt;
&lt;span class="gd"&gt;-        self.pt.estimate(src, dst)&lt;/span&gt;
&lt;span class="gd"&gt;-        return self.pt&lt;/span&gt;
&lt;span class="gi"&gt;+        pt = tf.ProjectiveTransform()&lt;/span&gt;
&lt;span class="gi"&gt;+        pt.estimate(src, dst)&lt;/span&gt;
&lt;span class="gi"&gt;+        return pt&lt;/span&gt;

     def warp_image(self) -&amp;gt; np.ndarray:
         """Warp a HiPS tile and a sky image"""

commit 69e09af162b071c3a1f271883ebf51fd00aceee5
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 15:23:22 2017 +0500

    Skip example from doctest

&lt;span class="gh"&gt;diff --git a/docs/getting_started.rst b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gh"&gt;index 81c48db..e730eac 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,6 +1,7 @@&lt;/span&gt;
 .. include:: references.txt

 .. _gs:
&lt;span class="gi"&gt;+.. doctest-skip-all&lt;/span&gt;

 ***************
 Getting started
&lt;span class="gu"&gt;@@ -10,19 +11,21 @@ The example below shows a high level use case of the ``hips`` package.&lt;/span&gt;
 It fetches a HiPS tile from a remote URL and draws it on a sky image.
 Then it saves it on local disk in FITS file format.

&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; from astropy.io import fits&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; from astropy.tests.helper import remote_data&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; from hips.utils import WCSGeometry&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; from hips.draw import make_sky_image&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; geometry = WCSGeometry.create(&lt;/span&gt;
&lt;span class="gd"&gt;-...     skydir=SkyCoord(0, 0, unit='deg', frame='galactic'),&lt;/span&gt;
&lt;span class="gd"&gt;-...     shape=(1000, 2000), coordsys='GAL',&lt;/span&gt;
&lt;span class="gd"&gt;-...     projection='AIT', cdelt=0.01, crpix=(1000, 500),&lt;/span&gt;
&lt;span class="gd"&gt;-... )&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; hips_survey = HipsSurveyProperties.fetch(url)  # doctest: +REMOTE_DATA&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; data = make_sky_image(geometry, hips_survey)&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; hdu = fits.PrimaryHDU(data=data, header=geometry.fits_header)&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; hdu.writeto('my_image.fits')&lt;/span&gt;
\ No newline at end of file
&lt;span class="gi"&gt;+::&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    from astropy.io import fits&lt;/span&gt;
&lt;span class="gi"&gt;+    from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gi"&gt;+    from astropy.tests.helper import remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+    from hips.utils import WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+    from hips.draw import make_sky_image&lt;/span&gt;
&lt;span class="gi"&gt;+    from hips.tiles import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry = WCSGeometry.create(&lt;/span&gt;
&lt;span class="gi"&gt;+         skydir=SkyCoord(0, 0, unit='deg', frame='galactic'),&lt;/span&gt;
&lt;span class="gi"&gt;+         shape=(1000, 2000), coordsys='GAL',&lt;/span&gt;
&lt;span class="gi"&gt;+         projection='AIT', cdelt=0.01, crpix=(1000, 500),&lt;/span&gt;
&lt;span class="gi"&gt;+    )&lt;/span&gt;
&lt;span class="gi"&gt;+    url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey = HipsSurveyProperties.fetch(url)  # doctest: +REMOTE_DATA&lt;/span&gt;
&lt;span class="gi"&gt;+    data = make_sky_image(geometry, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    hdu = fits.PrimaryHDU(data=data, header=geometry.fits_header)&lt;/span&gt;
&lt;span class="gi"&gt;+    hdu.writeto('my_image.fits')&lt;/span&gt;

commit 112fb37cd4514e84449be3e3543164cc4f171383
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 15:02:32 2017 +0500

    Update example for HipsTileMeta

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index c05c52a..f47888a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -41,9 +41,9 @@ class HipsTileMeta:&lt;/span&gt;
     &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTileMeta
     &amp;gt;&amp;gt;&amp;gt; tile_meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='icrs', tile_width=512)
     &amp;gt;&amp;gt;&amp;gt; tile_meta.skycoord_corners
&lt;span class="gd"&gt;-    &amp;lt;SkyCoord (Galactic): (l, b) in deg&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;lt;SkyCoord (ICRS): (ra, dec) in deg&lt;/span&gt;
     [( 264.375, -24.62431835), ( 258.75 , -30.        ),
&lt;span class="gd"&gt;-     ( 264.375, -35.68533471), ( 270.   , -30.        )]&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+    ( 264.375, -35.68533471), ( 270.   , -30.        )]&amp;gt;&lt;/span&gt;
     """

     def __init__(self, order: int, ipix: int, file_format: str, frame: str = 'galactic', tile_width: int = 512) -&amp;gt; None:

commit c34d4061a05eae864ae8de05b7fd639da36910dc
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 14:31:47 2017 +0500

    Update requires_hips_extra decorator function

&lt;span class="gh"&gt;diff --git a/hips/utils/testing.py b/hips/utils/testing.py&lt;/span&gt;
&lt;span class="gh"&gt;index d9d6d69..0563f7a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/testing.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/testing.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -22,11 +22,19 @@ def get_hips_extra_file(filename):&lt;/span&gt;
     return path / filename


&lt;span class="gi"&gt;+def has_hips_extra():&lt;/span&gt;
&lt;span class="gi"&gt;+    """Is hips-extra available? (bool)"""&lt;/span&gt;
&lt;span class="gi"&gt;+    if 'HIPS_EXTRA' in os.environ:&lt;/span&gt;
&lt;span class="gi"&gt;+        path = Path(os.environ['HIPS_EXTRA']) / 'datasets/samples/DSS2Red/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+        if path.is_file():&lt;/span&gt;
&lt;span class="gi"&gt;+            return True&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    return False&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 def requires_hips_extra():
&lt;span class="gd"&gt;-    """Decorator to mark tests requiring ``hips-extra`` data.&lt;/span&gt;
&lt;span class="gd"&gt;-    """&lt;/span&gt;
&lt;span class="gd"&gt;-    has_hips_extra = get_hips_extra_file('datasets/samples/DSS2Red/properties').is_file()&lt;/span&gt;
&lt;span class="gd"&gt;-    skip_it = not has_hips_extra&lt;/span&gt;
&lt;span class="gi"&gt;+    """Decorator to mark tests requiring ``hips-extra`` data."""&lt;/span&gt;
&lt;span class="gi"&gt;+    skip_it = not has_hips_extra()&lt;/span&gt;
     reason = 'No hips-extra data available.'
     return pytest.mark.skipif(skip_it, reason=reason)


commit 451b32a2985b55fad3bb2a0de8eb25ff3c75b218
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 14:10:51 2017 +0500

    Update read classmethod in HipsTile class

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index b7d95fc..c05c52a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -96,6 +96,7 @@ class HipsTileMeta:&lt;/span&gt;
         theta, phi = boundaries(self.nside, self.ipix)
         return SkyCoord(phi, np.pi / 2 - theta, unit='radian', frame=self.frame)

&lt;span class="gi"&gt;+&lt;/span&gt;
 class HipsTile:
     """HiPS tile container.

&lt;span class="gu"&gt;@@ -174,9 +175,9 @@ class HipsTile:&lt;/span&gt;
         path = Path(filename) if filename else meta.full_path

         if meta.file_format == 'fits':
&lt;span class="gd"&gt;-            hdu_list = fits.open(str(path))&lt;/span&gt;
&lt;span class="gd"&gt;-            data = hdu_list[0].data&lt;/span&gt;
&lt;span class="gd"&gt;-            header = hdu_list[0].header&lt;/span&gt;
&lt;span class="gi"&gt;+            with fits.open(str(path)) as hdu_list:&lt;/span&gt;
&lt;span class="gi"&gt;+                data = hdu_list[0].data&lt;/span&gt;
&lt;span class="gi"&gt;+                header = hdu_list[0].header&lt;/span&gt;
             return cls(meta, data, header)
         else:
             image = Image.open(str(path))

commit 186286c3a64f92ee1f9a50b053e5bc9724dd438f
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 14:07:33 2017 +0500

    Update test_skycoord_corners in TestHipsTileMeta

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 7d85e81..c0a8ccd 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -67,9 +67,11 @@ class TestHipsTileMeta:&lt;/span&gt;
         assert_allclose(self.meta.dst, dst)

     def test_skycoord_corners(self):
&lt;span class="gd"&gt;-        assert_allclose(self.meta.skycoord_corners.ra.deg, [264.375, 258.75, 264.375, 270.])&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_allclose(self.meta.skycoord_corners.dec.deg, [-24.624318, -30., -35.685335, -30.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.meta.skycoord_corners.data.lat.deg, [-24.624318, -30., -35.685335, -30.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.meta.skycoord_corners.data.lon.deg, [264.375, 258.75, 264.375, 270.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.meta.skycoord_corners.frame.name == 'icrs'&lt;/span&gt;

         meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='galactic', tile_width=512)
&lt;span class="gd"&gt;-        assert_allclose(meta.skycoord_corners.l.deg, [264.375, 258.75, 264.375, 270.])&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_allclose(meta.skycoord_corners.b.deg, [-24.624318, -30., -35.685335, -30.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(meta.skycoord_corners.data.lat.deg, [-24.624318, -30., -35.685335, -30.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(meta.skycoord_corners.data.lon.deg, [264.375, 258.75, 264.375, 270.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert meta.skycoord_corners.frame.name == 'galactic'&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 3ae0f4f..b7d95fc 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -94,11 +94,7 @@ class HipsTileMeta:&lt;/span&gt;
     def skycoord_corners(self) -&amp;gt; SkyCoord:
         """Corner values for a HiPS tile"""
         theta, phi = boundaries(self.nside, self.ipix)
&lt;span class="gd"&gt;-        if self.frame == 'galactic':&lt;/span&gt;
&lt;span class="gd"&gt;-            return SkyCoord(l=phi, b=np.pi / 2 - theta, unit='radian', frame=self.frame)&lt;/span&gt;
&lt;span class="gd"&gt;-        else:&lt;/span&gt;
&lt;span class="gd"&gt;-            return SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame=self.frame)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+        return SkyCoord(phi, np.pi / 2 - theta, unit='radian', frame=self.frame)&lt;/span&gt;

 class HipsTile:
     """HiPS tile container.

commit de5566394997a6a2d7a87e548f12b3b179aa1f53
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 12:46:30 2017 +0500

    Add function frames in utils/healpix.py

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index ea61810..d29f619 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -6,7 +6,7 @@ from skimage import transform as tf&lt;/span&gt;
 from typing import List, Generator, Any

 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta
&lt;span class="gd"&gt;-from ..utils import WCSGeometry, compute_healpix_pixel_indices&lt;/span&gt;
&lt;span class="gi"&gt;+from ..utils import WCSGeometry, compute_healpix_pixel_indices, frames&lt;/span&gt;

 __all__ = [
     'draw_sky_image',
&lt;span class="gu"&gt;@@ -89,10 +89,9 @@ def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: Hip&lt;/span&gt;
         Returns an object of  HipsTile
     """
     base_url = hips_survey.access_url + '/Norder' + str(hips_survey.hips_order) + '/Dir0/'
&lt;span class="gd"&gt;-    frames = dict({'equatorial': 'icrs', 'galactic': 'galactic', 'ecliptic': 'ecliptic'})&lt;/span&gt;
     for healpix_pixel_index in healpix_pixel_indices:
         tile_meta = HipsTileMeta(order=order, ipix=healpix_pixel_index,
&lt;span class="gd"&gt;-                                 frame=frames[hips_survey.hips_frame], file_format='fits')&lt;/span&gt;
&lt;span class="gi"&gt;+                                 frame=frames()[hips_survey.hips_frame], file_format='fits')&lt;/span&gt;
         tile = HipsTile.fetch(tile_meta, base_url + tile_meta.filename)
         yield tile

&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 80818f9..e4608ca 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -6,21 +6,23 @@ from numpy.testing import assert_allclose&lt;/span&gt;

 from ..simple import make_sky_image, draw_sky_image
 from ...tiles import HipsSurveyProperties, HipsTileMeta, HipsTile
&lt;span class="gi"&gt;+from ...utils import frames&lt;/span&gt;
 from ...utils.testing import get_hips_extra_file, make_test_wcs_geometry, requires_hips_extra


 def get_test_tiles():
&lt;span class="gd"&gt;-    frames = dict({'equatorial': 'icrs', 'galactic': 'galactic', 'ecliptic': 'ecliptic'})&lt;/span&gt;
     filename = get_pkg_data_filename('../../tiles/tests/data/properties.txt')
     hips_survey = HipsSurveyProperties.read(filename)

     tile1 = HipsTile.read(
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=450, file_format='fits', frame=frames[hips_survey.hips_frame], tile_width=512),&lt;/span&gt;
&lt;span class="gi"&gt;+        meta=HipsTileMeta(order=3, ipix=450, file_format='fits', frame=frames()[hips_survey.hips_frame],&lt;/span&gt;
&lt;span class="gi"&gt;+                          tile_width=512),&lt;/span&gt;
         filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix450.fits'),
     )

     tile2 = HipsTile.read(
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=451, file_format='fits', frame=frames[hips_survey.hips_frame], tile_width=512),&lt;/span&gt;
&lt;span class="gi"&gt;+        meta=HipsTileMeta(order=3, ipix=451, file_format='fits', frame=frames()[hips_survey.hips_frame],&lt;/span&gt;
&lt;span class="gi"&gt;+                          tile_width=512),&lt;/span&gt;
         filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix451.fits'),
     )

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 829248f..9eaffad 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -14,6 +14,7 @@ from .wcs import WCSGeometry&lt;/span&gt;
 __all__ = [
     'boundaries',
     'compute_healpix_pixel_indices',
&lt;span class="gi"&gt;+    'frames'&lt;/span&gt;
 ]

 __doctest_skip__ = ['boundaries', 'compute_healpix_pixel_indices']
&lt;span class="gu"&gt;@@ -109,3 +110,7 @@ def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, order: int) -&amp;gt; np.n&lt;/span&gt;
     vec = _skycoord_to_vec(center_coord)
     nside = hp.order2nside(order)
     return hp.query_disc(nside, vec, radius)
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def frames() -&amp;gt; dict:&lt;/span&gt;
&lt;span class="gi"&gt;+    """A dictionary mapping commonly used frames"""&lt;/span&gt;
&lt;span class="gi"&gt;+    return dict({'equatorial': 'icrs', 'galactic': 'galactic', 'ecliptic': 'ecliptic'})&lt;/span&gt;

commit a9b0984a670a624b791fc99f11e93972edf97aad
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 12:37:38 2017 +0500

    Rename draw_tile to painter

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index ef0908f..ea61810 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -33,8 +33,8 @@ def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any])&lt;/span&gt;
     # TODO: Fix type annotation issue
     sky_sky = np.zeros(geometry.shape)
     for tile in tiles:
&lt;span class="gd"&gt;-        draw_tile = SimpleTilePainter(geometry, tile)&lt;/span&gt;
&lt;span class="gd"&gt;-        sky_sky += draw_tile.warp_image()&lt;/span&gt;
&lt;span class="gi"&gt;+        painter = SimpleTilePainter(geometry, tile)&lt;/span&gt;
&lt;span class="gi"&gt;+        sky_sky += painter.warp_image()&lt;/span&gt;
     return sky_sky



commit a0ad4cb044373e879a2d88b5559de91c91557e19
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 12:36:50 2017 +0500

    Rename all_sky to sky_sky

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 9a849cd..ef0908f 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -31,11 +31,11 @@ def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any])&lt;/span&gt;
         Returns a numpy array containing all HiPS tiles projected onto it
     """
     # TODO: Fix type annotation issue
&lt;span class="gd"&gt;-    all_sky = np.zeros(geometry.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+    sky_sky = np.zeros(geometry.shape)&lt;/span&gt;
     for tile in tiles:
         draw_tile = SimpleTilePainter(geometry, tile)
&lt;span class="gd"&gt;-        all_sky += draw_tile.warp_image()&lt;/span&gt;
&lt;span class="gd"&gt;-    return all_sky&lt;/span&gt;
&lt;span class="gi"&gt;+        sky_sky += draw_tile.warp_image()&lt;/span&gt;
&lt;span class="gi"&gt;+    return sky_sky&lt;/span&gt;


 class SimpleTilePainter:

commit 9b79b9d19c6faa8f1bf5386076af04dc3340e995
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 12:33:05 2017 +0500

    Update test_skycoord_corners in TestHipsTileMeta

&lt;span class="gh"&gt;diff --git a/hips/tiles/__init__.py b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gh"&gt;index 0dfc508..3e45f09 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,6 +1,5 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 """Classes and functions to manage HiPS tiles."""
 from .tile import *
&lt;span class="gd"&gt;-from .tile_meta import *&lt;/span&gt;
 from .description import *
 from .surveys import *
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 95701cd..7d85e81 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -69,3 +69,7 @@ class TestHipsTileMeta:&lt;/span&gt;
     def test_skycoord_corners(self):
         assert_allclose(self.meta.skycoord_corners.ra.deg, [264.375, 258.75, 264.375, 270.])
         assert_allclose(self.meta.skycoord_corners.dec.deg, [-24.624318, -30., -35.685335, -30.])
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='galactic', tile_width=512)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(meta.skycoord_corners.l.deg, [264.375, 258.75, 264.375, 270.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(meta.skycoord_corners.b.deg, [-24.624318, -30., -35.685335, -30.])&lt;/span&gt;

commit 3c8204abecb09c62748100cdac40d0b33def4513
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 12:25:52 2017 +0500

    Add property projection in SimpleTilePainter

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 4808c6d..9a849cd 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -34,7 +34,6 @@ def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any])&lt;/span&gt;
     all_sky = np.zeros(geometry.shape)
     for tile in tiles:
         draw_tile = SimpleTilePainter(geometry, tile)
&lt;span class="gd"&gt;-        draw_tile.apply_projection()&lt;/span&gt;
         all_sky += draw_tile.warp_image()
     return all_sky

&lt;span class="gu"&gt;@@ -57,19 +56,19 @@ class SimpleTilePainter:&lt;/span&gt;
         self.tile = tile
         self.pt = None

&lt;span class="gd"&gt;-    def apply_projection(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Apply projective transformation on a HiPS tile"""&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def projection(self) -&amp;gt; tf.ProjectiveTransform:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Estimate projective transformation on a HiPS tile"""&lt;/span&gt;
         corners = self.tile.meta.skycoord_corners.to_pixel(self.geometry.wcs)
         src = np.array(corners).T.reshape((4, 2))
         dst = self.tile.meta.dst
         self.pt = tf.ProjectiveTransform()
         self.pt.estimate(src, dst)
&lt;span class="gi"&gt;+        return self.pt&lt;/span&gt;

     def warp_image(self) -&amp;gt; np.ndarray:
         """Warp a HiPS tile and a sky image"""
&lt;span class="gd"&gt;-        # This converts a big-endian byte integer to a float&lt;/span&gt;
&lt;span class="gd"&gt;-        data = self.tile.data.astype('float')&lt;/span&gt;
&lt;span class="gd"&gt;-        return tf.warp(data, self.pt, output_shape=self.geometry.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        return tf.warp(self.tile.data, self.projection, output_shape=self.geometry.shape, preserve_range=True)&lt;/span&gt;


 def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: HipsSurveyProperties) -&amp;gt; 'HipsTile':
&lt;span class="gu"&gt;@@ -90,8 +89,10 @@ def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: Hip&lt;/span&gt;
         Returns an object of  HipsTile
     """
     base_url = hips_survey.access_url + '/Norder' + str(hips_survey.hips_order) + '/Dir0/'
&lt;span class="gi"&gt;+    frames = dict({'equatorial': 'icrs', 'galactic': 'galactic', 'ecliptic': 'ecliptic'})&lt;/span&gt;
     for healpix_pixel_index in healpix_pixel_indices:
&lt;span class="gd"&gt;-        tile_meta = HipsTileMeta(order=order, ipix=healpix_pixel_index, file_format='fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_meta = HipsTileMeta(order=order, ipix=healpix_pixel_index,&lt;/span&gt;
&lt;span class="gi"&gt;+                                 frame=frames[hips_survey.hips_frame], file_format='fits')&lt;/span&gt;
         tile = HipsTile.fetch(tile_meta, base_url + tile_meta.filename)
         yield tile


commit a7d4ba4faf0dd826e94181a5ecd092036fdb12bd
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 12:22:16 2017 +0500

    Update test case for HipsTileMeta class

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index cc0e65a..95701cd 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,10 +1,10 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;
 from astropy.tests.helper import remote_data
 from numpy.testing import assert_allclose
 from numpy.testing import assert_equal

&lt;span class="gd"&gt;-from ..tile import HipsTile&lt;/span&gt;
&lt;span class="gd"&gt;-from ..tile_meta import HipsTileMeta&lt;/span&gt;
&lt;span class="gi"&gt;+from ..tile import HipsTile, HipsTileMeta&lt;/span&gt;


 class TestHipsTile:
&lt;span class="gu"&gt;@@ -46,7 +46,26 @@ class TestHipsTile:&lt;/span&gt;


 class TestHipsTileMeta:
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def setup_class(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='icrs', tile_width=512)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_path(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert str(self.meta.path) == 'hips/tiles/tests/data'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_filename(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.meta.filename == 'Npix450.fits'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_full_path(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert str(self.meta.full_path) == 'hips/tiles/tests/data/Npix450.fits'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_nside(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.meta.nside == 8&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_dst(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        dst = np.array([[511, 0], [511, 511], [0, 511], [0, 0]])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.meta.dst, dst)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
     def test_skycoord_corners(self):
&lt;span class="gd"&gt;-        meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='icrs', tile_width=512)&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_allclose(meta.skycoord_corners.ra.deg, [264.375, 258.75, 264.375, 270.])&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_allclose(meta.skycoord_corners.dec.deg, [-24.624318, -30., -35.685335, -30.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.meta.skycoord_corners.ra.deg, [264.375, 258.75, 264.375, 270.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.meta.skycoord_corners.dec.deg, [-24.624318, -30., -35.685335, -30.])&lt;/span&gt;

commit 2846fca6dd4eb6027b428920f8a81940c1e5a881
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 12:08:08 2017 +0500

    Merge HipsTile and HipsTileMeta within same file

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 76e2428..3ae0f4f 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,20 +1,105 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-from pathlib import Path&lt;/span&gt;
 import urllib.request
 from io import BytesIO
&lt;span class="gi"&gt;+from pathlib import Path&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+import healpy as hp&lt;/span&gt;
 import numpy as np
 from PIL import Image
&lt;span class="gi"&gt;+from astropy.coordinates import SkyCoord&lt;/span&gt;
 from astropy.io import fits
 from astropy.io.fits.header import Header
&lt;span class="gd"&gt;-from .tile_meta import HipsTileMeta&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from ..utils import boundaries&lt;/span&gt;

 __all__ = [
     'HipsTile',
&lt;span class="gi"&gt;+    'HipsTileMeta'&lt;/span&gt;
 ]

 __doctest_skip__ = ['HipsTile']


&lt;span class="gi"&gt;+class HipsTileMeta:&lt;/span&gt;
&lt;span class="gi"&gt;+    """HiPS tile metadata.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    order : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+        HEALPix order&lt;/span&gt;
&lt;span class="gi"&gt;+    ipix : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+        HEALPix pixel number&lt;/span&gt;
&lt;span class="gi"&gt;+    file_format : {'fits', 'jpg', 'png'}&lt;/span&gt;
&lt;span class="gi"&gt;+        File format&lt;/span&gt;
&lt;span class="gi"&gt;+    frame : {'icrs', 'galactic', 'ecliptic'}&lt;/span&gt;
&lt;span class="gi"&gt;+        Sky coordinate frame&lt;/span&gt;
&lt;span class="gi"&gt;+    tile_width : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+        Tile width (in pixels)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Examples&lt;/span&gt;
&lt;span class="gi"&gt;+    --------&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTileMeta&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; tile_meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='icrs', tile_width=512)&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; tile_meta.skycoord_corners&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;lt;SkyCoord (Galactic): (l, b) in deg&lt;/span&gt;
&lt;span class="gi"&gt;+    [( 264.375, -24.62431835), ( 258.75 , -30.        ),&lt;/span&gt;
&lt;span class="gi"&gt;+     ( 264.375, -35.68533471), ( 270.   , -30.        )]&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, order: int, ipix: int, file_format: str, frame: str = 'galactic', tile_width: int = 512) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.order = order&lt;/span&gt;
&lt;span class="gi"&gt;+        self.ipix = ipix&lt;/span&gt;
&lt;span class="gi"&gt;+        self.file_format = file_format&lt;/span&gt;
&lt;span class="gi"&gt;+        self.frame = frame&lt;/span&gt;
&lt;span class="gi"&gt;+        self.tile_width = tile_width&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __eq__(self, other: 'HipsTileMeta') -&amp;gt; bool:&lt;/span&gt;
&lt;span class="gi"&gt;+        return (&lt;/span&gt;
&lt;span class="gi"&gt;+            self.order == other.order and&lt;/span&gt;
&lt;span class="gi"&gt;+            self.ipix == other.ipix and&lt;/span&gt;
&lt;span class="gi"&gt;+            self.file_format == other.file_format and&lt;/span&gt;
&lt;span class="gi"&gt;+            self.tile_width == other.tile_width&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def path(self) -&amp;gt; Path:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Default path for tile storage (`~pathlib.Path`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return Path('hips', 'tiles', 'tests', 'data')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def filename(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Filename for HiPS tile (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return ''.join(['Npix', str(self.ipix), '.', self.file_format])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def full_path(self) -&amp;gt; Path:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Full path (folder and filename) (`~pathlib.Path`)"""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.path / self.filename&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def nside(self) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gi"&gt;+        """nside of the HEALPix map"""&lt;/span&gt;
&lt;span class="gi"&gt;+        return hp.order2nside(self.order)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def dst(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Destination array for projective transform"""&lt;/span&gt;
&lt;span class="gi"&gt;+        return np.array(&lt;/span&gt;
&lt;span class="gi"&gt;+            [[self.tile_width - 1, 0],&lt;/span&gt;
&lt;span class="gi"&gt;+             [self.tile_width - 1, self.tile_width - 1],&lt;/span&gt;
&lt;span class="gi"&gt;+             [0, self.tile_width - 1],&lt;/span&gt;
&lt;span class="gi"&gt;+             [0, 0]])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def skycoord_corners(self) -&amp;gt; SkyCoord:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Corner values for a HiPS tile"""&lt;/span&gt;
&lt;span class="gi"&gt;+        theta, phi = boundaries(self.nside, self.ipix)&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.frame == 'galactic':&lt;/span&gt;
&lt;span class="gi"&gt;+            return SkyCoord(l=phi, b=np.pi / 2 - theta, unit='radian', frame=self.frame)&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            return SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame=self.frame)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 class HipsTile:
     """HiPS tile container.

&lt;span class="gu"&gt;@@ -31,8 +116,7 @@ class HipsTile:&lt;/span&gt;

     Examples
     --------
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTile&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTileMeta&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTile, HipsTileMeta&lt;/span&gt;
     &amp;gt;&amp;gt;&amp;gt; meta = HipsTileMeta(order=6, ipix=30889, file_format='fits')
     &amp;gt;&amp;gt;&amp;gt; url = 'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.fits'
     &amp;gt;&amp;gt;&amp;gt; tile = HipsTile.fetch(meta, url)
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile_meta.py b/hips/tiles/tile_meta.py&lt;/span&gt;
deleted file mode 100644
&lt;span class="gh"&gt;index 29488bc..0000000&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ /dev/null&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,92 +0,0 @@&lt;/span&gt;
&lt;span class="gd"&gt;-# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gd"&gt;-from pathlib import Path&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-import healpy as hp&lt;/span&gt;
&lt;span class="gd"&gt;-import numpy as np&lt;/span&gt;
&lt;span class="gd"&gt;-from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-from ..utils import boundaries&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-__all__ = [&lt;/span&gt;
&lt;span class="gd"&gt;-    'HipsTileMeta',&lt;/span&gt;
&lt;span class="gd"&gt;-]&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-class HipsTileMeta:&lt;/span&gt;
&lt;span class="gd"&gt;-    """HiPS tile metadata.&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    Parameters&lt;/span&gt;
&lt;span class="gd"&gt;-    ----------&lt;/span&gt;
&lt;span class="gd"&gt;-    order : `int`&lt;/span&gt;
&lt;span class="gd"&gt;-        HEALPix order&lt;/span&gt;
&lt;span class="gd"&gt;-    ipix : `int`&lt;/span&gt;
&lt;span class="gd"&gt;-        HEALPix pixel number&lt;/span&gt;
&lt;span class="gd"&gt;-    file_format : {'fits', 'jpg', 'png'}&lt;/span&gt;
&lt;span class="gd"&gt;-        File format&lt;/span&gt;
&lt;span class="gd"&gt;-    frame : {'icrs', 'galactic', 'ecliptic'}&lt;/span&gt;
&lt;span class="gd"&gt;-        Sky coordinate frame&lt;/span&gt;
&lt;span class="gd"&gt;-    tile_width : `int`&lt;/span&gt;
&lt;span class="gd"&gt;-        Tile width (in pixels)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    Examples&lt;/span&gt;
&lt;span class="gd"&gt;-    --------&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTileMeta&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; tile_meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='galactic', tile_width=512)&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; tile_meta.skycoord_corners&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;lt;SkyCoord (Galactic): (l, b) in deg&lt;/span&gt;
&lt;span class="gd"&gt;-    [( 264.375, -24.62431835), ( 258.75 , -30.        ),&lt;/span&gt;
&lt;span class="gd"&gt;-     ( 264.375, -35.68533471), ( 270.   , -30.        )]&amp;gt;&lt;/span&gt;
&lt;span class="gd"&gt;-    """&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def __init__(self, order: int, ipix: int, file_format: str, frame: str = 'galactic', tile_width: int = 512) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        self.order = order&lt;/span&gt;
&lt;span class="gd"&gt;-        self.ipix = ipix&lt;/span&gt;
&lt;span class="gd"&gt;-        self.file_format = file_format&lt;/span&gt;
&lt;span class="gd"&gt;-        self.frame = frame&lt;/span&gt;
&lt;span class="gd"&gt;-        self.tile_width = tile_width&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def __eq__(self, other: 'HipsTileMeta') -&amp;gt; bool:&lt;/span&gt;
&lt;span class="gd"&gt;-        return (&lt;/span&gt;
&lt;span class="gd"&gt;-            self.order == other.order and&lt;/span&gt;
&lt;span class="gd"&gt;-            self.ipix == other.ipix and&lt;/span&gt;
&lt;span class="gd"&gt;-            self.file_format == other.file_format and&lt;/span&gt;
&lt;span class="gd"&gt;-            self.tile_width == other.tile_width&lt;/span&gt;
&lt;span class="gd"&gt;-        )&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def path(self) -&amp;gt; Path:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Default path for tile storage (`~pathlib.Path`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return Path('hips', 'tiles', 'tests', 'data')&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def filename(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Filename for HiPS tile (`str`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return ''.join(['Npix', str(self.ipix), '.', self.file_format])&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def full_path(self) -&amp;gt; Path:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Full path (folder and filename) (`~pathlib.Path`)"""&lt;/span&gt;
&lt;span class="gd"&gt;-        return self.path / self.filename&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def nside(self) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gd"&gt;-        """nside of the HEALPix map"""&lt;/span&gt;
&lt;span class="gd"&gt;-        return hp.order2nside(self.order)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def dst(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Destination array for projective transform"""&lt;/span&gt;
&lt;span class="gd"&gt;-        return np.array(&lt;/span&gt;
&lt;span class="gd"&gt;-            [[self.tile_width - 1, 0],&lt;/span&gt;
&lt;span class="gd"&gt;-             [self.tile_width - 1, self.tile_width - 1],&lt;/span&gt;
&lt;span class="gd"&gt;-             [0, self.tile_width - 1],&lt;/span&gt;
&lt;span class="gd"&gt;-             [0, 0]])&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def skycoord_corners(self) -&amp;gt; SkyCoord:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Corner values for a HiPS tile"""&lt;/span&gt;
&lt;span class="gd"&gt;-        theta, phi = boundaries(self.nside, self.ipix)&lt;/span&gt;
&lt;span class="gd"&gt;-        if self.frame == 'galactic':&lt;/span&gt;
&lt;span class="gd"&gt;-            return SkyCoord(l=phi, b=np.pi / 2 - theta, unit='radian', frame=self.frame)&lt;/span&gt;
&lt;span class="gd"&gt;-        else:&lt;/span&gt;
&lt;span class="gd"&gt;-            return SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame=self.frame)&lt;/span&gt;

commit 309a75a2c1b468dcd7e5969d2bd01f60f6a9005e
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 11:57:09 2017 +0500

    Pass fits_header to fits.PrimaryHDU function

&lt;span class="gh"&gt;diff --git a/docs/getting_started.rst b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gh"&gt;index 7018ccf..81c48db 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -24,5 +24,5 @@ Then it saves it on local disk in FITS file format.&lt;/span&gt;
 &amp;gt;&amp;gt;&amp;gt; url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'
 &amp;gt;&amp;gt;&amp;gt; hips_survey = HipsSurveyProperties.fetch(url)  # doctest: +REMOTE_DATA
 &amp;gt;&amp;gt;&amp;gt; data = make_sky_image(geometry, hips_survey)
&lt;span class="gd"&gt;-&amp;gt;&amp;gt;&amp;gt; hdu = fits.PrimaryHDU(data=data)&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; hdu = fits.PrimaryHDU(data=data, header=geometry.fits_header)&lt;/span&gt;
 &amp;gt;&amp;gt;&amp;gt; hdu.writeto('my_image.fits')
\ No newline at end of file

commit a0759cbe24b41ac50a86165db4438d474385291f
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 11:11:23 2017 +0500

    Remove test case for SimpleTilePainter class

&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index e99338f..80818f9 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -4,7 +4,7 @@ import pytest&lt;/span&gt;
 from astropy.utils.data import get_pkg_data_filename
 from numpy.testing import assert_allclose

&lt;span class="gd"&gt;-from ..simple import make_sky_image, draw_sky_image, SimpleTilePainter&lt;/span&gt;
&lt;span class="gi"&gt;+from ..simple import make_sky_image, draw_sky_image&lt;/span&gt;
 from ...tiles import HipsSurveyProperties, HipsTileMeta, HipsTile
 from ...utils.testing import get_hips_extra_file, make_test_wcs_geometry, requires_hips_extra

&lt;span class="gu"&gt;@@ -31,7 +31,6 @@ def get_test_tiles():&lt;/span&gt;
 def test_draw_sky_image():
     geometry = make_test_wcs_geometry(case=2)
     tiles = get_test_tiles()
&lt;span class="gd"&gt;-&lt;/span&gt;
     data = draw_sky_image(geometry, tiles)

     assert data.shape == geometry.shape
&lt;span class="gu"&gt;@@ -51,21 +50,3 @@ def test_make_sky_image():&lt;/span&gt;
     assert data.dtype == np.float64
     assert_allclose(data[200, 994], 3717.10091363)
     assert_allclose(data[200, 995], 3402.55292158)
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-class TestSimpleTilePainter:&lt;/span&gt;
&lt;span class="gd"&gt;-    @classmethod&lt;/span&gt;
&lt;span class="gd"&gt;-    def setup_class(cls):&lt;/span&gt;
&lt;span class="gd"&gt;-        geometry = make_test_wcs_geometry(case=2)&lt;/span&gt;
&lt;span class="gd"&gt;-        tile = HipsTile.read(&lt;/span&gt;
&lt;span class="gd"&gt;-            meta=HipsTileMeta(order=3, ipix=450, file_format='fits', frame='icrs', tile_width=512),&lt;/span&gt;
&lt;span class="gd"&gt;-            filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix450.fits'),&lt;/span&gt;
&lt;span class="gd"&gt;-        )&lt;/span&gt;
&lt;span class="gd"&gt;-        cls.simple_tile_painter = SimpleTilePainter(geometry, tile)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    # def test_warp_image(self):&lt;/span&gt;
&lt;span class="gd"&gt;-    #     self.simple_tile_painter.warp_image()&lt;/span&gt;
&lt;span class="gd"&gt;-    #     assert_allclose(self.simple_tile_painter.tile.meta.skycoord_corners.ra.deg,&lt;/span&gt;
&lt;span class="gd"&gt;-    #                     [264.375, 258.75, 264.375, 270.])&lt;/span&gt;
&lt;span class="gd"&gt;-    #     assert_allclose(self.simple_tile_painter.tile.meta.skycoord_corners.dec.deg,&lt;/span&gt;
&lt;span class="gd"&gt;-    #                     [-24.624318, -30., -35.685335, -30.])&lt;/span&gt;

commit 4571dd88dbd34a408ed934cb47cddfa752642119
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 11:11:00 2017 +0500

    Add comment on data type conversion

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index f188755..4808c6d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -67,7 +67,9 @@ class SimpleTilePainter:&lt;/span&gt;

     def warp_image(self) -&amp;gt; np.ndarray:
         """Warp a HiPS tile and a sky image"""
&lt;span class="gd"&gt;-        return tf.warp(self.tile.data.astype('float'), self.pt, output_shape=self.geometry.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        # This converts a big-endian byte integer to a float&lt;/span&gt;
&lt;span class="gi"&gt;+        data = self.tile.data.astype('float')&lt;/span&gt;
&lt;span class="gi"&gt;+        return tf.warp(data, self.pt, output_shape=self.geometry.shape)&lt;/span&gt;


 def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: HipsSurveyProperties) -&amp;gt; 'HipsTile':

commit 9e073c9370924fb0651db0c97631e53635b17abd
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 11:01:02 2017 +0500

    Remove docstring

&lt;span class="gh"&gt;diff --git a/hips/utils/testing.py b/hips/utils/testing.py&lt;/span&gt;
&lt;span class="gh"&gt;index ce8556c..d9d6d69 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/testing.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/testing.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -32,7 +32,6 @@ def requires_hips_extra():&lt;/span&gt;


 def make_test_wcs_geometry(case=0):
&lt;span class="gd"&gt;-    """An example Galactic CAR WCS that """&lt;/span&gt;
     if case == 0:
         return WCSGeometry.create(
             skydir=SkyCoord(3, 4, unit='deg', frame='galactic'),

commit 9f2e5fac6222fdaa6ddde8a1d6d973fe782968d6
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 11:00:12 2017 +0500

    Add test case for HipsTileMeta

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 1514ea6..cc0e65a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,6 +1,8 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-from numpy.testing import assert_equal&lt;/span&gt;
 from astropy.tests.helper import remote_data
&lt;span class="gi"&gt;+from numpy.testing import assert_allclose&lt;/span&gt;
&lt;span class="gi"&gt;+from numpy.testing import assert_equal&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 from ..tile import HipsTile
 from ..tile_meta import HipsTileMeta

&lt;span class="gu"&gt;@@ -41,3 +43,10 @@ class TestHipsTile:&lt;/span&gt;
         # print(tile2.data.sum())
         # print((tile == tile2).all())
         # assert tile == tile2
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class TestHipsTileMeta:&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_skycoord_corners(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='icrs', tile_width=512)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(meta.skycoord_corners.ra.deg, [264.375, 258.75, 264.375, 270.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(meta.skycoord_corners.dec.deg, [-24.624318, -30., -35.685335, -30.])&lt;/span&gt;

commit 69ae7642417b6b76796a448b9b9a3f4b387a9021
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 10:54:44 2017 +0500

    Add function apply_projection in SimpleTilePainter

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 0f8b418..f188755 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -2,7 +2,6 @@&lt;/span&gt;
 """HiPS tile drawing -- simple method."""

 import numpy as np
&lt;span class="gd"&gt;-from astropy.coordinates import SkyCoord&lt;/span&gt;
 from skimage import transform as tf
 from typing import List, Generator, Any

&lt;span class="gu"&gt;@@ -31,9 +30,11 @@ def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any])&lt;/span&gt;
     np.ndarray
         Returns a numpy array containing all HiPS tiles projected onto it
     """
&lt;span class="gi"&gt;+    # TODO: Fix type annotation issue&lt;/span&gt;
     all_sky = np.zeros(geometry.shape)
     for tile in tiles:
         draw_tile = SimpleTilePainter(geometry, tile)
&lt;span class="gi"&gt;+        draw_tile.apply_projection()&lt;/span&gt;
         all_sky += draw_tile.warp_image()
     return all_sky

&lt;span class="gu"&gt;@@ -54,11 +55,19 @@ class SimpleTilePainter:&lt;/span&gt;
     def __init__(self, geometry: WCSGeometry, tile: HipsTile) -&amp;gt; None:
         self.geometry = geometry
         self.tile = tile
&lt;span class="gi"&gt;+        self.pt = None&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def apply_projection(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Apply projective transformation on a HiPS tile"""&lt;/span&gt;
&lt;span class="gi"&gt;+        corners = self.tile.meta.skycoord_corners.to_pixel(self.geometry.wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+        src = np.array(corners).T.reshape((4, 2))&lt;/span&gt;
&lt;span class="gi"&gt;+        dst = self.tile.meta.dst&lt;/span&gt;
&lt;span class="gi"&gt;+        self.pt = tf.ProjectiveTransform()&lt;/span&gt;
&lt;span class="gi"&gt;+        self.pt.estimate(src, dst)&lt;/span&gt;

     def warp_image(self) -&amp;gt; np.ndarray:
         """Warp a HiPS tile and a sky image"""
&lt;span class="gd"&gt;-        pt = self.tile.meta.apply_projection(self.geometry.wcs)&lt;/span&gt;
&lt;span class="gd"&gt;-        return tf.warp(self.tile.data.astype('float'), pt, output_shape=self.geometry.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        return tf.warp(self.tile.data.astype('float'), self.pt, output_shape=self.geometry.shape)&lt;/span&gt;


 def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: HipsSurveyProperties) -&amp;gt; 'HipsTile':
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index acec27f..e99338f 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -63,9 +63,9 @@ class TestSimpleTilePainter:&lt;/span&gt;
         )
         cls.simple_tile_painter = SimpleTilePainter(geometry, tile)

&lt;span class="gd"&gt;-    def test_warp_image(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        self.simple_tile_painter.warp_image()&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_allclose(self.simple_tile_painter.tile.meta.skycoord_corners.ra.deg,&lt;/span&gt;
&lt;span class="gd"&gt;-                        [264.375, 258.75, 264.375, 270.])&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_allclose(self.simple_tile_painter.tile.meta.skycoord_corners.dec.deg,&lt;/span&gt;
&lt;span class="gd"&gt;-                        [-24.624318, -30., -35.685335, -30.])&lt;/span&gt;
&lt;span class="gi"&gt;+    # def test_warp_image(self):&lt;/span&gt;
&lt;span class="gi"&gt;+    #     self.simple_tile_painter.warp_image()&lt;/span&gt;
&lt;span class="gi"&gt;+    #     assert_allclose(self.simple_tile_painter.tile.meta.skycoord_corners.ra.deg,&lt;/span&gt;
&lt;span class="gi"&gt;+    #                     [264.375, 258.75, 264.375, 270.])&lt;/span&gt;
&lt;span class="gi"&gt;+    #     assert_allclose(self.simple_tile_painter.tile.meta.skycoord_corners.dec.deg,&lt;/span&gt;
&lt;span class="gi"&gt;+    #                     [-24.624318, -30., -35.685335, -30.])&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 234fb5d..76e2428 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -95,7 +95,6 @@ class HipsTile:&lt;/span&gt;

         if meta.file_format == 'fits':
             hdu_list = fits.open(str(path))
&lt;span class="gd"&gt;-            # This converts a big-endian byte integer to a float&lt;/span&gt;
             data = hdu_list[0].data
             header = hdu_list[0].header
             return cls(meta, data, header)

commit c7d5db5d8c54bb91fd3e91fd24d3991215bcdc1a
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 10:53:45 2017 +0500

    Remove function apply_projection from HipsTileMeta

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile_meta.py b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gh"&gt;index 826e56b..29488bc 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -4,8 +4,6 @@ from pathlib import Path&lt;/span&gt;
 import healpy as hp
 import numpy as np
 from astropy.coordinates import SkyCoord
&lt;span class="gd"&gt;-from astropy.wcs import WCS&lt;/span&gt;
&lt;span class="gd"&gt;-from skimage import transform as tf&lt;/span&gt;

 from ..utils import boundaries

&lt;span class="gu"&gt;@@ -92,12 +90,3 @@ class HipsTileMeta:&lt;/span&gt;
             return SkyCoord(l=phi, b=np.pi / 2 - theta, unit='radian', frame=self.frame)
         else:
             return SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame=self.frame)
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def apply_projection(self, wcs: WCS) -&amp;gt; tf.ProjectiveTransform:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Apply projective transformation on a HiPS tile"""&lt;/span&gt;
&lt;span class="gd"&gt;-        corners = self.skycoord_corners.to_pixel(wcs)&lt;/span&gt;
&lt;span class="gd"&gt;-        src = np.array(corners).T.reshape((4, 2))&lt;/span&gt;
&lt;span class="gd"&gt;-        dst = self.dst&lt;/span&gt;
&lt;span class="gd"&gt;-        pt = tf.ProjectiveTransform()&lt;/span&gt;
&lt;span class="gd"&gt;-        pt.estimate(src, dst)&lt;/span&gt;
&lt;span class="gd"&gt;-        return pt&lt;/span&gt;

commit bee4bcd0542657c74b040947ec20a6d9ab41edc3
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 10:46:03 2017 +0500

    Document frame parameter in HipsTileMeta

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile_meta.py b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gh"&gt;index 67759fb..826e56b 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -25,6 +25,8 @@ class HipsTileMeta:&lt;/span&gt;
         HEALPix pixel number
     file_format : {'fits', 'jpg', 'png'}
         File format
&lt;span class="gi"&gt;+    frame : {'icrs', 'galactic', 'ecliptic'}&lt;/span&gt;
&lt;span class="gi"&gt;+        Sky coordinate frame&lt;/span&gt;
     tile_width : `int`
         Tile width (in pixels)

&lt;span class="gu"&gt;@@ -38,7 +40,7 @@ class HipsTileMeta:&lt;/span&gt;
      ( 264.375, -35.68533471), ( 270.   , -30.        )]&amp;gt;
     """

&lt;span class="gd"&gt;-    def __init__(self, order: int, ipix: int, file_format: str, frame='galactic', tile_width: int = 512) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, order: int, ipix: int, file_format: str, frame: str = 'galactic', tile_width: int = 512) -&amp;gt; None:&lt;/span&gt;
         self.order = order
         self.ipix = ipix
         self.file_format = file_format

commit 9c5e687cf2948241dd13cedfe0ec79aba0389f38
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 10:43:07 2017 +0500

    Add missing import

&lt;span class="gh"&gt;diff --git a/docs/getting_started.rst b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gh"&gt;index ad0bdaa..7018ccf 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -11,6 +11,7 @@ It fetches a HiPS tile from a remote URL and draws it on a sky image.&lt;/span&gt;
 Then it saves it on local disk in FITS file format.

 &amp;gt;&amp;gt;&amp;gt; from astropy.io import fits
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; from astropy.coordinates import SkyCoord&lt;/span&gt;
 &amp;gt;&amp;gt;&amp;gt; from astropy.tests.helper import remote_data
 &amp;gt;&amp;gt;&amp;gt; from hips.utils import WCSGeometry
 &amp;gt;&amp;gt;&amp;gt; from hips.draw import make_sky_image

commit 9c82bc4c642c9417659ade65653490a39294b797
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 30 10:42:52 2017 +0500

    Use assert_allclose instead of assert

&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index de1b950..acec27f 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -36,9 +36,9 @@ def test_draw_sky_image():&lt;/span&gt;

     assert data.shape == geometry.shape
     assert data.dtype == np.float64
&lt;span class="gd"&gt;-    assert np.sum(data) == 4575235421.5126467&lt;/span&gt;
&lt;span class="gd"&gt;-    assert data[400, 500] == 2866.0101409848185&lt;/span&gt;
&lt;span class="gd"&gt;-    assert data[400, 501] == 2563.6916727348043&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(np.sum(data), 4575235421.5126467)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(data[400, 500], 2866.0101409848185)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(data[400, 501], 2563.6916727348043)&lt;/span&gt;


 @pytest.mark.xfail
&lt;span class="gu"&gt;@@ -49,8 +49,8 @@ def test_make_sky_image():&lt;/span&gt;
     data = make_sky_image(geometry, hips_survey)
     assert data.shape == geometry.shape
     assert data.dtype == np.float64
&lt;span class="gd"&gt;-    assert data[200, 994] == 3717.10091363&lt;/span&gt;
&lt;span class="gd"&gt;-    assert data[200, 995] == 3402.55292158&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(data[200, 994], 3717.10091363)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(data[200, 995], 3402.55292158)&lt;/span&gt;


 class TestSimpleTilePainter:

commit 8adff08b687c280f302df01bd8d1306a5e0a4008
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 29 23:41:41 2017 +0500

    Update drawing code

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index c6652d6..0f8b418 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -34,8 +34,6 @@ def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any])&lt;/span&gt;
     all_sky = np.zeros(geometry.shape)
     for tile in tiles:
         draw_tile = SimpleTilePainter(geometry, tile)
&lt;span class="gd"&gt;-        draw_tile.compute_corners()&lt;/span&gt;
&lt;span class="gd"&gt;-        draw_tile.compute_projection()&lt;/span&gt;
         all_sky += draw_tile.warp_image()
     return all_sky

&lt;span class="gu"&gt;@@ -56,20 +54,11 @@ class SimpleTilePainter:&lt;/span&gt;
     def __init__(self, geometry: WCSGeometry, tile: HipsTile) -&amp;gt; None:
         self.geometry = geometry
         self.tile = tile
&lt;span class="gd"&gt;-        self.corners = None&lt;/span&gt;
&lt;span class="gd"&gt;-        self.pt = None&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def compute_corners(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        self.corners = self.tile.meta.skycoord_corners.to_pixel(self.geometry.wcs)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def compute_projection(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        src = np.array(self.corners).T.reshape((4, 2))&lt;/span&gt;
&lt;span class="gd"&gt;-        dst = self.tile.meta.dst&lt;/span&gt;
&lt;span class="gd"&gt;-        self.pt = tf.ProjectiveTransform()&lt;/span&gt;
&lt;span class="gd"&gt;-        self.pt.estimate(src, dst)&lt;/span&gt;

     def warp_image(self) -&amp;gt; np.ndarray:
&lt;span class="gd"&gt;-        return tf.warp(self.tile.data.astype('float'), self.pt, output_shape=self.geometry.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        """Warp a HiPS tile and a sky image"""&lt;/span&gt;
&lt;span class="gi"&gt;+        pt = self.tile.meta.apply_projection(self.geometry.wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+        return tf.warp(self.tile.data.astype('float'), pt, output_shape=self.geometry.shape)&lt;/span&gt;


 def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: HipsSurveyProperties) -&amp;gt; 'HipsTile':
&lt;span class="gu"&gt;@@ -89,7 +78,7 @@ def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: Hip&lt;/span&gt;
     'HipsTile'
         Returns an object of  HipsTile
     """
&lt;span class="gd"&gt;-    base_url = hips_survey.data['moc_access_url'].rsplit('/', 1)[0] + '/Norder' + str(hips_survey.hips_order) + '/Dir0/'&lt;/span&gt;
&lt;span class="gi"&gt;+    base_url = hips_survey.access_url + '/Norder' + str(hips_survey.hips_order) + '/Dir0/'&lt;/span&gt;
     for healpix_pixel_index in healpix_pixel_indices:
         tile_meta = HipsTileMeta(order=order, ipix=healpix_pixel_index, file_format='fits')
         tile = HipsTile.fetch(tile_meta, base_url + tile_meta.filename)
&lt;span class="gu"&gt;@@ -99,6 +88,8 @@ def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: Hip&lt;/span&gt;
 def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt; np.ndarray:
     """Make sky image: fetch tiles and draw.

&lt;span class="gi"&gt;+    The example for this can be found on the :ref:`gs` page.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
     Parameters
     ----------
     geometry : `~hips.utils.WCSGeometry`
&lt;span class="gu"&gt;@@ -110,23 +101,6 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt;&lt;/span&gt;
     -------
     data : `~numpy.ndarray`
         Output image pixels
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    Examples&lt;/span&gt;
&lt;span class="gd"&gt;-    --------&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; from astropy.io import fits&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; from hips.utils import WCSGeometry&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; from hips.draw import make_sky_image&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; geometry = WCSGeometry.create(&lt;/span&gt;
&lt;span class="gd"&gt;-    ...     skydir=SkyCoord(0, 0, unit='deg', frame='galactic'),&lt;/span&gt;
&lt;span class="gd"&gt;-    ...     shape=(1000, 2000), coordsys='GAL',&lt;/span&gt;
&lt;span class="gd"&gt;-    ...     projection='AIT', cdelt=0.01, crpix=(1000, 500),&lt;/span&gt;
&lt;span class="gd"&gt;-    ... )&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; data = make_sky_image(geometry, hips_survey)&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; hdu = fits.PrimaryHDU(data=data)&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; hdu.writeto('my_image.fits')&lt;/span&gt;
     """
     healpix_pixel_indices = compute_healpix_pixel_indices(geometry, hips_survey.hips_order)
     # TODO: this isn't a good API. Will become better when we have a cache.
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 827b283..de1b950 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,6 +1,6 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-import pytest&lt;/span&gt;
 import numpy as np
&lt;span class="gi"&gt;+import pytest&lt;/span&gt;
 from astropy.utils.data import get_pkg_data_filename
 from numpy.testing import assert_allclose

&lt;span class="gu"&gt;@@ -63,7 +63,9 @@ class TestSimpleTilePainter:&lt;/span&gt;
         )
         cls.simple_tile_painter = SimpleTilePainter(geometry, tile)

&lt;span class="gd"&gt;-    def test_compute_corners(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        self.simple_tile_painter.compute_corners()&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_allclose(self.simple_tile_painter.corners[0], [728.54880122, 1453.32078085, 1662.33429379, 931.69072155])&lt;/span&gt;
&lt;span class="gd"&gt;-        assert_allclose(self.simple_tile_painter.corners[1], [880.33972146, 997.1604671, 288.00518917, 175.4190427])&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_warp_image(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        self.simple_tile_painter.warp_image()&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.simple_tile_painter.tile.meta.skycoord_corners.ra.deg,&lt;/span&gt;
&lt;span class="gi"&gt;+                        [264.375, 258.75, 264.375, 270.])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.simple_tile_painter.tile.meta.skycoord_corners.dec.deg,&lt;/span&gt;
&lt;span class="gi"&gt;+                        [-24.624318, -30., -35.685335, -30.])&lt;/span&gt;

commit 1f67310f98e5b873d6309928f428c66245ce3ba9
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 29 23:41:21 2017 +0500

    Add function apply_projection in HipsTileMeta

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile_meta.py b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gh"&gt;index 6f2862d..67759fb 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -4,6 +4,8 @@ from pathlib import Path&lt;/span&gt;
 import healpy as hp
 import numpy as np
 from astropy.coordinates import SkyCoord
&lt;span class="gi"&gt;+from astropy.wcs import WCS&lt;/span&gt;
&lt;span class="gi"&gt;+from skimage import transform as tf&lt;/span&gt;

 from ..utils import boundaries

&lt;span class="gu"&gt;@@ -53,12 +55,12 @@ class HipsTileMeta:&lt;/span&gt;

     @property
     def path(self) -&amp;gt; Path:
&lt;span class="gd"&gt;-        """Return the default path for tile storage (`~pathlib.Path`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        """Default path for tile storage (`~pathlib.Path`)."""&lt;/span&gt;
         return Path('hips', 'tiles', 'tests', 'data')

     @property
     def filename(self) -&amp;gt; str:
&lt;span class="gd"&gt;-        """Return the filename of HiPS tile (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        """Filename for HiPS tile (`str`)."""&lt;/span&gt;
         return ''.join(['Npix', str(self.ipix), '.', self.file_format])

     @property
&lt;span class="gu"&gt;@@ -67,13 +69,13 @@ class HipsTileMeta:&lt;/span&gt;
         return self.path / self.filename

     @property
&lt;span class="gd"&gt;-    def nside(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        """Return the nside of the HEALPix map"""&lt;/span&gt;
&lt;span class="gi"&gt;+    def nside(self) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gi"&gt;+        """nside of the HEALPix map"""&lt;/span&gt;
         return hp.order2nside(self.order)

     @property
&lt;span class="gd"&gt;-    def dst(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        """Return destination array for projective transform"""&lt;/span&gt;
&lt;span class="gi"&gt;+    def dst(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Destination array for projective transform"""&lt;/span&gt;
         return np.array(
             [[self.tile_width - 1, 0],
              [self.tile_width - 1, self.tile_width - 1],
&lt;span class="gu"&gt;@@ -81,10 +83,19 @@ class HipsTileMeta:&lt;/span&gt;
              [0, 0]])

     @property
&lt;span class="gd"&gt;-    def skycoord_corners(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        """Return corner values for a HiPS tile"""&lt;/span&gt;
&lt;span class="gi"&gt;+    def skycoord_corners(self) -&amp;gt; SkyCoord:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Corner values for a HiPS tile"""&lt;/span&gt;
         theta, phi = boundaries(self.nside, self.ipix)
         if self.frame == 'galactic':
             return SkyCoord(l=phi, b=np.pi / 2 - theta, unit='radian', frame=self.frame)
         else:
             return SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame=self.frame)
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def apply_projection(self, wcs: WCS) -&amp;gt; tf.ProjectiveTransform:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Apply projective transformation on a HiPS tile"""&lt;/span&gt;
&lt;span class="gi"&gt;+        corners = self.skycoord_corners.to_pixel(wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+        src = np.array(corners).T.reshape((4, 2))&lt;/span&gt;
&lt;span class="gi"&gt;+        dst = self.dst&lt;/span&gt;
&lt;span class="gi"&gt;+        pt = tf.ProjectiveTransform()&lt;/span&gt;
&lt;span class="gi"&gt;+        pt.estimate(src, dst)&lt;/span&gt;
&lt;span class="gi"&gt;+        return pt&lt;/span&gt;

commit 05b8ac8e97467576883da6c2dbd2be786ead4e73
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 29 23:40:31 2017 +0500

    Add test case for access_url property

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_description.py b/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gh"&gt;index b36aa02..d0e87dc 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -26,3 +26,6 @@ class TestHipsSurveyProperties:&lt;/span&gt;

     def test_tile_format(self):
         assert self.hips_survey_property.tile_format == 'jpeg'
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_access_url(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_property.access_url == 'http://alasky.u-strasbg.fr/DSS/DSSColor'&lt;/span&gt;

commit f7625a909254992cb4bbd0fc4ba7237bead65e8a
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 29 23:39:59 2017 +0500

    Add property access_url in HipsSurveyProperties

&lt;span class="gh"&gt;diff --git a/hips/tiles/description.py b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gh"&gt;index 21d2eb3..15d5a9a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -108,3 +108,8 @@ class HipsSurveyProperties:&lt;/span&gt;
     def tile_format(self) -&amp;gt; str:
         """HiPS tile format (`str`)."""
         return self.data['hips_tile_format']
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def access_url(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        """HiPS access url"""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.data['moc_access_url'].rsplit('/', 1)[0]&lt;/span&gt;

commit a32ba1b946c22c81d41bc8291206d90134d123d2
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 29 23:39:14 2017 +0500

    Add example in Getting Started page

&lt;span class="gh"&gt;diff --git a/docs/getting_started.rst b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gh"&gt;index e586127..ad0bdaa 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/getting_started.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -6,4 +6,22 @@&lt;/span&gt;
 Getting started
 ***************

&lt;span class="gd"&gt;-Coming soon ...&lt;/span&gt;
&lt;span class="gi"&gt;+The example below shows a high level use case of the ``hips`` package.&lt;/span&gt;
&lt;span class="gi"&gt;+It fetches a HiPS tile from a remote URL and draws it on a sky image.&lt;/span&gt;
&lt;span class="gi"&gt;+Then it saves it on local disk in FITS file format.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; from astropy.io import fits&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; from astropy.tests.helper import remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; from hips.utils import WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; from hips.draw import make_sky_image&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; geometry = WCSGeometry.create(&lt;/span&gt;
&lt;span class="gi"&gt;+...     skydir=SkyCoord(0, 0, unit='deg', frame='galactic'),&lt;/span&gt;
&lt;span class="gi"&gt;+...     shape=(1000, 2000), coordsys='GAL',&lt;/span&gt;
&lt;span class="gi"&gt;+...     projection='AIT', cdelt=0.01, crpix=(1000, 500),&lt;/span&gt;
&lt;span class="gi"&gt;+... )&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; hips_survey = HipsSurveyProperties.fetch(url)  # doctest: +REMOTE_DATA&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; data = make_sky_image(geometry, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; hdu = fits.PrimaryHDU(data=data)&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;gt;&amp;gt;&amp;gt; hdu.writeto('my_image.fits')&lt;/span&gt;
\ No newline at end of file

commit 42ceb7af3d271bf60cd82f6b49136d1fe4bb3920
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 29 20:35:59 2017 +0500

    Get HiPS order from HipsSurveyProperties class

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 006867d..c6652d6 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -89,7 +89,7 @@ def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: Hip&lt;/span&gt;
     'HipsTile'
         Returns an object of  HipsTile
     """
&lt;span class="gd"&gt;-    base_url = hips_survey.data['moc_access_url'].rsplit('/', 1)[0] + '/Norder3/Dir0/'&lt;/span&gt;
&lt;span class="gi"&gt;+    base_url = hips_survey.data['moc_access_url'].rsplit('/', 1)[0] + '/Norder' + str(hips_survey.hips_order) + '/Dir0/'&lt;/span&gt;
     for healpix_pixel_index in healpix_pixel_indices:
         tile_meta = HipsTileMeta(order=order, ipix=healpix_pixel_index, file_format='fits')
         tile = HipsTile.fetch(tile_meta, base_url + tile_meta.filename)

commit e487e44c68b8b4a8da44fc9fb82d932767abc471
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 29 20:33:32 2017 +0500

    Update drawing code

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index c106c8c..006867d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,15 +1,13 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 """HiPS tile drawing -- simple method."""
&lt;span class="gd"&gt;-import os&lt;/span&gt;
&lt;span class="gd"&gt;-from pathlib import Path&lt;/span&gt;

 import numpy as np
 from astropy.coordinates import SkyCoord
 from skimage import transform as tf
&lt;span class="gd"&gt;-from typing import List&lt;/span&gt;
&lt;span class="gi"&gt;+from typing import List, Generator, Any&lt;/span&gt;

 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta
&lt;span class="gd"&gt;-from ..utils import WCSGeometry, compute_healpix_pixel_indices, boundaries&lt;/span&gt;
&lt;span class="gi"&gt;+from ..utils import WCSGeometry, compute_healpix_pixel_indices&lt;/span&gt;

 __all__ = [
     'draw_sky_image',
&lt;span class="gu"&gt;@@ -18,7 +16,7 @@ __all__ = [&lt;/span&gt;
 ]


&lt;span class="gd"&gt;-def draw_sky_image(geometry: WCSGeometry, tiles: List[HipsTile]) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+def draw_sky_image(geometry: WCSGeometry, tiles: Generator[HipsTile, Any, Any]) -&amp;gt; np.ndarray:&lt;/span&gt;
     """Draw sky image using the simple and quick method.

     Parameters
&lt;span class="gu"&gt;@@ -35,7 +33,7 @@ def draw_sky_image(geometry: WCSGeometry, tiles: List[HipsTile]) -&amp;gt; np.ndarray:&lt;/span&gt;
     """
     all_sky = np.zeros(geometry.shape)
     for tile in tiles:
&lt;span class="gd"&gt;-        draw_tile = SimpleTilePainter(geometry, tile, all_sky.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        draw_tile = SimpleTilePainter(geometry, tile)&lt;/span&gt;
         draw_tile.compute_corners()
         draw_tile.compute_projection()
         all_sky += draw_tile.warp_image()
&lt;span class="gu"&gt;@@ -43,7 +41,9 @@ def draw_sky_image(geometry: WCSGeometry, tiles: List[HipsTile]) -&amp;gt; np.ndarray:&lt;/span&gt;


 class SimpleTilePainter:
&lt;span class="gd"&gt;-    """A class which iteratively draws a tile following the naive algorithm steps mentioned `here &amp;lt;https://hips.readthedocs.io/en/latest/drawing_algo.html#naive-algorithm&amp;gt;`_.&lt;/span&gt;
&lt;span class="gi"&gt;+    """Paint a single tile using a simple projective transformation method.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    The algorithm implemented is described here: :ref:`drawing_algo`.&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gu"&gt;@@ -51,21 +51,16 @@ class SimpleTilePainter:&lt;/span&gt;
         An object of WCSGeometry
     tile : `HipsTile`
        An object of HipsTile
&lt;span class="gd"&gt;-    shape : tuple&lt;/span&gt;
&lt;span class="gd"&gt;-        Shape of the all-sky image&lt;/span&gt;
     """

&lt;span class="gd"&gt;-    def __init__(self, geometry: WCSGeometry, tile: HipsTile, shape: tuple) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, geometry: WCSGeometry, tile: HipsTile) -&amp;gt; None:&lt;/span&gt;
         self.geometry = geometry
         self.tile = tile
&lt;span class="gd"&gt;-        self.shape = shape&lt;/span&gt;
         self.corners = None
         self.pt = None

&lt;span class="gd"&gt;-    def compute_corners(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        theta, phi = boundaries(self.tile.meta.nside, self.tile.meta.ipix)&lt;/span&gt;
&lt;span class="gd"&gt;-        radec = SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame='icrs')&lt;/span&gt;
&lt;span class="gd"&gt;-        self.corners = radec.to_pixel(self.geometry.wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+    def compute_corners(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        self.corners = self.tile.meta.skycoord_corners.to_pixel(self.geometry.wcs)&lt;/span&gt;

     def compute_projection(self) -&amp;gt; None:
         src = np.array(self.corners).T.reshape((4, 2))
&lt;span class="gu"&gt;@@ -74,7 +69,7 @@ class SimpleTilePainter:&lt;/span&gt;
         self.pt.estimate(src, dst)

     def warp_image(self) -&amp;gt; np.ndarray:
&lt;span class="gd"&gt;-        return tf.warp(self.tile.data, self.pt, output_shape=self.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        return tf.warp(self.tile.data.astype('float'), self.pt, output_shape=self.geometry.shape)&lt;/span&gt;


 def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: HipsSurveyProperties) -&amp;gt; 'HipsTile':
&lt;span class="gu"&gt;@@ -94,9 +89,10 @@ def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: Hip&lt;/span&gt;
     'HipsTile'
         Returns an object of  HipsTile
     """
&lt;span class="gi"&gt;+    base_url = hips_survey.data['moc_access_url'].rsplit('/', 1)[0] + '/Norder3/Dir0/'&lt;/span&gt;
     for healpix_pixel_index in healpix_pixel_indices:
         tile_meta = HipsTileMeta(order=order, ipix=healpix_pixel_index, file_format='fits')
&lt;span class="gd"&gt;-        tile = HipsTile.fetch(tile_meta, hips_survey.base_url)&lt;/span&gt;
&lt;span class="gi"&gt;+        tile = HipsTile.fetch(tile_meta, base_url + tile_meta.filename)&lt;/span&gt;
         yield tile


&lt;span class="gu"&gt;@@ -129,23 +125,12 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt;&lt;/span&gt;
     &amp;gt;&amp;gt;&amp;gt; url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'
     &amp;gt;&amp;gt;&amp;gt; hips_survey = HipsSurveyProperties.fetch(url)
     &amp;gt;&amp;gt;&amp;gt; data = make_sky_image(geometry, hips_survey)
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; hdu = fits.PrimaryHDU(data=data, header=geometry.header)&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; hdu = fits.PrimaryHDU(data=data)&lt;/span&gt;
     &amp;gt;&amp;gt;&amp;gt; hdu.writeto('my_image.fits')
     """
     healpix_pixel_indices = compute_healpix_pixel_indices(geometry, hips_survey.hips_order)
&lt;span class="gd"&gt;-    """TODO: Take user input for HiPS survey"""&lt;/span&gt;
&lt;span class="gd"&gt;-    path = Path(os.environ['HIPS_EXTRA'])&lt;/span&gt;
&lt;span class="gd"&gt;-    tiles_path = path / 'datasets' / 'samples' / 'DSS2Red' / 'Norder3' / 'Dir0'&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    tiles = []&lt;/span&gt;
&lt;span class="gd"&gt;-    for pixel_index in healpix_pixel_indices:&lt;/span&gt;
&lt;span class="gd"&gt;-        meta = HipsTileMeta(hips_survey.hips_order, pixel_index, 'fits')&lt;/span&gt;
&lt;span class="gd"&gt;-        filepath = str(tiles_path / meta.filename)&lt;/span&gt;
&lt;span class="gd"&gt;-        tiles.append(HipsTile.read(meta, filepath))&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    # Fetch the tiles&lt;/span&gt;
     # TODO: this isn't a good API. Will become better when we have a cache.
&lt;span class="gd"&gt;-    # tiles = _fetch_tiles(healpix_pixel_indices, order, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    tiles = _fetch_tiles(healpix_pixel_indices, hips_survey.hips_order, hips_survey)&lt;/span&gt;

     image_data = draw_sky_image(geometry, tiles)

&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 81f3ce4..827b283 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,23 +1,26 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-import numpy as np&lt;/span&gt;
 import pytest
&lt;span class="gd"&gt;-from astropy.tests.helper import remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.utils.data import get_pkg_data_filename&lt;/span&gt;
 from numpy.testing import assert_allclose

&lt;span class="gd"&gt;-from ..simple import make_sky_image, draw_sky_image&lt;/span&gt;
&lt;span class="gi"&gt;+from ..simple import make_sky_image, draw_sky_image, SimpleTilePainter&lt;/span&gt;
 from ...tiles import HipsSurveyProperties, HipsTileMeta, HipsTile
 from ...utils.testing import get_hips_extra_file, make_test_wcs_geometry, requires_hips_extra


 def get_test_tiles():
&lt;span class="gd"&gt;-    # TODO: check if this tile is inside our image&lt;/span&gt;
&lt;span class="gi"&gt;+    frames = dict({'equatorial': 'icrs', 'galactic': 'galactic', 'ecliptic': 'ecliptic'})&lt;/span&gt;
&lt;span class="gi"&gt;+    filename = get_pkg_data_filename('../../tiles/tests/data/properties.txt')&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey = HipsSurveyProperties.read(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
     tile1 = HipsTile.read(
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=450, file_format='fits', tile_width=512),&lt;/span&gt;
&lt;span class="gi"&gt;+        meta=HipsTileMeta(order=3, ipix=450, file_format='fits', frame=frames[hips_survey.hips_frame], tile_width=512),&lt;/span&gt;
         filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix450.fits'),
     )

     tile2 = HipsTile.read(
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=451, file_format='fits', tile_width=512),&lt;/span&gt;
&lt;span class="gi"&gt;+        meta=HipsTileMeta(order=3, ipix=451, file_format='fits', frame=frames[hips_survey.hips_frame], tile_width=512),&lt;/span&gt;
         filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix451.fits'),
     )

&lt;span class="gu"&gt;@@ -34,19 +37,33 @@ def test_draw_sky_image():&lt;/span&gt;
     assert data.shape == geometry.shape
     assert data.dtype == np.float64
     assert np.sum(data) == 4575235421.5126467
&lt;span class="gd"&gt;-    assert_allclose(data[400, 500:504], [2866.010141, 2563.691673, 2580.759013, 2746.608711])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert data[400, 500] == 2866.0101409848185&lt;/span&gt;
&lt;span class="gi"&gt;+    assert data[400, 501] == 2563.6916727348043&lt;/span&gt;


 @pytest.mark.xfail
&lt;span class="gd"&gt;-@remote_data&lt;/span&gt;
 def test_make_sky_image():
     url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'
     hips_survey = HipsSurveyProperties.fetch(url)
     geometry = make_test_wcs_geometry(case=2)
&lt;span class="gd"&gt;-&lt;/span&gt;
     data = make_sky_image(geometry, hips_survey)
&lt;span class="gd"&gt;-&lt;/span&gt;
     assert data.shape == geometry.shape
     assert data.dtype == np.float64
&lt;span class="gd"&gt;-    assert_allclose(data[200, 994:1000], [3717.10091363, 3402.55292158, 3181.16613051, 2868.45175662, 2832.23001706,&lt;/span&gt;
&lt;span class="gd"&gt;-                                          2779.23366271])&lt;/span&gt;
&lt;span class="gi"&gt;+    assert data[200, 994] == 3717.10091363&lt;/span&gt;
&lt;span class="gi"&gt;+    assert data[200, 995] == 3402.55292158&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class TestSimpleTilePainter:&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def setup_class(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        geometry = make_test_wcs_geometry(case=2)&lt;/span&gt;
&lt;span class="gi"&gt;+        tile = HipsTile.read(&lt;/span&gt;
&lt;span class="gi"&gt;+            meta=HipsTileMeta(order=3, ipix=450, file_format='fits', frame='icrs', tile_width=512),&lt;/span&gt;
&lt;span class="gi"&gt;+            filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix450.fits'),&lt;/span&gt;
&lt;span class="gi"&gt;+        )&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.simple_tile_painter = SimpleTilePainter(geometry, tile)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_compute_corners(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        self.simple_tile_painter.compute_corners()&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.simple_tile_painter.corners[0], [728.54880122, 1453.32078085, 1662.33429379, 931.69072155])&lt;/span&gt;
&lt;span class="gi"&gt;+        assert_allclose(self.simple_tile_painter.corners[1], [880.33972146, 997.1604671, 288.00518917, 175.4190427])&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 70423b2..234fb5d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -95,7 +95,8 @@ class HipsTile:&lt;/span&gt;

         if meta.file_format == 'fits':
             hdu_list = fits.open(str(path))
&lt;span class="gd"&gt;-            data = hdu_list[0].data.astype('float')&lt;/span&gt;
&lt;span class="gi"&gt;+            # This converts a big-endian byte integer to a float&lt;/span&gt;
&lt;span class="gi"&gt;+            data = hdu_list[0].data&lt;/span&gt;
             header = hdu_list[0].header
             return cls(meta, data, header)
         else:

commit c3d3d2729a4467667793af560df9b6c371625360
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 29 20:33:21 2017 +0500

    Fix link to WCSGeometry class in docs

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index f98a2bf..829248f 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -77,7 +77,7 @@ def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, order: int) -&amp;gt; np.n&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gd"&gt;-    wcs_geometry : WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+    wcs_geometry : `WCSGeometry`&lt;/span&gt;
         Container for WCS object and image shape
     order : int
         The order of the HEALPix

commit 1e4bb3b268f7b5893c5279a472d88b26fb4ecafc
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 29 20:30:48 2017 +0500

    Add property skycoord_corner to HipsTileMeta

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile_meta.py b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gh"&gt;index 53a2a21..6f2862d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -3,6 +3,9 @@ from pathlib import Path&lt;/span&gt;

 import healpy as hp
 import numpy as np
&lt;span class="gi"&gt;+from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from ..utils import boundaries&lt;/span&gt;

 __all__ = [
     'HipsTileMeta',
&lt;span class="gu"&gt;@@ -22,12 +25,22 @@ class HipsTileMeta:&lt;/span&gt;
         File format
     tile_width : `int`
         Tile width (in pixels)
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Examples&lt;/span&gt;
&lt;span class="gi"&gt;+    --------&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTileMeta&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; tile_meta = HipsTileMeta(order=3, ipix=450, file_format='fits', frame='galactic', tile_width=512)&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; tile_meta.skycoord_corners&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;lt;SkyCoord (Galactic): (l, b) in deg&lt;/span&gt;
&lt;span class="gi"&gt;+    [( 264.375, -24.62431835), ( 258.75 , -30.        ),&lt;/span&gt;
&lt;span class="gi"&gt;+     ( 264.375, -35.68533471), ( 270.   , -30.        )]&amp;gt;&lt;/span&gt;
     """

&lt;span class="gd"&gt;-    def __init__(self, order: int, ipix: int, file_format: str, tile_width: int = 512) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, order: int, ipix: int, file_format: str, frame='galactic', tile_width: int = 512) -&amp;gt; None:&lt;/span&gt;
         self.order = order
         self.ipix = ipix
         self.file_format = file_format
&lt;span class="gi"&gt;+        self.frame = frame&lt;/span&gt;
         self.tile_width = tile_width

     def __eq__(self, other: 'HipsTileMeta') -&amp;gt; bool:
&lt;span class="gu"&gt;@@ -60,5 +73,18 @@ class HipsTileMeta:&lt;/span&gt;

     @property
     def dst(self):
&lt;span class="gi"&gt;+        """Return destination array for projective transform"""&lt;/span&gt;
         return np.array(
&lt;span class="gd"&gt;-            [[self.tile_width - 1, 0], [self.tile_width - 1, self.tile_width - 1], [0, self.tile_width - 1], [0, 0]])&lt;/span&gt;
&lt;span class="gi"&gt;+            [[self.tile_width - 1, 0],&lt;/span&gt;
&lt;span class="gi"&gt;+             [self.tile_width - 1, self.tile_width - 1],&lt;/span&gt;
&lt;span class="gi"&gt;+             [0, self.tile_width - 1],&lt;/span&gt;
&lt;span class="gi"&gt;+             [0, 0]])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def skycoord_corners(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        """Return corner values for a HiPS tile"""&lt;/span&gt;
&lt;span class="gi"&gt;+        theta, phi = boundaries(self.nside, self.ipix)&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.frame == 'galactic':&lt;/span&gt;
&lt;span class="gi"&gt;+            return SkyCoord(l=phi, b=np.pi / 2 - theta, unit='radian', frame=self.frame)&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            return SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame=self.frame)&lt;/span&gt;

commit 7897504b97bc594d55aa23182af76dfd29ab152d
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 29 10:46:33 2017 +0500

    Fix drawing code

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 64c5eed..c106c8c 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -49,7 +49,7 @@ class SimpleTilePainter:&lt;/span&gt;
     ----------
     geometry : `~hips.utils.WCSGeometry`
         An object of WCSGeometry
&lt;span class="gd"&gt;-    tile : HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+    tile : `HipsTile`&lt;/span&gt;
        An object of HipsTile
     shape : tuple
         Shape of the all-sky image
&lt;span class="gu"&gt;@@ -65,12 +65,10 @@ class SimpleTilePainter:&lt;/span&gt;
     def compute_corners(self) -&amp;gt; None:
         theta, phi = boundaries(self.tile.meta.nside, self.tile.meta.ipix)
         radec = SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame='icrs')
&lt;span class="gd"&gt;-        self.corners = []&lt;/span&gt;
&lt;span class="gd"&gt;-        for i in range(len(radec.ra.deg)):&lt;/span&gt;
&lt;span class="gd"&gt;-            self.corners.append([radec.ra.deg[i], radec.dec.deg[i]])&lt;/span&gt;
&lt;span class="gi"&gt;+        self.corners = radec.to_pixel(self.geometry.wcs)&lt;/span&gt;

     def compute_projection(self) -&amp;gt; None:
&lt;span class="gd"&gt;-        src = self.geometry.wcs.wcs_world2pix(self.corners, 0)&lt;/span&gt;
&lt;span class="gi"&gt;+        src = np.array(self.corners).T.reshape((4, 2))&lt;/span&gt;
         dst = self.tile.meta.dst
         self.pt = tf.ProjectiveTransform()
         self.pt.estimate(src, dst)
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8c7aa97..81f3ce4 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -2,6 +2,7 @@&lt;/span&gt;
 import numpy as np
 import pytest
 from astropy.tests.helper import remote_data
&lt;span class="gi"&gt;+from numpy.testing import assert_allclose&lt;/span&gt;

 from ..simple import make_sky_image, draw_sky_image
 from ...tiles import HipsSurveyProperties, HipsTileMeta, HipsTile
&lt;span class="gu"&gt;@@ -11,19 +12,18 @@ from ...utils.testing import get_hips_extra_file, make_test_wcs_geometry, requir&lt;/span&gt;
 def get_test_tiles():
     # TODO: check if this tile is inside our image
     tile1 = HipsTile.read(
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=658, file_format='fits', tile_width=512),&lt;/span&gt;
&lt;span class="gd"&gt;-        filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix658.fits'),&lt;/span&gt;
&lt;span class="gi"&gt;+        meta=HipsTileMeta(order=3, ipix=450, file_format='fits', tile_width=512),&lt;/span&gt;
&lt;span class="gi"&gt;+        filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix450.fits'),&lt;/span&gt;
     )

     tile2 = HipsTile.read(
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=659, file_format='fits', tile_width=512),&lt;/span&gt;
&lt;span class="gd"&gt;-        filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix659.fits'),&lt;/span&gt;
&lt;span class="gi"&gt;+        meta=HipsTileMeta(order=3, ipix=451, file_format='fits', tile_width=512),&lt;/span&gt;
&lt;span class="gi"&gt;+        filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix451.fits'),&lt;/span&gt;
     )

     return [tile1, tile2]


&lt;span class="gd"&gt;-@pytest.mark.xfail&lt;/span&gt;
 @requires_hips_extra()
 def test_draw_sky_image():
     geometry = make_test_wcs_geometry(case=2)
&lt;span class="gu"&gt;@@ -33,10 +33,11 @@ def test_draw_sky_image():&lt;/span&gt;

     assert data.shape == geometry.shape
     assert data.dtype == np.float64
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    assert data[0, 0] == 0.0&lt;/span&gt;
&lt;span class="gi"&gt;+    assert np.sum(data) == 4575235421.5126467&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(data[400, 500:504], [2866.010141, 2563.691673, 2580.759013, 2746.608711])&lt;/span&gt;


&lt;span class="gi"&gt;+@pytest.mark.xfail&lt;/span&gt;
 @remote_data
 def test_make_sky_image():
     url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'
&lt;span class="gu"&gt;@@ -47,4 +48,5 @@ def test_make_sky_image():&lt;/span&gt;

     assert data.shape == geometry.shape
     assert data.dtype == np.float64
&lt;span class="gd"&gt;-    assert data[800, 1000] == 1794.7673494847763&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(data[200, 994:1000], [3717.10091363, 3402.55292158, 3181.16613051, 2868.45175662, 2832.23001706,&lt;/span&gt;
&lt;span class="gi"&gt;+                                          2779.23366271])&lt;/span&gt;

commit 53a0df576c6f1be0659cd4927609ae134cdb3643
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jun 28 17:51:42 2017 +0500

    Reformat some code

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 342a107..64c5eed 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -3,10 +3,8 @@&lt;/span&gt;
 import os
 from pathlib import Path

&lt;span class="gd"&gt;-import healpy as hp&lt;/span&gt;
 import numpy as np
 from astropy.coordinates import SkyCoord
&lt;span class="gd"&gt;-from astropy.wcs import WCS&lt;/span&gt;
 from skimage import transform as tf
 from typing import List

&lt;span class="gu"&gt;@@ -66,19 +64,14 @@ class SimpleTilePainter:&lt;/span&gt;

     def compute_corners(self) -&amp;gt; None:
         theta, phi = boundaries(self.tile.meta.nside, self.tile.meta.ipix)
&lt;span class="gd"&gt;-        self.corners = SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame='icrs')&lt;/span&gt;
&lt;span class="gd"&gt;-        self.test_corners = []&lt;/span&gt;
&lt;span class="gd"&gt;-        for i in range(len(self.corners.ra.deg)):&lt;/span&gt;
&lt;span class="gd"&gt;-            self.test_corners.append([self.corners.ra.deg[i], self.corners.dec.deg[i]])&lt;/span&gt;
&lt;span class="gi"&gt;+        radec = SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame='icrs')&lt;/span&gt;
&lt;span class="gi"&gt;+        self.corners = []&lt;/span&gt;
&lt;span class="gi"&gt;+        for i in range(len(radec.ra.deg)):&lt;/span&gt;
&lt;span class="gi"&gt;+            self.corners.append([radec.ra.deg[i], radec.dec.deg[i]])&lt;/span&gt;

     def compute_projection(self) -&amp;gt; None:
&lt;span class="gd"&gt;-        # print(self.corners.to_pixel(self.geometry.wcs))&lt;/span&gt;
&lt;span class="gd"&gt;-        # src = self.geometry.wcs.wcs_world2pix(self.corners.to_pixel(self.geometry.wcs), 0)&lt;/span&gt;
&lt;span class="gd"&gt;-        src = np.array(self.corners.to_pixel(self.geometry.wcs))&lt;/span&gt;
&lt;span class="gd"&gt;-        print('Corners: ', self.test_corners)&lt;/span&gt;
&lt;span class="gd"&gt;-        print('Source: ', src)&lt;/span&gt;
&lt;span class="gd"&gt;-        print(self.geometry.wcs.wcs_world2pix(self.corners.to_pixel(self.geometry.wcs), 0))&lt;/span&gt;
&lt;span class="gd"&gt;-        dst = np.array([[511, 0], [511, 511], [0, 511], [0, 0]])&lt;/span&gt;
&lt;span class="gi"&gt;+        src = self.geometry.wcs.wcs_world2pix(self.corners, 0)&lt;/span&gt;
&lt;span class="gi"&gt;+        dst = self.tile.meta.dst&lt;/span&gt;
         self.pt = tf.ProjectiveTransform()
         self.pt.estimate(src, dst)

&lt;span class="gu"&gt;@@ -142,6 +135,7 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt;&lt;/span&gt;
     &amp;gt;&amp;gt;&amp;gt; hdu.writeto('my_image.fits')
     """
     healpix_pixel_indices = compute_healpix_pixel_indices(geometry, hips_survey.hips_order)
&lt;span class="gi"&gt;+    """TODO: Take user input for HiPS survey"""&lt;/span&gt;
     path = Path(os.environ['HIPS_EXTRA'])
     tiles_path = path / 'datasets' / 'samples' / 'DSS2Red' / 'Norder3' / 'Dir0'

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 4f89897..f98a2bf 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -4,10 +4,10 @@&lt;/span&gt;
 This module contains wrapper functions around HEALPix utilizing
 the healpy library.
 """
&lt;span class="gd"&gt;-from typing import Tuple&lt;/span&gt;
&lt;span class="gi"&gt;+import healpy as hp&lt;/span&gt;
 import numpy as np
 from astropy.coordinates import SkyCoord
&lt;span class="gd"&gt;-import healpy as hp&lt;/span&gt;
&lt;span class="gi"&gt;+from typing import Tuple&lt;/span&gt;

 from .wcs import WCSGeometry


commit 243ef55f752c701c94f4b3736c20524f62b560a1
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jun 28 17:50:52 2017 +0500

    Add dst property in HipsTileMeta class

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile_meta.py b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gh"&gt;index fe0bacb..53a2a21 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,6 +1,8 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 from pathlib import Path
&lt;span class="gi"&gt;+&lt;/span&gt;
 import healpy as hp
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;

 __all__ = [
     'HipsTileMeta',
&lt;span class="gu"&gt;@@ -54,4 +56,9 @@ class HipsTileMeta:&lt;/span&gt;
     @property
     def nside(self):
         """Return the nside of the HEALPix map"""
&lt;span class="gd"&gt;-        return hp.order2nside(self.order)&lt;/span&gt;
\ No newline at end of file
&lt;span class="gi"&gt;+        return hp.order2nside(self.order)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def dst(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        return np.array(&lt;/span&gt;
&lt;span class="gi"&gt;+            [[self.tile_width - 1, 0], [self.tile_width - 1, self.tile_width - 1], [0, self.tile_width - 1], [0, 0]])&lt;/span&gt;

commit 3acf68e070ceeac9cce7e86c89f3c0350ed478aa
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jun 28 10:36:37 2017 +0500

    Update corner computation

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 9ab55e9..342a107 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -16,6 +16,7 @@ from ..utils import WCSGeometry, compute_healpix_pixel_indices, boundaries&lt;/span&gt;
 __all__ = [
     'draw_sky_image',
     'make_sky_image',
&lt;span class="gi"&gt;+    'SimpleTilePainter'&lt;/span&gt;
 ]


&lt;span class="gu"&gt;@@ -24,7 +25,7 @@ def draw_sky_image(geometry: WCSGeometry, tiles: List[HipsTile]) -&amp;gt; np.ndarray:&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gd"&gt;-    geometry : 'WCSGeometry'&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry : `~hips.utils.WCSGeometry`&lt;/span&gt;
         An object of WCSGeometry
     tiles : List[HipsTile]
         A list of HipsTile
&lt;span class="gu"&gt;@@ -36,23 +37,23 @@ def draw_sky_image(geometry: WCSGeometry, tiles: List[HipsTile]) -&amp;gt; np.ndarray:&lt;/span&gt;
     """
     all_sky = np.zeros(geometry.shape)
     for tile in tiles:
&lt;span class="gd"&gt;-        draw_tile = DrawSkyImageOneTile(geometry, tile, all_sky.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        draw_tile = SimpleTilePainter(geometry, tile, all_sky.shape)&lt;/span&gt;
         draw_tile.compute_corners()
&lt;span class="gd"&gt;-        draw_tile.apply_projection()&lt;/span&gt;
&lt;span class="gi"&gt;+        draw_tile.compute_projection()&lt;/span&gt;
         all_sky += draw_tile.warp_image()
     return all_sky


&lt;span class="gd"&gt;-class DrawSkyImageOneTile:&lt;/span&gt;
&lt;span class="gd"&gt;-    """A private function for drawing a tile over a sky image.&lt;/span&gt;
&lt;span class="gi"&gt;+class SimpleTilePainter:&lt;/span&gt;
&lt;span class="gi"&gt;+    """A class which iteratively draws a tile following the naive algorithm steps mentioned `here &amp;lt;https://hips.readthedocs.io/en/latest/drawing_algo.html#naive-algorithm&amp;gt;`_.&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gd"&gt;-    geometry : 'WCSGeometry'&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry : `~hips.utils.WCSGeometry`&lt;/span&gt;
         An object of WCSGeometry
     tile : HipsTile
        An object of HipsTile
&lt;span class="gd"&gt;-    shape ; tuple&lt;/span&gt;
&lt;span class="gi"&gt;+    shape : tuple&lt;/span&gt;
         Shape of the all-sky image
     """

&lt;span class="gu"&gt;@@ -60,20 +61,23 @@ class DrawSkyImageOneTile:&lt;/span&gt;
         self.geometry = geometry
         self.tile = tile
         self.shape = shape
&lt;span class="gd"&gt;-        self.wcs = WCS(tile.header)&lt;/span&gt;
         self.corners = None
         self.pt = None

     def compute_corners(self) -&amp;gt; None:
&lt;span class="gd"&gt;-        nside = hp.order2nside(self.tile.meta.order)&lt;/span&gt;
&lt;span class="gd"&gt;-        theta, phi = boundaries(nside, self.tile.meta.ipix)&lt;/span&gt;
&lt;span class="gd"&gt;-        radec = SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame='icrs')&lt;/span&gt;
&lt;span class="gd"&gt;-        self.corners = []&lt;/span&gt;
&lt;span class="gd"&gt;-        for i in range(len(radec.ra.deg)):&lt;/span&gt;
&lt;span class="gd"&gt;-            self.corners.append([radec.ra.deg[i], radec.dec.deg[i]])&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def apply_projection(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        src = self.geometry.wcs.wcs_world2pix(self.corners, 0)&lt;/span&gt;
&lt;span class="gi"&gt;+        theta, phi = boundaries(self.tile.meta.nside, self.tile.meta.ipix)&lt;/span&gt;
&lt;span class="gi"&gt;+        self.corners = SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame='icrs')&lt;/span&gt;
&lt;span class="gi"&gt;+        self.test_corners = []&lt;/span&gt;
&lt;span class="gi"&gt;+        for i in range(len(self.corners.ra.deg)):&lt;/span&gt;
&lt;span class="gi"&gt;+            self.test_corners.append([self.corners.ra.deg[i], self.corners.dec.deg[i]])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def compute_projection(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        # print(self.corners.to_pixel(self.geometry.wcs))&lt;/span&gt;
&lt;span class="gi"&gt;+        # src = self.geometry.wcs.wcs_world2pix(self.corners.to_pixel(self.geometry.wcs), 0)&lt;/span&gt;
&lt;span class="gi"&gt;+        src = np.array(self.corners.to_pixel(self.geometry.wcs))&lt;/span&gt;
&lt;span class="gi"&gt;+        print('Corners: ', self.test_corners)&lt;/span&gt;
&lt;span class="gi"&gt;+        print('Source: ', src)&lt;/span&gt;
&lt;span class="gi"&gt;+        print(self.geometry.wcs.wcs_world2pix(self.corners.to_pixel(self.geometry.wcs), 0))&lt;/span&gt;
         dst = np.array([[511, 0], [511, 511], [0, 511], [0, 0]])
         self.pt = tf.ProjectiveTransform()
         self.pt.estimate(src, dst)
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile_meta.py b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gh"&gt;index e1fca4c..fe0bacb 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,5 +1,6 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 from pathlib import Path
&lt;span class="gi"&gt;+import healpy as hp&lt;/span&gt;

 __all__ = [
     'HipsTileMeta',
&lt;span class="gu"&gt;@@ -49,3 +50,8 @@ class HipsTileMeta:&lt;/span&gt;
     def full_path(self) -&amp;gt; Path:
         """Full path (folder and filename) (`~pathlib.Path`)"""
         return self.path / self.filename
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def nside(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        """Return the nside of the HEALPix map"""&lt;/span&gt;
&lt;span class="gi"&gt;+        return hp.order2nside(self.order)&lt;/span&gt;
\ No newline at end of file

commit c838f6412cfeddea00d8449ee048d0429ed6a09d
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jun 27 23:18:42 2017 +0500

    Update drawing code

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index f82df43..9ab55e9 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -34,48 +34,52 @@ def draw_sky_image(geometry: WCSGeometry, tiles: List[HipsTile]) -&amp;gt; np.ndarray:&lt;/span&gt;
     np.ndarray
         Returns a numpy array containing all HiPS tiles projected onto it
     """
&lt;span class="gd"&gt;-    # TODO: copy over (and clean up a little) the drawing code you already have in notebooks.&lt;/span&gt;
&lt;span class="gd"&gt;-    # Suggestion: don't debug the code now, just put it here.&lt;/span&gt;
&lt;span class="gd"&gt;-    # First implement simple tile caching so that you can draw without needing to make web queries.&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    # Probably this function should just loop over tiles and call a `_draw_sky_image_one_tile`&lt;/span&gt;
&lt;span class="gd"&gt;-    # helper function, and sum up the results.&lt;/span&gt;
     all_sky = np.zeros(geometry.shape)
     for tile in tiles:
&lt;span class="gd"&gt;-        nside = hp.order2nside(tile.meta.order)&lt;/span&gt;
&lt;span class="gd"&gt;-        theta, phi = boundaries(nside, tile.meta.ipix)&lt;/span&gt;
&lt;span class="gd"&gt;-        radec = SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame='icrs')&lt;/span&gt;
&lt;span class="gd"&gt;-        corners = []&lt;/span&gt;
&lt;span class="gd"&gt;-        for i in range(len(radec.ra.deg)):&lt;/span&gt;
&lt;span class="gd"&gt;-            corners.append([radec.ra.deg[i], radec.dec.deg[i]])&lt;/span&gt;
&lt;span class="gd"&gt;-        all_sky += _draw_sky_image_one_tile(corners, WCS(tile.header), tile, all_sky.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        draw_tile = DrawSkyImageOneTile(geometry, tile, all_sky.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+        draw_tile.compute_corners()&lt;/span&gt;
&lt;span class="gi"&gt;+        draw_tile.apply_projection()&lt;/span&gt;
&lt;span class="gi"&gt;+        all_sky += draw_tile.warp_image()&lt;/span&gt;
     return all_sky


&lt;span class="gd"&gt;-def _draw_sky_image_one_tile(corners: list, wcs: WCS, tile: HipsTile, shape: tuple) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+class DrawSkyImageOneTile:&lt;/span&gt;
     """A private function for drawing a tile over a sky image.

     Parameters
     ----------
&lt;span class="gd"&gt;-    corners : `~astropy.coordinates.SkyCoord`&lt;/span&gt;
&lt;span class="gd"&gt;-        Four corners of a HiPS tile&lt;/span&gt;
&lt;span class="gd"&gt;-    wcs : `~astropy.wcs.WCS`&lt;/span&gt;
&lt;span class="gd"&gt;-        WCS projection of a HiPS tile&lt;/span&gt;
&lt;span class="gd"&gt;-    tile : 'HipsTile'&lt;/span&gt;
&lt;span class="gd"&gt;-        An object of HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry : 'WCSGeometry'&lt;/span&gt;
&lt;span class="gi"&gt;+        An object of WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+    tile : HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+       An object of HipsTile&lt;/span&gt;
     shape ; tuple
         Shape of the all-sky image
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    Returns&lt;/span&gt;
&lt;span class="gd"&gt;-    -------&lt;/span&gt;
&lt;span class="gd"&gt;-    np.ndarray&lt;/span&gt;
&lt;span class="gd"&gt;-        Returns a numpy array containing the projected HiPS tile&lt;/span&gt;
     """
&lt;span class="gd"&gt;-    src = wcs.wcs_world2pix(corners, 0)&lt;/span&gt;
&lt;span class="gd"&gt;-    dst = np.array([[511, 0], [511, 511], [0, 511], [0, 0]])&lt;/span&gt;
&lt;span class="gd"&gt;-    pt = tf.ProjectiveTransform()&lt;/span&gt;
&lt;span class="gd"&gt;-    pt.estimate(src, dst)&lt;/span&gt;
&lt;span class="gd"&gt;-    return tf.warp(tile.data, pt, output_shape=shape)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, geometry: WCSGeometry, tile: HipsTile, shape: tuple) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.geometry = geometry&lt;/span&gt;
&lt;span class="gi"&gt;+        self.tile = tile&lt;/span&gt;
&lt;span class="gi"&gt;+        self.shape = shape&lt;/span&gt;
&lt;span class="gi"&gt;+        self.wcs = WCS(tile.header)&lt;/span&gt;
&lt;span class="gi"&gt;+        self.corners = None&lt;/span&gt;
&lt;span class="gi"&gt;+        self.pt = None&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def compute_corners(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        nside = hp.order2nside(self.tile.meta.order)&lt;/span&gt;
&lt;span class="gi"&gt;+        theta, phi = boundaries(nside, self.tile.meta.ipix)&lt;/span&gt;
&lt;span class="gi"&gt;+        radec = SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame='icrs')&lt;/span&gt;
&lt;span class="gi"&gt;+        self.corners = []&lt;/span&gt;
&lt;span class="gi"&gt;+        for i in range(len(radec.ra.deg)):&lt;/span&gt;
&lt;span class="gi"&gt;+            self.corners.append([radec.ra.deg[i], radec.dec.deg[i]])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def apply_projection(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        src = self.geometry.wcs.wcs_world2pix(self.corners, 0)&lt;/span&gt;
&lt;span class="gi"&gt;+        dst = np.array([[511, 0], [511, 511], [0, 511], [0, 0]])&lt;/span&gt;
&lt;span class="gi"&gt;+        self.pt = tf.ProjectiveTransform()&lt;/span&gt;
&lt;span class="gi"&gt;+        self.pt.estimate(src, dst)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def warp_image(self) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+        return tf.warp(self.tile.data, self.pt, output_shape=self.shape)&lt;/span&gt;


 def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: HipsSurveyProperties) -&amp;gt; 'HipsTile':
&lt;span class="gu"&gt;@@ -118,26 +122,21 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt;&lt;/span&gt;

     Examples
     --------
&lt;span class="gd"&gt;-    Define which image you want:&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; geometry = tbd&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    Define which HiPS survey you want:&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; hips_survey = tbd&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    Compute the image:&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; from hips import make_sky_image&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; data = make_sky_image(geometry, hips_survey)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    If you want, you can save the image to file:&lt;/span&gt;
     &amp;gt;&amp;gt;&amp;gt; from astropy.io import fits
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from hips.utils import WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from hips.draw import make_sky_image&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; geometry = WCSGeometry.create(&lt;/span&gt;
&lt;span class="gi"&gt;+    ...     skydir=SkyCoord(0, 0, unit='deg', frame='galactic'),&lt;/span&gt;
&lt;span class="gi"&gt;+    ...     shape=(1000, 2000), coordsys='GAL',&lt;/span&gt;
&lt;span class="gi"&gt;+    ...     projection='AIT', cdelt=0.01, crpix=(1000, 500),&lt;/span&gt;
&lt;span class="gi"&gt;+    ... )&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; data = make_sky_image(geometry, hips_survey)&lt;/span&gt;
     &amp;gt;&amp;gt;&amp;gt; hdu = fits.PrimaryHDU(data=data, header=geometry.header)
     &amp;gt;&amp;gt;&amp;gt; hdu.writeto('my_image.fits')
     """
&lt;span class="gd"&gt;-    # Compute list of tiles needed&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
     healpix_pixel_indices = compute_healpix_pixel_indices(geometry, hips_survey.hips_order)
     path = Path(os.environ['HIPS_EXTRA'])
     tiles_path = path / 'datasets' / 'samples' / 'DSS2Red' / 'Norder3' / 'Dir0'
&lt;span class="gu"&gt;@@ -152,7 +151,6 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt;&lt;/span&gt;
     # TODO: this isn't a good API. Will become better when we have a cache.
     # tiles = _fetch_tiles(healpix_pixel_indices, order, hips_survey)

&lt;span class="gd"&gt;-    # Draw the image&lt;/span&gt;
     image_data = draw_sky_image(geometry, tiles)

     return image_data
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8f293a7..8c7aa97 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -34,7 +34,7 @@ def test_draw_sky_image():&lt;/span&gt;
     assert data.shape == geometry.shape
     assert data.dtype == np.float64

&lt;span class="gd"&gt;-    assert data[0, 0] == 0.060903854985925092&lt;/span&gt;
&lt;span class="gi"&gt;+    assert data[0, 0] == 0.0&lt;/span&gt;


 @remote_data
&lt;span class="gu"&gt;@@ -47,5 +47,4 @@ def test_make_sky_image():&lt;/span&gt;

     assert data.shape == geometry.shape
     assert data.dtype == np.float64
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    assert data[0, 0] == 0.060903854985925092&lt;/span&gt;
&lt;span class="gi"&gt;+    assert data[800, 1000] == 1794.7673494847763&lt;/span&gt;

commit 91e7e394a4f7bf363122703f55048ddcfee5118b
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jun 27 23:18:27 2017 +0500

    Store FITS data as float type

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 76e2428..70423b2 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -95,7 +95,7 @@ class HipsTile:&lt;/span&gt;

         if meta.file_format == 'fits':
             hdu_list = fits.open(str(path))
&lt;span class="gd"&gt;-            data = hdu_list[0].data&lt;/span&gt;
&lt;span class="gi"&gt;+            data = hdu_list[0].data.astype('float')&lt;/span&gt;
             header = hdu_list[0].header
             return cls(meta, data, header)
         else:

commit 818a9102b3f12ab61ed13d3987b31b227719a700
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jun 27 11:49:58 2017 +0500

    Update drawing function

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8d7c268..f82df43 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,9 +1,15 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 """HiPS tile drawing -- simple method."""
&lt;span class="gd"&gt;-import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+import os&lt;/span&gt;
&lt;span class="gi"&gt;+from pathlib import Path&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 import healpy as hp
&lt;span class="gd"&gt;-from typing import List&lt;/span&gt;
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.wcs import WCS&lt;/span&gt;
 from skimage import transform as tf
&lt;span class="gi"&gt;+from typing import List&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta
 from ..utils import WCSGeometry, compute_healpix_pixel_indices, boundaries

&lt;span class="gu"&gt;@@ -16,7 +22,17 @@ __all__ = [&lt;/span&gt;
 def draw_sky_image(geometry: WCSGeometry, tiles: List[HipsTile]) -&amp;gt; np.ndarray:
     """Draw sky image using the simple and quick method.

&lt;span class="gd"&gt;-    TODO: fill in code here&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    geometry : 'WCSGeometry'&lt;/span&gt;
&lt;span class="gi"&gt;+        An object of WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+    tiles : List[HipsTile]&lt;/span&gt;
&lt;span class="gi"&gt;+        A list of HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Returns&lt;/span&gt;
&lt;span class="gi"&gt;+    -------&lt;/span&gt;
&lt;span class="gi"&gt;+    np.ndarray&lt;/span&gt;
&lt;span class="gi"&gt;+        Returns a numpy array containing all HiPS tiles projected onto it&lt;/span&gt;
     """
     # TODO: copy over (and clean up a little) the drawing code you already have in notebooks.
     # Suggestion: don't debug the code now, just put it here.
&lt;span class="gu"&gt;@@ -24,24 +40,68 @@ def draw_sky_image(geometry: WCSGeometry, tiles: List[HipsTile]) -&amp;gt; np.ndarray:&lt;/span&gt;

     # Probably this function should just loop over tiles and call a `_draw_sky_image_one_tile`
     # helper function, and sum up the results.
&lt;span class="gd"&gt;-    for tile in HipsTile:&lt;/span&gt;
&lt;span class="gi"&gt;+    all_sky = np.zeros(geometry.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+    for tile in tiles:&lt;/span&gt;
         nside = hp.order2nside(tile.meta.order)
&lt;span class="gd"&gt;-        corners = boundaries(nside, tile.meta.ipix)&lt;/span&gt;
&lt;span class="gd"&gt;-        # tile.meta.&lt;/span&gt;
&lt;span class="gi"&gt;+        theta, phi = boundaries(nside, tile.meta.ipix)&lt;/span&gt;
&lt;span class="gi"&gt;+        radec = SkyCoord(ra=phi, dec=np.pi / 2 - theta, unit='radian', frame='icrs')&lt;/span&gt;
&lt;span class="gi"&gt;+        corners = []&lt;/span&gt;
&lt;span class="gi"&gt;+        for i in range(len(radec.ra.deg)):&lt;/span&gt;
&lt;span class="gi"&gt;+            corners.append([radec.ra.deg[i], radec.dec.deg[i]])&lt;/span&gt;
&lt;span class="gi"&gt;+        all_sky += _draw_sky_image_one_tile(corners, WCS(tile.header), tile, all_sky.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+    return all_sky&lt;/span&gt;

&lt;span class="gd"&gt;-    return np.zeros(geometry.shape)&lt;/span&gt;

&lt;span class="gd"&gt;-def _draw_sky_image_one_tile(corners: tuple, tile: HipsTile) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+def _draw_sky_image_one_tile(corners: list, wcs: WCS, tile: HipsTile, shape: tuple) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+    """A private function for drawing a tile over a sky image.&lt;/span&gt;

&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    corners : `~astropy.coordinates.SkyCoord`&lt;/span&gt;
&lt;span class="gi"&gt;+        Four corners of a HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    wcs : `~astropy.wcs.WCS`&lt;/span&gt;
&lt;span class="gi"&gt;+        WCS projection of a HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    tile : 'HipsTile'&lt;/span&gt;
&lt;span class="gi"&gt;+        An object of HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+    shape ; tuple&lt;/span&gt;
&lt;span class="gi"&gt;+        Shape of the all-sky image&lt;/span&gt;

&lt;span class="gd"&gt;-def _fetch_tiles(healpix_pixel_indices, order, hips_survey):&lt;/span&gt;
&lt;span class="gi"&gt;+    Returns&lt;/span&gt;
&lt;span class="gi"&gt;+    -------&lt;/span&gt;
&lt;span class="gi"&gt;+    np.ndarray&lt;/span&gt;
&lt;span class="gi"&gt;+        Returns a numpy array containing the projected HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+    src = wcs.wcs_world2pix(corners, 0)&lt;/span&gt;
&lt;span class="gi"&gt;+    dst = np.array([[511, 0], [511, 511], [0, 511], [0, 0]])&lt;/span&gt;
&lt;span class="gi"&gt;+    pt = tf.ProjectiveTransform()&lt;/span&gt;
&lt;span class="gi"&gt;+    pt.estimate(src, dst)&lt;/span&gt;
&lt;span class="gi"&gt;+    return tf.warp(tile.data, pt, output_shape=shape)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def _fetch_tiles(healpix_pixel_indices: np.ndarray, order: int, hips_survey: HipsSurveyProperties) -&amp;gt; 'HipsTile':&lt;/span&gt;
&lt;span class="gi"&gt;+    """Fetch HiPS tiles from a remote URL.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    healpix_pixel_indices : np.ndarray&lt;/span&gt;
&lt;span class="gi"&gt;+        A list of HEALPix pixel indices&lt;/span&gt;
&lt;span class="gi"&gt;+    order : int&lt;/span&gt;
&lt;span class="gi"&gt;+        Order of the HEALPix map&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey : HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+        An object of HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Returns&lt;/span&gt;
&lt;span class="gi"&gt;+    -------&lt;/span&gt;
&lt;span class="gi"&gt;+    'HipsTile'&lt;/span&gt;
&lt;span class="gi"&gt;+        Returns an object of  HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
     for healpix_pixel_index in healpix_pixel_indices:
&lt;span class="gd"&gt;-        tile_meta = HipsTileMeta(order=order, ipix=healpix_pixel_index, file_format='jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_meta = HipsTileMeta(order=order, ipix=healpix_pixel_index, file_format='fits')&lt;/span&gt;
         tile = HipsTile.fetch(tile_meta, hips_survey.base_url)
         yield tile


&lt;span class="gd"&gt;-def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties):&lt;/span&gt;
&lt;span class="gi"&gt;+def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties) -&amp;gt; np.ndarray:&lt;/span&gt;
     """Make sky image: fetch tiles and draw.

     Parameters
&lt;span class="gu"&gt;@@ -77,12 +137,20 @@ def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties):&lt;/span&gt;
     &amp;gt;&amp;gt;&amp;gt; hdu.writeto('my_image.fits')
     """
     # Compute list of tiles needed
&lt;span class="gd"&gt;-    order = hips_survey.hips_order&lt;/span&gt;
&lt;span class="gd"&gt;-    healpix_pixel_indices = compute_healpix_pixel_indices(geometry, order)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    healpix_pixel_indices = compute_healpix_pixel_indices(geometry, hips_survey.hips_order)&lt;/span&gt;
&lt;span class="gi"&gt;+    path = Path(os.environ['HIPS_EXTRA'])&lt;/span&gt;
&lt;span class="gi"&gt;+    tiles_path = path / 'datasets' / 'samples' / 'DSS2Red' / 'Norder3' / 'Dir0'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    tiles = []&lt;/span&gt;
&lt;span class="gi"&gt;+    for pixel_index in healpix_pixel_indices:&lt;/span&gt;
&lt;span class="gi"&gt;+        meta = HipsTileMeta(hips_survey.hips_order, pixel_index, 'fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        filepath = str(tiles_path / meta.filename)&lt;/span&gt;
&lt;span class="gi"&gt;+        tiles.append(HipsTile.read(meta, filepath))&lt;/span&gt;

     # Fetch the tiles
     # TODO: this isn't a good API. Will become better when we have a cache.
&lt;span class="gd"&gt;-    tiles = _fetch_tiles(healpix_pixel_indices, order, hips_survey)&lt;/span&gt;
&lt;span class="gi"&gt;+    # tiles = _fetch_tiles(healpix_pixel_indices, order, hips_survey)&lt;/span&gt;

     # Draw the image
     image_data = draw_sky_image(geometry, tiles)
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index fae10bc..8f293a7 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,32 +1,31 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-import pytest&lt;/span&gt;
 import numpy as np
&lt;span class="gi"&gt;+import pytest&lt;/span&gt;
 from astropy.tests.helper import remote_data
&lt;span class="gd"&gt;-from ...tiles import HipsSurveyProperties, HipsTileMeta, HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 from ..simple import make_sky_image, draw_sky_image
&lt;span class="gi"&gt;+from ...tiles import HipsSurveyProperties, HipsTileMeta, HipsTile&lt;/span&gt;
 from ...utils.testing import get_hips_extra_file, make_test_wcs_geometry, requires_hips_extra


 def get_test_tiles():
&lt;span class="gd"&gt;-    # Could make manually a list of two tiles to draw&lt;/span&gt;
&lt;span class="gd"&gt;-    # Pointing to FITS tiles in hips-extra like e.g.&lt;/span&gt;
&lt;span class="gd"&gt;-    # hips-extra/datasets/samples//DSS2Red/Norder3/Dir0/Npix659.fits&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
     # TODO: check if this tile is inside our image
     tile1 = HipsTile.read(
&lt;span class="gd"&gt;-        meta=HipsTileMeta(order=3, ipix=659, file_format='fits', tile_width=512),&lt;/span&gt;
&lt;span class="gd"&gt;-        filename=get_hips_extra_file('datasets/samples//DSS2Red/Norder3/Dir0/Npix659.fits'),&lt;/span&gt;
&lt;span class="gi"&gt;+        meta=HipsTileMeta(order=3, ipix=658, file_format='fits', tile_width=512),&lt;/span&gt;
&lt;span class="gi"&gt;+        filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix658.fits'),&lt;/span&gt;
     )

&lt;span class="gd"&gt;-    # TODO: also fetch a second one.&lt;/span&gt;
&lt;span class="gi"&gt;+    tile2 = HipsTile.read(&lt;/span&gt;
&lt;span class="gi"&gt;+        meta=HipsTileMeta(order=3, ipix=659, file_format='fits', tile_width=512),&lt;/span&gt;
&lt;span class="gi"&gt;+        filename=get_hips_extra_file('datasets/samples/DSS2Red/Norder3/Dir0/Npix659.fits'),&lt;/span&gt;
&lt;span class="gi"&gt;+    )&lt;/span&gt;

&lt;span class="gd"&gt;-    return [tile1]&lt;/span&gt;
&lt;span class="gi"&gt;+    return [tile1, tile2]&lt;/span&gt;


&lt;span class="gi"&gt;+@pytest.mark.xfail&lt;/span&gt;
 @requires_hips_extra()
 def test_draw_sky_image():
&lt;span class="gd"&gt;-    # filename = get_pkg_data_filename('../../tiles/tests/data/properties.txt')&lt;/span&gt;
&lt;span class="gd"&gt;-    # hips_survey = HipsSurveyProperties.read(filename)&lt;/span&gt;
     geometry = make_test_wcs_geometry(case=2)
     tiles = get_test_tiles()

&lt;span class="gu"&gt;@@ -35,13 +34,12 @@ def test_draw_sky_image():&lt;/span&gt;
     assert data.shape == geometry.shape
     assert data.dtype == np.float64

&lt;span class="gd"&gt;-    assert data[100, 200] == 42&lt;/span&gt;
&lt;span class="gi"&gt;+    assert data[0, 0] == 0.060903854985925092&lt;/span&gt;


&lt;span class="gd"&gt;-@pytest.mark.xfail&lt;/span&gt;
 @remote_data
 def test_make_sky_image():
&lt;span class="gd"&gt;-    url = 'https://raw.githubusercontent.com/hipspy/hips/master/hips/tiles/tests/data/properties.txt'&lt;/span&gt;
&lt;span class="gi"&gt;+    url = 'https://raw.githubusercontent.com/hipspy/hips-extra/master/datasets/samples/DSS2Red/properties'&lt;/span&gt;
     hips_survey = HipsSurveyProperties.fetch(url)
     geometry = make_test_wcs_geometry(case=2)

&lt;span class="gu"&gt;@@ -50,4 +48,4 @@ def test_make_sky_image():&lt;/span&gt;
     assert data.shape == geometry.shape
     assert data.dtype == np.float64

&lt;span class="gd"&gt;-    assert data[100, 200] == 42&lt;/span&gt;
&lt;span class="gi"&gt;+    assert data[0, 0] == 0.060903854985925092&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/testing.py b/hips/utils/testing.py&lt;/span&gt;
&lt;span class="gh"&gt;index 50c7e11..ce8556c 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/testing.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/testing.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -2,10 +2,12 @@&lt;/span&gt;

 Not of use for users / outside this package.
 """
&lt;span class="gd"&gt;-import pytest&lt;/span&gt;
 import os
 from pathlib import Path
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+import pytest&lt;/span&gt;
 from astropy.coordinates import SkyCoord
&lt;span class="gi"&gt;+&lt;/span&gt;
 from .wcs import WCSGeometry


&lt;span class="gu"&gt;@@ -50,4 +52,4 @@ def make_test_wcs_geometry(case=0):&lt;/span&gt;
             projection='AIT', cdelt=0.01, crpix=(1000, 500),
         )
     else:
&lt;span class="gd"&gt;-        raise ValueError()&lt;/span&gt;
&lt;span class="gi"&gt;+        raise ValueError()  # pragma: no cover&lt;/span&gt;

commit 120ff07dd6b4cd13bcd0131927746fab7dbb7f7d
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jun 26 13:49:52 2017 +0500

    Add skeleton of drawing code

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 309c15d..8d7c268 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,9 +1,11 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 """HiPS tile drawing -- simple method."""
&lt;span class="gd"&gt;-from typing import List&lt;/span&gt;
 import numpy as np
&lt;span class="gi"&gt;+import healpy as hp&lt;/span&gt;
&lt;span class="gi"&gt;+from typing import List&lt;/span&gt;
&lt;span class="gi"&gt;+from skimage import transform as tf&lt;/span&gt;
 from ..tiles import HipsSurveyProperties, HipsTile, HipsTileMeta
&lt;span class="gd"&gt;-from ..utils import WCSGeometry, compute_healpix_pixel_indices&lt;/span&gt;
&lt;span class="gi"&gt;+from ..utils import WCSGeometry, compute_healpix_pixel_indices, boundaries&lt;/span&gt;

 __all__ = [
     'draw_sky_image',
&lt;span class="gu"&gt;@@ -22,9 +24,15 @@ def draw_sky_image(geometry: WCSGeometry, tiles: List[HipsTile]) -&amp;gt; np.ndarray:&lt;/span&gt;

     # Probably this function should just loop over tiles and call a `_draw_sky_image_one_tile`
     # helper function, and sum up the results.
&lt;span class="gi"&gt;+    for tile in HipsTile:&lt;/span&gt;
&lt;span class="gi"&gt;+        nside = hp.order2nside(tile.meta.order)&lt;/span&gt;
&lt;span class="gi"&gt;+        corners = boundaries(nside, tile.meta.ipix)&lt;/span&gt;
&lt;span class="gi"&gt;+        # tile.meta.&lt;/span&gt;

     return np.zeros(geometry.shape)

&lt;span class="gi"&gt;+def _draw_sky_image_one_tile(corners: tuple, tile: HipsTile) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;

 def _fetch_tiles(healpix_pixel_indices, order, hips_survey):
     for healpix_pixel_index in healpix_pixel_indices:

commit 1dcc81164f456a9bd4fa7f7905630c94c429d308
Merge: a5ac131 32db7fb
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jun 26 12:04:52 2017 +0500

    Merge branch 'master' of https://github.com/hipspy/hips into tiles.draw

commit a3f7261fe255ac8a6904741f576d99bddeba3ffd
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Sun Jun 25 17:25:00 2017 +0500

    Add documentation on HIPS_EXTRA environment variable

&lt;span class="gh"&gt;diff --git a/docs/develop.rst b/docs/develop.rst&lt;/span&gt;
&lt;span class="gh"&gt;index c34c07f..4f2fdd5 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/develop.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/develop.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -6,6 +6,13 @@&lt;/span&gt;
 Develop
 *******

&lt;span class="gi"&gt;+To run tests accessing files from `hips-extra &amp;lt;https://github.com/hipspy/hips-extra&amp;gt;`_&lt;/span&gt;
&lt;span class="gi"&gt;+repository, users must have it cloned on their system, otherwise some test cases&lt;/span&gt;
&lt;span class="gi"&gt;+will be skipped. This contains tiles from different HiPS surveys which are used&lt;/span&gt;
&lt;span class="gi"&gt;+by the drawing module. After this, the ``HIPS_EXTRA`` environment variable must&lt;/span&gt;
&lt;span class="gi"&gt;+be set up on their system. On UNIX operating systems, this can be set using&lt;/span&gt;
&lt;span class="gi"&gt;+``export HIPS_EXTRA=path/to/hips-extra``.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 Want to contribute to the ``hips`` package?

 Great! Talk to us by filing a Github issue any time
&lt;span class="gh"&gt;diff --git a/docs/installation.rst b/docs/installation.rst&lt;/span&gt;
&lt;span class="gh"&gt;index 094aeeb..2e33e82 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/installation.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/installation.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -80,6 +80,10 @@ To check if there are any issues with your installation, you can run the tests:&lt;/span&gt;

     python -c 'import hips; hips.test()'

&lt;span class="gi"&gt;+.. note::&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    For more information, see the :ref:`develop` page.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 Development version
 ===================


commit 8add0250a612c22b9a5ecb5dbd4ce9e4a9369f89
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 22 18:01:32 2017 +0500

    Add function make_sky_image

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 362127d..3dc8f05 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,5 +1,23 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 """HiPS tile drawing -- simple method."""

&lt;span class="gi"&gt;+import healpy as hp&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from ..tiles import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+from ..tiles import HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+from ..tiles import HipsTileMeta&lt;/span&gt;
&lt;span class="gi"&gt;+from ..utils import WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+from ..utils import compute_healpix_pixel_indices&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 __all__ = [
&lt;span class="gi"&gt;+    'make_sky_image'&lt;/span&gt;
 ]
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def make_sky_image(geometry: WCSGeometry, hips_survey: HipsSurveyProperties):&lt;/span&gt;
&lt;span class="gi"&gt;+    order = hips_survey.hips_order&lt;/span&gt;
&lt;span class="gi"&gt;+    healpix_pixel_indices = compute_healpix_pixel_indices(geometry, order)&lt;/span&gt;
&lt;span class="gi"&gt;+    tiles = list()&lt;/span&gt;
&lt;span class="gi"&gt;+    for healpix_pixel_index in healpix_pixel_indices:&lt;/span&gt;
&lt;span class="gi"&gt;+        tile_meta = HipsTileMeta(order=order, ipix=healpix_pixel_index, file_format='jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+        tiles.append(HipsTile(tile_meta))&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/draw/tests/test_simple.py b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 9dce85d..9f8d838 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/tests/test_simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1 +1,21 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.tests.helper import remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from hips.tiles import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+from hips.utils import WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+from ..simple import make_sky_image&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+@remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+def test_make_sky_image():&lt;/span&gt;
&lt;span class="gi"&gt;+    url = 'https://raw.githubusercontent.com/hipspy/hips/master/hips/tiles/tests/data/properties.txt'&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_survey = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    shape = (1000, 2000)&lt;/span&gt;
&lt;span class="gi"&gt;+    y_center, x_center = shape[0] / 2, shape[1] / 2&lt;/span&gt;
&lt;span class="gi"&gt;+    skycoord = SkyCoord(0, 0, unit="deg")&lt;/span&gt;
&lt;span class="gi"&gt;+    wcs_geometry = WCSGeometry.create(skydir=skycoord, shape=shape, coordsys='CEL', projection='AIT', cdelt=0.01,&lt;/span&gt;
&lt;span class="gi"&gt;+                                      crpix=(y_center, x_center))&lt;/span&gt;
&lt;span class="gi"&gt;+    make_sky_image(wcs_geometry, hips_survey)&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 63f1cd7..4f89897 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -8,6 +8,7 @@ from typing import Tuple&lt;/span&gt;
 import numpy as np
 from astropy.coordinates import SkyCoord
 import healpy as hp
&lt;span class="gi"&gt;+&lt;/span&gt;
 from .wcs import WCSGeometry

 __all__ = [
&lt;span class="gu"&gt;@@ -68,7 +69,7 @@ def boundaries(nside: int, pix: int, nest: bool = True) -&amp;gt; tuple:&lt;/span&gt;
     return theta, phi


&lt;span class="gd"&gt;-def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, nside: int) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, order: int) -&amp;gt; np.ndarray:&lt;/span&gt;
     """Compute HEALPix pixels within a minimal disk covering a given WCSGeometry.

     This function calls `healpy.pixelfunc.ang2vec` and `healpy.query_disc`
&lt;span class="gu"&gt;@@ -78,8 +79,8 @@ def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, nside: int) -&amp;gt; np.n&lt;/span&gt;
     ----------
     wcs_geometry : WCSGeometry
         Container for WCS object and image shape
&lt;span class="gd"&gt;-    nside : int&lt;/span&gt;
&lt;span class="gd"&gt;-        The nside of the HEALPix map&lt;/span&gt;
&lt;span class="gi"&gt;+    order : int&lt;/span&gt;
&lt;span class="gi"&gt;+        The order of the HEALPix&lt;/span&gt;

     Returns
     -------
&lt;span class="gu"&gt;@@ -89,7 +90,6 @@ def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, nside: int) -&amp;gt; np.n&lt;/span&gt;
     Examples
     --------
     &amp;gt;&amp;gt;&amp;gt; from astropy.coordinates import SkyCoord
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; import healpy as hp&lt;/span&gt;
     &amp;gt;&amp;gt;&amp;gt; from hips.utils import WCSGeometry
     &amp;gt;&amp;gt;&amp;gt; from hips.utils import compute_healpix_pixel_indices
     &amp;gt;&amp;gt;&amp;gt; skycoord = SkyCoord(10, 20, unit="deg")
&lt;span class="gu"&gt;@@ -98,8 +98,7 @@ def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, nside: int) -&amp;gt; np.n&lt;/span&gt;
     ...     coordsys='CEL', projection='AIT',
     ...     cdelt=1.0, crpix=(1., 1.),
     ... )
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; nside = hp.order2nside(order=3)&lt;/span&gt;
&lt;span class="gd"&gt;-    &amp;gt;&amp;gt;&amp;gt; compute_healpix_pixel_indices(wcs_geometry, nside)&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;gt;&amp;gt;&amp;gt; compute_healpix_pixel_indices(wcs_geometry, order=3)&lt;/span&gt;
     array([176, 207, 208, 239, 240, 271, 272])
     """
     center_coord = wcs_geometry.center_skycoord
&lt;span class="gu"&gt;@@ -108,5 +107,5 @@ def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, nside: int) -&amp;gt; np.n&lt;/span&gt;
     radius = np.nanmax(separation.rad)

     vec = _skycoord_to_vec(center_coord)
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+    nside = hp.order2nside(order)&lt;/span&gt;
     return hp.query_disc(nside, vec, radius)
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 0fc0267..864eadb 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -23,6 +23,5 @@ def test_boundaries():&lt;/span&gt;

 def test_compute_healpix_pixel_indices():
     wcs_geometry = make_test_wcs_geometry(case=1)
&lt;span class="gd"&gt;-    nside = hp.order2nside(order=3)&lt;/span&gt;
&lt;span class="gd"&gt;-    pixels = compute_healpix_pixel_indices(wcs_geometry, nside)&lt;/span&gt;
&lt;span class="gi"&gt;+    pixels = compute_healpix_pixel_indices(wcs_geometry, order=3)&lt;/span&gt;
     assert_allclose(pixels, [176, 207, 208, 239, 240, 271, 272])

commit 449e4df92ed21259d527e9b2fb325ae708e46045
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jun 19 18:05:07 2017 +0500

    Add class HipsSurveyList for parsing list of hips surveys

&lt;span class="gh"&gt;diff --git a/hips/tiles/description.py b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gh"&gt;index 86ccfae..2062836 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,26 +1,34 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gi"&gt;+import urllib.request&lt;/span&gt;
 from collections import OrderedDict

 __all__ = [
&lt;span class="gd"&gt;-    'HipsDescription',&lt;/span&gt;
&lt;span class="gi"&gt;+    'HipsSurveyProperties',&lt;/span&gt;
 ]


&lt;span class="gd"&gt;-class HipsDescription:&lt;/span&gt;
&lt;span class="gi"&gt;+class HipsSurveyProperties:&lt;/span&gt;
     """HiPS properties container.

     Parameters
     ----------
     properties : `~collections.OrderedDict`
&lt;span class="gd"&gt;-        HiPS description properties&lt;/span&gt;
&lt;span class="gi"&gt;+        HiPS survey properties&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Examples&lt;/span&gt;
&lt;span class="gi"&gt;+    --------&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; url = 'https://raw.githubusercontent.com/hipspy/hips/master/hips/tiles/tests/data/properties.txt'&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_survey_property = HipsSurveyProperties.fetch(url)&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_survey_property.base_url&lt;/span&gt;
&lt;span class="gi"&gt;+        'http://alasky.u-strasbg.fr/DSS/DSSColor'&lt;/span&gt;
     """

     def __init__(self, properties: OrderedDict) -&amp;gt; None:
         self.properties = properties

     @classmethod
&lt;span class="gd"&gt;-    def read(cls, filename: str) -&amp;gt; 'HipsDescription':&lt;/span&gt;
&lt;span class="gd"&gt;-        """Read from HiPS description file (`HipsDescription`).&lt;/span&gt;
&lt;span class="gi"&gt;+    def read(cls, filename: str) -&amp;gt; 'HipsSurveyProperties':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Read from HiPS survey description file (`HipsSurveyProperties`).&lt;/span&gt;

         Parameters
         ----------
&lt;span class="gu"&gt;@@ -33,20 +41,33 @@ class HipsDescription:&lt;/span&gt;
         return cls.parse(text)

     @classmethod
&lt;span class="gd"&gt;-    def parse(cls, text: str) -&amp;gt; 'HipsDescription':&lt;/span&gt;
&lt;span class="gd"&gt;-        """Parse HiPS description text (`HipsDescription`).&lt;/span&gt;
&lt;span class="gi"&gt;+    def fetch(cls, url: str) -&amp;gt; 'HipsSurveyProperties':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Read from HiPS survey description file from remote URL (`HipsSurveyProperties`).&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        url : str&lt;/span&gt;
&lt;span class="gi"&gt;+            URL containing HiPS properties&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        response = urllib.request.urlopen(url).read()&lt;/span&gt;
&lt;span class="gi"&gt;+        text = response.decode('utf-8')&lt;/span&gt;
&lt;span class="gi"&gt;+        return cls.parse(text)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def parse(cls, text: str) -&amp;gt; 'HipsSurveyProperties':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Parse HiPS survey description text (`HipsSurveyProperties`).&lt;/span&gt;

         Parameters
         ----------
         text : str
&lt;span class="gd"&gt;-            HiPS properties text&lt;/span&gt;
&lt;span class="gi"&gt;+            Text containing HiPS survey properties&lt;/span&gt;
         """
         properties = OrderedDict()
         for line in text.split('\n'):
             # Skip empty or comment lines
             if line == '' or line.startswith('#'):
                 continue
&lt;span class="gd"&gt;-&lt;/span&gt;
             try:
                 key, value = [_.strip() for _ in line.split('=')]
                 properties[key] = value
&lt;span class="gh"&gt;diff --git a/hips/tiles/surveys.py b/hips/tiles/surveys.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..511dca5&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,70 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+import urllib.request&lt;/span&gt;
&lt;span class="gi"&gt;+from typing import List&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.table import Table&lt;/span&gt;
&lt;span class="gi"&gt;+from collections import OrderedDict&lt;/span&gt;
&lt;span class="gi"&gt;+from .description import HipsSurveyProperties&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+__all__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'HipsSurveyPropertiesList',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class HipsSurveyPropertiesList:&lt;/span&gt;
&lt;span class="gi"&gt;+    """HiPS survey container.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    surveys : List[HipsSurveyProperties]&lt;/span&gt;
&lt;span class="gi"&gt;+        HiPS surveys&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, surveys: List[HipsSurveyProperties]) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.surveys = surveys&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def read(cls, filename: str) -&amp;gt; 'HipsSurveyPropertiesList':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Read HiPS list from file (`HipsSurveyPropertiesList`).&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        filename : str&lt;/span&gt;
&lt;span class="gi"&gt;+            HiPS list filename&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        with open(filename, encoding='utf-8', errors='ignore') as fh:&lt;/span&gt;
&lt;span class="gi"&gt;+            text = fh.read()&lt;/span&gt;
&lt;span class="gi"&gt;+        return cls.parse(text)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def fetch(cls, url: str='http://alasky.unistra.fr/MocServer/query?hips_service_url=*&amp;amp;dataproduct_type=!catalog&amp;amp;dataproduct_type=!cube&amp;amp;get=record') -&amp;gt; 'HipsSurveyPropertiesList':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Fetch HiPS list text from remote location (`HipsSurveyPropertiesList`).&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        url : str&lt;/span&gt;
&lt;span class="gi"&gt;+            HiPS list URL&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        response = urllib.request.urlopen(url).read()&lt;/span&gt;
&lt;span class="gi"&gt;+        text = str(response)&lt;/span&gt;
&lt;span class="gi"&gt;+        return cls.parse(text)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def parse(cls, text: str) -&amp;gt; 'HipsSurveyPropertiesList':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Parse HiPS list text (`HipsSurveyPropertiesList`).&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        text : str&lt;/span&gt;
&lt;span class="gi"&gt;+            HiPS list text&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        surveys = list()&lt;/span&gt;
&lt;span class="gi"&gt;+        for raw_survey in text.split('\n\n'):&lt;/span&gt;
&lt;span class="gi"&gt;+            surveys.append(HipsSurveyProperties.parse(raw_survey))&lt;/span&gt;
&lt;span class="gi"&gt;+        return cls(surveys)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def table(self) -&amp;gt; Table:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Astropy Table containing HiPS surveys (`HipsSurveyPropertiesList`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        table = Table()&lt;/span&gt;
&lt;span class="gi"&gt;+        table['surveys'] = [survey.properties for survey in self.surveys]&lt;/span&gt;
&lt;span class="gi"&gt;+        return table&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/data/surveys.txt b/hips/tiles/tests/data/surveys.txt&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..876234c&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/data/surveys.txt&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,202 @@&lt;/span&gt;
&lt;span class="gi"&gt;+ID                   = CDS/C/MUSE-M42&lt;/span&gt;
&lt;span class="gi"&gt;+creator_did          = ivo://CDS/C/MUSE-M42&lt;/span&gt;
&lt;span class="gi"&gt;+obs_collection       = MUSE-M42&lt;/span&gt;
&lt;span class="gi"&gt;+obs_title            = MUSE map of the central Orion Nebula (M 42)&lt;/span&gt;
&lt;span class="gi"&gt;+obs_description      = Integral-field spectroscopic dataset of the central part of the Orion Nebula (M 42), observed with the MUSE instrument at the ESO VLT (reduced the data with the public MUSE pipeline) representing a FITS cube with a spatial size of ~5.9'x4.9' (corresponding to ~0.76 pc x 0.63 pc) and a contiguous wavelength coverage of 4595...9366 Angstrom, spatially sampled at 0.2", with a sampling of 1.25 Angstrom in dispersion direction.&lt;/span&gt;
&lt;span class="gi"&gt;+obs_ack              = Based on data obtained from the ESO/VLT&lt;/span&gt;
&lt;span class="gi"&gt;+prov_progenitor      = MUSE Consortium&lt;/span&gt;
&lt;span class="gi"&gt;+bib_reference        = 2015A&amp;amp;A...582A.114W&lt;/span&gt;
&lt;span class="gi"&gt;+bib_reference_url    = http://simbad.u-strasbg.fr/simbad/sim-ref?bibcode=2015A%26A...582A.114W&lt;/span&gt;
&lt;span class="gi"&gt;+obs_copyright        = Copyright mention of the original data&lt;/span&gt;
&lt;span class="gi"&gt;+obs_copyright_url    = http://muse-vlt.eu/science/m42/&lt;/span&gt;
&lt;span class="gi"&gt;+hips_release_date    = 2015-07-07T00:29Z&lt;/span&gt;
&lt;span class="gi"&gt;+hips_builder         = Aladin/HipsGen v9.505&lt;/span&gt;
&lt;span class="gi"&gt;+hips_order           = 12&lt;/span&gt;
&lt;span class="gi"&gt;+hips_pixel_cut       = 0 7760&lt;/span&gt;
&lt;span class="gi"&gt;+hips_tile_format     = png fits&lt;/span&gt;
&lt;span class="gi"&gt;+hips_cube_depth      = 3818&lt;/span&gt;
&lt;span class="gi"&gt;+hips_cube_firstframe  = 1909&lt;/span&gt;
&lt;span class="gi"&gt;+hips_frame           = equatorial&lt;/span&gt;
&lt;span class="gi"&gt;+dataproduct_type     = image&lt;/span&gt;
&lt;span class="gi"&gt;+t_min                = 56693&lt;/span&gt;
&lt;span class="gi"&gt;+t_max                = 56704&lt;/span&gt;
&lt;span class="gi"&gt;+em_min               = 4,595e-7&lt;/span&gt;
&lt;span class="gi"&gt;+em_max               = 9,366e-7&lt;/span&gt;
&lt;span class="gi"&gt;+hips_version         = 1.31&lt;/span&gt;
&lt;span class="gi"&gt;+hips_creation_date   = 03/07/15 12:00:30&lt;/span&gt;
&lt;span class="gi"&gt;+hips_creator         = CDS (P.Fernique)&lt;/span&gt;
&lt;span class="gi"&gt;+hips_tile_width      = 512&lt;/span&gt;
&lt;span class="gi"&gt;+hips_status          = public master clonableOnce&lt;/span&gt;
&lt;span class="gi"&gt;+hips_pixel_bitpix    = -32&lt;/span&gt;
&lt;span class="gi"&gt;+data_pixel_bitpix    = -32&lt;/span&gt;
&lt;span class="gi"&gt;+hips_hierarchy       = mean&lt;/span&gt;
&lt;span class="gi"&gt;+hips_initial_ra      = 83.82094&lt;/span&gt;
&lt;span class="gi"&gt;+hips_initial_dec     = -5.39542&lt;/span&gt;
&lt;span class="gi"&gt;+hips_initial_fov     = 0.09811&lt;/span&gt;
&lt;span class="gi"&gt;+hips_pixel_scale     = 2.795E-5&lt;/span&gt;
&lt;span class="gi"&gt;+s_pixel_scale        = 5.555E-5&lt;/span&gt;
&lt;span class="gi"&gt;+moc_sky_fraction     = 2.980E-7&lt;/span&gt;
&lt;span class="gi"&gt;+hips_estsize         = 87653&lt;/span&gt;
&lt;span class="gi"&gt;+data_bunit           = 10**(-20)*erg/s/cm**2/Angstrom&lt;/span&gt;
&lt;span class="gi"&gt;+data_cube_crpix3     = 1&lt;/span&gt;
&lt;span class="gi"&gt;+data_cube_crval3     = 4595&lt;/span&gt;
&lt;span class="gi"&gt;+data_cube_cdelt3     = 1.25&lt;/span&gt;
&lt;span class="gi"&gt;+data_cube_bunit3     = Angstrom&lt;/span&gt;
&lt;span class="gi"&gt;+client_application   = AladinDesktopBeta&lt;/span&gt;
&lt;span class="gi"&gt;+client_application   = AladinDesktop&lt;/span&gt;
&lt;span class="gi"&gt;+hips_copyright       = CNRS/Unistra&lt;/span&gt;
&lt;span class="gi"&gt;+obs_regime           = Optical&lt;/span&gt;
&lt;span class="gi"&gt;+hips_service_url     = http://alasky.unistra.fr/MUSE/MUSE-M42&lt;/span&gt;
&lt;span class="gi"&gt;+hips_service_url_1   = http://alaskybis.unistra.fr/MUSE/MUSE-M42&lt;/span&gt;
&lt;span class="gi"&gt;+hips_status_1        = public mirror clonable&lt;/span&gt;
&lt;span class="gi"&gt;+hips_service_url_2   = https://alaskybis.unistra.fr/MUSE/MUSE-M42&lt;/span&gt;
&lt;span class="gi"&gt;+hips_status_2        = public mirror clonable&lt;/span&gt;
&lt;span class="gi"&gt;+moc_order            = 12&lt;/span&gt;
&lt;span class="gi"&gt;+obs_initial_ra       = 83.82094&lt;/span&gt;
&lt;span class="gi"&gt;+obs_initial_dec      = -5.39542&lt;/span&gt;
&lt;span class="gi"&gt;+obs_initial_fov      = 0.014314526715905856&lt;/span&gt;
&lt;span class="gi"&gt;+TIMESTAMP            = 1490387811000&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+ID                   = CDS/P/2MASS/H&lt;/span&gt;
&lt;span class="gi"&gt;+creator_did          = ivo://CDS/P/2MASS/H&lt;/span&gt;
&lt;span class="gi"&gt;+obs_collection       = The Two Micron All Sky Survey - H band (2MASS H)&lt;/span&gt;
&lt;span class="gi"&gt;+obs_title            = 2MASS H (1.66 microns)&lt;/span&gt;
&lt;span class="gi"&gt;+obs_description      = 2MASS has uniformly scanned the entire sky in three near-infrared bands to detect and characterize point sources brighter than about 1 mJy in each band, with signal-to-noise ratio (SNR) greater than 10, using a pixel size of 2.0". This has achieved an 80,000-fold improvement in sensitivity relative to earlier surveys. 2MASS used two highly-automated 1.3-m telescopes, one at Mt. Hopkins, AZ, and one at CTIO, Chile. Each telescope was equipped with a three-channel camera, each channel consisting of a 256x256 array of HgCdTe detectors, capable of observing the sky simultaneously at J (1.25 microns), H (1.65 microns), and Ks (2.17 microns). The University of Massachusetts (UMass) was responsible for the overall management of the project, and for developing the infrared cameras and on-site computing systems at both facilities. The Infrared Processing and Analysis Center (IPAC) is responsible for all data processing through the Production Pipeline, and construction and distribution of the data products. Funding is provided primarily by NASA and the NSF&lt;/span&gt;
&lt;span class="gi"&gt;+obs_copyright_url    = http://www.ipac.caltech.edu/2mass/&lt;/span&gt;
&lt;span class="gi"&gt;+prov_progenitor      = IPAC/NASA&lt;/span&gt;
&lt;span class="gi"&gt;+client_category      = Image/Infrared/2MASS&lt;/span&gt;
&lt;span class="gi"&gt;+client_sort_key      = 04-001-03&lt;/span&gt;
&lt;span class="gi"&gt;+hips_creation_date   = 2013-05-06T20:36Z&lt;/span&gt;
&lt;span class="gi"&gt;+hips_release_date    = 2016-04-22T13:48Z&lt;/span&gt;
&lt;span class="gi"&gt;+hips_builder         = Aladin/HipsGen v9.017&lt;/span&gt;
&lt;span class="gi"&gt;+hips_creator         = CDS (A.Oberto)&lt;/span&gt;
&lt;span class="gi"&gt;+hips_version         = 1.31&lt;/span&gt;
&lt;span class="gi"&gt;+hips_order           = 9&lt;/span&gt;
&lt;span class="gi"&gt;+hips_frame           = equatorial&lt;/span&gt;
&lt;span class="gi"&gt;+hips_tile_width      = 512&lt;/span&gt;
&lt;span class="gi"&gt;+hips_tile_format     = jpeg fits&lt;/span&gt;
&lt;span class="gi"&gt;+dataproduct_type     = image&lt;/span&gt;
&lt;span class="gi"&gt;+hips_pixel_cut       = 0 60&lt;/span&gt;
&lt;span class="gi"&gt;+moc_access_url       = http://alasky.u-strasbg.fr/2MASS/H/Moc.fits&lt;/span&gt;
&lt;span class="gi"&gt;+hips_service_url     = http://alasky.unistra.fr/2MASS/H&lt;/span&gt;
&lt;span class="gi"&gt;+hips_status          = public master clonableOnce&lt;/span&gt;
&lt;span class="gi"&gt;+hips_copyright       = CNRS/Unistra&lt;/span&gt;
&lt;span class="gi"&gt;+obs_ack              = University of Massachusetts &amp;amp; IPAC/Caltech&lt;/span&gt;
&lt;span class="gi"&gt;+bib_reference        = 2006AJ....131.1163S&lt;/span&gt;
&lt;span class="gi"&gt;+bib_reference_url    = http://cdsbib.u-strasbg.fr/cgi-bin/cdsbib?2006AJ....131.1163S&lt;/span&gt;
&lt;span class="gi"&gt;+obs_copyright        = University of Massachusetts &amp;amp; IPAC/Caltech&lt;/span&gt;
&lt;span class="gi"&gt;+t_min                = 50600&lt;/span&gt;
&lt;span class="gi"&gt;+t_max                = 51941&lt;/span&gt;
&lt;span class="gi"&gt;+obs_regime           = Infrared&lt;/span&gt;
&lt;span class="gi"&gt;+em_min               = 1.525E-6&lt;/span&gt;
&lt;span class="gi"&gt;+em_max               = 1.798E-6&lt;/span&gt;
&lt;span class="gi"&gt;+hips_hierarchy       = mean&lt;/span&gt;
&lt;span class="gi"&gt;+hips_pixel_scale     = 2.236E-4&lt;/span&gt;
&lt;span class="gi"&gt;+hips_service_url_1   = http://alaskybis.unistra.fr/2MASS/H&lt;/span&gt;
&lt;span class="gi"&gt;+hips_status_1        = public mirror clonableOnce&lt;/span&gt;
&lt;span class="gi"&gt;+hips_service_url_2   = https://alaskybis.unistra.fr/2MASS/H&lt;/span&gt;
&lt;span class="gi"&gt;+hips_status_2        = public mirror clonableOnce&lt;/span&gt;
&lt;span class="gi"&gt;+moc_sky_fraction     = 1&lt;/span&gt;
&lt;span class="gi"&gt;+moc_order            = 9&lt;/span&gt;
&lt;span class="gi"&gt;+obs_initial_ra       = 0&lt;/span&gt;
&lt;span class="gi"&gt;+obs_initial_dec      = +0&lt;/span&gt;
&lt;span class="gi"&gt;+obs_initial_fov      = 0.11451621372724685&lt;/span&gt;
&lt;span class="gi"&gt;+client_application   = AladinDesktop&lt;/span&gt;
&lt;span class="gi"&gt;+TIMESTAMP            = 1490028262000&lt;/span&gt;
&lt;span class="gi"&gt;+# a test comment&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+ID                   = CDS/P/2MASS/J&lt;/span&gt;
&lt;span class="gi"&gt;+creator_did          = ivo://CDS/P/2MASS/J&lt;/span&gt;
&lt;span class="gi"&gt;+obs_collection       = The Two Micron All Sky Survey - J band (2MASS J)&lt;/span&gt;
&lt;span class="gi"&gt;+obs_title            = 2MASS J (1.23 microns)&lt;/span&gt;
&lt;span class="gi"&gt;+obs_description      = 2MASS has uniformly scanned the entire sky in three near-infrared bands to detect and characterize point sources brighter than about 1 mJy in each band, with signal-to-noise ratio (SNR) greater than 10, using a pixel size of 2.0". This has achieved an 80,000-fold improvement in sensitivity relative to earlier surveys. 2MASS used two highly-automated 1.3-m telescopes, one at Mt. Hopkins, AZ, and one at CTIO, Chile. Each telescope was equipped with a three-channel camera, each channel consisting of a 256x256 array of HgCdTe detectors, capable of observing the sky simultaneously at J (1.25 microns), H (1.65 microns), and Ks (2.17 microns). The University of Massachusetts (UMass) was responsible for the overall management of the project, and for developing the infrared cameras and on-site computing systems at both facilities. The Infrared Processing and Analysis Center (IPAC) is responsible for all data processing through the Production Pipeline, and construction and distribution of the data products. Funding is provided primarily by NASA and the NSF&lt;/span&gt;
&lt;span class="gi"&gt;+obs_copyright_url    = http://www.ipac.caltech.edu/2mass/&lt;/span&gt;
&lt;span class="gi"&gt;+prov_progenitor      = IPAC/NASA&lt;/span&gt;
&lt;span class="gi"&gt;+client_category      = Image/Infrared/2MASS&lt;/span&gt;
&lt;span class="gi"&gt;+client_sort_key      = 04-001-02&lt;/span&gt;
&lt;span class="gi"&gt;+hips_creation_date   = 2014-02-11T11:28Z&lt;/span&gt;
&lt;span class="gi"&gt;+hips_release_date    = 2016-04-22T14:03Z&lt;/span&gt;
&lt;span class="gi"&gt;+hips_builder         = Aladin/HipsGen v9.017&lt;/span&gt;
&lt;span class="gi"&gt;+hips_creator         = CDS (A.Oberto)&lt;/span&gt;
&lt;span class="gi"&gt;+hips_version         = 1.31&lt;/span&gt;
&lt;span class="gi"&gt;+hips_order           = 9&lt;/span&gt;
&lt;span class="gi"&gt;+hips_frame           = equatorial&lt;/span&gt;
&lt;span class="gi"&gt;+hips_tile_width      = 512&lt;/span&gt;
&lt;span class="gi"&gt;+hips_tile_format     = jpeg fits&lt;/span&gt;
&lt;span class="gi"&gt;+dataproduct_type     = image&lt;/span&gt;
&lt;span class="gi"&gt;+hips_pixel_cut       = -1 116&lt;/span&gt;
&lt;span class="gi"&gt;+moc_access_url       = http://alasky.u-strasbg.fr/2MASS/J/Moc.fits&lt;/span&gt;
&lt;span class="gi"&gt;+hips_service_url     = http://alasky.unistra.fr/2MASS/J&lt;/span&gt;
&lt;span class="gi"&gt;+hips_status          = public master clonableOnce&lt;/span&gt;
&lt;span class="gi"&gt;+hips_copyright       = CNRS/Unistra&lt;/span&gt;
&lt;span class="gi"&gt;+obs_ack              = University of Massachusetts &amp;amp; IPAC/Caltech&lt;/span&gt;
&lt;span class="gi"&gt;+bib_reference        = 2006AJ....131.1163S&lt;/span&gt;
&lt;span class="gi"&gt;+bib_reference_url    = http://cdsbib.u-strasbg.fr/cgi-bin/cdsbib?2006AJ....131.1163S&lt;/span&gt;
&lt;span class="gi"&gt;+obs_copyright        = University of Massachusetts &amp;amp; IPAC/Caltech&lt;/span&gt;
&lt;span class="gi"&gt;+t_min                = 50600&lt;/span&gt;
&lt;span class="gi"&gt;+t_max                = 51941&lt;/span&gt;
&lt;span class="gi"&gt;+obs_regime           = Infrared&lt;/span&gt;
&lt;span class="gi"&gt;+em_min               = 1.147E-6&lt;/span&gt;
&lt;span class="gi"&gt;+em_max               = 1.323E-6&lt;/span&gt;
&lt;span class="gi"&gt;+hips_hierarchy       = mean&lt;/span&gt;
&lt;span class="gi"&gt;+hips_pixel_scale     = 2.236E-4&lt;/span&gt;
&lt;span class="gi"&gt;+hips_progenitor_url  = http://alasky.unistra.fr/2MASS/J/HpxFinder&lt;/span&gt;
&lt;span class="gi"&gt;+hips_service_url_1   = http://alaskybis.unistra.fr/2MASS/J&lt;/span&gt;
&lt;span class="gi"&gt;+hips_status_1        = public mirror clonableOnce&lt;/span&gt;
&lt;span class="gi"&gt;+hips_service_url_2   = https://alaskybis.unistra.fr/2MASS/J&lt;/span&gt;
&lt;span class="gi"&gt;+hips_status_2        = public mirror clonableOnce&lt;/span&gt;
&lt;span class="gi"&gt;+moc_sky_fraction     = 1&lt;/span&gt;
&lt;span class="gi"&gt;+moc_order            = 29&lt;/span&gt;
&lt;span class="gi"&gt;+obs_initial_ra       = 0&lt;/span&gt;
&lt;span class="gi"&gt;+obs_initial_dec      = +0&lt;/span&gt;
&lt;span class="gi"&gt;+obs_initial_fov      = 1.0921117184376416E-7&lt;/span&gt;
&lt;span class="gi"&gt;+client_application   = AladinDesktop&lt;/span&gt;
&lt;span class="gi"&gt;+TIMESTAMP            = 1491570319000&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+ID                   = CDS/P/2MASS/K&lt;/span&gt;
&lt;span class="gi"&gt;+creator_did          = ivo://CDS/P/2MASS/K&lt;/span&gt;
&lt;span class="gi"&gt;+obs_collection       = The Two Micron All Sky Survey - K band (2MASS K)&lt;/span&gt;
&lt;span class="gi"&gt;+obs_title            = 2MASS K (2.16 microns)&lt;/span&gt;
&lt;span class="gi"&gt;+obs_description      = 2MASS has uniformly scanned the entire sky in three near-infrared bands to detect and characterize point sources brighter than about 1 mJy in each band, with signal-to-noise ratio (SNR) greater than 10, using a pixel size of 2.0". This has achieved an 80,000-fold improvement in sensitivity relative to earlier surveys. 2MASS used two highly-automated 1.3-m telescopes, one at Mt. Hopkins, AZ, and one at CTIO, Chile. Each telescope was equipped with a three-channel camera, each channel consisting of a 256x256 array of HgCdTe detectors, capable of observing the sky simultaneously at J (1.25 microns), H (1.65 microns), and Ks (2.17 microns). The University of Massachusetts (UMass) was responsible for the overall management of the project, and for developing the infrared cameras and on-site computing systems at both facilities. The Infrared Processing and Analysis Center (IPAC) is responsible for all data processing through the Production Pipeline, and construction and distribution of the data products. Funding is provided primarily by NASA and the NSF&lt;/span&gt;
&lt;span class="gi"&gt;+obs_copyright_url    = http://www.ipac.caltech.edu/2mass/&lt;/span&gt;
&lt;span class="gi"&gt;+prov_progenitor      = IPAC/NASA&lt;/span&gt;
&lt;span class="gi"&gt;+client_category      = Image/Infrared/2MASS&lt;/span&gt;
&lt;span class="gi"&gt;+client_sort_key      = 04-001-04&lt;/span&gt;
&lt;span class="gi"&gt;+hips_creation_date   = 2013-01-14T09:45Z&lt;/span&gt;
&lt;span class="gi"&gt;+hips_release_date    = 2016-04-22T14:23Z&lt;/span&gt;
&lt;span class="gi"&gt;+hips_builder         = Aladin/HipsGen v9.017&lt;/span&gt;
&lt;span class="gi"&gt;+hips_creator         = CDS (A.Oberto)&lt;/span&gt;
&lt;span class="gi"&gt;+hips_version         = 1.31&lt;/span&gt;
&lt;span class="gi"&gt;+hips_order           = 9&lt;/span&gt;
&lt;span class="gi"&gt;+hips_frame           = equatorial&lt;/span&gt;
&lt;span class="gi"&gt;+hips_tile_width      = 512&lt;/span&gt;
&lt;span class="gi"&gt;+hips_tile_format     = jpeg fits&lt;/span&gt;
&lt;span class="gi"&gt;+dataproduct_type     = image&lt;/span&gt;
&lt;span class="gi"&gt;+hips_pixel_cut       = -2 35&lt;/span&gt;
&lt;span class="gi"&gt;+moc_access_url       = http://alasky.u-strasbg.fr/2MASS/K/Moc.fits&lt;/span&gt;
&lt;span class="gi"&gt;+hips_service_url     = http://alasky.unistra.fr/2MASS/K&lt;/span&gt;
&lt;span class="gi"&gt;+hips_status          = public master clonableOnce&lt;/span&gt;
&lt;span class="gi"&gt;+hips_copyright       = CNRS/Unistra&lt;/span&gt;
&lt;span class="gi"&gt;+obs_ack              = University of Massachusetts &amp;amp; IPAC/Caltech&lt;/span&gt;
&lt;span class="gi"&gt;+bib_reference        = 2006AJ....131.1163S&lt;/span&gt;
&lt;span class="gi"&gt;+bib_reference_url    = http://cdsbib.u-strasbg.fr/cgi-bin/cdsbib?2006AJ....131.1163S&lt;/span&gt;
&lt;span class="gi"&gt;+obs_copyright        = University of Massachusetts &amp;amp; IPAC/Caltech&lt;/span&gt;
&lt;span class="gi"&gt;+t_min                = 50600&lt;/span&gt;
&lt;span class="gi"&gt;+t_max                = 51941&lt;/span&gt;
&lt;span class="gi"&gt;+obs_regime           = Infrared&lt;/span&gt;
&lt;span class="gi"&gt;+em_min               = 2.015E-6&lt;/span&gt;
&lt;span class="gi"&gt;+em_max               = 2.303E-6&lt;/span&gt;
&lt;span class="gi"&gt;+hips_hierarchy       = mean&lt;/span&gt;
&lt;span class="gi"&gt;+hips_pixel_scale     = 2.236E-4&lt;/span&gt;
&lt;span class="gi"&gt;+hips_progenitor_url  = http://alasky.unistra.fr/2MASS/K/HpxFinder&lt;/span&gt;
&lt;span class="gi"&gt;+hips_service_url_1   = http://alaskybis.unistra.fr/2MASS/K&lt;/span&gt;
&lt;span class="gi"&gt;+hips_status_1        = public mirror clonableOnce&lt;/span&gt;
&lt;span class="gi"&gt;+hips_service_url_2   = https://alaskybis.unistra.fr/2MASS/K&lt;/span&gt;
&lt;span class="gi"&gt;+hips_status_2        = public mirror clonableOnce&lt;/span&gt;
&lt;span class="gi"&gt;+moc_sky_fraction     = 1&lt;/span&gt;
&lt;span class="gi"&gt;+moc_order            = 29&lt;/span&gt;
&lt;span class="gi"&gt;+obs_initial_ra       = 0&lt;/span&gt;
&lt;span class="gi"&gt;+obs_initial_dec      = +0&lt;/span&gt;
&lt;span class="gi"&gt;+obs_initial_fov      = 1.0921117184376416E-7&lt;/span&gt;
&lt;span class="gi"&gt;+client_application   = AladinDesktop&lt;/span&gt;
&lt;span class="gi"&gt;+TIMESTAMP            = 1491570319000&lt;/span&gt;
\ No newline at end of file
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_description.py b/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gh"&gt;index cd5c24b..b36aa02 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,28 +1,28 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 from astropy.utils.data import get_pkg_data_filename
&lt;span class="gd"&gt;-from ..description import HipsDescription&lt;/span&gt;
&lt;span class="gi"&gt;+from ..description import HipsSurveyProperties&lt;/span&gt;


&lt;span class="gd"&gt;-class TestHiPSDescription:&lt;/span&gt;
&lt;span class="gi"&gt;+class TestHipsSurveyProperties:&lt;/span&gt;
     @classmethod
     def setup_class(cls):
         filename = get_pkg_data_filename('data/properties.txt')
&lt;span class="gd"&gt;-        cls.hipsdescription = HipsDescription.read(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.hips_survey_property = HipsSurveyProperties.read(filename)&lt;/span&gt;

     def test_base_url(self):
&lt;span class="gd"&gt;-        assert self.hipsdescription.base_url == 'http://alasky.u-strasbg.fr/DSS/DSSColor'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_property.base_url == 'http://alasky.u-strasbg.fr/DSS/DSSColor'&lt;/span&gt;

     def test_title(self):
&lt;span class="gd"&gt;-        assert self.hipsdescription.title == 'DSS colored'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_property.title == 'DSS colored'&lt;/span&gt;

     def test_hips_version(self):
&lt;span class="gd"&gt;-        assert self.hipsdescription.hips_version == '1.31'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_property.hips_version == '1.31'&lt;/span&gt;

     def test_hips_frame(self):
&lt;span class="gd"&gt;-        assert self.hipsdescription.hips_frame == 'equatorial'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_property.hips_frame == 'equatorial'&lt;/span&gt;

     def test_hips_order(self):
&lt;span class="gd"&gt;-        assert self.hipsdescription.hips_order == 9&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_property.hips_order == 9&lt;/span&gt;

     def test_tile_format(self):
&lt;span class="gd"&gt;-        assert self.hipsdescription.tile_format == 'jpeg'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_property.tile_format == 'jpeg'&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_surveys.py b/hips/tiles/tests/test_surveys.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..99dd3d4&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_surveys.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,21 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.utils.data import get_pkg_data_filename&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.tests.helper import remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+from ..surveys import HipsSurveyPropertiesList&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class TestHipsSurveyPropertiesList:&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def setup_class(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        filename = get_pkg_data_filename('data/surveys.txt')&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.hips_survey_list = HipsSurveyPropertiesList.read(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_fetch(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        self.hips_survey_list.fetch()&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_surveys(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert len(self.hips_survey_list.surveys) == 4&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_list.surveys[0].properties['creator_did'] == 'ivo://CDS/C/MUSE-M42'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_list.surveys[0].properties['obs_collection'] == 'MUSE-M42'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_list.surveys[0].properties['hips_tile_format'] == 'png fits'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips_survey_list.table['surveys'][0]['hips_tile_format'] == 'png fits'&lt;/span&gt;

commit 0bdb052115291c0657841c6becf973cec2ff59d6
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 23 09:48:15 2017 +0500

    Fix type annotation issue

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 0764fe7..2fabf49 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -22,11 +22,11 @@ class TestHipsTile:&lt;/span&gt;
         assert jpg_tile.data.shape == (512, 512, 3)
         assert list(fits_tile.data[510][:12]) == data_precomp

&lt;span class="gd"&gt;-        jpg_tile.write('Npix30889.jpg', tmpdir)&lt;/span&gt;
&lt;span class="gd"&gt;-        fits_tile.write('Npix30889.fits', tmpdir)&lt;/span&gt;
&lt;span class="gi"&gt;+        jpg_tile.write('Npix30889.jpg', str(tmpdir / 'Npix30889.jpg'))&lt;/span&gt;
&lt;span class="gi"&gt;+        fits_tile.write('Npix30889.fits', str(tmpdir / 'Npix30889.fits'))&lt;/span&gt;

&lt;span class="gd"&gt;-        jpg_tile = HipsTile.read(self.hips_tile_meta_jpg, tmpdir)&lt;/span&gt;
&lt;span class="gd"&gt;-        fits_tile = HipsTile.read(self.hips_tile_meta_fits, tmpdir)&lt;/span&gt;
&lt;span class="gi"&gt;+        jpg_tile = HipsTile.read(self.hips_tile_meta_jpg, str(tmpdir / 'Npix30889.jpg'))&lt;/span&gt;
&lt;span class="gi"&gt;+        fits_tile = HipsTile.read(self.hips_tile_meta_fits, str(tmpdir / 'Npix30889.fits'))&lt;/span&gt;

         data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]
         assert fits_tile.data.shape == (512, 512)
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index c521df6..a6b846b 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -8,7 +8,7 @@ from astropy.io import fits&lt;/span&gt;
 from astropy.io.fits.header import Header

 from .tile_meta import HipsTileMeta
&lt;span class="gd"&gt;-import py._path.local&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 __all__ = [
     'HipsTile',
 ]
&lt;span class="gu"&gt;@@ -73,18 +73,20 @@ class HipsTile:&lt;/span&gt;
             return cls(meta, data)

     @classmethod
&lt;span class="gd"&gt;-    def read(cls, meta: HipsTileMeta, tmpdir: py._path.local = None) -&amp;gt; 'HipsTile':&lt;/span&gt;
&lt;span class="gi"&gt;+    def read(cls, meta: HipsTileMeta, file_path: str = None) -&amp;gt; 'HipsTile':&lt;/span&gt;
         """Read HiPS tile data from a directory and load into memory (`HipsTile`).

         Parameters
         ----------
         meta : `HipsTileMeta`
             Metadata of HiPS tile
&lt;span class="gi"&gt;+        file_path : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+            File path to store a HiPS tile&lt;/span&gt;
         """
&lt;span class="gd"&gt;-        if tmpdir == None:&lt;/span&gt;
&lt;span class="gd"&gt;-            path = meta.path / meta.filename&lt;/span&gt;
&lt;span class="gi"&gt;+        if file_path is None:&lt;/span&gt;
&lt;span class="gi"&gt;+            path = meta.path / meta.filename  # pragma: no cover&lt;/span&gt;
         else:
&lt;span class="gd"&gt;-            path = tmpdir / meta.filename&lt;/span&gt;
&lt;span class="gi"&gt;+            path = file_path&lt;/span&gt;

         if meta.file_format == 'fits':
             hdulist = fits.open(str(path))
&lt;span class="gu"&gt;@@ -95,18 +97,20 @@ class HipsTile:&lt;/span&gt;
             data = np.array(Image.open(str(path)))
             return cls(meta, data)

&lt;span class="gd"&gt;-    def write(self, filename: str, tmpdir: py._path.local = None) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def write(self, filename: str, file_path: str = None) -&amp;gt; None:&lt;/span&gt;
         """Write HiPS tile by a given filename.

         Parameters
         ----------
         filename : `str`
             Name of the file
&lt;span class="gi"&gt;+        file_path : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+            File path to store a HiPS tile&lt;/span&gt;
         """
&lt;span class="gd"&gt;-        if tmpdir == None:&lt;/span&gt;
&lt;span class="gd"&gt;-            path = self.meta.path / self.meta.filename&lt;/span&gt;
&lt;span class="gi"&gt;+        if file_path is None:&lt;/span&gt;
&lt;span class="gi"&gt;+            path = self.meta.path / self.meta.filename  # pragma: no cover&lt;/span&gt;
         else:
&lt;span class="gd"&gt;-            path = tmpdir / self.meta.filename&lt;/span&gt;
&lt;span class="gi"&gt;+            path = file_path&lt;/span&gt;

         if self.meta.file_format == 'fits':
             hdu = fits.PrimaryHDU(self.data, header=self.header).writeto(str(path))
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile_meta.py b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gh"&gt;index 3789609..0461b7d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -30,11 +30,11 @@ class HipsTileMeta:&lt;/span&gt;
         self.tile_width = tile_width

     @property
&lt;span class="gd"&gt;-    def path(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Return the default path for tile storage (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+    def path(self) -&amp;gt; Path:  # pragma: no cover&lt;/span&gt;
&lt;span class="gi"&gt;+        """Return the default path for tile storage (`Path`)."""&lt;/span&gt;
         return Path('hips', 'tiles', 'tests', 'data')

     @property
&lt;span class="gd"&gt;-    def filename(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+    def filename(self) -&amp;gt; str:  # pragma: no cover&lt;/span&gt;
         """Return the filename of HiPS tile (`str`)."""
         return ''.join(['Npix', str(self.ipix), '.', self.file_format])

commit 1136490773612a0601b06b5c8a644d728f0f659b
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 22 18:52:50 2017 +0500

    Update tiles.hips module

&lt;span class="gh"&gt;diff --git a/hips/tiles/__init__.py b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gh"&gt;index f6101be..2adbd76 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,4 +1,5 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 """Classes and functions to manage HiPS tiles."""
 from .tile import *
&lt;span class="gi"&gt;+from .tile_meta import *&lt;/span&gt;
 from .description import *
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index f27f1b9..0764fe7 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -7,11 +7,11 @@ from ..tile_meta import HipsTileMeta&lt;/span&gt;

 class TestHipsTile:
     def setup(self):
&lt;span class="gd"&gt;-        self.hips_tile_meta_fits = HipsTileMeta(order=6, ipix=30889, format='fits')&lt;/span&gt;
&lt;span class="gd"&gt;-        self.hips_tile_meta_jpg = HipsTileMeta(order=6, ipix=30889, format='jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+        self.hips_tile_meta_fits = HipsTileMeta(order=6, ipix=30889, file_format='fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        self.hips_tile_meta_jpg = HipsTileMeta(order=6, ipix=30889, file_format='jpg')&lt;/span&gt;

     @remote_data
&lt;span class="gd"&gt;-    def test_fetch_read_write(self):&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_fetch_read_write(self, tmpdir):&lt;/span&gt;
         fits_tile = HipsTile.fetch(self.hips_tile_meta_fits,
                                    'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.fits')
         jpg_tile = HipsTile.fetch(self.hips_tile_meta_jpg,
&lt;span class="gu"&gt;@@ -22,11 +22,11 @@ class TestHipsTile:&lt;/span&gt;
         assert jpg_tile.data.shape == (512, 512, 3)
         assert list(fits_tile.data[510][:12]) == data_precomp

&lt;span class="gd"&gt;-        jpg_tile.write('Npix30889.jpg')&lt;/span&gt;
&lt;span class="gd"&gt;-        fits_tile.write('Npix30889.fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        jpg_tile.write('Npix30889.jpg', tmpdir)&lt;/span&gt;
&lt;span class="gi"&gt;+        fits_tile.write('Npix30889.fits', tmpdir)&lt;/span&gt;

&lt;span class="gd"&gt;-        fits_tile = HipsTile.read(self.hips_tile_meta_fits)&lt;/span&gt;
&lt;span class="gd"&gt;-        jpg_tile = HipsTile.read(self.hips_tile_meta_jpg)&lt;/span&gt;
&lt;span class="gi"&gt;+        jpg_tile = HipsTile.read(self.hips_tile_meta_jpg, tmpdir)&lt;/span&gt;
&lt;span class="gi"&gt;+        fits_tile = HipsTile.read(self.hips_tile_meta_fits, tmpdir)&lt;/span&gt;

         data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]
         assert fits_tile.data.shape == (512, 512)
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index bf8ae51..c521df6 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -8,7 +8,7 @@ from astropy.io import fits&lt;/span&gt;
 from astropy.io.fits.header import Header

 from .tile_meta import HipsTileMeta
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+import py._path.local&lt;/span&gt;
 __all__ = [
     'HipsTile',
 ]
&lt;span class="gu"&gt;@@ -48,7 +48,6 @@ class HipsTile:&lt;/span&gt;

     def __init__(self, meta: HipsTileMeta, data: np.ndarray = None, header: Header = None) -&amp;gt; None:
         self.meta = meta
&lt;span class="gd"&gt;-        self.format = format&lt;/span&gt;
         self.data = data
         self.header = header

&lt;span class="gu"&gt;@@ -64,7 +63,7 @@ class HipsTile:&lt;/span&gt;
             URL containing HiPS tile
         """
         raw_image = BytesIO(urllib.request.urlopen(url).read())
&lt;span class="gd"&gt;-        if meta.format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+        if meta.file_format == 'fits':&lt;/span&gt;
             hdulist = fits.open(raw_image)
             data = np.array(hdulist[0].data)
             header = hdulist[0].header
&lt;span class="gu"&gt;@@ -74,7 +73,7 @@ class HipsTile:&lt;/span&gt;
             return cls(meta, data)

     @classmethod
&lt;span class="gd"&gt;-    def read(cls, meta: HipsTileMeta) -&amp;gt; 'HipsTile':&lt;/span&gt;
&lt;span class="gi"&gt;+    def read(cls, meta: HipsTileMeta, tmpdir: py._path.local = None) -&amp;gt; 'HipsTile':&lt;/span&gt;
         """Read HiPS tile data from a directory and load into memory (`HipsTile`).

         Parameters
&lt;span class="gu"&gt;@@ -82,9 +81,13 @@ class HipsTile:&lt;/span&gt;
         meta : `HipsTileMeta`
             Metadata of HiPS tile
         """
&lt;span class="gd"&gt;-        path = meta.path / meta.filename&lt;/span&gt;
&lt;span class="gd"&gt;-        if meta.format == 'fits':&lt;/span&gt;
&lt;span class="gd"&gt;-            hdulist = fits.open(path)&lt;/span&gt;
&lt;span class="gi"&gt;+        if tmpdir == None:&lt;/span&gt;
&lt;span class="gi"&gt;+            path = meta.path / meta.filename&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            path = tmpdir / meta.filename&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        if meta.file_format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+            hdulist = fits.open(str(path))&lt;/span&gt;
             data = np.array(hdulist[0].data)
             header = hdulist[0].header
             return cls(meta, data, header)
&lt;span class="gu"&gt;@@ -92,7 +95,7 @@ class HipsTile:&lt;/span&gt;
             data = np.array(Image.open(str(path)))
             return cls(meta, data)

&lt;span class="gd"&gt;-    def write(self, filename: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def write(self, filename: str, tmpdir: py._path.local = None) -&amp;gt; None:&lt;/span&gt;
         """Write HiPS tile by a given filename.

         Parameters
&lt;span class="gu"&gt;@@ -100,8 +103,12 @@ class HipsTile:&lt;/span&gt;
         filename : `str`
             Name of the file
         """
&lt;span class="gd"&gt;-        path = self.meta.path / self.meta.filename&lt;/span&gt;
&lt;span class="gd"&gt;-        if self.meta.format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+        if tmpdir == None:&lt;/span&gt;
&lt;span class="gi"&gt;+            path = self.meta.path / self.meta.filename&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            path = tmpdir / self.meta.filename&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.meta.file_format == 'fits':&lt;/span&gt;
             hdu = fits.PrimaryHDU(self.data, header=self.header).writeto(str(path))
         else:
             Image.fromarray(self.data).save(str(path))
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile_meta.py b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gh"&gt;index 50ed011..3789609 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -23,10 +23,10 @@ class HipsTileMeta:&lt;/span&gt;
         HiPS tile width
     """

&lt;span class="gd"&gt;-    def __init__(self, order: int, ipix: int, format: str, tile_width: int = 512) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        self.order = format&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, order: int, ipix: int, file_format: str, tile_width: int = 512) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.order = order&lt;/span&gt;
         self.ipix = ipix
&lt;span class="gd"&gt;-        self.format = format&lt;/span&gt;
&lt;span class="gi"&gt;+        self.file_format = file_format&lt;/span&gt;
         self.tile_width = tile_width

     @property
&lt;span class="gu"&gt;@@ -37,4 +37,4 @@ class HipsTileMeta:&lt;/span&gt;
     @property
     def filename(self) -&amp;gt; str:
         """Return the filename of HiPS tile (`str`)."""
&lt;span class="gd"&gt;-        return ''.join(['Npix', str(self.ipix), '.', self.format])&lt;/span&gt;
&lt;span class="gi"&gt;+        return ''.join(['Npix', str(self.ipix), '.', self.file_format])&lt;/span&gt;

commit 5db3ef2ae3c3958ae86906e840c4bc4793845adf
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 22 09:28:31 2017 +0500

    Update tiles.hips module

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index a3a3397..f27f1b9 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -25,8 +25,8 @@ class TestHipsTile:&lt;/span&gt;
         jpg_tile.write('Npix30889.jpg')
         fits_tile.write('Npix30889.fits')

&lt;span class="gd"&gt;-        fits_tile = HipsTile.read(self.hips_tile_meta_fits, 'Npix30889.fits')&lt;/span&gt;
&lt;span class="gd"&gt;-        jpg_tile = HipsTile.read(self.hips_tile_meta_jpg, 'Npix30889.jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+        fits_tile = HipsTile.read(self.hips_tile_meta_fits)&lt;/span&gt;
&lt;span class="gi"&gt;+        jpg_tile = HipsTile.read(self.hips_tile_meta_jpg)&lt;/span&gt;

         data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]
         assert fits_tile.data.shape == (512, 512)
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index b822d69..bf8ae51 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -8,7 +8,6 @@ from astropy.io import fits&lt;/span&gt;
 from astropy.io.fits.header import Header

 from .tile_meta import HipsTileMeta
&lt;span class="gd"&gt;-from ..utils.tile import tile_path&lt;/span&gt;

 __all__ = [
     'HipsTile',
&lt;span class="gu"&gt;@@ -28,15 +27,15 @@ class HipsTile:&lt;/span&gt;
         Metadata of HiPS tile
     data : `~numpy.ndarray`
         Data containing HiPS tile
&lt;span class="gd"&gt;-    header : `astropy.io.fits.Header`&lt;/span&gt;
&lt;span class="gi"&gt;+    header : `~astropy.io.fits.Header`&lt;/span&gt;
         Header of HiPS tile

     Examples
     --------
         &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTile
         &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTileMeta
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; hips_tile_met = HipsTileMeta(order=6, ipix=30889, format='fits')&lt;/span&gt;
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; hips_tile = HipsTile.read(meta, 'Npix30889.fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; meta = HipsTileMeta(order=6, ipix=30889, format='fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_tile = HipsTile.read(meta)&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; hips_tile.data
         array([[0, 0, 0, ..., 0, 0, 0],
                [0, 0, 0, ..., 0, 0, 0],
&lt;span class="gu"&gt;@@ -75,17 +74,15 @@ class HipsTile:&lt;/span&gt;
             return cls(meta, data)

     @classmethod
&lt;span class="gd"&gt;-    def read(cls, meta: HipsTileMeta, filename: str) -&amp;gt; 'HipsTile':&lt;/span&gt;
&lt;span class="gi"&gt;+    def read(cls, meta: HipsTileMeta) -&amp;gt; 'HipsTile':&lt;/span&gt;
         """Read HiPS tile data from a directory and load into memory (`HipsTile`).

         Parameters
         ----------
         meta : `HipsTileMeta`
             Metadata of HiPS tile
&lt;span class="gd"&gt;-        filename : `str`&lt;/span&gt;
&lt;span class="gd"&gt;-            File name of HiPS tile&lt;/span&gt;
         """
&lt;span class="gd"&gt;-        path = tile_path().absolute() / filename&lt;/span&gt;
&lt;span class="gi"&gt;+        path = meta.path / meta.filename&lt;/span&gt;
         if meta.format == 'fits':
             hdulist = fits.open(path)
             data = np.array(hdulist[0].data)
&lt;span class="gu"&gt;@@ -103,7 +100,7 @@ class HipsTile:&lt;/span&gt;
         filename : `str`
             Name of the file
         """
&lt;span class="gd"&gt;-        path = tile_path().absolute() / filename&lt;/span&gt;
&lt;span class="gi"&gt;+        path = self.meta.path / self.meta.filename&lt;/span&gt;
         if self.meta.format == 'fits':
             hdu = fits.PrimaryHDU(self.data, header=self.header).writeto(str(path))
         else:
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile_meta.py b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8ac403b..50ed011 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,5 +1,7 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst

&lt;span class="gi"&gt;+from pathlib import Path&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 __all__ = [
     'HipsTileMeta',
 ]
&lt;span class="gu"&gt;@@ -26,3 +28,13 @@ class HipsTileMeta:&lt;/span&gt;
         self.ipix = ipix
         self.format = format
         self.tile_width = tile_width
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def path(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Return the default path for tile storage (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return Path('hips', 'tiles', 'tests', 'data')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def filename(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Return the filename of HiPS tile (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return ''.join(['Npix', str(self.ipix), '.', self.format])&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/tile.py b/hips/utils/tile.py&lt;/span&gt;
deleted file mode 100644
&lt;span class="gh"&gt;index c3937ea..0000000&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ /dev/null&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,16 +0,0 @@&lt;/span&gt;
&lt;span class="gd"&gt;-# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gd"&gt;-"""HiPS tile utility functions.&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-"""&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-from pathlib import Path&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-__all__ = [&lt;/span&gt;
&lt;span class="gd"&gt;-    'tile_path',&lt;/span&gt;
&lt;span class="gd"&gt;-]&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-def tile_path() -&amp;gt; Path:&lt;/span&gt;
&lt;span class="gd"&gt;-    """Return default path of HiPS tile storage."""&lt;/span&gt;
&lt;span class="gd"&gt;-    path = Path('hips', 'tiles', 'tests', 'data')&lt;/span&gt;
&lt;span class="gd"&gt;-    return path&lt;/span&gt;

commit 9d2ef083c0dc9b73fb00e4228daf3179ca482348
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jun 21 23:20:30 2017 +0500

    Refactor some code

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index efd0bb9..b822d69 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -24,23 +24,19 @@ class HipsTile:&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gd"&gt;-    hips_tile_meta : `HipsTileMeta`&lt;/span&gt;
&lt;span class="gi"&gt;+    meta : `HipsTileMeta`&lt;/span&gt;
         Metadata of HiPS tile
&lt;span class="gd"&gt;-    format : `str`&lt;/span&gt;
&lt;span class="gd"&gt;-        Format of HiPS tile&lt;/span&gt;
&lt;span class="gd"&gt;-    data : `np.ndarray`&lt;/span&gt;
&lt;span class="gi"&gt;+    data : `~numpy.ndarray`&lt;/span&gt;
         Data containing HiPS tile
     header : `astropy.io.fits.Header`
         Header of HiPS tile

     Examples
     --------
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; import urllib.request&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTile
         &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTileMeta
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; from astropy.tests.helper import remote_data&lt;/span&gt;
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; hips_tile_metadata = HipsTileMeta(order=6, ipix=30889, format='fits')&lt;/span&gt;
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; hips_tile = HipsTile.read(hips_tile_metadata, 'Npix30889.fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_tile_met = HipsTileMeta(order=6, ipix=30889, format='fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_tile = HipsTile.read(meta, 'Npix30889.fits')&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; hips_tile.data
         array([[0, 0, 0, ..., 0, 0, 0],
                [0, 0, 0, ..., 0, 0, 0],
&lt;span class="gu"&gt;@@ -51,56 +47,56 @@ class HipsTile:&lt;/span&gt;
                [0, 0, 0, ..., 1, 0, 1]], dtype=int16)
         """

&lt;span class="gd"&gt;-    def __init__(self, hips_tile_meta: HipsTileMeta, data: np.ndarray = None, header: Header = None) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        self.hips_tile_meta = hips_tile_meta&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, meta: HipsTileMeta, data: np.ndarray = None, header: Header = None) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.meta = meta&lt;/span&gt;
         self.format = format
         self.data = data
         self.header = header

     @classmethod
&lt;span class="gd"&gt;-    def fetch(cls, hips_tile_meta: HipsTileMeta, url: str) -&amp;gt; 'HipsTile':&lt;/span&gt;
&lt;span class="gi"&gt;+    def fetch(cls, meta: HipsTileMeta, url: str) -&amp;gt; 'HipsTile':&lt;/span&gt;
         """Fetch HiPS tile and load into memory (`HipsTile`).

         Parameters
         ----------
&lt;span class="gd"&gt;-        hips_tile_meta : `HipsTileMeta`&lt;/span&gt;
&lt;span class="gi"&gt;+        meta : `HipsTileMeta`&lt;/span&gt;
             Metadata of HiPS tile
         url : `str`
             URL containing HiPS tile
         """
         raw_image = BytesIO(urllib.request.urlopen(url).read())
&lt;span class="gd"&gt;-        if hips_tile_meta.format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+        if meta.format == 'fits':&lt;/span&gt;
             hdulist = fits.open(raw_image)
             data = np.array(hdulist[0].data)
             header = hdulist[0].header
&lt;span class="gd"&gt;-            return cls(hips_tile_meta, data, header)&lt;/span&gt;
&lt;span class="gi"&gt;+            return cls(meta, data, header)&lt;/span&gt;
         else:
             data = np.array(Image.open(raw_image))
&lt;span class="gd"&gt;-            return cls(hips_tile_meta, data)&lt;/span&gt;
&lt;span class="gi"&gt;+            return cls(meta, data)&lt;/span&gt;

     @classmethod
&lt;span class="gd"&gt;-    def read(cls, hips_tile_meta: HipsTileMeta, filename: str) -&amp;gt; 'HipsTile':&lt;/span&gt;
&lt;span class="gi"&gt;+    def read(cls, meta: HipsTileMeta, filename: str) -&amp;gt; 'HipsTile':&lt;/span&gt;
         """Read HiPS tile data from a directory and load into memory (`HipsTile`).

         Parameters
         ----------
&lt;span class="gd"&gt;-        hips_tile_meta : `HipsTileMeta`&lt;/span&gt;
&lt;span class="gi"&gt;+        meta : `HipsTileMeta`&lt;/span&gt;
             Metadata of HiPS tile
         filename : `str`
             File name of HiPS tile
         """
         path = tile_path().absolute() / filename
&lt;span class="gd"&gt;-        if hips_tile_meta.format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+        if meta.format == 'fits':&lt;/span&gt;
             hdulist = fits.open(path)
             data = np.array(hdulist[0].data)
             header = hdulist[0].header
&lt;span class="gd"&gt;-            return cls(hips_tile_meta, data, header)&lt;/span&gt;
&lt;span class="gi"&gt;+            return cls(meta, data, header)&lt;/span&gt;
         else:
             data = np.array(Image.open(str(path)))
&lt;span class="gd"&gt;-            return cls(hips_tile_meta, data)&lt;/span&gt;
&lt;span class="gi"&gt;+            return cls(meta, data)&lt;/span&gt;

     def write(self, filename: str) -&amp;gt; None:
&lt;span class="gd"&gt;-        """Write HiPS tile by a given filename (`None`).&lt;/span&gt;
&lt;span class="gi"&gt;+        """Write HiPS tile by a given filename.&lt;/span&gt;

         Parameters
         ----------
&lt;span class="gu"&gt;@@ -108,10 +104,7 @@ class HipsTile:&lt;/span&gt;
             Name of the file
         """
         path = tile_path().absolute() / filename
&lt;span class="gd"&gt;-        if self.hips_tile_meta.format == 'fits':&lt;/span&gt;
&lt;span class="gd"&gt;-            hdu = fits.PrimaryHDU(self.data, header=self.header)&lt;/span&gt;
&lt;span class="gd"&gt;-            hdulist = fits.HDUList([hdu])&lt;/span&gt;
&lt;span class="gd"&gt;-            hdulist.writeto(str(path))&lt;/span&gt;
&lt;span class="gd"&gt;-            hdulist.close()&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.meta.format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+            hdu = fits.PrimaryHDU(self.data, header=self.header).writeto(str(path))&lt;/span&gt;
         else:
             Image.fromarray(self.data).save(str(path))
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile_meta.py b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gh"&gt;index 9ee8445..8ac403b 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -7,7 +7,6 @@ __all__ = [&lt;/span&gt;

 class HipsTileMeta:
     """HiPS tile metadata container.
&lt;span class="gd"&gt;-&lt;/span&gt;
     This class stores HiPS tile meta attributes.

     Parameters
&lt;span class="gu"&gt;@@ -16,8 +15,8 @@ class HipsTileMeta:&lt;/span&gt;
         Order of HiPS tile
     ipix : `int`
         Pixel number of HiPS tile
&lt;span class="gd"&gt;-    format : `str`&lt;/span&gt;
&lt;span class="gd"&gt;-        Format of the HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    format : {'fits', 'jpg', 'png'}&lt;/span&gt;
&lt;span class="gi"&gt;+        File format of the HiPS tile&lt;/span&gt;
     tile_width : `int`
         HiPS tile width
     """
&lt;span class="gh"&gt;diff --git a/hips/utils/tile.py b/hips/utils/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index f08d640..c3937ea 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,8 +1,6 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-"""HEALpy wrapper functions.&lt;/span&gt;
&lt;span class="gi"&gt;+"""HiPS tile utility functions.&lt;/span&gt;

&lt;span class="gd"&gt;-This module contains wrapper functions around HEALPix utilizing&lt;/span&gt;
&lt;span class="gd"&gt;-the healpy library.&lt;/span&gt;
 """

 from pathlib import Path

commit 616340bd6c87cb070d324b1631ced8cbe76654b8
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jun 21 22:33:36 2017 +0500

    Add class HipsTileMeta and update test case

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/data/Npix30889.fits b/hips/tiles/tests/data/Npix30889.fits&lt;/span&gt;
deleted file mode 100644
&lt;span class="gh"&gt;index 522852f..0000000&lt;/span&gt;
Binary files a/hips/tiles/tests/data/Npix30889.fits and /dev/null differ
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/data/Npix30889.jpg b/hips/tiles/tests/data/Npix30889.jpg&lt;/span&gt;
deleted file mode 100644
&lt;span class="gh"&gt;index b6365db..0000000&lt;/span&gt;
Binary files a/hips/tiles/tests/data/Npix30889.jpg and /dev/null differ
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index d82e8a0..a3a3397 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,34 +1,34 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 from astropy.tests.helper import remote_data
&lt;span class="gi"&gt;+&lt;/span&gt;
 from ..tile import HipsTile
&lt;span class="gi"&gt;+from ..tile_meta import HipsTileMeta&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class TestHipsTile:&lt;/span&gt;
&lt;span class="gi"&gt;+    def setup(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        self.hips_tile_meta_fits = HipsTileMeta(order=6, ipix=30889, format='fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        self.hips_tile_meta_jpg = HipsTileMeta(order=6, ipix=30889, format='jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_fetch_read_write(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        fits_tile = HipsTile.fetch(self.hips_tile_meta_fits,&lt;/span&gt;
&lt;span class="gi"&gt;+                                   'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        jpg_tile = HipsTile.fetch(self.hips_tile_meta_jpg,&lt;/span&gt;
&lt;span class="gi"&gt;+                                  'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]&lt;/span&gt;
&lt;span class="gi"&gt;+        assert fits_tile.data.shape == (512, 512)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert jpg_tile.data.shape == (512, 512, 3)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert list(fits_tile.data[510][:12]) == data_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        jpg_tile.write('Npix30889.jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+        fits_tile.write('Npix30889.fits')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        fits_tile = HipsTile.read(self.hips_tile_meta_fits, 'Npix30889.fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        jpg_tile = HipsTile.read(self.hips_tile_meta_jpg, 'Npix30889.jpg')&lt;/span&gt;

&lt;span class="gd"&gt;-@remote_data&lt;/span&gt;
&lt;span class="gd"&gt;-def test_fetch():&lt;/span&gt;
&lt;span class="gd"&gt;-    fits_tile = HipsTile.fetch('fits', 'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.fits')&lt;/span&gt;
&lt;span class="gd"&gt;-    jpg_tile = HipsTile.fetch('jpg', 'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.jpg')&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    shape_fits_precomp = (512, 512)&lt;/span&gt;
&lt;span class="gd"&gt;-    shape_jpg_precomp = (512, 512, 3)&lt;/span&gt;
&lt;span class="gd"&gt;-    data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]&lt;/span&gt;
&lt;span class="gd"&gt;-    assert fits_tile.data.shape == shape_fits_precomp&lt;/span&gt;
&lt;span class="gd"&gt;-    assert jpg_tile.data.shape == shape_jpg_precomp&lt;/span&gt;
&lt;span class="gd"&gt;-    assert list(fits_tile.data[510][:12]) == data_precomp&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-def test_read_write():&lt;/span&gt;
&lt;span class="gd"&gt;-    fits_tile = HipsTile.read('fits', 'Npix30889.fits')&lt;/span&gt;
&lt;span class="gd"&gt;-    jpg_tile = HipsTile.read('jpg', 'Npix30889.jpg')&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    shape_fits_precomp = (512, 512)&lt;/span&gt;
&lt;span class="gd"&gt;-    shape_jpg_precomp = (512, 512, 3)&lt;/span&gt;
&lt;span class="gd"&gt;-    data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]&lt;/span&gt;
&lt;span class="gd"&gt;-    assert (fits_tile.data.shape) == shape_fits_precomp&lt;/span&gt;
&lt;span class="gd"&gt;-    assert (jpg_tile.data.shape) == shape_jpg_precomp&lt;/span&gt;
&lt;span class="gd"&gt;-    assert list(fits_tile.data[510][:12]) == data_precomp&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    fits_tile.write('test_file.fits')&lt;/span&gt;
&lt;span class="gd"&gt;-    jpg_tile.write('test_file.jpg')&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    path_fits = fits_tile.path / 'test_file.fits'&lt;/span&gt;
&lt;span class="gd"&gt;-    path_jpg = jpg_tile.path / 'test_file.jpg'&lt;/span&gt;
&lt;span class="gd"&gt;-    assert True == path_fits.is_file()&lt;/span&gt;
&lt;span class="gd"&gt;-    assert True == path_jpg.is_file()&lt;/span&gt;
&lt;span class="gi"&gt;+        data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]&lt;/span&gt;
&lt;span class="gi"&gt;+        assert fits_tile.data.shape == (512, 512)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert jpg_tile.data.shape == (512, 512, 3)&lt;/span&gt;
&lt;span class="gi"&gt;+        assert list(fits_tile.data[510][:12]) == data_precomp&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 509667e..efd0bb9 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,16 +1,21 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-from astropy.io.fits.header import Header&lt;/span&gt;
&lt;span class="gd"&gt;-from astropy.io import fits&lt;/span&gt;
&lt;span class="gd"&gt;-from pathlib import Path&lt;/span&gt;
&lt;span class="gd"&gt;-from io import BytesIO&lt;/span&gt;
&lt;span class="gd"&gt;-from PIL import Image&lt;/span&gt;
 import urllib.request
&lt;span class="gi"&gt;+from io import BytesIO&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 import numpy as np
&lt;span class="gi"&gt;+from PIL import Image&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.io import fits&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.io.fits.header import Header&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from .tile_meta import HipsTileMeta&lt;/span&gt;
&lt;span class="gi"&gt;+from ..utils.tile import tile_path&lt;/span&gt;

 __all__ = [
     'HipsTile',
 ]

&lt;span class="gi"&gt;+__doctest_skip__ = ['HipsTile']&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;

 class HipsTile:
     """HiPS tile container.
&lt;span class="gu"&gt;@@ -19,21 +24,23 @@ class HipsTile:&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gi"&gt;+    hips_tile_meta : `HipsTileMeta`&lt;/span&gt;
&lt;span class="gi"&gt;+        Metadata of HiPS tile&lt;/span&gt;
     format : `str`
         Format of HiPS tile
&lt;span class="gd"&gt;-    data : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+    data : `np.ndarray`&lt;/span&gt;
         Data containing HiPS tile
&lt;span class="gd"&gt;-    header : `format`&lt;/span&gt;
&lt;span class="gi"&gt;+    header : `astropy.io.fits.Header`&lt;/span&gt;
         Header of HiPS tile

     Examples
     --------
&lt;span class="gd"&gt;-    ::&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; import urllib.request
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsTileMeta&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; from astropy.tests.helper import remote_data
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; text = urllib.request.urlopen('https://raw.githubusercontent.com/hipspy/hips/master/hips/tiles/tests/data/properties.txt').read() # doctest: +REMOTE_DATA&lt;/span&gt;
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; hips_tile = HipsTile.read('fits', 'Npix30889.fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_tile_metadata = HipsTileMeta(order=6, ipix=30889, format='fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_tile = HipsTile.read(hips_tile_metadata, 'Npix30889.fits')&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; hips_tile.data
         array([[0, 0, 0, ..., 0, 0, 0],
                [0, 0, 0, ..., 0, 0, 0],
&lt;span class="gu"&gt;@@ -44,57 +51,53 @@ class HipsTile:&lt;/span&gt;
                [0, 0, 0, ..., 1, 0, 1]], dtype=int16)
         """

&lt;span class="gd"&gt;-    def __init__(self, format: str, data: np.ndarray=None, header: Header=None) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, hips_tile_meta: HipsTileMeta, data: np.ndarray = None, header: Header = None) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.hips_tile_meta = hips_tile_meta&lt;/span&gt;
         self.format = format
         self.data = data
         self.header = header

&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def path(self) -&amp;gt; Path:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Default path for tile storage (`Path`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return Path('hips', 'tiles', 'tests', 'data')&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
     @classmethod
&lt;span class="gd"&gt;-    def fetch(cls, format: str, url: str) -&amp;gt; HipsTile:&lt;/span&gt;
&lt;span class="gi"&gt;+    def fetch(cls, hips_tile_meta: HipsTileMeta, url: str) -&amp;gt; 'HipsTile':&lt;/span&gt;
         """Fetch HiPS tile and load into memory (`HipsTile`).

         Parameters
         ----------
&lt;span class="gd"&gt;-        format : `str`&lt;/span&gt;
&lt;span class="gd"&gt;-            Format of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_tile_meta : `HipsTileMeta`&lt;/span&gt;
&lt;span class="gi"&gt;+            Metadata of HiPS tile&lt;/span&gt;
         url : `str`
             URL containing HiPS tile
         """
         raw_image = BytesIO(urllib.request.urlopen(url).read())
&lt;span class="gd"&gt;-        if format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+        if hips_tile_meta.format == 'fits':&lt;/span&gt;
             hdulist = fits.open(raw_image)
             data = np.array(hdulist[0].data)
             header = hdulist[0].header
&lt;span class="gd"&gt;-            return cls(format, data, header)&lt;/span&gt;
&lt;span class="gi"&gt;+            return cls(hips_tile_meta, data, header)&lt;/span&gt;
         else:
             data = np.array(Image.open(raw_image))
&lt;span class="gd"&gt;-            return cls(format, data)&lt;/span&gt;
&lt;span class="gi"&gt;+            return cls(hips_tile_meta, data)&lt;/span&gt;

     @classmethod
&lt;span class="gd"&gt;-    def read(cls, format: str, filename: str) -&amp;gt; 'HipsTile':&lt;/span&gt;
&lt;span class="gi"&gt;+    def read(cls, hips_tile_meta: HipsTileMeta, filename: str) -&amp;gt; 'HipsTile':&lt;/span&gt;
         """Read HiPS tile data from a directory and load into memory (`HipsTile`).

         Parameters
         ----------
&lt;span class="gd"&gt;-        format : `str`&lt;/span&gt;
&lt;span class="gd"&gt;-            Format of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_tile_meta : `HipsTileMeta`&lt;/span&gt;
&lt;span class="gi"&gt;+            Metadata of HiPS tile&lt;/span&gt;
         filename : `str`
             File name of HiPS tile
         """
&lt;span class="gd"&gt;-        path = Path('hips', 'tiles', 'tests', 'data') / filename&lt;/span&gt;
&lt;span class="gd"&gt;-        if format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+        path = tile_path().absolute() / filename&lt;/span&gt;
&lt;span class="gi"&gt;+        if hips_tile_meta.format == 'fits':&lt;/span&gt;
             hdulist = fits.open(path)
             data = np.array(hdulist[0].data)
             header = hdulist[0].header
&lt;span class="gd"&gt;-            return cls(format, data, header)&lt;/span&gt;
&lt;span class="gi"&gt;+            return cls(hips_tile_meta, data, header)&lt;/span&gt;
         else:
             data = np.array(Image.open(str(path)))
&lt;span class="gd"&gt;-            return cls(format, data)&lt;/span&gt;
&lt;span class="gi"&gt;+            return cls(hips_tile_meta, data)&lt;/span&gt;

     def write(self, filename: str) -&amp;gt; None:
         """Write HiPS tile by a given filename (`None`).
&lt;span class="gu"&gt;@@ -104,11 +107,11 @@ class HipsTile:&lt;/span&gt;
         filename : `str`
             Name of the file
         """
&lt;span class="gd"&gt;-        path = self.path / filename&lt;/span&gt;
&lt;span class="gd"&gt;-        if self.format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+        path = tile_path().absolute() / filename&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.hips_tile_meta.format == 'fits':&lt;/span&gt;
             hdu = fits.PrimaryHDU(self.data, header=self.header)
             hdulist = fits.HDUList([hdu])
&lt;span class="gd"&gt;-            hdulist.writeto(path)&lt;/span&gt;
&lt;span class="gi"&gt;+            hdulist.writeto(str(path))&lt;/span&gt;
             hdulist.close()
         else:
             Image.fromarray(self.data).save(str(path))
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile_meta.py b/hips/tiles/tile_meta.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..9ee8445&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile_meta.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,29 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+__all__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'HipsTileMeta',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class HipsTileMeta:&lt;/span&gt;
&lt;span class="gi"&gt;+    """HiPS tile metadata container.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    This class stores HiPS tile meta attributes.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    order : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+        Order of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    ipix : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+        Pixel number of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    format : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+        Format of the HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    tile_width : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+        HiPS tile width&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, order: int, ipix: int, format: str, tile_width: int = 512) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.order = format&lt;/span&gt;
&lt;span class="gi"&gt;+        self.ipix = ipix&lt;/span&gt;
&lt;span class="gi"&gt;+        self.format = format&lt;/span&gt;
&lt;span class="gi"&gt;+        self.tile_width = tile_width&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/tile.py b/hips/utils/tile.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..f08d640&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,18 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+"""HEALpy wrapper functions.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+This module contains wrapper functions around HEALPix utilizing&lt;/span&gt;
&lt;span class="gi"&gt;+the healpy library.&lt;/span&gt;
&lt;span class="gi"&gt;+"""&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from pathlib import Path&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+__all__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'tile_path',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def tile_path() -&amp;gt; Path:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Return default path of HiPS tile storage."""&lt;/span&gt;
&lt;span class="gi"&gt;+    path = Path('hips', 'tiles', 'tests', 'data')&lt;/span&gt;
&lt;span class="gi"&gt;+    return path&lt;/span&gt;

commit 6250e9ec0c665151a84403d986a4b71a804ea632
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jun 21 16:15:41 2017 +0500

    Minimize HipsTile classs functionality

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 1316b5d..d82e8a0 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,61 +1,34 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-from astropy.utils.data import get_pkg_data_filename&lt;/span&gt;
 from astropy.tests.helper import remote_data
&lt;span class="gd"&gt;-from ..description import HipsDescription&lt;/span&gt;
 from ..tile import HipsTile
&lt;span class="gd"&gt;-from pathlib import Path&lt;/span&gt;
&lt;span class="gd"&gt;-import numpy as np&lt;/span&gt;

&lt;span class="gd"&gt;-class TestHipsTile:&lt;/span&gt;
&lt;span class="gd"&gt;-    @classmethod&lt;/span&gt;
&lt;span class="gd"&gt;-    def setup_class(cls):&lt;/span&gt;
&lt;span class="gd"&gt;-        filename = get_pkg_data_filename('data/properties.txt')&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_description = HipsDescription.read(filename)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        cls.fits_tile = HipsTile(hips_description=hips_description, order=6,&lt;/span&gt;
&lt;span class="gd"&gt;-                            ipix=30889, format='fits', tile_width=512)&lt;/span&gt;
&lt;span class="gd"&gt;-        cls.jpg_tile = HipsTile(hips_description=hips_description, order=6,&lt;/span&gt;
&lt;span class="gd"&gt;-                            ipix=30889, format='jpg', tile_width=512)&lt;/span&gt;
&lt;span class="gd"&gt;-        cls.fits_tile.base_url = 'http://alasky.unistra.fr/2MASS/H'&lt;/span&gt;
&lt;span class="gd"&gt;-        cls.jpg_tile.base_url = 'http://alasky.unistra.fr/2MASS/H'&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_base_url(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        assert self.fits_tile.base_url == 'http://alasky.unistra.fr/2MASS/H'&lt;/span&gt;
&lt;span class="gd"&gt;-        assert self.jpg_tile.base_url == 'http://alasky.unistra.fr/2MASS/H'&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_tile_url(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        assert self.fits_tile.tile_url == 'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.fits'&lt;/span&gt;
&lt;span class="gd"&gt;-        assert self.jpg_tile.tile_url == 'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.jpg'&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @remote_data&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_fetch(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        self.fits_tile.fetch()&lt;/span&gt;
&lt;span class="gd"&gt;-        self.jpg_tile.fetch()&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        shape_fits_precomp = (512, 512)&lt;/span&gt;
&lt;span class="gd"&gt;-        shape_jpg_precomp = (512, 512, 3)&lt;/span&gt;
&lt;span class="gd"&gt;-        data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]&lt;/span&gt;
&lt;span class="gd"&gt;-        assert self.fits_tile.data.shape == shape_fits_precomp&lt;/span&gt;
&lt;span class="gd"&gt;-        assert self.jpg_tile.data.shape == shape_jpg_precomp&lt;/span&gt;
&lt;span class="gd"&gt;-        assert list(self.fits_tile.data[510][:12]) == data_precomp&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_read(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        self.fits_tile.read()&lt;/span&gt;
&lt;span class="gd"&gt;-        self.jpg_tile.read()&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        shape_fits_precomp = (512, 512)&lt;/span&gt;
&lt;span class="gd"&gt;-        shape_jpg_precomp = (512, 512, 3)&lt;/span&gt;
&lt;span class="gd"&gt;-        data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]&lt;/span&gt;
&lt;span class="gd"&gt;-        assert (self.fits_tile.data.shape) == shape_fits_precomp&lt;/span&gt;
&lt;span class="gd"&gt;-        assert (self.jpg_tile.data.shape) == shape_jpg_precomp&lt;/span&gt;
&lt;span class="gd"&gt;-        assert list(self.fits_tile.data[510][:12]) == data_precomp&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_write(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        filename = 'test_file'&lt;/span&gt;
&lt;span class="gd"&gt;-        self.fits_tile.write(filename)&lt;/span&gt;
&lt;span class="gd"&gt;-        self.jpg_tile.write(filename)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        path_fits = self.fits_tile.path.joinpath(''.join([filename, '.', self.fits_tile.format]))&lt;/span&gt;
&lt;span class="gd"&gt;-        path_jpg = self.jpg_tile.path.joinpath(''.join([filename, '.', self.jpg_tile.format]))&lt;/span&gt;
&lt;span class="gd"&gt;-        assert True == path_fits.is_file()&lt;/span&gt;
&lt;span class="gd"&gt;-        assert True == path_jpg.is_file()&lt;/span&gt;
&lt;span class="gi"&gt;+@remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+def test_fetch():&lt;/span&gt;
&lt;span class="gi"&gt;+    fits_tile = HipsTile.fetch('fits', 'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.fits')&lt;/span&gt;
&lt;span class="gi"&gt;+    jpg_tile = HipsTile.fetch('jpg', 'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    shape_fits_precomp = (512, 512)&lt;/span&gt;
&lt;span class="gi"&gt;+    shape_jpg_precomp = (512, 512, 3)&lt;/span&gt;
&lt;span class="gi"&gt;+    data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]&lt;/span&gt;
&lt;span class="gi"&gt;+    assert fits_tile.data.shape == shape_fits_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+    assert jpg_tile.data.shape == shape_jpg_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+    assert list(fits_tile.data[510][:12]) == data_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def test_read_write():&lt;/span&gt;
&lt;span class="gi"&gt;+    fits_tile = HipsTile.read('fits', 'Npix30889.fits')&lt;/span&gt;
&lt;span class="gi"&gt;+    jpg_tile = HipsTile.read('jpg', 'Npix30889.jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    shape_fits_precomp = (512, 512)&lt;/span&gt;
&lt;span class="gi"&gt;+    shape_jpg_precomp = (512, 512, 3)&lt;/span&gt;
&lt;span class="gi"&gt;+    data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]&lt;/span&gt;
&lt;span class="gi"&gt;+    assert (fits_tile.data.shape) == shape_fits_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+    assert (jpg_tile.data.shape) == shape_jpg_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+    assert list(fits_tile.data[510][:12]) == data_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    fits_tile.write('test_file.fits')&lt;/span&gt;
&lt;span class="gi"&gt;+    jpg_tile.write('test_file.jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    path_fits = fits_tile.path / 'test_file.fits'&lt;/span&gt;
&lt;span class="gi"&gt;+    path_jpg = jpg_tile.path / 'test_file.jpg'&lt;/span&gt;
&lt;span class="gi"&gt;+    assert True == path_fits.is_file()&lt;/span&gt;
&lt;span class="gi"&gt;+    assert True == path_jpg.is_file()&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8b033e1..509667e 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,5 +1,5 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-from .description import HipsDescription&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.io.fits.header import Header&lt;/span&gt;
 from astropy.io import fits
 from pathlib import Path
 from io import BytesIO
&lt;span class="gu"&gt;@@ -15,39 +15,25 @@ __all__ = [&lt;/span&gt;
 class HipsTile:
     """HiPS tile container.

&lt;span class="gd"&gt;-    This class provides methods for fetching, reading,&lt;/span&gt;
&lt;span class="gd"&gt;-    and writing a HiPS tile. It also contains a few&lt;/span&gt;
&lt;span class="gd"&gt;-    getters and setters around frequently used&lt;/span&gt;
&lt;span class="gd"&gt;-    HiPS tile attributes.&lt;/span&gt;
&lt;span class="gi"&gt;+    This class provides methods for fetching, reading, and writing a HiPS tile.&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gd"&gt;-    hips_description : `HipsDescription`&lt;/span&gt;
&lt;span class="gd"&gt;-        Class HipsDescription contains HiPS properties&lt;/span&gt;
&lt;span class="gd"&gt;-    order : `int`&lt;/span&gt;
&lt;span class="gd"&gt;-        Order of the HiPS tile&lt;/span&gt;
&lt;span class="gd"&gt;-    ipix : `int`&lt;/span&gt;
&lt;span class="gd"&gt;-        HEALPix pixel number&lt;/span&gt;
&lt;span class="gd"&gt;-    format : `format`&lt;/span&gt;
&lt;span class="gi"&gt;+    format : `str`&lt;/span&gt;
         Format of HiPS tile
&lt;span class="gd"&gt;-    data : `numpy.ndarray`&lt;/span&gt;
&lt;span class="gd"&gt;-        Pixel values of HiPS tile&lt;/span&gt;
&lt;span class="gd"&gt;-    tile_width : `int`&lt;/span&gt;
&lt;span class="gd"&gt;-        Width of HiPS tile&lt;/span&gt;
&lt;span class="gd"&gt;-    base_url : `str`&lt;/span&gt;
&lt;span class="gd"&gt;-        Base URL of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    data : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+        Data containing HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    header : `format`&lt;/span&gt;
&lt;span class="gi"&gt;+        Header of HiPS tile&lt;/span&gt;

     Examples
     --------
     ::

         &amp;gt;&amp;gt;&amp;gt; import urllib.request
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsDescription&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; from astropy.tests.helper import remote_data
         &amp;gt;&amp;gt;&amp;gt; text = urllib.request.urlopen('https://raw.githubusercontent.com/hipspy/hips/master/hips/tiles/tests/data/properties.txt').read() # doctest: +REMOTE_DATA
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; hips_description = HipsDescription.parse(str(text))&lt;/span&gt;
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; hips_tile = HipsTile(hips_description=hips_description, order=6, ipix=30889, format='fits', tile_width=512)&lt;/span&gt;
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; hips_tile.read()&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_tile = HipsTile.read('fits', 'Npix30889.fits')&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; hips_tile.data
         array([[0, 0, 0, ..., 0, 0, 0],
                [0, 0, 0, ..., 0, 0, 0],
&lt;span class="gu"&gt;@@ -58,51 +44,57 @@ class HipsTile:&lt;/span&gt;
                [0, 0, 0, ..., 1, 0, 1]], dtype=int16)
         """

&lt;span class="gd"&gt;-    def __init__(self, hips_description: HipsDescription, order: int, ipix: int, format: str,&lt;/span&gt;
&lt;span class="gd"&gt;-                 data: np.ndarray=None, tile_width: int=512, base_url: str=None) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        self.hips_description = hips_description&lt;/span&gt;
&lt;span class="gd"&gt;-        self.order = order&lt;/span&gt;
&lt;span class="gd"&gt;-        self.ipix = ipix&lt;/span&gt;
&lt;span class="gd"&gt;-        self.tile_width = tile_width&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, format: str, data: np.ndarray=None, header: Header=None) -&amp;gt; None:&lt;/span&gt;
         self.format = format
         self.data = data
&lt;span class="gd"&gt;-        self.base_url = base_url&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @staticmethod&lt;/span&gt;
&lt;span class="gd"&gt;-    def _directory(ipix: int) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Directory of the HiPS tile (`int`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return np.around(ipix, decimals=-(len(str(ipix)) - 1))&lt;/span&gt;
&lt;span class="gi"&gt;+        self.header = header&lt;/span&gt;

     @property
     def path(self) -&amp;gt; Path:
         """Default path for tile storage (`Path`)."""
         return Path('hips', 'tiles', 'tests', 'data')

&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def tile_url(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gd"&gt;-        """HiPS tile url (`str`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return ''.join([self.base_url, '/Norder', str(self.order), '/Dir',&lt;/span&gt;
&lt;span class="gd"&gt;-               str(self._directory(self.ipix)), '/Npix', str(self.ipix), '.', self.format])&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def fetch(cls, format: str, url: str) -&amp;gt; HipsTile:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Fetch HiPS tile and load into memory (`HipsTile`).&lt;/span&gt;

&lt;span class="gd"&gt;-    def fetch(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Fetch HiPS tile and load into memory (`None`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        raw_image = BytesIO(urllib.request.urlopen(self.tile_url).read())&lt;/span&gt;
&lt;span class="gd"&gt;-        if self.format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        format : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+            Format of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+        url : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+            URL containing HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        raw_image = BytesIO(urllib.request.urlopen(url).read())&lt;/span&gt;
&lt;span class="gi"&gt;+        if format == 'fits':&lt;/span&gt;
             hdulist = fits.open(raw_image)
&lt;span class="gd"&gt;-            self.data = np.array(hdulist[0].data)&lt;/span&gt;
&lt;span class="gd"&gt;-            self.header = hdulist[0].header&lt;/span&gt;
&lt;span class="gi"&gt;+            data = np.array(hdulist[0].data)&lt;/span&gt;
&lt;span class="gi"&gt;+            header = hdulist[0].header&lt;/span&gt;
&lt;span class="gi"&gt;+            return cls(format, data, header)&lt;/span&gt;
         else:
&lt;span class="gd"&gt;-            self.data = np.array(Image.open(raw_image))&lt;/span&gt;
&lt;span class="gi"&gt;+            data = np.array(Image.open(raw_image))&lt;/span&gt;
&lt;span class="gi"&gt;+            return cls(format, data)&lt;/span&gt;

&lt;span class="gd"&gt;-    def read(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Read HiPS tile data from a directory and load into memory (`None`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        path = self.path / (''.join(['Npix', str(self.ipix), '.', self.format]))&lt;/span&gt;
&lt;span class="gd"&gt;-        if self.format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def read(cls, format: str, filename: str) -&amp;gt; 'HipsTile':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Read HiPS tile data from a directory and load into memory (`HipsTile`).&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        format : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+            Format of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+        filename : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+            File name of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        path = Path('hips', 'tiles', 'tests', 'data') / filename&lt;/span&gt;
&lt;span class="gi"&gt;+        if format == 'fits':&lt;/span&gt;
             hdulist = fits.open(path)
&lt;span class="gd"&gt;-            self.data = np.array(hdulist[0].data)&lt;/span&gt;
&lt;span class="gd"&gt;-            self.header = hdulist[0].header&lt;/span&gt;
&lt;span class="gi"&gt;+            data = np.array(hdulist[0].data)&lt;/span&gt;
&lt;span class="gi"&gt;+            header = hdulist[0].header&lt;/span&gt;
&lt;span class="gi"&gt;+            return cls(format, data, header)&lt;/span&gt;
         else:
&lt;span class="gd"&gt;-            self.data = np.array(Image.open(str(path)))&lt;/span&gt;
&lt;span class="gi"&gt;+            data = np.array(Image.open(str(path)))&lt;/span&gt;
&lt;span class="gi"&gt;+            return cls(format, data)&lt;/span&gt;

     def write(self, filename: str) -&amp;gt; None:
         """Write HiPS tile by a given filename (`None`).
&lt;span class="gu"&gt;@@ -112,7 +104,7 @@ class HipsTile:&lt;/span&gt;
         filename : `str`
             Name of the file
         """
&lt;span class="gd"&gt;-        path = self.path / (''.join([filename, '.', self.format]))&lt;/span&gt;
&lt;span class="gi"&gt;+        path = self.path / filename&lt;/span&gt;
         if self.format == 'fits':
             hdu = fits.PrimaryHDU(self.data, header=self.header)
             hdulist = fits.HDUList([hdu])

commit 12f0b4fe059cdd29ecb1f37956320570c87791b8
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jun 20 17:58:47 2017 +0500

    Use / instead of joinpath

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index a0eca23..8b033e1 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -96,7 +96,7 @@ class HipsTile:&lt;/span&gt;

     def read(self) -&amp;gt; None:
         """Read HiPS tile data from a directory and load into memory (`None`)."""
&lt;span class="gd"&gt;-        path = self.path.joinpath(''.join(['Npix', str(self.ipix), '.', self.format]))&lt;/span&gt;
&lt;span class="gi"&gt;+        path = self.path / (''.join(['Npix', str(self.ipix), '.', self.format]))&lt;/span&gt;
         if self.format == 'fits':
             hdulist = fits.open(path)
             self.data = np.array(hdulist[0].data)
&lt;span class="gu"&gt;@@ -112,7 +112,7 @@ class HipsTile:&lt;/span&gt;
         filename : `str`
             Name of the file
         """
&lt;span class="gd"&gt;-        path = self.path.joinpath(''.join([filename, '.', self.format]))&lt;/span&gt;
&lt;span class="gi"&gt;+        path = self.path / (''.join([filename, '.', self.format]))&lt;/span&gt;
         if self.format == 'fits':
             hdu = fits.PrimaryHDU(self.data, header=self.header)
             hdulist = fits.HDUList([hdu])

commit 2876957883d4eacc7984fa554dc176b75f35c1ad
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jun 20 17:53:59 2017 +0500

    Change path opening method

&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 5f979d2..a0eca23 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -97,14 +97,12 @@ class HipsTile:&lt;/span&gt;
     def read(self) -&amp;gt; None:
         """Read HiPS tile data from a directory and load into memory (`None`)."""
         path = self.path.joinpath(''.join(['Npix', str(self.ipix), '.', self.format]))
&lt;span class="gd"&gt;-        with path.open('rb') as rf:&lt;/span&gt;
&lt;span class="gd"&gt;-            raw_img = BytesIO(rf.read())&lt;/span&gt;
&lt;span class="gd"&gt;-            if self.format == 'fits':&lt;/span&gt;
&lt;span class="gd"&gt;-                hdulist = fits.open(raw_img)&lt;/span&gt;
&lt;span class="gd"&gt;-                self.data = np.array(hdulist[0].data)&lt;/span&gt;
&lt;span class="gd"&gt;-                self.header = hdulist[0].header&lt;/span&gt;
&lt;span class="gd"&gt;-            else:&lt;/span&gt;
&lt;span class="gd"&gt;-                self.data = np.array(Image.open(raw_img))&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+            hdulist = fits.open(path)&lt;/span&gt;
&lt;span class="gi"&gt;+            self.data = np.array(hdulist[0].data)&lt;/span&gt;
&lt;span class="gi"&gt;+            self.header = hdulist[0].header&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            self.data = np.array(Image.open(str(path)))&lt;/span&gt;

     def write(self, filename: str) -&amp;gt; None:
         """Write HiPS tile by a given filename (`None`).

commit b937d1486e2c67c2519c8b572b43e899536ca24c
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jun 20 14:30:02 2017 +0500

    Update tiles.hips module

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/data/Npix24185.fits b/hips/tiles/tests/data/Npix24185.fits&lt;/span&gt;
deleted file mode 100644
&lt;span class="gh"&gt;index d9786f5..0000000&lt;/span&gt;
Binary files a/hips/tiles/tests/data/Npix24185.fits and /dev/null differ
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/data/Npix24185.jpg b/hips/tiles/tests/data/Npix24185.jpg&lt;/span&gt;
deleted file mode 100644
&lt;span class="gh"&gt;index 63254fa..0000000&lt;/span&gt;
Binary files a/hips/tiles/tests/data/Npix24185.jpg and /dev/null differ
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/data/Npix30889.fits b/hips/tiles/tests/data/Npix30889.fits&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..522852f&lt;/span&gt;
Binary files /dev/null and b/hips/tiles/tests/data/Npix30889.fits differ
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/data/Npix30889.jpg b/hips/tiles/tests/data/Npix30889.jpg&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..b6365db&lt;/span&gt;
Binary files /dev/null and b/hips/tiles/tests/data/Npix30889.jpg differ
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index a6c2107..1316b5d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,5 +1,6 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 from astropy.utils.data import get_pkg_data_filename
&lt;span class="gi"&gt;+from astropy.tests.helper import remote_data&lt;/span&gt;
 from ..description import HipsDescription
 from ..tile import HipsTile
 from pathlib import Path
&lt;span class="gu"&gt;@@ -11,38 +12,50 @@ class TestHipsTile:&lt;/span&gt;
         filename = get_pkg_data_filename('data/properties.txt')
         hips_description = HipsDescription.read(filename)

&lt;span class="gd"&gt;-        cls.tile = HipsTile(hips_description, 6, 24185, 'jpg', 512)&lt;/span&gt;
&lt;span class="gd"&gt;-        cls.tile.base_url = 'http://alasky.unistra.fr/DSS/DSSColor'&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.fits_tile = HipsTile(hips_description=hips_description, order=6,&lt;/span&gt;
&lt;span class="gi"&gt;+                            ipix=30889, format='fits', tile_width=512)&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.jpg_tile = HipsTile(hips_description=hips_description, order=6,&lt;/span&gt;
&lt;span class="gi"&gt;+                            ipix=30889, format='jpg', tile_width=512)&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.fits_tile.base_url = 'http://alasky.unistra.fr/2MASS/H'&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.jpg_tile.base_url = 'http://alasky.unistra.fr/2MASS/H'&lt;/span&gt;

     def test_base_url(self):
&lt;span class="gd"&gt;-        assert self.tile.base_url == 'http://alasky.unistra.fr/DSS/DSSColor'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.fits_tile.base_url == 'http://alasky.unistra.fr/2MASS/H'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.jpg_tile.base_url == 'http://alasky.unistra.fr/2MASS/H'&lt;/span&gt;

     def test_tile_url(self):
&lt;span class="gd"&gt;-        assert self.tile.tile_url == 'http://alasky.unistra.fr/DSS/DSSColor/Norder6/Dir20000/Npix24185.jpg'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.fits_tile.tile_url == 'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.fits'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.jpg_tile.tile_url == 'http://alasky.unistra.fr/2MASS/H/Norder6/Dir30000/Npix30889.jpg'&lt;/span&gt;

&lt;span class="gi"&gt;+    @remote_data&lt;/span&gt;
     def test_fetch(self):
&lt;span class="gd"&gt;-        self.tile.fetch()&lt;/span&gt;
&lt;span class="gi"&gt;+        self.fits_tile.fetch()&lt;/span&gt;
&lt;span class="gi"&gt;+        self.jpg_tile.fetch()&lt;/span&gt;

&lt;span class="gd"&gt;-        """&lt;/span&gt;
&lt;span class="gd"&gt;-        This data was obtain from 'http://alasky.unistra.fr/DSS/DSSColor/Norder6/Dir20000/Npix24185.jpg'&lt;/span&gt;
&lt;span class="gd"&gt;-        at the index [10, 20]&lt;/span&gt;
&lt;span class="gd"&gt;-        """&lt;/span&gt;
&lt;span class="gd"&gt;-        data_precomp = [0, 0, 0]&lt;/span&gt;
&lt;span class="gd"&gt;-        assert self.data[10, 20] == data_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+        shape_fits_precomp = (512, 512)&lt;/span&gt;
&lt;span class="gi"&gt;+        shape_jpg_precomp = (512, 512, 3)&lt;/span&gt;
&lt;span class="gi"&gt;+        data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.fits_tile.data.shape == shape_fits_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.jpg_tile.data.shape == shape_jpg_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+        assert list(self.fits_tile.data[510][:12]) == data_precomp&lt;/span&gt;

     def test_read(self):
&lt;span class="gd"&gt;-        self.tile.read()&lt;/span&gt;
&lt;span class="gi"&gt;+        self.fits_tile.read()&lt;/span&gt;
&lt;span class="gi"&gt;+        self.jpg_tile.read()&lt;/span&gt;

&lt;span class="gd"&gt;-        """&lt;/span&gt;
&lt;span class="gd"&gt;-        This data was obtain from 'http://alasky.unistra.fr/DSS/DSSColor/Norder6/Dir20000/Npix24185.jpg'&lt;/span&gt;
&lt;span class="gd"&gt;-        at the index [10, 20]&lt;/span&gt;
&lt;span class="gd"&gt;-        """&lt;/span&gt;
&lt;span class="gd"&gt;-        data_precomp = [0, 0, 0]&lt;/span&gt;
&lt;span class="gd"&gt;-        assert list(self.tile.data[10, 20]) == data_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+        shape_fits_precomp = (512, 512)&lt;/span&gt;
&lt;span class="gi"&gt;+        shape_jpg_precomp = (512, 512, 3)&lt;/span&gt;
&lt;span class="gi"&gt;+        data_precomp = [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]&lt;/span&gt;
&lt;span class="gi"&gt;+        assert (self.fits_tile.data.shape) == shape_fits_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+        assert (self.jpg_tile.data.shape) == shape_jpg_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+        assert list(self.fits_tile.data[510][:12]) == data_precomp&lt;/span&gt;

&lt;span class="gd"&gt;-    def test_store(self):&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_write(self):&lt;/span&gt;
         filename = 'test_file'
&lt;span class="gd"&gt;-        self.tile.store(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+        self.fits_tile.write(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+        self.jpg_tile.write(filename)&lt;/span&gt;

&lt;span class="gd"&gt;-        path = self.tile.path.joinpath(''.join([filename, '.', self.tile.format]))&lt;/span&gt;
&lt;span class="gd"&gt;-        assert True == path.is_file()&lt;/span&gt;
&lt;span class="gi"&gt;+        path_fits = self.fits_tile.path.joinpath(''.join([filename, '.', self.fits_tile.format]))&lt;/span&gt;
&lt;span class="gi"&gt;+        path_jpg = self.jpg_tile.path.joinpath(''.join([filename, '.', self.jpg_tile.format]))&lt;/span&gt;
&lt;span class="gi"&gt;+        assert True == path_fits.is_file()&lt;/span&gt;
&lt;span class="gi"&gt;+        assert True == path_jpg.is_file()&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index a55aa20..5f979d2 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,12 +1,11 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-from astropy.utils.data import get_pkg_data_filename&lt;/span&gt;
 from .description import HipsDescription
 from astropy.io import fits
 from pathlib import Path
 from io import BytesIO
 from PIL import Image
&lt;span class="gd"&gt;-import numpy as np&lt;/span&gt;
 import urllib.request
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;

 __all__ = [
     'HipsTile',
&lt;span class="gu"&gt;@@ -17,8 +16,8 @@ class HipsTile:&lt;/span&gt;
     """HiPS tile container.

     This class provides methods for fetching, reading,
&lt;span class="gd"&gt;-    and stroing a HiPS tile. It also contains a few&lt;/span&gt;
&lt;span class="gd"&gt;-    getters and setters around most commonly used&lt;/span&gt;
&lt;span class="gi"&gt;+    and writing a HiPS tile. It also contains a few&lt;/span&gt;
&lt;span class="gi"&gt;+    getters and setters around frequently used&lt;/span&gt;
     HiPS tile attributes.

     Parameters
&lt;span class="gu"&gt;@@ -26,43 +25,48 @@ class HipsTile:&lt;/span&gt;
     hips_description : `HipsDescription`
         Class HipsDescription contains HiPS properties
     order : `int`
&lt;span class="gd"&gt;-        Order of the HiPS&lt;/span&gt;
&lt;span class="gi"&gt;+        Order of the HiPS tile&lt;/span&gt;
     ipix : `int`
         HEALPix pixel number
&lt;span class="gd"&gt;-    tile_width : `int`&lt;/span&gt;
&lt;span class="gd"&gt;-        Width of HiPS tile&lt;/span&gt;
     format : `format`
         Format of HiPS tile
&lt;span class="gd"&gt;-    data : `list`&lt;/span&gt;
&lt;span class="gi"&gt;+    data : `numpy.ndarray`&lt;/span&gt;
         Pixel values of HiPS tile
&lt;span class="gi"&gt;+    tile_width : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+        Width of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    base_url : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+        Base URL of HiPS tile&lt;/span&gt;

     Examples
     --------
     ::

&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; import urllib.request&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsDescription
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; from astropy.utils.data import get_pkg_data_filename&lt;/span&gt;
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; filename = get_pkg_data_filename('tests/data/properties.txt')&lt;/span&gt;
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; hips_description = HipsDescription.read(filename)&lt;/span&gt;
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; hips_tile = HipsTile(hips_description, 6, 24185, 'fits')&lt;/span&gt;
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; tile.read()&lt;/span&gt;
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; tile.data&lt;/span&gt;
&lt;span class="gd"&gt;-        [[3617 3304 4196 ..., 4545 4800 5701]&lt;/span&gt;
&lt;span class="gd"&gt;-         [3638 3288 3934 ..., 4448 5029 4951]&lt;/span&gt;
&lt;span class="gd"&gt;-         [3116 3653 3412 ..., 5282 4406 4967]&lt;/span&gt;
&lt;span class="gd"&gt;-         ...,&lt;/span&gt;
&lt;span class="gd"&gt;-         [3890 3463 3448 ..., 5980 6902 6543]&lt;/span&gt;
&lt;span class="gd"&gt;-         [4845 4065 3821 ..., 6928 6557 7197]&lt;/span&gt;
&lt;span class="gd"&gt;-         [4261 3581 3842 ..., 7095 6390 6191]]&lt;/span&gt;
&lt;span class="gd"&gt;-    """&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from astropy.tests.helper import remote_data&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; text = urllib.request.urlopen('https://raw.githubusercontent.com/hipspy/hips/master/hips/tiles/tests/data/properties.txt').read() # doctest: +REMOTE_DATA&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_description = HipsDescription.parse(str(text))&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_tile = HipsTile(hips_description=hips_description, order=6, ipix=30889, format='fits', tile_width=512)&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_tile.read()&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_tile.data&lt;/span&gt;
&lt;span class="gi"&gt;+        array([[0, 0, 0, ..., 0, 0, 0],&lt;/span&gt;
&lt;span class="gi"&gt;+               [0, 0, 0, ..., 0, 0, 0],&lt;/span&gt;
&lt;span class="gi"&gt;+               [0, 0, 0, ..., 0, 0, 0],&lt;/span&gt;
&lt;span class="gi"&gt;+               ...,&lt;/span&gt;
&lt;span class="gi"&gt;+               [0, 0, 0, ..., 1, 0, 0],&lt;/span&gt;
&lt;span class="gi"&gt;+               [0, 0, 0, ..., 1, 0, 1],&lt;/span&gt;
&lt;span class="gi"&gt;+               [0, 0, 0, ..., 1, 0, 1]], dtype=int16)&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;

&lt;span class="gd"&gt;-    def __init__(self, hips_description: HipsDescription, order: int, ipix: int, format: str, data: list=None, tile_width: int=512) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, hips_description: HipsDescription, order: int, ipix: int, format: str,&lt;/span&gt;
&lt;span class="gi"&gt;+                 data: np.ndarray=None, tile_width: int=512, base_url: str=None) -&amp;gt; None:&lt;/span&gt;
         self.hips_description = hips_description
         self.order = order
         self.ipix = ipix
         self.tile_width = tile_width
         self.format = format
         self.data = data
&lt;span class="gi"&gt;+        self.base_url = base_url&lt;/span&gt;

     @staticmethod
     def _directory(ipix: int) -&amp;gt; int:
&lt;span class="gu"&gt;@@ -70,11 +74,6 @@ class HipsTile:&lt;/span&gt;
         return np.around(ipix, decimals=-(len(str(ipix)) - 1))

     @property
&lt;span class="gd"&gt;-    def base_url(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gd"&gt;-        """HiPS tile base url (`str`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return self._base_url&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
     def path(self) -&amp;gt; Path:
         """Default path for tile storage (`Path`)."""
         return Path('hips', 'tiles', 'tests', 'data')
&lt;span class="gu"&gt;@@ -82,17 +81,13 @@ class HipsTile:&lt;/span&gt;
     @property
     def tile_url(self) -&amp;gt; str:
         """HiPS tile url (`str`)."""
&lt;span class="gd"&gt;-        return ''.join([self._base_url, '/Norder', str(self.order), '/Dir', str(self._directory(self.ipix)), '/Npix', str(self.ipix), '.', self.format])&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @base_url.setter&lt;/span&gt;
&lt;span class="gd"&gt;-    def base_url(self, base_url: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Set the HiPS tile base url (`None`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        self._base_url = base_url&lt;/span&gt;
&lt;span class="gi"&gt;+        return ''.join([self.base_url, '/Norder', str(self.order), '/Dir',&lt;/span&gt;
&lt;span class="gi"&gt;+               str(self._directory(self.ipix)), '/Npix', str(self.ipix), '.', self.format])&lt;/span&gt;

     def fetch(self) -&amp;gt; None:
         """Fetch HiPS tile and load into memory (`None`)."""
         raw_image = BytesIO(urllib.request.urlopen(self.tile_url).read())
&lt;span class="gd"&gt;-        if self.format is 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.format == 'fits':&lt;/span&gt;
             hdulist = fits.open(raw_image)
             self.data = np.array(hdulist[0].data)
             self.header = hdulist[0].header
&lt;span class="gu"&gt;@@ -104,15 +99,15 @@ class HipsTile:&lt;/span&gt;
         path = self.path.joinpath(''.join(['Npix', str(self.ipix), '.', self.format]))
         with path.open('rb') as rf:
             raw_img = BytesIO(rf.read())
&lt;span class="gd"&gt;-            if self.format is 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+            if self.format == 'fits':&lt;/span&gt;
                 hdulist = fits.open(raw_img)
                 self.data = np.array(hdulist[0].data)
                 self.header = hdulist[0].header
             else:
                 self.data = np.array(Image.open(raw_img))

&lt;span class="gd"&gt;-    def store(self, filename: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Store HiPS tile by a given filename (`None`).&lt;/span&gt;
&lt;span class="gi"&gt;+    def write(self, filename: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Write HiPS tile by a given filename (`None`).&lt;/span&gt;

         Parameters
         ----------
&lt;span class="gu"&gt;@@ -120,12 +115,10 @@ class HipsTile:&lt;/span&gt;
             Name of the file
         """
         path = self.path.joinpath(''.join([filename, '.', self.format]))
&lt;span class="gd"&gt;-        print(path)&lt;/span&gt;
&lt;span class="gd"&gt;-        with path.open('w') as wf:&lt;/span&gt;
&lt;span class="gd"&gt;-            if self.format is 'fits':&lt;/span&gt;
&lt;span class="gd"&gt;-                hdu = fits.PrimaryHDU(self.data, header=self.header)&lt;/span&gt;
&lt;span class="gd"&gt;-                hdulist = fits.HDUList([hdu])&lt;/span&gt;
&lt;span class="gd"&gt;-                hdulist.writeto(wf)&lt;/span&gt;
&lt;span class="gd"&gt;-                hdulist.close()&lt;/span&gt;
&lt;span class="gd"&gt;-            else:&lt;/span&gt;
&lt;span class="gd"&gt;-                Image.fromarray(self.data).save(wf)&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.format == 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+            hdu = fits.PrimaryHDU(self.data, header=self.header)&lt;/span&gt;
&lt;span class="gi"&gt;+            hdulist = fits.HDUList([hdu])&lt;/span&gt;
&lt;span class="gi"&gt;+            hdulist.writeto(path)&lt;/span&gt;
&lt;span class="gi"&gt;+            hdulist.close()&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            Image.fromarray(self.data).save(str(path))&lt;/span&gt;

commit 7869a5d5e36a1bd2219b5b9212b2dcd68ffc77f9
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jun 19 10:34:01 2017 +0500

    Add tile_width property to HipsTile

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 535b005..a6c2107 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -11,7 +11,7 @@ class TestHipsTile:&lt;/span&gt;
         filename = get_pkg_data_filename('data/properties.txt')
         hips_description = HipsDescription.read(filename)

&lt;span class="gd"&gt;-        cls.tile = HipsTile(hips_description, 6, 24185, 'jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.tile = HipsTile(hips_description, 6, 24185, 'jpg', 512)&lt;/span&gt;
         cls.tile.base_url = 'http://alasky.unistra.fr/DSS/DSSColor'

     def test_base_url(self):
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 4f0fd3e..a55aa20 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -29,6 +29,8 @@ class HipsTile:&lt;/span&gt;
         Order of the HiPS
     ipix : `int`
         HEALPix pixel number
&lt;span class="gi"&gt;+    tile_width : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+        Width of HiPS tile&lt;/span&gt;
     format : `format`
         Format of HiPS tile
     data : `list`
&lt;span class="gu"&gt;@@ -54,10 +56,11 @@ class HipsTile:&lt;/span&gt;
          [4261 3581 3842 ..., 7095 6390 6191]]
     """

&lt;span class="gd"&gt;-    def __init__(self, hips_description: HipsDescription, order: int, ipix: int, format: str, data: list=None) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, hips_description: HipsDescription, order: int, ipix: int, format: str, data: list=None, tile_width: int=512) -&amp;gt; None:&lt;/span&gt;
         self.hips_description = hips_description
         self.order = order
         self.ipix = ipix
&lt;span class="gi"&gt;+        self.tile_width = tile_width&lt;/span&gt;
         self.format = format
         self.data = data


commit 27cca875b322df5a4b0a9caa01d081f9fb3054b0
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 16 20:16:00 2017 +0500

    Update tiles.hips module

    This commit adds some extra methods for reading tiles (from disk and URL). It also provides a method
    for storing a HiPS tile on disk. The docstring is updated to contain an example showing fetching of a HiPS tile.

&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/data/Npix24185.fits b/hips/tiles/tests/data/Npix24185.fits&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..d9786f5&lt;/span&gt;
Binary files /dev/null and b/hips/tiles/tests/data/Npix24185.fits differ
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/data/Npix24185.jpg b/hips/tiles/tests/data/Npix24185.jpg&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..63254fa&lt;/span&gt;
Binary files /dev/null and b/hips/tiles/tests/data/Npix24185.jpg differ
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index f1f050b..535b005 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,8 +1,9 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 from astropy.utils.data import get_pkg_data_filename
&lt;span class="gd"&gt;-from ..tile import HipsTile&lt;/span&gt;
 from ..description import HipsDescription
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+from ..tile import HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+from pathlib import Path&lt;/span&gt;
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;

 class TestHipsTile:
     @classmethod
&lt;span class="gu"&gt;@@ -11,14 +12,37 @@ class TestHipsTile:&lt;/span&gt;
         hips_description = HipsDescription.read(filename)

         cls.tile = HipsTile(hips_description, 6, 24185, 'jpg')
&lt;span class="gd"&gt;-        cls.tile.data = [0, 0, 0, 0]&lt;/span&gt;
         cls.tile.base_url = 'http://alasky.unistra.fr/DSS/DSSColor'

     def test_base_url(self):
         assert self.tile.base_url == 'http://alasky.unistra.fr/DSS/DSSColor'

&lt;span class="gd"&gt;-    def test_data(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        assert self.tile.data == [0, 0, 0, 0]&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
     def test_tile_url(self):
&lt;span class="gd"&gt;-        assert self.tile.get_tile_url(6, 24185, 'jpg') == 'http://alasky.unistra.fr/DSS/DSSColor/Norder6/Dir20000/Npix24185.jpg'&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.tile.tile_url == 'http://alasky.unistra.fr/DSS/DSSColor/Norder6/Dir20000/Npix24185.jpg'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_fetch(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        self.tile.fetch()&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        This data was obtain from 'http://alasky.unistra.fr/DSS/DSSColor/Norder6/Dir20000/Npix24185.jpg'&lt;/span&gt;
&lt;span class="gi"&gt;+        at the index [10, 20]&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        data_precomp = [0, 0, 0]&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.data[10, 20] == data_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_read(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        self.tile.read()&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        This data was obtain from 'http://alasky.unistra.fr/DSS/DSSColor/Norder6/Dir20000/Npix24185.jpg'&lt;/span&gt;
&lt;span class="gi"&gt;+        at the index [10, 20]&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        data_precomp = [0, 0, 0]&lt;/span&gt;
&lt;span class="gi"&gt;+        assert list(self.tile.data[10, 20]) == data_precomp&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_store(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        filename = 'test_file'&lt;/span&gt;
&lt;span class="gi"&gt;+        self.tile.store(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        path = self.tile.path.joinpath(''.join([filename, '.', self.tile.format]))&lt;/span&gt;
&lt;span class="gi"&gt;+        assert True == path.is_file()&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gh"&gt;index 70cad39..4f0fd3e 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,6 +1,12 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gi"&gt;+from astropy.utils.data import get_pkg_data_filename&lt;/span&gt;
 from .description import HipsDescription
&lt;span class="gi"&gt;+from astropy.io import fits&lt;/span&gt;
&lt;span class="gi"&gt;+from pathlib import Path&lt;/span&gt;
&lt;span class="gi"&gt;+from io import BytesIO&lt;/span&gt;
&lt;span class="gi"&gt;+from PIL import Image&lt;/span&gt;
 import numpy as np
&lt;span class="gi"&gt;+import urllib.request&lt;/span&gt;

 __all__ = [
     'HipsTile',
&lt;span class="gu"&gt;@@ -10,36 +16,113 @@ __all__ = [&lt;/span&gt;
 class HipsTile:
     """HiPS tile container.

&lt;span class="gi"&gt;+    This class provides methods for fetching, reading,&lt;/span&gt;
&lt;span class="gi"&gt;+    and stroing a HiPS tile. It also contains a few&lt;/span&gt;
&lt;span class="gi"&gt;+    getters and setters around most commonly used&lt;/span&gt;
&lt;span class="gi"&gt;+    HiPS tile attributes.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    hips_description : `HipsDescription`&lt;/span&gt;
&lt;span class="gi"&gt;+        Class HipsDescription contains HiPS properties&lt;/span&gt;
&lt;span class="gi"&gt;+    order : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+        Order of the HiPS&lt;/span&gt;
&lt;span class="gi"&gt;+    ipix : `int`&lt;/span&gt;
&lt;span class="gi"&gt;+        HEALPix pixel number&lt;/span&gt;
&lt;span class="gi"&gt;+    format : `format`&lt;/span&gt;
&lt;span class="gi"&gt;+        Format of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+    data : `list`&lt;/span&gt;
&lt;span class="gi"&gt;+        Pixel values of HiPS tile&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Examples&lt;/span&gt;
&lt;span class="gi"&gt;+    --------&lt;/span&gt;
&lt;span class="gi"&gt;+    ::&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from hips.tiles import HipsDescription&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from astropy.utils.data import get_pkg_data_filename&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; filename = get_pkg_data_filename('tests/data/properties.txt')&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_description = HipsDescription.read(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; hips_tile = HipsTile(hips_description, 6, 24185, 'fits')&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; tile.read()&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; tile.data&lt;/span&gt;
&lt;span class="gi"&gt;+        [[3617 3304 4196 ..., 4545 4800 5701]&lt;/span&gt;
&lt;span class="gi"&gt;+         [3638 3288 3934 ..., 4448 5029 4951]&lt;/span&gt;
&lt;span class="gi"&gt;+         [3116 3653 3412 ..., 5282 4406 4967]&lt;/span&gt;
&lt;span class="gi"&gt;+         ...,&lt;/span&gt;
&lt;span class="gi"&gt;+         [3890 3463 3448 ..., 5980 6902 6543]&lt;/span&gt;
&lt;span class="gi"&gt;+         [4845 4065 3821 ..., 6928 6557 7197]&lt;/span&gt;
&lt;span class="gi"&gt;+         [4261 3581 3842 ..., 7095 6390 6191]]&lt;/span&gt;
     """

&lt;span class="gd"&gt;-    def __init__(self, hips_description: HipsDescription, order: int, ipix: int, format: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, hips_description: HipsDescription, order: int, ipix: int, format: str, data: list=None) -&amp;gt; None:&lt;/span&gt;
         self.hips_description = hips_description
         self.order = order
         self.ipix = ipix
         self.format = format
&lt;span class="gi"&gt;+        self.data = data&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @staticmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def _directory(ipix: int) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Directory of the HiPS tile (`int`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return np.around(ipix, decimals=-(len(str(ipix)) - 1))&lt;/span&gt;

     @property
     def base_url(self) -&amp;gt; str:
         """HiPS tile base url (`str`)."""
&lt;span class="gd"&gt;-        return self.base_url&lt;/span&gt;
&lt;span class="gi"&gt;+        return self._base_url&lt;/span&gt;

     @property
&lt;span class="gd"&gt;-    def data(self) -&amp;gt; list:&lt;/span&gt;
&lt;span class="gd"&gt;-        """HiPS tile data (`list`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return self.data&lt;/span&gt;
&lt;span class="gi"&gt;+    def path(self) -&amp;gt; Path:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Default path for tile storage (`Path`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return Path('hips', 'tiles', 'tests', 'data')&lt;/span&gt;

     @property
     def tile_url(self) -&amp;gt; str:
         """HiPS tile url (`str`)."""
&lt;span class="gd"&gt;-        directory = np.around(self.ipix, decimals=-(len(str(self.ipix)) - 1))&lt;/span&gt;
&lt;span class="gd"&gt;-        return ''.join([self.base_url, '/Norder', str(self.order), '/Dir', str(directory), '/Npix', str(self.ipix), '.', self.format])&lt;/span&gt;
&lt;span class="gi"&gt;+        return ''.join([self._base_url, '/Norder', str(self.order), '/Dir', str(self._directory(self.ipix)), '/Npix', str(self.ipix), '.', self.format])&lt;/span&gt;

     @base_url.setter
     def base_url(self, base_url: str) -&amp;gt; None:
         """Set the HiPS tile base url (`None`)."""
         self._base_url = base_url

&lt;span class="gd"&gt;-    @data.setter&lt;/span&gt;
&lt;span class="gd"&gt;-    def data(self, data: list) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Set the HiPS tile data (`None`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        self.data = data&lt;/span&gt;
&lt;span class="gi"&gt;+    def fetch(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Fetch HiPS tile and load into memory (`None`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        raw_image = BytesIO(urllib.request.urlopen(self.tile_url).read())&lt;/span&gt;
&lt;span class="gi"&gt;+        if self.format is 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+            hdulist = fits.open(raw_image)&lt;/span&gt;
&lt;span class="gi"&gt;+            self.data = np.array(hdulist[0].data)&lt;/span&gt;
&lt;span class="gi"&gt;+            self.header = hdulist[0].header&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            self.data = np.array(Image.open(raw_image))&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def read(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Read HiPS tile data from a directory and load into memory (`None`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        path = self.path.joinpath(''.join(['Npix', str(self.ipix), '.', self.format]))&lt;/span&gt;
&lt;span class="gi"&gt;+        with path.open('rb') as rf:&lt;/span&gt;
&lt;span class="gi"&gt;+            raw_img = BytesIO(rf.read())&lt;/span&gt;
&lt;span class="gi"&gt;+            if self.format is 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+                hdulist = fits.open(raw_img)&lt;/span&gt;
&lt;span class="gi"&gt;+                self.data = np.array(hdulist[0].data)&lt;/span&gt;
&lt;span class="gi"&gt;+                self.header = hdulist[0].header&lt;/span&gt;
&lt;span class="gi"&gt;+            else:&lt;/span&gt;
&lt;span class="gi"&gt;+                self.data = np.array(Image.open(raw_img))&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def store(self, filename: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Store HiPS tile by a given filename (`None`).&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        filename : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+            Name of the file&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        path = self.path.joinpath(''.join([filename, '.', self.format]))&lt;/span&gt;
&lt;span class="gi"&gt;+        print(path)&lt;/span&gt;
&lt;span class="gi"&gt;+        with path.open('w') as wf:&lt;/span&gt;
&lt;span class="gi"&gt;+            if self.format is 'fits':&lt;/span&gt;
&lt;span class="gi"&gt;+                hdu = fits.PrimaryHDU(self.data, header=self.header)&lt;/span&gt;
&lt;span class="gi"&gt;+                hdulist = fits.HDUList([hdu])&lt;/span&gt;
&lt;span class="gi"&gt;+                hdulist.writeto(wf)&lt;/span&gt;
&lt;span class="gi"&gt;+                hdulist.close()&lt;/span&gt;
&lt;span class="gi"&gt;+            else:&lt;/span&gt;
&lt;span class="gi"&gt;+                Image.fromarray(self.data).save(wf)&lt;/span&gt;

commit b5a268688e48d775a6aceb82898af8fc745c3b9f
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 15 15:32:30 2017 +0500

    Update tiles.hips module

    Renamed the main Hips class to HipsTile. Added additional methods and test cases

&lt;span class="gh"&gt;diff --git a/hips/tiles/__init__.py b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gh"&gt;index 12ac39b..f6101be 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,4 +1,4 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 """Classes and functions to manage HiPS tiles."""
&lt;span class="gd"&gt;-from .hips import *&lt;/span&gt;
&lt;span class="gi"&gt;+from .tile import *&lt;/span&gt;
 from .description import *
&lt;span class="gh"&gt;diff --git a/hips/tiles/hips.py b/hips/tiles/hips.py&lt;/span&gt;
deleted file mode 100644
&lt;span class="gh"&gt;index c01c0b8..0000000&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/hips.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ /dev/null&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,31 +0,0 @@&lt;/span&gt;
&lt;span class="gd"&gt;-# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gd"&gt;-from .description import HipsDescription&lt;/span&gt;
&lt;span class="gd"&gt;-import numpy as np&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-__all__ = [&lt;/span&gt;
&lt;span class="gd"&gt;-    'Hips',&lt;/span&gt;
&lt;span class="gd"&gt;-]&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-class Hips:&lt;/span&gt;
&lt;span class="gd"&gt;-    """HiPS base url container.&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    """&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def __init__(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        pass&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def base_url(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gd"&gt;-        """HiPS base url (`str`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return self.base_url&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @base_url.setter&lt;/span&gt;
&lt;span class="gd"&gt;-    def base_url(self, base_url: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Set the HiPS base url (`None`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        self.base_url = base_url&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def get_tile_url(self, order: int, ipix: int, format: str) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gd"&gt;-        """HiPS tile url (`str`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        directory = np.around(ipix, decimals=-(len(str(ipix)) - 1))&lt;/span&gt;
&lt;span class="gd"&gt;-        return ''.join([self.base_url, '/Norder', str(order), '/Dir', str(directory), '/Npix', str(ipix), '.', format])&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_hips.py b/hips/tiles/tests/test_hips.py&lt;/span&gt;
deleted file mode 100644
&lt;span class="gh"&gt;index 831ccb3..0000000&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_hips.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ /dev/null&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,15 +0,0 @@&lt;/span&gt;
&lt;span class="gd"&gt;-# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gd"&gt;-from ..hips import Hips&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-class TestHiPS:&lt;/span&gt;
&lt;span class="gd"&gt;-    @classmethod&lt;/span&gt;
&lt;span class="gd"&gt;-    def setup_class(cls):&lt;/span&gt;
&lt;span class="gd"&gt;-        cls.hips = Hips&lt;/span&gt;
&lt;span class="gd"&gt;-        cls.hips.base_url = 'http://alasky.unistra.fr/DSS/DSSColor'&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_base_url(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        assert self.hips.base_url == 'http://alasky.unistra.fr/DSS/DSSColor'&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_tile_url(self):&lt;/span&gt;
&lt;span class="gd"&gt;-        assert self.hips.get_tile_url(self.hips, 6, 24185, 'jpg') == 'http://alasky.unistra.fr/DSS/DSSColor/Norder6/Dir20000/Npix24185.jpg'&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_tile.py b/hips/tiles/tests/test_tile.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..f1f050b&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,24 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.utils.data import get_pkg_data_filename&lt;/span&gt;
&lt;span class="gi"&gt;+from ..tile import HipsTile&lt;/span&gt;
&lt;span class="gi"&gt;+from ..description import HipsDescription&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class TestHipsTile:&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def setup_class(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        filename = get_pkg_data_filename('data/properties.txt')&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_description = HipsDescription.read(filename)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.tile = HipsTile(hips_description, 6, 24185, 'jpg')&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.tile.data = [0, 0, 0, 0]&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.tile.base_url = 'http://alasky.unistra.fr/DSS/DSSColor'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_base_url(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.tile.base_url == 'http://alasky.unistra.fr/DSS/DSSColor'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_data(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.tile.data == [0, 0, 0, 0]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_tile_url(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.tile.get_tile_url(6, 24185, 'jpg') == 'http://alasky.unistra.fr/DSS/DSSColor/Norder6/Dir20000/Npix24185.jpg'&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tile.py b/hips/tiles/tile.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..70cad39&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tile.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,45 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+from .description import HipsDescription&lt;/span&gt;
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+__all__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'HipsTile',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class HipsTile:&lt;/span&gt;
&lt;span class="gi"&gt;+    """HiPS tile container.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, hips_description: HipsDescription, order: int, ipix: int, format: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.hips_description = hips_description&lt;/span&gt;
&lt;span class="gi"&gt;+        self.order = order&lt;/span&gt;
&lt;span class="gi"&gt;+        self.ipix = ipix&lt;/span&gt;
&lt;span class="gi"&gt;+        self.format = format&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def base_url(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """HiPS tile base url (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.base_url&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def data(self) -&amp;gt; list:&lt;/span&gt;
&lt;span class="gi"&gt;+        """HiPS tile data (`list`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.data&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def tile_url(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """HiPS tile url (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        directory = np.around(self.ipix, decimals=-(len(str(self.ipix)) - 1))&lt;/span&gt;
&lt;span class="gi"&gt;+        return ''.join([self.base_url, '/Norder', str(self.order), '/Dir', str(directory), '/Npix', str(self.ipix), '.', self.format])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @base_url.setter&lt;/span&gt;
&lt;span class="gi"&gt;+    def base_url(self, base_url: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Set the HiPS tile base url (`None`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        self._base_url = base_url&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @data.setter&lt;/span&gt;
&lt;span class="gi"&gt;+    def data(self, data: list) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Set the HiPS tile data (`None`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        self.data = data&lt;/span&gt;

commit 1f0b0dfb873e83e3af0d432e49a245ec650636da
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jun 14 09:27:43 2017 +0500

    Remove blank lines and docstring

&lt;span class="gh"&gt;diff --git a/hips/tiles/hips.py b/hips/tiles/hips.py&lt;/span&gt;
&lt;span class="gh"&gt;index 1c7fafd..c01c0b8 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/hips.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/hips.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,7 +1,4 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-"""Classes and functions to manage HiPS tiles."""&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
 from .description import HipsDescription
 import numpy as np


commit 6826c7b9f97f45b2ce62b6f700a7a8758c9661a3
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jun 14 09:24:54 2017 +0500

    Update .gitignore to ignore Mypy cache directory

&lt;span class="gh"&gt;diff --git a/.gitignore b/.gitignore&lt;/span&gt;
&lt;span class="gh"&gt;index 21dfb4f..ad63e7f 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/.gitignore&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/.gitignore&lt;/span&gt;
&lt;span class="gu"&gt;@@ -29,6 +29,9 @@ docs/_build&lt;/span&gt;
 # Pycharm editor project files
 .idea

&lt;span class="gi"&gt;+# Mypy cache&lt;/span&gt;
&lt;span class="gi"&gt;+.mypy_cache&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 # Floobits project files
 .floo
 .flooignore

commit a16a78f789b5f96f814a8856f503f979693202cb
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jun 14 09:24:00 2017 +0500

    Add tiles.hips package

&lt;span class="gh"&gt;diff --git a/hips/tiles/__init__.py b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gh"&gt;index d19ff3e..12ac39b 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,3 +1,4 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 """Classes and functions to manage HiPS tiles."""
&lt;span class="gi"&gt;+from .hips import *&lt;/span&gt;
 from .description import *
&lt;span class="gh"&gt;diff --git a/hips/tiles/hips.py b/hips/tiles/hips.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..1c7fafd&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/hips.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,34 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+"""Classes and functions to manage HiPS tiles."""&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from .description import HipsDescription&lt;/span&gt;
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+__all__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'Hips',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class Hips:&lt;/span&gt;
&lt;span class="gi"&gt;+    """HiPS base url container.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        pass&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def base_url(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """HiPS base url (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.base_url&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @base_url.setter&lt;/span&gt;
&lt;span class="gi"&gt;+    def base_url(self, base_url: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Set the HiPS base url (`None`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        self.base_url = base_url&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def get_tile_url(self, order: int, ipix: int, format: str) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """HiPS tile url (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        directory = np.around(ipix, decimals=-(len(str(ipix)) - 1))&lt;/span&gt;
&lt;span class="gi"&gt;+        return ''.join([self.base_url, '/Norder', str(order), '/Dir', str(directory), '/Npix', str(ipix), '.', format])&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_hips.py b/hips/tiles/tests/test_hips.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..831ccb3&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_hips.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,15 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+from ..hips import Hips&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class TestHiPS:&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def setup_class(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.hips = Hips&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.hips.base_url = 'http://alasky.unistra.fr/DSS/DSSColor'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_base_url(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips.base_url == 'http://alasky.unistra.fr/DSS/DSSColor'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_tile_url(self):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert self.hips.get_tile_url(self.hips, 6, 24185, 'jpg') == 'http://alasky.unistra.fr/DSS/DSSColor/Norder6/Dir20000/Npix24185.jpg'&lt;/span&gt;

commit 0ffe20e0ea787f11df65cd384c63e03c522aa514
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jun 21 13:31:42 2017 +0500

    Update hips.utils package

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 584be5f..c485bc0 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -5,6 +5,8 @@ This module contains wrapper functions around HEALPix utilizing&lt;/span&gt;
 the healpy library
 """

&lt;span class="gi"&gt;+__doctest_skip__ = ['boundaries', 'compute_healpix_pixel_indices']&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 __all__ = [
     'boundaries', 'compute_healpix_pixel_indices'
 ]
&lt;span class="gu"&gt;@@ -87,15 +89,17 @@ def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, nside: int) -&amp;gt; np.n&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; order = 3
         &amp;gt;&amp;gt;&amp;gt; nside = hp.order2nside(order)
         &amp;gt;&amp;gt;&amp;gt; skycoord = SkyCoord(10, 20, unit="deg")
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; wcs_geometry = WCSGeometry.create(skydir=skycoord, shape=(10, 20), coordsys='CEL', projection='AIT', cdelt=1.0, crpix=(1., 1.))&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; wcs_geometry = WCSGeometry.create(skydir=skycoord, shape=(10, 20), \&lt;/span&gt;
&lt;span class="gi"&gt;+coordsys='CEL', projection='AIT', \&lt;/span&gt;
&lt;span class="gi"&gt;+cdelt=1.0, crpix=(1., 1.))&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; compute_healpix_pixel_indices(wcs_geometry, nside)
         [ 84 111 112 113 142 143 144 145 146 174 175 176 177 178 206 207 208 209
         210 238 239 240 241 270 271 272 273 274 302 303 304 305 334 335 336 337
         367 368 399]
     """
&lt;span class="gd"&gt;-    y_center, x_center = wcs_geometry.shape[0] // 2, wcs_geometry.shape[1] // 2&lt;/span&gt;
&lt;span class="gi"&gt;+    y_center, x_center = wcs_geometry.Shape.ny / 2, wcs_geometry.Shape.nx / 2&lt;/span&gt;
     lon_center, lat_center = wcs_geometry.wcs.all_pix2world(x_center, y_center, 1)
&lt;span class="gd"&gt;-    vec = hp.ang2vec(lon_center, lat_center, lonlat=True)&lt;/span&gt;
     separations = angular_separation(x_center, y_center, lon_center, lat_center)
     max_separation = np.nanmax(separations)
&lt;span class="gi"&gt;+    vec = hp.ang2vec(lon_center, lat_center, lonlat=True)&lt;/span&gt;
     return hp.query_disc(nside, vec, max_separation)
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 3d8952e..ec2dc3d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -26,15 +26,14 @@ def test_boundaries():&lt;/span&gt;
     assert_allclose([radec.ra, radec.dec], radec_precomp)

 def test_compute_healpix_pixel_indices():
&lt;span class="gd"&gt;-    order = 3&lt;/span&gt;
&lt;span class="gd"&gt;-    nside = hp.order2nside(order)&lt;/span&gt;
&lt;span class="gi"&gt;+    nside = hp.order2nside(order=3)&lt;/span&gt;

     skycoord = SkyCoord(10, 20, unit="deg")
&lt;span class="gd"&gt;-    wcs_geometry = WCSGeometry.create(skydir=skycoord, shape=(10, 20), coordsys='CEL', projection='AIT', cdelt=1.0, crpix=(1., 1.))&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+    wcs_geometry_CEL = WCSGeometry.create(skydir=skycoord, shape=(10, 20), coordsys='CEL',&lt;/span&gt;
&lt;span class="gi"&gt;+                                      projection='AIT', cdelt=1.0, crpix=(1., 1.))&lt;/span&gt;
&lt;span class="gi"&gt;+    wcs_geometry_GAL = WCSGeometry.create(skydir=skycoord, shape=(10, 20), coordsys='GAL',&lt;/span&gt;
&lt;span class="gi"&gt;+                                      projection='AIT', cdelt=1.0, crpix=(1., 1.))&lt;/span&gt;
     pixels_precomp = [84, 111, 112, 113]
&lt;span class="gd"&gt;-    len_precomp = 39&lt;/span&gt;
&lt;span class="gd"&gt;-    pixels = compute_healpix_pixel_indices(wcs_geometry, nside)&lt;/span&gt;
&lt;span class="gd"&gt;-    print(pixels)&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(len(pixels), len_precomp)&lt;/span&gt;
&lt;span class="gi"&gt;+    pixels = compute_healpix_pixel_indices(wcs_geometry_CEL, nside)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert len(pixels) == 39&lt;/span&gt;
     assert_allclose(pixels[0:4], pixels_precomp)
&lt;span class="gh"&gt;diff --git a/hips/utils/wcs.py b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index d1d365e..9a58482 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,8 +1,11 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 import numpy as np
 from astropy.wcs import WCS
&lt;span class="gi"&gt;+from collections import namedtuple&lt;/span&gt;
 from astropy.coordinates import SkyCoord

&lt;span class="gi"&gt;+__doctest_skip__ = ['WCSGeometry']&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 __all__ = [
     'WCSGeometry',
 ]
&lt;span class="gu"&gt;@@ -25,7 +28,9 @@ class WCSGeometry:&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; from hips.utils import WCSGeometry
         &amp;gt;&amp;gt;&amp;gt; from astropy.coordinates import SkyCoord
         &amp;gt;&amp;gt;&amp;gt; skycoord = SkyCoord(10, 20, unit="deg")
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; wcs_geometry = WCSGeometry.create(skydir=skycoord, shape=(10, 20), coordsys='CEL', projection='AIT', cdelt=1.0, crpix=1.)&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; wcs_geometry = WCSGeometry.create(skydir=skycoord, shape=(10, 20), \&lt;/span&gt;
&lt;span class="gi"&gt;+coordsys='CEL', projection='AIT', \&lt;/span&gt;
&lt;span class="gi"&gt;+cdelt=1.0, crpix=1.)&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; wcs_geometry.wcs
         Number of WCS axes: 2
         CTYPE : 'RA---AIT'  'DEC--AIT'
&lt;span class="gu"&gt;@@ -41,7 +46,7 @@ class WCSGeometry:&lt;/span&gt;

     def __init__(self, wcs: WCS, shape: tuple) -&amp;gt; None:
         self.wcs = wcs
&lt;span class="gd"&gt;-        self.shape = shape&lt;/span&gt;
&lt;span class="gi"&gt;+        self.Shape = namedtuple('Shape', ['ny', 'nx'])(*shape)&lt;/span&gt;

     @classmethod
     def create(cls, skydir: SkyCoord, shape: tuple, coordsys: str='CEL',
&lt;span class="gu"&gt;@@ -77,7 +82,7 @@ class WCSGeometry:&lt;/span&gt;
             w.wcs.crval[0] = skydir.galactic.l.deg
             w.wcs.crval[1] = skydir.galactic.b.deg
         else:
&lt;span class="gd"&gt;-            raise ValueError('Unrecognized coordinate system.')&lt;/span&gt;
&lt;span class="gi"&gt;+            raise ValueError('Unrecognized coordinate system.') # pragma: no cover&lt;/span&gt;

         w.wcs.crpix[0] = crpix[0]
         w.wcs.crpix[1] = crpix[1]

commit 8f3139dfd23e9624e4cd9dafd412889cc49a340e
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jun 19 13:41:23 2017 +0500

    Update hips.utils package

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 4dfb22a..584be5f 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -58,11 +58,11 @@ def boundaries(nside: int, pix: int, nest: bool=True) -&amp;gt; tuple:&lt;/span&gt;
     return theta, phi

 def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, nside: int) -&amp;gt; np.ndarray:
&lt;span class="gd"&gt;-    """Returns an array containing pixels corresponding to an image.&lt;/span&gt;
&lt;span class="gi"&gt;+    """Returns an array containing HEALPix pixels corresponding to disk regions.&lt;/span&gt;

     This function calls `healpy.pixelfunc.ang2vec`, `healpy.query_disc`, and
     `astropy.coordinates.angle_utilities.angular_separation` to compute
&lt;span class="gd"&gt;-    the pixel values, which will be use in tile drawing.&lt;/span&gt;
&lt;span class="gi"&gt;+    the HEALPix pixel indices, which will be used in tile drawing.&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gu"&gt;@@ -75,6 +75,23 @@ def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, nside: int) -&amp;gt; np.n&lt;/span&gt;
     -------
     pixels : `numpy.ndarray`
         HEALPix pixel numbers
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Examples&lt;/span&gt;
&lt;span class="gi"&gt;+    --------&lt;/span&gt;
&lt;span class="gi"&gt;+    ::&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; import healpy as hp&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from hips.utils import WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from hips.utils import compute_healpix_pixel_indices&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; order = 3&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; nside = hp.order2nside(order)&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; skycoord = SkyCoord(10, 20, unit="deg")&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; wcs_geometry = WCSGeometry.create(skydir=skycoord, shape=(10, 20), coordsys='CEL', projection='AIT', cdelt=1.0, crpix=(1., 1.))&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; compute_healpix_pixel_indices(wcs_geometry, nside)&lt;/span&gt;
&lt;span class="gi"&gt;+        [ 84 111 112 113 142 143 144 145 146 174 175 176 177 178 206 207 208 209&lt;/span&gt;
&lt;span class="gi"&gt;+        210 238 239 240 241 270 271 272 273 274 302 303 304 305 334 335 336 337&lt;/span&gt;
&lt;span class="gi"&gt;+        367 368 399]&lt;/span&gt;
     """
     y_center, x_center = wcs_geometry.shape[0] // 2, wcs_geometry.shape[1] // 2
     lon_center, lat_center = wcs_geometry.wcs.all_pix2world(x_center, y_center, 1)
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8945ee4..3d8952e 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -30,13 +30,11 @@ def test_compute_healpix_pixel_indices():&lt;/span&gt;
     nside = hp.order2nside(order)

     skycoord = SkyCoord(10, 20, unit="deg")
&lt;span class="gd"&gt;-    wcs_geometry = WCSGeometry.create(skycoord, (10, 20), 'CEL', 'AIT', 1.0, 1)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    """&lt;/span&gt;
&lt;span class="gd"&gt;-    These pixel values were obtained for the all-sky image located at:&lt;/span&gt;
&lt;span class="gd"&gt;-    https://github.com/gammapy/gammapy-extra/blob/master/datasets/catalogs/fermi/gll_psch_v08.fit.gz?raw=true&lt;/span&gt;
&lt;span class="gd"&gt;-    """&lt;/span&gt;
&lt;span class="gd"&gt;-    pixels_precomp = [0, 767]&lt;/span&gt;
&lt;span class="gi"&gt;+    wcs_geometry = WCSGeometry.create(skydir=skycoord, shape=(10, 20), coordsys='CEL', projection='AIT', cdelt=1.0, crpix=(1., 1.))&lt;/span&gt;

&lt;span class="gi"&gt;+    pixels_precomp = [84, 111, 112, 113]&lt;/span&gt;
&lt;span class="gi"&gt;+    len_precomp = 39&lt;/span&gt;
     pixels = compute_healpix_pixel_indices(wcs_geometry, nside)
&lt;span class="gd"&gt;-    assert_allclose([pixels[0], pixels[-1]], pixels_precomp)&lt;/span&gt;
&lt;span class="gi"&gt;+    print(pixels)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(len(pixels), len_precomp)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(pixels[0:4], pixels_precomp)&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/wcs.py b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index 472d009..d1d365e 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -17,25 +17,36 @@ class WCSGeometry:&lt;/span&gt;
         WCS projection object
     shape : tuple
         Shape of the image
&lt;span class="gd"&gt;-    """&lt;/span&gt;

&lt;span class="gd"&gt;-    def __init__(self, wcs: WCS, shape: tuple) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        self._wcs = wcs&lt;/span&gt;
&lt;span class="gd"&gt;-        self._shape = shape&lt;/span&gt;
&lt;span class="gi"&gt;+    Examples&lt;/span&gt;
&lt;span class="gi"&gt;+    --------&lt;/span&gt;
&lt;span class="gi"&gt;+    ::&lt;/span&gt;

&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def shape(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Shape of the image (`None`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return self._shape&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from hips.utils import WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; skycoord = SkyCoord(10, 20, unit="deg")&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; wcs_geometry = WCSGeometry.create(skydir=skycoord, shape=(10, 20), coordsys='CEL', projection='AIT', cdelt=1.0, crpix=1.)&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; wcs_geometry.wcs&lt;/span&gt;
&lt;span class="gi"&gt;+        Number of WCS axes: 2&lt;/span&gt;
&lt;span class="gi"&gt;+        CTYPE : 'RA---AIT'  'DEC--AIT'&lt;/span&gt;
&lt;span class="gi"&gt;+        CRVAL : 10.0  20.0&lt;/span&gt;
&lt;span class="gi"&gt;+        CRPIX : 1.0  1.0&lt;/span&gt;
&lt;span class="gi"&gt;+        PC1_1 PC1_2  : 1.0  0.0&lt;/span&gt;
&lt;span class="gi"&gt;+        PC2_1 PC2_2  : 0.0  1.0&lt;/span&gt;
&lt;span class="gi"&gt;+        CDELT : -1.0  1.0&lt;/span&gt;
&lt;span class="gi"&gt;+        NAXIS : 0  0&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; wcs_geometry.shape&lt;/span&gt;
&lt;span class="gi"&gt;+        (10, 20)&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;

&lt;span class="gd"&gt;-    @property&lt;/span&gt;
&lt;span class="gd"&gt;-    def wcs(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        """WCS object containing FITS image header (`None`)."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return self._wcs&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, wcs: WCS, shape: tuple) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.wcs = wcs&lt;/span&gt;
&lt;span class="gi"&gt;+        self.shape = shape&lt;/span&gt;

     @classmethod
&lt;span class="gd"&gt;-    def create(cls, skydir: SkyCoord, shape: tuple, coordsys: str='CEL', projection: str='AIT', cdelt: float=1.0, crpix: float=1.) -&amp;gt; 'WCSGeometry':&lt;/span&gt;
&lt;span class="gd"&gt;-        """Read from HiPS description file (`WCSGeometry`).&lt;/span&gt;
&lt;span class="gi"&gt;+    def create(cls, skydir: SkyCoord, shape: tuple, coordsys: str='CEL',&lt;/span&gt;
&lt;span class="gi"&gt;+        projection: str='AIT', cdelt: float=1.0, crpix: tuple=(1., 1.)) -&amp;gt; 'WCSGeometry':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Create WCS object programmatically (`WCSGeometry`).&lt;/span&gt;

         Parameters
         ----------
&lt;span class="gu"&gt;@@ -49,15 +60,11 @@ class WCSGeometry:&lt;/span&gt;
             Projection of the WCS object
         cdelt : `float`
             Coordinate increment at reference point
&lt;span class="gd"&gt;-        crpix : `float`&lt;/span&gt;
&lt;span class="gd"&gt;-            Pixel coordinate of reference point&lt;/span&gt;
&lt;span class="gi"&gt;+        crpix : `tuple`&lt;/span&gt;
&lt;span class="gi"&gt;+            Pixel coordinates of reference point&lt;/span&gt;
         """

&lt;span class="gd"&gt;-        naxis = 2&lt;/span&gt;
&lt;span class="gd"&gt;-        if shape is not None:&lt;/span&gt;
&lt;span class="gd"&gt;-            naxis += len(shape)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        w = WCS(naxis=naxis)&lt;/span&gt;
&lt;span class="gi"&gt;+        w = WCS(naxis=2)&lt;/span&gt;

         if coordsys == 'CEL':
             w.wcs.ctype[0] = 'RA---{}'.format(projection)
&lt;span class="gu"&gt;@@ -72,12 +79,9 @@ class WCSGeometry:&lt;/span&gt;
         else:
             raise ValueError('Unrecognized coordinate system.')

&lt;span class="gd"&gt;-        try:&lt;/span&gt;
&lt;span class="gd"&gt;-            w.wcs.crpix[0] = crpix[0]&lt;/span&gt;
&lt;span class="gd"&gt;-            w.wcs.crpix[1] = crpix[1]&lt;/span&gt;
&lt;span class="gd"&gt;-        except:&lt;/span&gt;
&lt;span class="gd"&gt;-            w.wcs.crpix[0] = crpix&lt;/span&gt;
&lt;span class="gd"&gt;-            w.wcs.crpix[1] = crpix&lt;/span&gt;
&lt;span class="gi"&gt;+        w.wcs.crpix[0] = crpix[0]&lt;/span&gt;
&lt;span class="gi"&gt;+        w.wcs.crpix[1] = crpix[1]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
         w.wcs.cdelt[0] = -cdelt
         w.wcs.cdelt[1] = cdelt


commit 81d74de79ec5971d0e528a3f5c2d8e0e21fc7e0a
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Sun Jun 18 09:17:17 2017 +0500

    Add classmethod for creating a WCS object

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 4c74dd7..4dfb22a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -6,7 +6,7 @@ the healpy library&lt;/span&gt;
 """

 __all__ = [
&lt;span class="gd"&gt;-    'boundaries', 'compute_image_pixels'&lt;/span&gt;
&lt;span class="gi"&gt;+    'boundaries', 'compute_healpix_pixel_indices'&lt;/span&gt;
 ]

 import healpy as hp
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index afdd80d..8945ee4 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -3,11 +3,9 @@ import numpy as np&lt;/span&gt;
 import healpy as hp
 from ..wcs import WCSGeometry
 from ..healpix import boundaries
&lt;span class="gd"&gt;-from ..healpix import compute_image_pixels&lt;/span&gt;
&lt;span class="gd"&gt;-from astropy.io import fits&lt;/span&gt;
&lt;span class="gd"&gt;-from astropy.wcs import WCS&lt;/span&gt;
 from astropy.coordinates import SkyCoord
 from numpy.testing import assert_allclose
&lt;span class="gi"&gt;+from ..healpix import compute_healpix_pixel_indices&lt;/span&gt;


 def test_boundaries():
&lt;span class="gu"&gt;@@ -31,9 +29,8 @@ def test_compute_healpix_pixel_indices():&lt;/span&gt;
     order = 3
     nside = hp.order2nside(order)

&lt;span class="gd"&gt;-    hdu = fits.open('https://github.com/gammapy/gammapy-extra/blob/master/datasets/catalogs/fermi/gll_psch_v08.fit.gz?raw=true')&lt;/span&gt;
&lt;span class="gd"&gt;-    wcs = WCS(hdu[0].header)&lt;/span&gt;
&lt;span class="gd"&gt;-    wcs_geometry = WCSGeometry(wcs, hdu[0].data.shape)&lt;/span&gt;
&lt;span class="gi"&gt;+    skycoord = SkyCoord(10, 20, unit="deg")&lt;/span&gt;
&lt;span class="gi"&gt;+    wcs_geometry = WCSGeometry.create(skycoord, (10, 20), 'CEL', 'AIT', 1.0, 1)&lt;/span&gt;

     """
     These pixel values were obtained for the all-sky image located at:
&lt;span class="gu"&gt;@@ -41,5 +38,5 @@ def test_compute_healpix_pixel_indices():&lt;/span&gt;
     """
     pixels_precomp = [0, 767]

&lt;span class="gd"&gt;-    pixels = compute_image_pixels(wcs_geometry, nside)&lt;/span&gt;
&lt;span class="gi"&gt;+    pixels = compute_healpix_pixel_indices(wcs_geometry, nside)&lt;/span&gt;
     assert_allclose([pixels[0], pixels[-1]], pixels_precomp)
&lt;span class="gh"&gt;diff --git a/hips/utils/wcs.py b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gh"&gt;index 45b5541..472d009 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,6 +1,7 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 import numpy as np
 from astropy.wcs import WCS
&lt;span class="gi"&gt;+from astropy.coordinates import SkyCoord&lt;/span&gt;

 __all__ = [
     'WCSGeometry',
&lt;span class="gu"&gt;@@ -33,17 +34,53 @@ class WCSGeometry:&lt;/span&gt;
         return self._wcs

     @classmethod
&lt;span class="gd"&gt;-    def create(cls, projection: str='AIT', cdelt: float=1.0, crpix: float=1., shape: tuple) -&amp;gt; 'WCSGeometry':&lt;/span&gt;
&lt;span class="gi"&gt;+    def create(cls, skydir: SkyCoord, shape: tuple, coordsys: str='CEL', projection: str='AIT', cdelt: float=1.0, crpix: float=1.) -&amp;gt; 'WCSGeometry':&lt;/span&gt;
         """Read from HiPS description file (`WCSGeometry`).

         Parameters
         ----------
&lt;span class="gd"&gt;-        projection : `str`&lt;/span&gt;
&lt;span class="gd"&gt;-            Project of the WCS object&lt;/span&gt;
&lt;span class="gd"&gt;-        cdelt : `str`&lt;/span&gt;
&lt;span class="gd"&gt;-        crpix : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+        skydir : `~astropy.coordinates.SkyCoord`&lt;/span&gt;
&lt;span class="gi"&gt;+            Sky coordinate of the WCS reference point&lt;/span&gt;
         shape : `tuple`
&lt;span class="gd"&gt;-            Image shape&lt;/span&gt;
&lt;span class="gi"&gt;+            Shape of the image&lt;/span&gt;
&lt;span class="gi"&gt;+        coordsys : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+            Coordinate system&lt;/span&gt;
&lt;span class="gi"&gt;+        projection : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+            Projection of the WCS object&lt;/span&gt;
&lt;span class="gi"&gt;+        cdelt : `float`&lt;/span&gt;
&lt;span class="gi"&gt;+            Coordinate increment at reference point&lt;/span&gt;
&lt;span class="gi"&gt;+        crpix : `float`&lt;/span&gt;
&lt;span class="gi"&gt;+            Pixel coordinate of reference point&lt;/span&gt;
         """
&lt;span class="gd"&gt;-        # TODO&lt;/span&gt;
&lt;span class="gd"&gt;-        pass&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        naxis = 2&lt;/span&gt;
&lt;span class="gi"&gt;+        if shape is not None:&lt;/span&gt;
&lt;span class="gi"&gt;+            naxis += len(shape)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        w = WCS(naxis=naxis)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        if coordsys == 'CEL':&lt;/span&gt;
&lt;span class="gi"&gt;+            w.wcs.ctype[0] = 'RA---{}'.format(projection)&lt;/span&gt;
&lt;span class="gi"&gt;+            w.wcs.ctype[1] = 'DEC--{}'.format(projection)&lt;/span&gt;
&lt;span class="gi"&gt;+            w.wcs.crval[0] = skydir.icrs.ra.deg&lt;/span&gt;
&lt;span class="gi"&gt;+            w.wcs.crval[1] = skydir.icrs.dec.deg&lt;/span&gt;
&lt;span class="gi"&gt;+        elif coordsys == 'GAL':&lt;/span&gt;
&lt;span class="gi"&gt;+            w.wcs.ctype[0] = 'GLON-{}'.format(projection)&lt;/span&gt;
&lt;span class="gi"&gt;+            w.wcs.ctype[1] = 'GLAT-{}'.format(projection)&lt;/span&gt;
&lt;span class="gi"&gt;+            w.wcs.crval[0] = skydir.galactic.l.deg&lt;/span&gt;
&lt;span class="gi"&gt;+            w.wcs.crval[1] = skydir.galactic.b.deg&lt;/span&gt;
&lt;span class="gi"&gt;+        else:&lt;/span&gt;
&lt;span class="gi"&gt;+            raise ValueError('Unrecognized coordinate system.')&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        try:&lt;/span&gt;
&lt;span class="gi"&gt;+            w.wcs.crpix[0] = crpix[0]&lt;/span&gt;
&lt;span class="gi"&gt;+            w.wcs.crpix[1] = crpix[1]&lt;/span&gt;
&lt;span class="gi"&gt;+        except:&lt;/span&gt;
&lt;span class="gi"&gt;+            w.wcs.crpix[0] = crpix&lt;/span&gt;
&lt;span class="gi"&gt;+            w.wcs.crpix[1] = crpix&lt;/span&gt;
&lt;span class="gi"&gt;+        w.wcs.cdelt[0] = -cdelt&lt;/span&gt;
&lt;span class="gi"&gt;+        w.wcs.cdelt[1] = cdelt&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        w = WCS(w.to_header())&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        return cls(w, shape)&lt;/span&gt;

commit 5f52d62d5402080dcd271b106670d86878856f3b
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 16 22:35:54 2017 +0500

    Add class WCSGeometry

    This commit renames the compute_image_pixels function to compute_healpix_pixel_indices and wrap the WCS object and image shape in a separate class. Also, some refactoring is done in the test case.

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 0ab2549..4c74dd7 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -11,6 +11,7 @@ __all__ = [&lt;/span&gt;

 import healpy as hp
 import numpy as np
&lt;span class="gi"&gt;+from .wcs import WCSGeometry&lt;/span&gt;
 from astropy.coordinates.angle_utilities import angular_separation
 from astropy.wcs import WCS

&lt;span class="gu"&gt;@@ -52,13 +53,12 @@ def boundaries(nside: int, pix: int, nest: bool=True) -&amp;gt; tuple:&lt;/span&gt;
         [( 264.375, -24.62431835), ( 258.75 , -30.        ),
          ( 264.375, -35.68533471), ( 270.   , -30.        )]&amp;gt;
     """
&lt;span class="gd"&gt;-&lt;/span&gt;
     boundary_coords = hp.boundaries(nside, pix, nest=nest)
     theta, phi = hp.vec2ang(np.transpose(boundary_coords))
     return theta, phi

&lt;span class="gd"&gt;-def compute_image_pixels(nside: int, shape: tuple, wcs: WCS) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gd"&gt;-    """Returns an array containing the pixels corresponding to an image.&lt;/span&gt;
&lt;span class="gi"&gt;+def compute_healpix_pixel_indices(wcs_geometry: WCSGeometry, nside: int) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Returns an array containing pixels corresponding to an image.&lt;/span&gt;

     This function calls `healpy.pixelfunc.ang2vec`, `healpy.query_disc`, and
     `astropy.coordinates.angle_utilities.angular_separation` to compute
&lt;span class="gu"&gt;@@ -66,22 +66,18 @@ def compute_image_pixels(nside: int, shape: tuple, wcs: WCS) -&amp;gt; np.ndarray:&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gi"&gt;+    wcs_geometry : WCSGeometry&lt;/span&gt;
&lt;span class="gi"&gt;+        Container for WCS object and image shape&lt;/span&gt;
     nside : int
         The nside of the HEALPix map
&lt;span class="gd"&gt;-    shape : tuple&lt;/span&gt;
&lt;span class="gd"&gt;-        Shape of the image&lt;/span&gt;
&lt;span class="gd"&gt;-    wcs : astropy.wcs.wcs.WCS&lt;/span&gt;
&lt;span class="gd"&gt;-        A WCS object containing the image header&lt;/span&gt;

     Returns
     -------
     pixels : `numpy.ndarray`
&lt;span class="gd"&gt;-        Returns a list of pixel values&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+        HEALPix pixel numbers&lt;/span&gt;
     """
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    y_center, x_center = shape[0] // 2, shape[1] // 2&lt;/span&gt;
&lt;span class="gd"&gt;-    lon_center, lat_center = wcs.all_pix2world(x_center, y_center, 1)&lt;/span&gt;
&lt;span class="gi"&gt;+    y_center, x_center = wcs_geometry.shape[0] // 2, wcs_geometry.shape[1] // 2&lt;/span&gt;
&lt;span class="gi"&gt;+    lon_center, lat_center = wcs_geometry.wcs.all_pix2world(x_center, y_center, 1)&lt;/span&gt;
     vec = hp.ang2vec(lon_center, lat_center, lonlat=True)
     separations = angular_separation(x_center, y_center, lon_center, lat_center)
     max_separation = np.nanmax(separations)
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index da358dd..afdd80d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,6 +1,7 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 import numpy as np
 import healpy as hp
&lt;span class="gi"&gt;+from ..wcs import WCSGeometry&lt;/span&gt;
 from ..healpix import boundaries
 from ..healpix import compute_image_pixels
 from astropy.io import fits
&lt;span class="gu"&gt;@@ -26,43 +27,19 @@ def test_boundaries():&lt;/span&gt;
                      [-24.624318,  -30.,  -35.685335,  -30.]]
     assert_allclose([radec.ra, radec.dec], radec_precomp)

&lt;span class="gd"&gt;-def test_compute_image_pixels():&lt;/span&gt;
&lt;span class="gi"&gt;+def test_compute_healpix_pixel_indices():&lt;/span&gt;
     order = 3
     nside = hp.order2nside(order)

     hdu = fits.open('https://github.com/gammapy/gammapy-extra/blob/master/datasets/catalogs/fermi/gll_psch_v08.fit.gz?raw=true')
     wcs = WCS(hdu[0].header)
&lt;span class="gi"&gt;+    wcs_geometry = WCSGeometry(wcs, hdu[0].data.shape)&lt;/span&gt;

     """
     These pixel values were obtained for the all-sky image located at:
     https://github.com/gammapy/gammapy-extra/blob/master/datasets/catalogs/fermi/gll_psch_v08.fit.gz?raw=true
     """
&lt;span class="gd"&gt;-    pixels_precomp = \&lt;/span&gt;
&lt;span class="gd"&gt;-    [  0, 1, 2, 3, 4, 5, 6, 9, 10, 11, 12, 13, 14, 15, 20, 21, 22, 23,&lt;/span&gt;
&lt;span class="gd"&gt;-      24, 25, 26, 27, 28, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 54, 55,&lt;/span&gt;
&lt;span class="gd"&gt;-      56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 77, 78, 79, 80, 81, 82, 83,&lt;/span&gt;
&lt;span class="gd"&gt;-      84, 85, 86, 87, 88, 89, 90, 91, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113,&lt;/span&gt;
&lt;span class="gd"&gt;-     114, 115, 116, 117, 118, 119, 120, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145,&lt;/span&gt;
&lt;span class="gd"&gt;-     146, 147, 148, 149, 150, 151, 152, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178,&lt;/span&gt;
&lt;span class="gd"&gt;-     179, 180, 181, 182, 183, 184, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210,&lt;/span&gt;
&lt;span class="gd"&gt;-     211, 212, 213, 214, 215, 216, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243,&lt;/span&gt;
&lt;span class="gd"&gt;-     244, 245, 246, 247, 248, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275,&lt;/span&gt;
&lt;span class="gd"&gt;-     276, 277, 278, 279, 280, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308,&lt;/span&gt;
&lt;span class="gd"&gt;-     309, 310, 311, 312, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340,&lt;/span&gt;
&lt;span class="gd"&gt;-     341, 342, 343, 344, 360, 361, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373,&lt;/span&gt;
&lt;span class="gd"&gt;-     374, 375, 376, 391, 392, 393, 394, 395, 396, 397, 398, 399, 400, 401, 402, 403, 404, 405,&lt;/span&gt;
&lt;span class="gd"&gt;-     406, 407, 408, 424, 425, 426, 427, 428, 429, 430, 431, 432, 433, 434, 435, 436, 437, 438,&lt;/span&gt;
&lt;span class="gd"&gt;-     439, 440, 455, 456, 457, 458, 459, 460, 461, 462, 463, 464, 465, 466, 467, 468, 469, 470,&lt;/span&gt;
&lt;span class="gd"&gt;-     471, 472, 488, 489, 490, 491, 492, 493, 494, 495, 496, 497, 498, 499, 500, 501, 502, 503,&lt;/span&gt;
&lt;span class="gd"&gt;-     504, 519, 520, 521, 522, 523, 524, 525, 526, 527, 528, 529, 530, 531, 532, 533, 534, 535,&lt;/span&gt;
&lt;span class="gd"&gt;-     536, 552, 553, 554, 555, 556, 557, 558, 559, 560, 561, 562, 563, 564, 565, 566, 567, 568,&lt;/span&gt;
&lt;span class="gd"&gt;-     583, 584, 585, 586, 587, 588, 589, 590, 591, 592, 593, 594, 595, 596, 597, 598, 599, 600,&lt;/span&gt;
&lt;span class="gd"&gt;-     616, 617, 618, 619, 620, 621, 622, 623, 624, 625, 626, 627, 628, 629, 630, 631, 632, 647,&lt;/span&gt;
&lt;span class="gd"&gt;-     648, 649, 650, 651, 652, 653, 654, 655, 656, 657, 658, 659, 660, 661, 662, 663, 676, 677,&lt;/span&gt;
&lt;span class="gd"&gt;-     678, 679, 680, 681, 682, 683, 684, 685, 686, 687, 688, 689, 690, 701, 702, 703, 704, 705,&lt;/span&gt;
&lt;span class="gd"&gt;-     706, 707, 708, 709, 710, 711, 712, 713, 722, 723, 724, 725, 726, 727, 728, 729, 730, 731,&lt;/span&gt;
&lt;span class="gd"&gt;-     732, 739, 740, 741, 742, 743, 744, 745, 746, 747, 752, 753, 754, 755, 756, 757, 758, 761,&lt;/span&gt;
&lt;span class="gd"&gt;-     762, 763, 764, 765, 766, 767]&lt;/span&gt;
&lt;span class="gi"&gt;+    pixels_precomp = [0, 767]&lt;/span&gt;

&lt;span class="gd"&gt;-    pixels = compute_image_pixels(nside, hdu[0].data.shape, wcs)&lt;/span&gt;
&lt;span class="gd"&gt;-    assert_allclose(pixels, pixels_precomp)&lt;/span&gt;
&lt;span class="gi"&gt;+    pixels = compute_image_pixels(wcs_geometry, nside)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose([pixels[0], pixels[-1]], pixels_precomp)&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/wcs.py b/hips/utils/wcs.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..45b5541&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/wcs.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,49 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.wcs import WCS&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+__all__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'WCSGeometry',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class WCSGeometry:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Container for WCS object and image shape.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    wcs : `~astropy.wcs.WCS`&lt;/span&gt;
&lt;span class="gi"&gt;+        WCS projection object&lt;/span&gt;
&lt;span class="gi"&gt;+    shape : tuple&lt;/span&gt;
&lt;span class="gi"&gt;+        Shape of the image&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, wcs: WCS, shape: tuple) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self._wcs = wcs&lt;/span&gt;
&lt;span class="gi"&gt;+        self._shape = shape&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def shape(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Shape of the image (`None`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self._shape&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def wcs(self) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        """WCS object containing FITS image header (`None`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self._wcs&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def create(cls, projection: str='AIT', cdelt: float=1.0, crpix: float=1., shape: tuple) -&amp;gt; 'WCSGeometry':&lt;/span&gt;
&lt;span class="gi"&gt;+        """Read from HiPS description file (`WCSGeometry`).&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        projection : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+            Project of the WCS object&lt;/span&gt;
&lt;span class="gi"&gt;+        cdelt : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+        crpix : `str`&lt;/span&gt;
&lt;span class="gi"&gt;+        shape : `tuple`&lt;/span&gt;
&lt;span class="gi"&gt;+            Image shape&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        # TODO&lt;/span&gt;
&lt;span class="gi"&gt;+        pass&lt;/span&gt;

commit 6e2dd380d3d397e08a2e0f79489d10756a876787
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Thu Jun 15 11:02:58 2017 +0500

    Add compute_image_pixels function in hips.utils

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 36bff9d..0ab2549 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -6,11 +6,13 @@ the healpy library&lt;/span&gt;
 """

 __all__ = [
&lt;span class="gd"&gt;-    'boundaries',&lt;/span&gt;
&lt;span class="gi"&gt;+    'boundaries', 'compute_image_pixels'&lt;/span&gt;
 ]

 import healpy as hp
 import numpy as np
&lt;span class="gi"&gt;+from astropy.coordinates.angle_utilities import angular_separation&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.wcs import WCS&lt;/span&gt;


 def boundaries(nside: int, pix: int, nest: bool=True) -&amp;gt; tuple:
&lt;span class="gu"&gt;@@ -54,3 +56,33 @@ def boundaries(nside: int, pix: int, nest: bool=True) -&amp;gt; tuple:&lt;/span&gt;
     boundary_coords = hp.boundaries(nside, pix, nest=nest)
     theta, phi = hp.vec2ang(np.transpose(boundary_coords))
     return theta, phi
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def compute_image_pixels(nside: int, shape: tuple, wcs: WCS) -&amp;gt; np.ndarray:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Returns an array containing the pixels corresponding to an image.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    This function calls `healpy.pixelfunc.ang2vec`, `healpy.query_disc`, and&lt;/span&gt;
&lt;span class="gi"&gt;+    `astropy.coordinates.angle_utilities.angular_separation` to compute&lt;/span&gt;
&lt;span class="gi"&gt;+    the pixel values, which will be use in tile drawing.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    nside : int&lt;/span&gt;
&lt;span class="gi"&gt;+        The nside of the HEALPix map&lt;/span&gt;
&lt;span class="gi"&gt;+    shape : tuple&lt;/span&gt;
&lt;span class="gi"&gt;+        Shape of the image&lt;/span&gt;
&lt;span class="gi"&gt;+    wcs : astropy.wcs.wcs.WCS&lt;/span&gt;
&lt;span class="gi"&gt;+        A WCS object containing the image header&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Returns&lt;/span&gt;
&lt;span class="gi"&gt;+    -------&lt;/span&gt;
&lt;span class="gi"&gt;+    pixels : `numpy.ndarray`&lt;/span&gt;
&lt;span class="gi"&gt;+        Returns a list of pixel values&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    y_center, x_center = shape[0] // 2, shape[1] // 2&lt;/span&gt;
&lt;span class="gi"&gt;+    lon_center, lat_center = wcs.all_pix2world(x_center, y_center, 1)&lt;/span&gt;
&lt;span class="gi"&gt;+    vec = hp.ang2vec(lon_center, lat_center, lonlat=True)&lt;/span&gt;
&lt;span class="gi"&gt;+    separations = angular_separation(x_center, y_center, lon_center, lat_center)&lt;/span&gt;
&lt;span class="gi"&gt;+    max_separation = np.nanmax(separations)&lt;/span&gt;
&lt;span class="gi"&gt;+    return hp.query_disc(nside, vec, max_separation)&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 34373ad..da358dd 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,7 +1,10 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 import numpy as np
 import healpy as hp
&lt;span class="gd"&gt;-from .. healpix import boundaries&lt;/span&gt;
&lt;span class="gi"&gt;+from ..healpix import boundaries&lt;/span&gt;
&lt;span class="gi"&gt;+from ..healpix import compute_image_pixels&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.io import fits&lt;/span&gt;
&lt;span class="gi"&gt;+from astropy.wcs import WCS&lt;/span&gt;
 from astropy.coordinates import SkyCoord
 from numpy.testing import assert_allclose

&lt;span class="gu"&gt;@@ -22,3 +25,44 @@ def test_boundaries():&lt;/span&gt;
     radec_precomp = [[264.375,  258.75,  264.375,  270.],
                      [-24.624318,  -30.,  -35.685335,  -30.]]
     assert_allclose([radec.ra, radec.dec], radec_precomp)
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def test_compute_image_pixels():&lt;/span&gt;
&lt;span class="gi"&gt;+    order = 3&lt;/span&gt;
&lt;span class="gi"&gt;+    nside = hp.order2nside(order)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    hdu = fits.open('https://github.com/gammapy/gammapy-extra/blob/master/datasets/catalogs/fermi/gll_psch_v08.fit.gz?raw=true')&lt;/span&gt;
&lt;span class="gi"&gt;+    wcs = WCS(hdu[0].header)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+    These pixel values were obtained for the all-sky image located at:&lt;/span&gt;
&lt;span class="gi"&gt;+    https://github.com/gammapy/gammapy-extra/blob/master/datasets/catalogs/fermi/gll_psch_v08.fit.gz?raw=true&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+    pixels_precomp = \&lt;/span&gt;
&lt;span class="gi"&gt;+    [  0, 1, 2, 3, 4, 5, 6, 9, 10, 11, 12, 13, 14, 15, 20, 21, 22, 23,&lt;/span&gt;
&lt;span class="gi"&gt;+      24, 25, 26, 27, 28, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 54, 55,&lt;/span&gt;
&lt;span class="gi"&gt;+      56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 77, 78, 79, 80, 81, 82, 83,&lt;/span&gt;
&lt;span class="gi"&gt;+      84, 85, 86, 87, 88, 89, 90, 91, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113,&lt;/span&gt;
&lt;span class="gi"&gt;+     114, 115, 116, 117, 118, 119, 120, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145,&lt;/span&gt;
&lt;span class="gi"&gt;+     146, 147, 148, 149, 150, 151, 152, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178,&lt;/span&gt;
&lt;span class="gi"&gt;+     179, 180, 181, 182, 183, 184, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210,&lt;/span&gt;
&lt;span class="gi"&gt;+     211, 212, 213, 214, 215, 216, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243,&lt;/span&gt;
&lt;span class="gi"&gt;+     244, 245, 246, 247, 248, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275,&lt;/span&gt;
&lt;span class="gi"&gt;+     276, 277, 278, 279, 280, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308,&lt;/span&gt;
&lt;span class="gi"&gt;+     309, 310, 311, 312, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340,&lt;/span&gt;
&lt;span class="gi"&gt;+     341, 342, 343, 344, 360, 361, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373,&lt;/span&gt;
&lt;span class="gi"&gt;+     374, 375, 376, 391, 392, 393, 394, 395, 396, 397, 398, 399, 400, 401, 402, 403, 404, 405,&lt;/span&gt;
&lt;span class="gi"&gt;+     406, 407, 408, 424, 425, 426, 427, 428, 429, 430, 431, 432, 433, 434, 435, 436, 437, 438,&lt;/span&gt;
&lt;span class="gi"&gt;+     439, 440, 455, 456, 457, 458, 459, 460, 461, 462, 463, 464, 465, 466, 467, 468, 469, 470,&lt;/span&gt;
&lt;span class="gi"&gt;+     471, 472, 488, 489, 490, 491, 492, 493, 494, 495, 496, 497, 498, 499, 500, 501, 502, 503,&lt;/span&gt;
&lt;span class="gi"&gt;+     504, 519, 520, 521, 522, 523, 524, 525, 526, 527, 528, 529, 530, 531, 532, 533, 534, 535,&lt;/span&gt;
&lt;span class="gi"&gt;+     536, 552, 553, 554, 555, 556, 557, 558, 559, 560, 561, 562, 563, 564, 565, 566, 567, 568,&lt;/span&gt;
&lt;span class="gi"&gt;+     583, 584, 585, 586, 587, 588, 589, 590, 591, 592, 593, 594, 595, 596, 597, 598, 599, 600,&lt;/span&gt;
&lt;span class="gi"&gt;+     616, 617, 618, 619, 620, 621, 622, 623, 624, 625, 626, 627, 628, 629, 630, 631, 632, 647,&lt;/span&gt;
&lt;span class="gi"&gt;+     648, 649, 650, 651, 652, 653, 654, 655, 656, 657, 658, 659, 660, 661, 662, 663, 676, 677,&lt;/span&gt;
&lt;span class="gi"&gt;+     678, 679, 680, 681, 682, 683, 684, 685, 686, 687, 688, 689, 690, 701, 702, 703, 704, 705,&lt;/span&gt;
&lt;span class="gi"&gt;+     706, 707, 708, 709, 710, 711, 712, 713, 722, 723, 724, 725, 726, 727, 728, 729, 730, 731,&lt;/span&gt;
&lt;span class="gi"&gt;+     732, 739, 740, 741, 742, 743, 744, 745, 746, 747, 752, 753, 754, 755, 756, 757, 758, 761,&lt;/span&gt;
&lt;span class="gi"&gt;+     762, 763, 764, 765, 766, 767]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    pixels = compute_image_pixels(nside, hdu[0].data.shape, wcs)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose(pixels, pixels_precomp)&lt;/span&gt;

commit d369652b5edc9cda4705d0199a862bd8d226f526
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jun 12 18:55:36 2017 +0500

    Update class docstring

&lt;span class="gh"&gt;diff --git a/hips/tiles/description.py b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gh"&gt;index e270d1d..d58c7ee 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -15,8 +15,8 @@ class HipsDescription:&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gd"&gt;-    properties : str&lt;/span&gt;
&lt;span class="gd"&gt;-        A string containing HiPS tile properties&lt;/span&gt;
&lt;span class="gi"&gt;+    properties : OrderedDict&lt;/span&gt;
&lt;span class="gi"&gt;+        An ordered dictionary containing the HiPS file properties&lt;/span&gt;
     """

     def __init__(self, properties: OrderedDict) -&amp;gt; None:

commit a245521987a4971aaa70f842bb045f72512c760e
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon Jun 12 11:55:31 2017 +0500

    Update tiles.hipsdescription module

    This commits modifies the classmethod to return the appropriate type, and changes the file reading technique.

&lt;span class="gh"&gt;diff --git a/hips/tiles/description.py b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gh"&gt;index a0d7bdb..e270d1d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -19,9 +19,8 @@ class HipsDescription:&lt;/span&gt;
         A string containing HiPS tile properties
     """

&lt;span class="gd"&gt;-    def __init__(self, properties: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        super(HipsDescription, self).__init__()&lt;/span&gt;
&lt;span class="gd"&gt;-        self.properties = self.parse_file_properties(properties)&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, properties: OrderedDict) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        self.properties = properties&lt;/span&gt;

     @classmethod
     def read_file(cls, filename: str) -&amp;gt; OrderedDict:
&lt;span class="gu"&gt;@@ -39,8 +38,9 @@ class HipsDescription:&lt;/span&gt;
         -------
         dict_properties : OrderedDict
         """
&lt;span class="gd"&gt;-        file = open(filename, 'r')&lt;/span&gt;
&lt;span class="gd"&gt;-        return cls.parse_file_properties(file.read())&lt;/span&gt;
&lt;span class="gi"&gt;+        with open(filename) as file:&lt;/span&gt;
&lt;span class="gi"&gt;+            text = file.read()&lt;/span&gt;
&lt;span class="gi"&gt;+        return cls.parse_file_properties(text)&lt;/span&gt;

     @classmethod
     def parse_file_properties(cls, properties: str) -&amp;gt; OrderedDict:
&lt;span class="gu"&gt;@@ -58,15 +58,15 @@ class HipsDescription:&lt;/span&gt;
         -------
         list_properties : OrderedDict
         """
&lt;span class="gd"&gt;-        properties = properties.split('\n')&lt;/span&gt;
&lt;span class="gi"&gt;+        properties_lines = properties.split('\n')&lt;/span&gt;
         list_properties = []
&lt;span class="gd"&gt;-        for property in properties:&lt;/span&gt;
&lt;span class="gi"&gt;+        for property in properties_lines:&lt;/span&gt;
             key_value = property.split('=')
             try:
                 list_properties.append((key_value[0].strip(), key_value[1].strip()))
&lt;span class="gd"&gt;-            except IndexError: # The case where a property contains comment or a blank line&lt;/span&gt;
&lt;span class="gi"&gt;+            except IndexError: # the case where a property contains a comment or a blank line&lt;/span&gt;
                 pass
&lt;span class="gd"&gt;-        return OrderedDict(list_properties)&lt;/span&gt;
&lt;span class="gi"&gt;+        return cls(OrderedDict(list_properties))&lt;/span&gt;

     @property
     def base_url(self) -&amp;gt; str:
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_description.py b/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gh"&gt;index 75d42d2..5e4a2b2 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -58,7 +58,7 @@ class TestHiPSDescription:&lt;/span&gt;
         isColor            = true
         ~
         """
&lt;span class="gd"&gt;-        cls.hipsdescription = HipsDescription(hips_properties)&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.hipsdescription = HipsDescription.parse_file_properties(hips_properties)&lt;/span&gt;

     def test_base_url(cls):
         assert cls.hipsdescription.base_url == 'http://alasky.u-strasbg.fr/DSS/DSSColor'

commit dae30ac9cff524a0dc64bb638c5e6b62bc4011d4
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 9 22:46:14 2017 +0500

    Update class docstring

&lt;span class="gh"&gt;diff --git a/hips/tiles/__init__.py b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gh"&gt;index 1c77ba4..d19ff3e 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,3 +1,3 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gd"&gt;-"""HiPS description class -- provides methods for parsing the HiPS file properties."""&lt;/span&gt;
&lt;span class="gi"&gt;+"""Classes and functions to manage HiPS tiles."""&lt;/span&gt;
 from .description import *

commit fbf89687c9e5f6dab8b0de8a638abaf433ec6a87
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 9 22:43:58 2017 +0500

    Update tiles.hipsdescription module

    This commits renames the hipsdescription file to description and converts the getters methods to properties. It also fixes some formatting issue.

&lt;span class="gh"&gt;diff --git a/docs/api.rst b/docs/api.rst&lt;/span&gt;
&lt;span class="gh"&gt;index 46c5c1f..eb152d9 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/api.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/api.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -2,4 +2,3 @@ Reference/API&lt;/span&gt;
 =============

 .. automodapi:: hips
&lt;span class="gd"&gt;-.. automodapi:: hips.tiles&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/__init__.py b/hips/__init__.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8d3819e..ce0fdf7 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/__init__.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/__init__.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -19,3 +19,4 @@ from ._astropy_init import *&lt;/span&gt;
 if not _ASTROPY_SETUP_:
     # For egg_info test builds to pass, put package imports here.
     from .draw import *
&lt;span class="gi"&gt;+    from .tiles import *&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/__init__.py b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gh"&gt;index bb73205..1c77ba4 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,3 +1,3 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 """HiPS description class -- provides methods for parsing the HiPS file properties."""
&lt;span class="gd"&gt;-from .hipsdescription import *&lt;/span&gt;
&lt;span class="gi"&gt;+from .description import *&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/description.py b/hips/tiles/description.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..a0d7bdb&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/description.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,99 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+"""Classes and functions to manage HiPS tiles."""&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from collections import OrderedDict&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+__all__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'HipsDescription',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class HipsDescription:&lt;/span&gt;
&lt;span class="gi"&gt;+    """This class provides methods for parsing the HiPS properties file.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    It also provides multiple getters around the commonly used HiPS properties.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    properties : str&lt;/span&gt;
&lt;span class="gi"&gt;+        A string containing HiPS tile properties&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, properties: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        super(HipsDescription, self).__init__()&lt;/span&gt;
&lt;span class="gi"&gt;+        self.properties = self.parse_file_properties(properties)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def read_file(cls, filename: str) -&amp;gt; OrderedDict:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Reads text from a file and returns an ordered dictionary containing the HiPS file properties.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        This method reads a file given by the parameter and returns an ordered dictionary&lt;/span&gt;
&lt;span class="gi"&gt;+        containing the HiPS file properties by calling the `parse_file_properties` method.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        filename : str&lt;/span&gt;
&lt;span class="gi"&gt;+            Name of the file containing HiPS file properties&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Returns&lt;/span&gt;
&lt;span class="gi"&gt;+        -------&lt;/span&gt;
&lt;span class="gi"&gt;+        dict_properties : OrderedDict&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        file = open(filename, 'r')&lt;/span&gt;
&lt;span class="gi"&gt;+        return cls.parse_file_properties(file.read())&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def parse_file_properties(cls, properties: str) -&amp;gt; OrderedDict:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Returns an ordered dictionary containing the HiPS file properties.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        This method parses the HiPS file properties and loads it in a dictionary,&lt;/span&gt;
&lt;span class="gi"&gt;+        then is casts it to `collections.OrderedDict` type.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        properties : str&lt;/span&gt;
&lt;span class="gi"&gt;+            HiPS file properties&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Returns&lt;/span&gt;
&lt;span class="gi"&gt;+        -------&lt;/span&gt;
&lt;span class="gi"&gt;+        list_properties : OrderedDict&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        properties = properties.split('\n')&lt;/span&gt;
&lt;span class="gi"&gt;+        list_properties = []&lt;/span&gt;
&lt;span class="gi"&gt;+        for property in properties:&lt;/span&gt;
&lt;span class="gi"&gt;+            key_value = property.split('=')&lt;/span&gt;
&lt;span class="gi"&gt;+            try:&lt;/span&gt;
&lt;span class="gi"&gt;+                list_properties.append((key_value[0].strip(), key_value[1].strip()))&lt;/span&gt;
&lt;span class="gi"&gt;+            except IndexError: # The case where a property contains comment or a blank line&lt;/span&gt;
&lt;span class="gi"&gt;+                pass&lt;/span&gt;
&lt;span class="gi"&gt;+        return OrderedDict(list_properties)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def base_url(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Returns the base url from the HiPS file properties (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.properties['hips_service_url']&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def title(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Returns the title from the HiPS file properties (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.properties['obs_title']&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def hips_version(self) -&amp;gt; float:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Returns the HiPS version from the HiPS file properties (`float`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return float(self.properties['hips_version'])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def hips_frame(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Returns the HiPS frame from the HiPS file properties (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.properties['hips_frame']&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def hips_order(self) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Returns the HiPS order from the HiPS file properties (`int`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return int(self.properties['hips_order'])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @property&lt;/span&gt;
&lt;span class="gi"&gt;+    def tile_format(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Returns the HiPS tile format from the HiPS file properties (`str`)."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.properties['hips_tile_format']&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/hipsdescription.py b/hips/tiles/hipsdescription.py&lt;/span&gt;
deleted file mode 100644
&lt;span class="gh"&gt;index f13624a..0000000&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/hipsdescription.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ /dev/null&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,75 +0,0 @@&lt;/span&gt;
&lt;span class="gd"&gt;-# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gd"&gt;-"""HiPS description class -- provides methods for parsing the HiPS file properties."""&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-__all__ = [&lt;/span&gt;
&lt;span class="gd"&gt;-    'HipsDescription',&lt;/span&gt;
&lt;span class="gd"&gt;-]&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-from collections import OrderedDict&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-class HipsDescription:&lt;/span&gt;
&lt;span class="gd"&gt;-    """This class provides methods for parsing the HiPS properties file.&lt;/span&gt;
&lt;span class="gd"&gt;-       It also provides multiple getters around the commonly used properties.&lt;/span&gt;
&lt;span class="gd"&gt;-    """&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def __init__(self, properties: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gd"&gt;-        super(HipsDescription, self).__init__()&lt;/span&gt;
&lt;span class="gd"&gt;-        self.properties = self.parse_file_properties(properties)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    @classmethod&lt;/span&gt;
&lt;span class="gd"&gt;-    def parse_file_properties(cls, properties: str) -&amp;gt; OrderedDict:&lt;/span&gt;
&lt;span class="gd"&gt;-        """Returns an ordered dictionary containing the HiPS file properties.&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        This method parses the HiPS file properties and loads it in a dictionary,&lt;/span&gt;
&lt;span class="gd"&gt;-        then is casts it to `collections.OrderedDict` type.&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        Parameters&lt;/span&gt;
&lt;span class="gd"&gt;-        ----------&lt;/span&gt;
&lt;span class="gd"&gt;-        properties : str&lt;/span&gt;
&lt;span class="gd"&gt;-            HiPS file properties&lt;/span&gt;
&lt;span class="gd"&gt;-        &lt;/span&gt;
&lt;span class="gd"&gt;-        Returns&lt;/span&gt;
&lt;span class="gd"&gt;-        -------&lt;/span&gt;
&lt;span class="gd"&gt;-        dict_properties : OrderedDict&lt;/span&gt;
&lt;span class="gd"&gt;-        """&lt;/span&gt;
&lt;span class="gd"&gt;-        properties = properties.split('\n')&lt;/span&gt;
&lt;span class="gd"&gt;-        dict_properties = {}&lt;/span&gt;
&lt;span class="gd"&gt;-        for property in properties:&lt;/span&gt;
&lt;span class="gd"&gt;-            key_value = property.split('=')&lt;/span&gt;
&lt;span class="gd"&gt;-            try:&lt;/span&gt;
&lt;span class="gd"&gt;-                dict_properties[key_value[0].strip()] = key_value[1].strip()&lt;/span&gt;
&lt;span class="gd"&gt;-            except:&lt;/span&gt;
&lt;span class="gd"&gt;-                pass&lt;/span&gt;
&lt;span class="gd"&gt;-        return OrderedDict(dict_properties)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def get_properties(self) -&amp;gt; OrderedDict:&lt;/span&gt;
&lt;span class="gd"&gt;-        """OrderedDict: Returns the ordered dictionary containing the HiPS properties."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return self.properties&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def get_base_url(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gd"&gt;-        """str: Returns the base url from the HiPS file properties."""&lt;/span&gt;
&lt;span class="gd"&gt;-        try:&lt;/span&gt;
&lt;span class="gd"&gt;-            return self.properties['hips_service_url']&lt;/span&gt;
&lt;span class="gd"&gt;-        except:&lt;/span&gt;
&lt;span class="gd"&gt;-            return None&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def get_title(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gd"&gt;-        """str: Returns the title from the HiPS file properties."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return self.properties['obs_title']&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def get_hips_version(self) -&amp;gt; float:&lt;/span&gt;
&lt;span class="gd"&gt;-        """float: Returns the HiPS version from the HiPS file properties."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return float(self.properties['hips_version'])&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def get_hips_frame(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gd"&gt;-        """str: Returns the HiPS frame from the HiPS file properties."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return self.properties['hips_frame']&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def get_hips_order(self) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gd"&gt;-        """int: Returns the HiPS order from the HiPS file properties."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return int(self.properties['hips_order'])&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def get_tile_format(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gd"&gt;-        """str: Returns the HiPS tile format from the HiPS file properties."""&lt;/span&gt;
&lt;span class="gd"&gt;-        return self.properties['hips_tile_format']&lt;/span&gt;
\ No newline at end of file
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_description.py b/hips/tiles/tests/test_description.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..75d42d2&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_description.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,79 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from ..description import HipsDescription&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class TestHiPSDescription:&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def setup_class(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        # These HiPS properties were obtained from: http://alasky.u-strasbg.fr/DSS/DSSColor/properties&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_properties = """&lt;/span&gt;
&lt;span class="gi"&gt;+        creator_did          = ivo://CDS/P/DSS2/color&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_collection       = DSS colored&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_title            = DSS colored&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_description      = Color composition generated by CDS. This HiPS survey is based on 2 others HiPS surveys, respectively DSS2-red and DSS2-blue HiPS, both of them directly generated from original scanned plates downloaded from STScI site. The red component has been built from POSS-II F, AAO-SES,SR and SERC-ER plates. The blue component has been build from POSS-II J and SERC-J,EJ. The green component is based on the mean of other components. Three missing plates from red survey (253, 260, 359) has been replaced by pixels from the DSSColor STScI jpeg survey. The 11 missing blue plates (mainly in galactic plane) have not been replaced (only red component).&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_copyright        = Digitized Sky Survey - STScI/NASA, Colored &amp;amp; Healpixed by CDS&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_copyright_url    = http://archive.stsci.edu/dss/acknowledging.html&lt;/span&gt;
&lt;span class="gi"&gt;+        client_category      = Image/Optical/DSS&lt;/span&gt;
&lt;span class="gi"&gt;+        client_sort_key      = 03-00&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_builder         = Aladin/HipsGen v9.039&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_creation_date   = 2010-05-01T19:05Z&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_release_date    = 2015-05-11T08:45Z&lt;/span&gt;
&lt;span class="gi"&gt;+        # hips_release_date    = 2016-12-13T14:51Z&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_creator         = CDS (A.Oberto, P.Fernique)&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_version         = 1.31&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_order           = 9&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_frame           = equatorial&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_tile_width      = 512&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_tile_format     = jpeg&lt;/span&gt;
&lt;span class="gi"&gt;+        dataproduct_type     = image&lt;/span&gt;
&lt;span class="gi"&gt;+        client_application   = AladinLite&lt;/span&gt;
&lt;span class="gi"&gt;+        moc_access_url       = http://alasky.u-strasbg.fr/DSS/DSSColor/Moc.fits&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_service_url     = http://alasky.u-strasbg.fr/DSS/DSSColor&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_status          = public master clonableOnce&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_rgb_red         = DSS2Merged [1488.0 8488.8125 14666.0 Linear]&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_rgb_blue        = DSS2-blue-XJ-S [4286.0 12122.5 19959.0 Linear]&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_hierarchy       = median&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_pixel_scale     = 2.236E-4&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_initial_ra      = 085.30251&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_initial_dec     = -02.25468&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_initial_fov     = 2&lt;/span&gt;
&lt;span class="gi"&gt;+        moc_sky_fraction     = 1&lt;/span&gt;
&lt;span class="gi"&gt;+        dataproduct_subtype  = color&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_copyright       = CNRS/Unistra&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_ack              = The Digitized Sky Surveys were produced at the Space Telescope Science Institute under U.S. Government grant NAG W-2166. The images of these surveys are based on photographic data obtained using the Oschin Schmidt Telescope on Palomar Mountain and the UK Schmidt Telescope. The plates were processed into the present compressed digital form with the permission of these institutions&lt;/span&gt;
&lt;span class="gi"&gt;+        prov_progenitor      = STScI&lt;/span&gt;
&lt;span class="gi"&gt;+        bib_reference        = 2008AJ....136..735L&lt;/span&gt;
&lt;span class="gi"&gt;+        bib_reference_url    = http://simbad.u-strasbg.fr/simbad/sim-ref?bibcode=2008AJ....136..735L&lt;/span&gt;
&lt;span class="gi"&gt;+        # 1975-1999&lt;/span&gt;
&lt;span class="gi"&gt;+        t_min                = 42413&lt;/span&gt;
&lt;span class="gi"&gt;+        t_max                = 51179&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_regime           = Optical&lt;/span&gt;
&lt;span class="gi"&gt;+        # Bandpass  422-967 THz&lt;/span&gt;
&lt;span class="gi"&gt;+        em_min               = 7.104086682464e-7&lt;/span&gt;
&lt;span class="gi"&gt;+        em_max               = 3.100232244054e-7&lt;/span&gt;
&lt;span class="gi"&gt;+        # hips_master_url     = ex: http://yourHipsServer/null&lt;/span&gt;
&lt;span class="gi"&gt;+        # For compatibility&lt;/span&gt;
&lt;span class="gi"&gt;+        label              = DSS colored&lt;/span&gt;
&lt;span class="gi"&gt;+        coordsys           = C&lt;/span&gt;
&lt;span class="gi"&gt;+        isColor            = true&lt;/span&gt;
&lt;span class="gi"&gt;+        ~&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.hipsdescription = HipsDescription(hips_properties)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_base_url(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert cls.hipsdescription.base_url == 'http://alasky.u-strasbg.fr/DSS/DSSColor'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_title(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert cls.hipsdescription.title == 'DSS colored'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_hips_version(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert cls.hipsdescription.hips_version == 1.31&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_hips_frame(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert cls.hipsdescription.hips_frame == 'equatorial'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_hips_order(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert cls.hipsdescription.hips_order == 9&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_tile_format(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert cls.hipsdescription.tile_format == 'jpeg'&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_hipsdescription.py b/hips/tiles/tests/test_hipsdescription.py&lt;/span&gt;
deleted file mode 100644
&lt;span class="gh"&gt;index 458e976..0000000&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/tests/test_hipsdescription.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ /dev/null&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,79 +0,0 @@&lt;/span&gt;
&lt;span class="gd"&gt;-# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-from .. hipsdescription import HipsDescription&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-class TestHiPSDescription:&lt;/span&gt;
&lt;span class="gd"&gt;-    @classmethod&lt;/span&gt;
&lt;span class="gd"&gt;-    def setup_class(cls):&lt;/span&gt;
&lt;span class="gd"&gt;-        # These HiPS properties were obtained from: http://alasky.u-strasbg.fr/DSS/DSSColor/properties&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_properties = """&lt;/span&gt;
&lt;span class="gd"&gt;-        creator_did          = ivo://CDS/P/DSS2/color&lt;/span&gt;
&lt;span class="gd"&gt;-        obs_collection       = DSS colored&lt;/span&gt;
&lt;span class="gd"&gt;-        obs_title            = DSS colored&lt;/span&gt;
&lt;span class="gd"&gt;-        obs_description      = Color composition generated by CDS. This HiPS survey is based on 2 others HiPS surveys, respectively DSS2-red and DSS2-blue HiPS, both of them directly generated from original scanned plates downloaded from STScI site. The red component has been built from POSS-II F, AAO-SES,SR and SERC-ER plates. The blue component has been build from POSS-II J and SERC-J,EJ. The green component is based on the mean of other components. Three missing plates from red survey (253, 260, 359) has been replaced by pixels from the DSSColor STScI jpeg survey. The 11 missing blue plates (mainly in galactic plane) have not been replaced (only red component).&lt;/span&gt;
&lt;span class="gd"&gt;-        obs_copyright        = Digitized Sky Survey - STScI/NASA, Colored &amp;amp; Healpixed by CDS&lt;/span&gt;
&lt;span class="gd"&gt;-        obs_copyright_url    = http://archive.stsci.edu/dss/acknowledging.html&lt;/span&gt;
&lt;span class="gd"&gt;-        client_category      = Image/Optical/DSS&lt;/span&gt;
&lt;span class="gd"&gt;-        client_sort_key      = 03-00&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_builder         = Aladin/HipsGen v9.039&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_creation_date   = 2010-05-01T19:05Z&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_release_date    = 2015-05-11T08:45Z&lt;/span&gt;
&lt;span class="gd"&gt;-        # hips_release_date    = 2016-12-13T14:51Z&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_creator         = CDS (A.Oberto, P.Fernique)&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_version         = 1.31&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_order           = 9&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_frame           = equatorial&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_tile_width      = 512&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_tile_format     = jpeg&lt;/span&gt;
&lt;span class="gd"&gt;-        dataproduct_type     = image&lt;/span&gt;
&lt;span class="gd"&gt;-        client_application   = AladinLite&lt;/span&gt;
&lt;span class="gd"&gt;-        moc_access_url       = http://alasky.u-strasbg.fr/DSS/DSSColor/Moc.fits&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_service_url     = http://alasky.u-strasbg.fr/DSS/DSSColor&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_status          = public master clonableOnce&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_rgb_red         = DSS2Merged [1488.0 8488.8125 14666.0 Linear]&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_rgb_blue        = DSS2-blue-XJ-S [4286.0 12122.5 19959.0 Linear]&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_hierarchy       = median&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_pixel_scale     = 2.236E-4&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_initial_ra      = 085.30251&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_initial_dec     = -02.25468&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_initial_fov     = 2&lt;/span&gt;
&lt;span class="gd"&gt;-        moc_sky_fraction     = 1&lt;/span&gt;
&lt;span class="gd"&gt;-        dataproduct_subtype  = color&lt;/span&gt;
&lt;span class="gd"&gt;-        hips_copyright       = CNRS/Unistra&lt;/span&gt;
&lt;span class="gd"&gt;-        obs_ack              = The Digitized Sky Surveys were produced at the Space Telescope Science Institute under U.S. Government grant NAG W-2166. The images of these surveys are based on photographic data obtained using the Oschin Schmidt Telescope on Palomar Mountain and the UK Schmidt Telescope. The plates were processed into the present compressed digital form with the permission of these institutions&lt;/span&gt;
&lt;span class="gd"&gt;-        prov_progenitor      = STScI&lt;/span&gt;
&lt;span class="gd"&gt;-        bib_reference        = 2008AJ....136..735L&lt;/span&gt;
&lt;span class="gd"&gt;-        bib_reference_url    = http://simbad.u-strasbg.fr/simbad/sim-ref?bibcode=2008AJ....136..735L&lt;/span&gt;
&lt;span class="gd"&gt;-        # 1975-1999&lt;/span&gt;
&lt;span class="gd"&gt;-        t_min                = 42413&lt;/span&gt;
&lt;span class="gd"&gt;-        t_max                = 51179&lt;/span&gt;
&lt;span class="gd"&gt;-        obs_regime           = Optical&lt;/span&gt;
&lt;span class="gd"&gt;-        # Bandpass  422-967 THz&lt;/span&gt;
&lt;span class="gd"&gt;-        em_min               = 7.104086682464e-7&lt;/span&gt;
&lt;span class="gd"&gt;-        em_max               = 3.100232244054e-7&lt;/span&gt;
&lt;span class="gd"&gt;-        # hips_master_url     = ex: http://yourHipsServer/null&lt;/span&gt;
&lt;span class="gd"&gt;-        # For compatibility&lt;/span&gt;
&lt;span class="gd"&gt;-        label              = DSS colored&lt;/span&gt;
&lt;span class="gd"&gt;-        coordsys           = C&lt;/span&gt;
&lt;span class="gd"&gt;-        isColor            = true&lt;/span&gt;
&lt;span class="gd"&gt;-        ~&lt;/span&gt;
&lt;span class="gd"&gt;-        """&lt;/span&gt;
&lt;span class="gd"&gt;-        cls.hipsdescription = HipsDescription(hips_properties)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_get_base_url(cls):&lt;/span&gt;
&lt;span class="gd"&gt;-        assert cls.hipsdescription.get_base_url() == 'http://alasky.u-strasbg.fr/DSS/DSSColor'&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_get_title(cls):&lt;/span&gt;
&lt;span class="gd"&gt;-        assert cls.hipsdescription.get_title() == 'DSS colored'&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_get_hips_version(cls):&lt;/span&gt;
&lt;span class="gd"&gt;-        assert cls.hipsdescription.get_hips_version() == 1.31&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_get_hips_frame(cls):&lt;/span&gt;
&lt;span class="gd"&gt;-        assert cls.hipsdescription.get_hips_frame() == 'equatorial'&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_get_hips_order(cls):&lt;/span&gt;
&lt;span class="gd"&gt;-        assert cls.hipsdescription.get_hips_order() == 9&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    def test_get_tile_format(cls):&lt;/span&gt;
&lt;span class="gd"&gt;-        assert cls.hipsdescription.get_tile_format() == 'jpeg'&lt;/span&gt;
\ No newline at end of file

commit 69a91f0a35369ccd018990746b2f830d0ecb74d8
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 9 15:06:30 2017 +0500

    Remove whitespace

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index a104bdc..36bff9d 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -18,7 +18,7 @@ def boundaries(nside: int, pix: int, nest: bool=True) -&amp;gt; tuple:&lt;/span&gt;

     This function calls `healpy.boundaries` and `healpy.pixelfunc.vec2ang`
     and computes the four corners of a HiPS tile. The order of the returned
&lt;span class="gd"&gt;-    corners is: N, W, S, E where N (resp. W, S, E) is the corner roughly &lt;/span&gt;
&lt;span class="gi"&gt;+    corners is: N, W, S, E where N (resp. W, S, E) is the corner roughly&lt;/span&gt;
     pointing towards the North (resp. West, South and East).

     Parameters

commit 8c235c2ebe5861aa2ea213ff4fe0f5d7f7c89d99
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 9 14:05:56 2017 +0500

    Update docstring

    This commit updates the docstring to show the order of the returned corners.

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 6ea5681..a104bdc 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -13,10 +13,13 @@ import healpy as hp&lt;/span&gt;
 import numpy as np


&lt;span class="gd"&gt;-def boundaries(nside: int, pix: int, nest: bool=False) -&amp;gt; tuple:&lt;/span&gt;
&lt;span class="gi"&gt;+def boundaries(nside: int, pix: int, nest: bool=True) -&amp;gt; tuple:&lt;/span&gt;
     """Returns an array containing the angle (theta and phi) in radians.

&lt;span class="gd"&gt;-    This function calls `healpy.boundaries` and `healpy.vec2ang`.&lt;/span&gt;
&lt;span class="gi"&gt;+    This function calls `healpy.boundaries` and `healpy.pixelfunc.vec2ang`&lt;/span&gt;
&lt;span class="gi"&gt;+    and computes the four corners of a HiPS tile. The order of the returned&lt;/span&gt;
&lt;span class="gi"&gt;+    corners is: N, W, S, E where N (resp. W, S, E) is the corner roughly &lt;/span&gt;
&lt;span class="gi"&gt;+    pointing towards the North (resp. West, South and East).&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gu"&gt;@@ -41,7 +44,7 @@ def boundaries(nside: int, pix: int, nest: bool=False) -&amp;gt; tuple:&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; from astropy.coordinates import SkyCoord
         &amp;gt;&amp;gt;&amp;gt; nside = 8
         &amp;gt;&amp;gt;&amp;gt; pix = 450
&lt;span class="gd"&gt;-        &amp;gt;&amp;gt;&amp;gt; theta, phi = boundaries(nside, pix, nest=True)&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; theta, phi = boundaries(nside, pix)&lt;/span&gt;
         &amp;gt;&amp;gt;&amp;gt; SkyCoord(ra=phi, dec=np.pi/2 - theta, unit='radian', frame='icrs')
         &amp;lt;SkyCoord (ICRS): (ra, dec) in deg
         [( 264.375, -24.62431835), ( 258.75 , -30.        ),
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 7606819..34373ad 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -10,7 +10,7 @@ def test_boundaries():&lt;/span&gt;
     order = 3
     nside = hp.order2nside(order)
     pix = 450
&lt;span class="gd"&gt;-    theta, phi = boundaries(nside, pix, nest=True)&lt;/span&gt;
&lt;span class="gi"&gt;+    theta, phi = boundaries(nside, pix)&lt;/span&gt;

     radec = SkyCoord(ra=phi, dec=np.pi/2 - theta, unit='radian', frame='icrs')


commit 45b4117c3e85bb6fac72aeb790dfa483c03f0b12
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 9 13:14:04 2017 +0500

    Add entry in api.rst

    This commit fixes some formatting issues and adds an entry for the
    tiles.hipsdescription module in api.rst file.

&lt;span class="gh"&gt;diff --git a/docs/api.rst b/docs/api.rst&lt;/span&gt;
&lt;span class="gh"&gt;index eb152d9..46c5c1f 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/api.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/api.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -2,3 +2,4 @@ Reference/API&lt;/span&gt;
 =============

 .. automodapi:: hips
&lt;span class="gi"&gt;+.. automodapi:: hips.tiles&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/hipsdescription.py b/hips/tiles/hipsdescription.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8c81957..f13624a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/tiles/hipsdescription.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/hipsdescription.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -9,8 +9,8 @@ from collections import OrderedDict&lt;/span&gt;


 class HipsDescription:
&lt;span class="gd"&gt;-    """This class provides method for parsing the HiPS properties file.&lt;/span&gt;
&lt;span class="gd"&gt;-       It also provides various getters around the commonly used properties.&lt;/span&gt;
&lt;span class="gi"&gt;+    """This class provides methods for parsing the HiPS properties file.&lt;/span&gt;
&lt;span class="gi"&gt;+       It also provides multiple getters around the commonly used properties.&lt;/span&gt;
     """

     def __init__(self, properties: str) -&amp;gt; None:
&lt;span class="gu"&gt;@@ -28,6 +28,7 @@ class HipsDescription:&lt;/span&gt;
         ----------
         properties : str
             HiPS file properties
&lt;span class="gi"&gt;+        &lt;/span&gt;
         Returns
         -------
         dict_properties : OrderedDict
&lt;span class="gu"&gt;@@ -46,7 +47,7 @@ class HipsDescription:&lt;/span&gt;
         """OrderedDict: Returns the ordered dictionary containing the HiPS properties."""
         return self.properties

&lt;span class="gd"&gt;-    def get_base_url(self) -&amp;gt; [str, None]:&lt;/span&gt;
&lt;span class="gi"&gt;+    def get_base_url(self) -&amp;gt; str:&lt;/span&gt;
         """str: Returns the base url from the HiPS file properties."""
         try:
             return self.properties['hips_service_url']

commit ff3299abeb476ffb1937b6647f6bdae26d659e34
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 9 12:16:52 2017 +0500

    Add tiles.hipsdescription module

    This commits adds a class named HipsDescription which provides methods for parsing the HiPS properties.
    It parses the given string and returns an object of OrderedDict. Additional getter methods are also included.
    For the test cases, a sample properties file was obtained from http://alasky.unistra.fr/DSS/DSSColor/properties

&lt;span class="gh"&gt;diff --git a/hips/tiles/__init__.py b/hips/tiles/__init__.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..bb73205&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/__init__.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,3 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+"""HiPS description class -- provides methods for parsing the HiPS file properties."""&lt;/span&gt;
&lt;span class="gi"&gt;+from .hipsdescription import *&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/hipsdescription.py b/hips/tiles/hipsdescription.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..8c81957&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/hipsdescription.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,74 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+"""HiPS description class -- provides methods for parsing the HiPS file properties."""&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+__all__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'HipsDescription',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from collections import OrderedDict&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class HipsDescription:&lt;/span&gt;
&lt;span class="gi"&gt;+    """This class provides method for parsing the HiPS properties file.&lt;/span&gt;
&lt;span class="gi"&gt;+       It also provides various getters around the commonly used properties.&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def __init__(self, properties: str) -&amp;gt; None:&lt;/span&gt;
&lt;span class="gi"&gt;+        super(HipsDescription, self).__init__()&lt;/span&gt;
&lt;span class="gi"&gt;+        self.properties = self.parse_file_properties(properties)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def parse_file_properties(cls, properties: str) -&amp;gt; OrderedDict:&lt;/span&gt;
&lt;span class="gi"&gt;+        """Returns an ordered dictionary containing the HiPS file properties.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        This method parses the HiPS file properties and loads it in a dictionary,&lt;/span&gt;
&lt;span class="gi"&gt;+        then is casts it to `collections.OrderedDict` type.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+        ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        properties : str&lt;/span&gt;
&lt;span class="gi"&gt;+            HiPS file properties&lt;/span&gt;
&lt;span class="gi"&gt;+        Returns&lt;/span&gt;
&lt;span class="gi"&gt;+        -------&lt;/span&gt;
&lt;span class="gi"&gt;+        dict_properties : OrderedDict&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        properties = properties.split('\n')&lt;/span&gt;
&lt;span class="gi"&gt;+        dict_properties = {}&lt;/span&gt;
&lt;span class="gi"&gt;+        for property in properties:&lt;/span&gt;
&lt;span class="gi"&gt;+            key_value = property.split('=')&lt;/span&gt;
&lt;span class="gi"&gt;+            try:&lt;/span&gt;
&lt;span class="gi"&gt;+                dict_properties[key_value[0].strip()] = key_value[1].strip()&lt;/span&gt;
&lt;span class="gi"&gt;+            except:&lt;/span&gt;
&lt;span class="gi"&gt;+                pass&lt;/span&gt;
&lt;span class="gi"&gt;+        return OrderedDict(dict_properties)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def get_properties(self) -&amp;gt; OrderedDict:&lt;/span&gt;
&lt;span class="gi"&gt;+        """OrderedDict: Returns the ordered dictionary containing the HiPS properties."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.properties&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def get_base_url(self) -&amp;gt; [str, None]:&lt;/span&gt;
&lt;span class="gi"&gt;+        """str: Returns the base url from the HiPS file properties."""&lt;/span&gt;
&lt;span class="gi"&gt;+        try:&lt;/span&gt;
&lt;span class="gi"&gt;+            return self.properties['hips_service_url']&lt;/span&gt;
&lt;span class="gi"&gt;+        except:&lt;/span&gt;
&lt;span class="gi"&gt;+            return None&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def get_title(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """str: Returns the title from the HiPS file properties."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.properties['obs_title']&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def get_hips_version(self) -&amp;gt; float:&lt;/span&gt;
&lt;span class="gi"&gt;+        """float: Returns the HiPS version from the HiPS file properties."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return float(self.properties['hips_version'])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def get_hips_frame(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """str: Returns the HiPS frame from the HiPS file properties."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.properties['hips_frame']&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def get_hips_order(self) -&amp;gt; int:&lt;/span&gt;
&lt;span class="gi"&gt;+        """int: Returns the HiPS order from the HiPS file properties."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return int(self.properties['hips_order'])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def get_tile_format(self) -&amp;gt; str:&lt;/span&gt;
&lt;span class="gi"&gt;+        """str: Returns the HiPS tile format from the HiPS file properties."""&lt;/span&gt;
&lt;span class="gi"&gt;+        return self.properties['hips_tile_format']&lt;/span&gt;
\ No newline at end of file
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/__init__.py b/hips/tiles/tests/__init__.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..e69de29&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/tiles/tests/test_hipsdescription.py b/hips/tiles/tests/test_hipsdescription.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..458e976&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/tiles/tests/test_hipsdescription.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,79 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+from .. hipsdescription import HipsDescription&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+class TestHiPSDescription:&lt;/span&gt;
&lt;span class="gi"&gt;+    @classmethod&lt;/span&gt;
&lt;span class="gi"&gt;+    def setup_class(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        # These HiPS properties were obtained from: http://alasky.u-strasbg.fr/DSS/DSSColor/properties&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_properties = """&lt;/span&gt;
&lt;span class="gi"&gt;+        creator_did          = ivo://CDS/P/DSS2/color&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_collection       = DSS colored&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_title            = DSS colored&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_description      = Color composition generated by CDS. This HiPS survey is based on 2 others HiPS surveys, respectively DSS2-red and DSS2-blue HiPS, both of them directly generated from original scanned plates downloaded from STScI site. The red component has been built from POSS-II F, AAO-SES,SR and SERC-ER plates. The blue component has been build from POSS-II J and SERC-J,EJ. The green component is based on the mean of other components. Three missing plates from red survey (253, 260, 359) has been replaced by pixels from the DSSColor STScI jpeg survey. The 11 missing blue plates (mainly in galactic plane) have not been replaced (only red component).&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_copyright        = Digitized Sky Survey - STScI/NASA, Colored &amp;amp; Healpixed by CDS&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_copyright_url    = http://archive.stsci.edu/dss/acknowledging.html&lt;/span&gt;
&lt;span class="gi"&gt;+        client_category      = Image/Optical/DSS&lt;/span&gt;
&lt;span class="gi"&gt;+        client_sort_key      = 03-00&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_builder         = Aladin/HipsGen v9.039&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_creation_date   = 2010-05-01T19:05Z&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_release_date    = 2015-05-11T08:45Z&lt;/span&gt;
&lt;span class="gi"&gt;+        # hips_release_date    = 2016-12-13T14:51Z&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_creator         = CDS (A.Oberto, P.Fernique)&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_version         = 1.31&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_order           = 9&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_frame           = equatorial&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_tile_width      = 512&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_tile_format     = jpeg&lt;/span&gt;
&lt;span class="gi"&gt;+        dataproduct_type     = image&lt;/span&gt;
&lt;span class="gi"&gt;+        client_application   = AladinLite&lt;/span&gt;
&lt;span class="gi"&gt;+        moc_access_url       = http://alasky.u-strasbg.fr/DSS/DSSColor/Moc.fits&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_service_url     = http://alasky.u-strasbg.fr/DSS/DSSColor&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_status          = public master clonableOnce&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_rgb_red         = DSS2Merged [1488.0 8488.8125 14666.0 Linear]&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_rgb_blue        = DSS2-blue-XJ-S [4286.0 12122.5 19959.0 Linear]&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_hierarchy       = median&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_pixel_scale     = 2.236E-4&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_initial_ra      = 085.30251&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_initial_dec     = -02.25468&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_initial_fov     = 2&lt;/span&gt;
&lt;span class="gi"&gt;+        moc_sky_fraction     = 1&lt;/span&gt;
&lt;span class="gi"&gt;+        dataproduct_subtype  = color&lt;/span&gt;
&lt;span class="gi"&gt;+        hips_copyright       = CNRS/Unistra&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_ack              = The Digitized Sky Surveys were produced at the Space Telescope Science Institute under U.S. Government grant NAG W-2166. The images of these surveys are based on photographic data obtained using the Oschin Schmidt Telescope on Palomar Mountain and the UK Schmidt Telescope. The plates were processed into the present compressed digital form with the permission of these institutions&lt;/span&gt;
&lt;span class="gi"&gt;+        prov_progenitor      = STScI&lt;/span&gt;
&lt;span class="gi"&gt;+        bib_reference        = 2008AJ....136..735L&lt;/span&gt;
&lt;span class="gi"&gt;+        bib_reference_url    = http://simbad.u-strasbg.fr/simbad/sim-ref?bibcode=2008AJ....136..735L&lt;/span&gt;
&lt;span class="gi"&gt;+        # 1975-1999&lt;/span&gt;
&lt;span class="gi"&gt;+        t_min                = 42413&lt;/span&gt;
&lt;span class="gi"&gt;+        t_max                = 51179&lt;/span&gt;
&lt;span class="gi"&gt;+        obs_regime           = Optical&lt;/span&gt;
&lt;span class="gi"&gt;+        # Bandpass  422-967 THz&lt;/span&gt;
&lt;span class="gi"&gt;+        em_min               = 7.104086682464e-7&lt;/span&gt;
&lt;span class="gi"&gt;+        em_max               = 3.100232244054e-7&lt;/span&gt;
&lt;span class="gi"&gt;+        # hips_master_url     = ex: http://yourHipsServer/null&lt;/span&gt;
&lt;span class="gi"&gt;+        # For compatibility&lt;/span&gt;
&lt;span class="gi"&gt;+        label              = DSS colored&lt;/span&gt;
&lt;span class="gi"&gt;+        coordsys           = C&lt;/span&gt;
&lt;span class="gi"&gt;+        isColor            = true&lt;/span&gt;
&lt;span class="gi"&gt;+        ~&lt;/span&gt;
&lt;span class="gi"&gt;+        """&lt;/span&gt;
&lt;span class="gi"&gt;+        cls.hipsdescription = HipsDescription(hips_properties)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_get_base_url(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert cls.hipsdescription.get_base_url() == 'http://alasky.u-strasbg.fr/DSS/DSSColor'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_get_title(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert cls.hipsdescription.get_title() == 'DSS colored'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_get_hips_version(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert cls.hipsdescription.get_hips_version() == 1.31&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_get_hips_frame(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert cls.hipsdescription.get_hips_frame() == 'equatorial'&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_get_hips_order(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert cls.hipsdescription.get_hips_order() == 9&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    def test_get_tile_format(cls):&lt;/span&gt;
&lt;span class="gi"&gt;+        assert cls.hipsdescription.get_tile_format() == 'jpeg'&lt;/span&gt;
\ No newline at end of file

commit 0b1359036a1436551234dd21ce47149c533c1bea
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed Jun 7 14:12:46 2017 +0500

    Update utils.healpix module

    This commit addresses import conventions and also some formatting issues. An example was also added and the test case was updated to follow this issue: https://github.com/healpy/healpy/issues/393#issuecomment-305994042.

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index f9a86e6..6ea5681 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -9,14 +9,14 @@ __all__ = [&lt;/span&gt;
     'boundaries',
 ]

&lt;span class="gd"&gt;-import healpy&lt;/span&gt;
&lt;span class="gi"&gt;+import healpy as hp&lt;/span&gt;
 import numpy as np


 def boundaries(nside: int, pix: int, nest: bool=False) -&amp;gt; tuple:
     """Returns an array containing the angle (theta and phi) in radians.

&lt;span class="gd"&gt;-    This method calls `healpy.boundaries` and `healpy.vec2ang`.&lt;/span&gt;
&lt;span class="gi"&gt;+    This function calls `healpy.boundaries` and `healpy.vec2ang`.&lt;/span&gt;

     Parameters
     ----------
&lt;span class="gu"&gt;@@ -33,14 +33,21 @@ def boundaries(nside: int, pix: int, nest: bool=False) -&amp;gt; tuple:&lt;/span&gt;
         Returns the angle (theta and phi) in radians

     Examples
&lt;span class="gd"&gt;-    -------&lt;/span&gt;
&lt;span class="gd"&gt;-    nside = 8&lt;/span&gt;
&lt;span class="gd"&gt;-    pix = 450&lt;/span&gt;
&lt;span class="gd"&gt;-    theta, phi = boundaries(nside, pix, nest=True)&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    radec = SkyCoord(ra=phi, dec=np.pi/2 - theta, unit='radian', frame='icrs')&lt;/span&gt;
&lt;span class="gi"&gt;+    --------&lt;/span&gt;
&lt;span class="gi"&gt;+    ::&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from hips.utils import boundaries&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; from astropy.coordinates import SkyCoord&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; nside = 8&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; pix = 450&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; theta, phi = boundaries(nside, pix, nest=True)&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;gt;&amp;gt;&amp;gt; SkyCoord(ra=phi, dec=np.pi/2 - theta, unit='radian', frame='icrs')&lt;/span&gt;
&lt;span class="gi"&gt;+        &amp;lt;SkyCoord (ICRS): (ra, dec) in deg&lt;/span&gt;
&lt;span class="gi"&gt;+        [( 264.375, -24.62431835), ( 258.75 , -30.        ),&lt;/span&gt;
&lt;span class="gi"&gt;+         ( 264.375, -35.68533471), ( 270.   , -30.        )]&amp;gt;&lt;/span&gt;
     """

&lt;span class="gd"&gt;-    boundary_coords = healpy.boundaries(nside, pix, nest=nest)&lt;/span&gt;
&lt;span class="gd"&gt;-    theta, phi = healpy.vec2ang(np.transpose(boundary_coords))&lt;/span&gt;
&lt;span class="gi"&gt;+    boundary_coords = hp.boundaries(nside, pix, nest=nest)&lt;/span&gt;
&lt;span class="gi"&gt;+    theta, phi = hp.vec2ang(np.transpose(boundary_coords))&lt;/span&gt;
     return theta, phi
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 93056e4..7606819 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,15 +1,24 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+import healpy as hp&lt;/span&gt;
 from .. healpix import boundaries
 from astropy.coordinates import SkyCoord
&lt;span class="gd"&gt;-import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+from numpy.testing import assert_allclose&lt;/span&gt;


 def test_boundaries():
&lt;span class="gd"&gt;-    nside = 8&lt;/span&gt;
&lt;span class="gi"&gt;+    order = 3&lt;/span&gt;
&lt;span class="gi"&gt;+    nside = hp.order2nside(order)&lt;/span&gt;
     pix = 450
     theta, phi = boundaries(nside, pix, nest=True)

     radec = SkyCoord(ra=phi, dec=np.pi/2 - theta, unit='radian', frame='icrs')
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+    These HEALPix corner values were verified through Aladin Lite with the "Show&lt;/span&gt;
&lt;span class="gi"&gt;+    healpix grid" option turned on. More information can be found on this GitHub&lt;/span&gt;
&lt;span class="gi"&gt;+    issue: https://github.com/healpy/healpy/issues/393#issuecomment-305994042&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
     radec_precomp = [[264.375,  258.75,  264.375,  270.],
                      [-24.624318,  -30.,  -35.685335,  -30.]]
&lt;span class="gd"&gt;-    np.testing.assert_allclose([radec.ra, radec.dec], radec_precomp)&lt;/span&gt;
&lt;span class="gi"&gt;+    assert_allclose([radec.ra, radec.dec], radec_precomp)&lt;/span&gt;

commit fa832132c016e7285d24abe58d1438fff27e649b
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jun 6 22:34:14 2017 +0500

    Add example

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 5ebe49a..f9a86e6 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -31,6 +31,14 @@ def boundaries(nside: int, pix: int, nest: bool=False) -&amp;gt; tuple:&lt;/span&gt;
     -------
     theta, phi : float, array
         Returns the angle (theta and phi) in radians
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Examples&lt;/span&gt;
&lt;span class="gi"&gt;+    -------&lt;/span&gt;
&lt;span class="gi"&gt;+    nside = 8&lt;/span&gt;
&lt;span class="gi"&gt;+    pix = 450&lt;/span&gt;
&lt;span class="gi"&gt;+    theta, phi = boundaries(nside, pix, nest=True)&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    radec = SkyCoord(ra=phi, dec=np.pi/2 - theta, unit='radian', frame='icrs')&lt;/span&gt;
     """

     boundary_coords = healpy.boundaries(nside, pix, nest=nest)

commit 5de3e05971f7570eeb4402a266e8918b14d9e9ca
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jun 6 22:30:41 2017 +0500

    Update test case

&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 7f63ebc..93056e4 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,5 +1,6 @@&lt;/span&gt;
 # Licensed under a 3-clause BSD style license - see LICENSE.rst
 from .. healpix import boundaries
&lt;span class="gi"&gt;+from astropy.coordinates import SkyCoord&lt;/span&gt;
 import numpy as np


&lt;span class="gu"&gt;@@ -8,7 +9,7 @@ def test_boundaries():&lt;/span&gt;
     pix = 450
     theta, phi = boundaries(nside, pix, nest=True)

&lt;span class="gd"&gt;-    thetaphi_precomp = ([[2.00057176,  2.0943951,  2.19362291,  2.0943951],&lt;/span&gt;
&lt;span class="gd"&gt;-                         [4.61421421,  4.51603944,  4.61421421,  4.71238898]])&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-    np.testing.assert_allclose([theta, phi], thetaphi_precomp)&lt;/span&gt;
&lt;span class="gi"&gt;+    radec = SkyCoord(ra=phi, dec=np.pi/2 - theta, unit='radian', frame='icrs')&lt;/span&gt;
&lt;span class="gi"&gt;+    radec_precomp = [[264.375,  258.75,  264.375,  270.],&lt;/span&gt;
&lt;span class="gi"&gt;+                     [-24.624318,  -30.,  -35.685335,  -30.]]&lt;/span&gt;
&lt;span class="gi"&gt;+    np.testing.assert_allclose([radec.ra, radec.dec], radec_precomp)&lt;/span&gt;

commit aca32b631e949222e88bfc48ff25b1ecaa28f3cd
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jun 6 22:17:09 2017 +0500

    Update formatting

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 30996fa..5ebe49a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -15,21 +15,17 @@ import numpy as np&lt;/span&gt;

 def boundaries(nside: int, pix: int, nest: bool=False) -&amp;gt; tuple:
     """Returns an array containing the angle (theta and phi) in radians.
&lt;span class="gd"&gt;-    This method calls :py:meth:`.healpy.boundaries` and :py:meth:`.healpy.vec2ang`&lt;/span&gt;
&lt;span class="gd"&gt;-    &lt;/span&gt;
&lt;span class="gd"&gt;-    Parameters&lt;/span&gt;
&lt;span class="gd"&gt;-    ----------&lt;/span&gt;
&lt;span class="gd"&gt;-        nside : int&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-            The nside of the HEALPix map&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-        pix : int&lt;/span&gt;

&lt;span class="gd"&gt;-            Pixel identifier&lt;/span&gt;
&lt;span class="gi"&gt;+    This method calls `healpy.boundaries` and `healpy.vec2ang`.&lt;/span&gt;

&lt;span class="gd"&gt;-        nest : bool, optional&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-            If True, assume NESTED pixel ordering, otherwise, RING pixel ordering&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+    nside : int&lt;/span&gt;
&lt;span class="gi"&gt;+        The nside of the HEALPix map&lt;/span&gt;
&lt;span class="gi"&gt;+    pix : int&lt;/span&gt;
&lt;span class="gi"&gt;+        Pixel identifier&lt;/span&gt;
&lt;span class="gi"&gt;+    nest : bool, optional&lt;/span&gt;
&lt;span class="gi"&gt;+        If True, assume NESTED pixel ordering, otherwise, RING pixel ordering&lt;/span&gt;

     Returns
     -------

commit 9da1f1fd3e79a552839bff00fc814396dcba7920
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jun 6 14:48:28 2017 +0500

    Add newline

&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 2cd3c73..30996fa 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -16,6 +16,7 @@ import numpy as np&lt;/span&gt;
 def boundaries(nside: int, pix: int, nest: bool=False) -&amp;gt; tuple:
     """Returns an array containing the angle (theta and phi) in radians.
     This method calls :py:meth:`.healpy.boundaries` and :py:meth:`.healpy.vec2ang`
&lt;span class="gi"&gt;+    &lt;/span&gt;
     Parameters
     ----------
         nside : int

commit bbb48be4b0c77180fa34de83a2b6a3614639e3c1
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Tue Jun 6 14:43:01 2017 +0500

    Update utils.healpix module

&lt;span class="gh"&gt;diff --git a/docs/api.rst b/docs/api.rst&lt;/span&gt;
&lt;span class="gh"&gt;index eb152d9..0b198d9 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/api.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/api.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -2,3 +2,4 @@ Reference/API&lt;/span&gt;
 =============

 .. automodapi:: hips
&lt;span class="gi"&gt;+.. automodapi:: hips.utils&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 8e85569..2cd3c73 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -10,11 +10,12 @@ __all__ = [&lt;/span&gt;
 ]

 import healpy
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;


&lt;span class="gd"&gt;-def boundaries(nside, pix, step=1, nest=False):&lt;/span&gt;
&lt;span class="gd"&gt;-    """Returns an array containing the longitude and latitude.&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+def boundaries(nside: int, pix: int, nest: bool=False) -&amp;gt; tuple:&lt;/span&gt;
&lt;span class="gi"&gt;+    """Returns an array containing the angle (theta and phi) in radians.&lt;/span&gt;
&lt;span class="gi"&gt;+    This method calls :py:meth:`.healpy.boundaries` and :py:meth:`.healpy.vec2ang`&lt;/span&gt;
     Parameters
     ----------
         nside : int
&lt;span class="gu"&gt;@@ -25,20 +26,16 @@ def boundaries(nside, pix, step=1, nest=False):&lt;/span&gt;

             Pixel identifier

&lt;span class="gd"&gt;-        step : int, optional&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gd"&gt;-            Number of elements for each side of the pixel&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
         nest : bool, optional

             If True, assume NESTED pixel ordering, otherwise, RING pixel ordering

     Returns
     -------
&lt;span class="gd"&gt;-    longitude, latitude : float, array&lt;/span&gt;
&lt;span class="gd"&gt;-        Longitude and latitude positions&lt;/span&gt;
&lt;span class="gi"&gt;+    theta, phi : float, array&lt;/span&gt;
&lt;span class="gi"&gt;+        Returns the angle (theta and phi) in radians&lt;/span&gt;
     """

     boundary_coords = healpy.boundaries(nside, pix, nest=nest)
&lt;span class="gd"&gt;-    lon, lat = healpy.vec2ang(boundary_coords, lonlat=True)&lt;/span&gt;
&lt;span class="gd"&gt;-    return [lon, lat]&lt;/span&gt;
&lt;span class="gi"&gt;+    theta, phi = healpy.vec2ang(np.transpose(boundary_coords))&lt;/span&gt;
&lt;span class="gi"&gt;+    return theta, phi&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gh"&gt;index 82b2223..7f63ebc 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -6,8 +6,9 @@ import numpy as np&lt;/span&gt;
 def test_boundaries():
     nside = 8
     pix = 450
&lt;span class="gd"&gt;-    lon = boundaries(nside, pix, nest=True)&lt;/span&gt;
&lt;span class="gd"&gt;-    lonlat_precomp = [[242.19350089, 270., 226.97382512, 229.39870535],&lt;/span&gt;
&lt;span class="gd"&gt;-                      [-22.6263803, -43.1943471, -19.37793463, -33.05573115]]&lt;/span&gt;
&lt;span class="gi"&gt;+    theta, phi = boundaries(nside, pix, nest=True)&lt;/span&gt;

&lt;span class="gd"&gt;-    np.testing.assert_array_almost_equal(lon, lonlat_precomp, decimal=8)&lt;/span&gt;
&lt;span class="gi"&gt;+    thetaphi_precomp = ([[2.00057176,  2.0943951,  2.19362291,  2.0943951],&lt;/span&gt;
&lt;span class="gi"&gt;+                         [4.61421421,  4.51603944,  4.61421421,  4.71238898]])&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    np.testing.assert_allclose([theta, phi], thetaphi_precomp)&lt;/span&gt;

commit e4c00b949e0ca03f06c115927256f0539cdde9ad
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Sun Jun 4 19:47:11 2017 +0500

    Add utils.healpix module

&lt;span class="gh"&gt;diff --git a/hips/utils/__init__.py b/hips/utils/__init__.py&lt;/span&gt;
&lt;span class="gh"&gt;index d3f4517..ed56631 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/utils/__init__.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/__init__.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -2,3 +2,4 @@&lt;/span&gt;

 # This sub-module is destined for common non-package specific utility
 # functions.
&lt;span class="gi"&gt;+from .healpix import *&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/healpix.py b/hips/utils/healpix.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..8e85569&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,44 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+"""HEALpy wrapper functions.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+This module contains wrapper functions around HEALPix utilizing&lt;/span&gt;
&lt;span class="gi"&gt;+the healpy library&lt;/span&gt;
&lt;span class="gi"&gt;+"""&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+__all__ = [&lt;/span&gt;
&lt;span class="gi"&gt;+    'boundaries',&lt;/span&gt;
&lt;span class="gi"&gt;+]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+import healpy&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def boundaries(nside, pix, step=1, nest=False):&lt;/span&gt;
&lt;span class="gi"&gt;+    """Returns an array containing the longitude and latitude.&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Parameters&lt;/span&gt;
&lt;span class="gi"&gt;+    ----------&lt;/span&gt;
&lt;span class="gi"&gt;+        nside : int&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+            The nside of the HEALPix map&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        pix : int&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+            Pixel identifier&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        step : int, optional&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+            Number of elements for each side of the pixel&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+        nest : bool, optional&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+            If True, assume NESTED pixel ordering, otherwise, RING pixel ordering&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    Returns&lt;/span&gt;
&lt;span class="gi"&gt;+    -------&lt;/span&gt;
&lt;span class="gi"&gt;+    longitude, latitude : float, array&lt;/span&gt;
&lt;span class="gi"&gt;+        Longitude and latitude positions&lt;/span&gt;
&lt;span class="gi"&gt;+    """&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    boundary_coords = healpy.boundaries(nside, pix, nest=nest)&lt;/span&gt;
&lt;span class="gi"&gt;+    lon, lat = healpy.vec2ang(boundary_coords, lonlat=True)&lt;/span&gt;
&lt;span class="gi"&gt;+    return [lon, lat]&lt;/span&gt;
&lt;span class="gh"&gt;diff --git a/hips/utils/tests/test_healpix.py b/hips/utils/tests/test_healpix.py&lt;/span&gt;
new file mode 100644
&lt;span class="gh"&gt;index 0000000..82b2223&lt;/span&gt;
&lt;span class="gd"&gt;--- /dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/utils/tests/test_healpix.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -0,0 +1,13 @@&lt;/span&gt;
&lt;span class="gi"&gt;+# Licensed under a 3-clause BSD style license - see LICENSE.rst&lt;/span&gt;
&lt;span class="gi"&gt;+from .. healpix import boundaries&lt;/span&gt;
&lt;span class="gi"&gt;+import numpy as np&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+def test_boundaries():&lt;/span&gt;
&lt;span class="gi"&gt;+    nside = 8&lt;/span&gt;
&lt;span class="gi"&gt;+    pix = 450&lt;/span&gt;
&lt;span class="gi"&gt;+    lon = boundaries(nside, pix, nest=True)&lt;/span&gt;
&lt;span class="gi"&gt;+    lonlat_precomp = [[242.19350089, 270., 226.97382512, 229.39870535],&lt;/span&gt;
&lt;span class="gi"&gt;+                      [-22.6263803, -43.1943471, -19.37793463, -33.05573115]]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+    np.testing.assert_array_almost_equal(lon, lonlat_precomp, decimal=8)&lt;/span&gt;

commit 53a607b4fa0031fe3fedd0b6bf89ba03436d715a
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Fri Jun 2 11:38:40 2017 +0500

    Update Sphinx docs

&lt;span class="gh"&gt;diff --git a/docs/index.rst b/docs/index.rst&lt;/span&gt;
&lt;span class="gh"&gt;index 3e75ee2..3ba6afe 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/docs/index.rst&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/docs/index.rst&lt;/span&gt;
&lt;span class="gu"&gt;@@ -4,8 +4,11 @@&lt;/span&gt;
 Python HiPS package documentation
 #################################

&lt;span class="gd"&gt;-.. warning::&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+.. note::&lt;/span&gt;
&lt;span class="gi"&gt;+ &lt;/span&gt;
&lt;span class="gi"&gt;+    This package is being developed as part of Google Summer of Code 2017 program. The progress &lt;/span&gt;
&lt;span class="gi"&gt;+    of this package will be updated on this `blog &amp;lt;https://adl1995.github.io&amp;gt;`_ and the student's&lt;/span&gt;
&lt;span class="gi"&gt;+    application can be found `here &amp;lt;https://github.com/adl1995/HIPS-to-Py/blob/master/documents/application.md&amp;gt;`_.&lt;/span&gt;
     This ``hips`` package is in a very early stage of development.
     We started to work on it in June 2017 and expect to have a first v0.1 release in summer 2017.
     That said, please have a look and try to use it for your applications.

commit c7224fe181a18d041513973f043337e3d5af33fc
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Wed May 31 11:24:44 2017 +0500

    Update Makefile to use python3 command

&lt;span class="gh"&gt;diff --git a/Makefile b/Makefile&lt;/span&gt;
&lt;span class="gh"&gt;index 508b55f..c883419 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/Makefile&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/Makefile&lt;/span&gt;
&lt;span class="gu"&gt;@@ -22,12 +22,12 @@ help:&lt;/span&gt;
    @echo ''
    @echo ' Common `setup.py` commands:'
    @echo ''
&lt;span class="gd"&gt;-   @echo '     python setup.py --help-commands'&lt;/span&gt;
&lt;span class="gd"&gt;-   @echo '     python setup.py install'&lt;/span&gt;
&lt;span class="gd"&gt;-   @echo '     python setup.py develop'&lt;/span&gt;
&lt;span class="gd"&gt;-   @echo '     python setup.py test -V'&lt;/span&gt;
&lt;span class="gd"&gt;-   @echo '     python setup.py test --help # to see available options'&lt;/span&gt;
&lt;span class="gd"&gt;-   @echo '     python setup.py build_docs # use `-l` for clean build'&lt;/span&gt;
&lt;span class="gi"&gt;+   @echo '     python3 setup.py --help-commands'&lt;/span&gt;
&lt;span class="gi"&gt;+   @echo '     python3 setup.py install'&lt;/span&gt;
&lt;span class="gi"&gt;+   @echo '     python3 setup.py develop'&lt;/span&gt;
&lt;span class="gi"&gt;+   @echo '     python3 setup.py test -V'&lt;/span&gt;
&lt;span class="gi"&gt;+   @echo '     python3 setup.py test --help # to see available options'&lt;/span&gt;
&lt;span class="gi"&gt;+   @echo '     python3 setup.py build_docs # use `-l` for clean build'&lt;/span&gt;
    @echo ''
    @echo ' More info:'
    @echo ''
&lt;span class="gu"&gt;@@ -36,14 +36,14 @@ help:&lt;/span&gt;
    @echo ''

 test:
&lt;span class="gd"&gt;-   python -m pytest hips&lt;/span&gt;
&lt;span class="gi"&gt;+   python3 -m pytest hips&lt;/span&gt;

 # TODO: add flake8 and pylint
 # TODO: activate mypy testing. Fix or configure to ignore these issues:
 # https://travis-ci.org/hipspy/hips/jobs/236913996#L694
 #  python -m mypy hips
 code-analysis:
&lt;span class="gd"&gt;-   python -m pycodestyle hips --count&lt;/span&gt;
&lt;span class="gi"&gt;+   python3 -m pycodestyle hips --count&lt;/span&gt;

 doc-show:
    open docs/_build/html/index.html
&lt;span class="gu"&gt;@@ -63,4 +63,4 @@ trailing-spaces:&lt;/span&gt;
    find $(PROJECT) docs -name "*.rst" -exec perl -pi -e 's/[ \t]*$$//' {} \;

 conda:
&lt;span class="gd"&gt;-   python setup.py bdist_conda&lt;/span&gt;
&lt;span class="gi"&gt;+   python3 setup.py bdist_conda&lt;/span&gt;

commit c5942b52a60a45dbe05e154dc381dd8ef3d2b46c
Author: Adeel Ahmad &amp;lt;adeelahmad14@hotmail.com&amp;gt;
Date:   Mon May 29 10:34:09 2017 +0500

    Update simple.py

    Return correct value.

&lt;span class="gh"&gt;diff --git a/hips/draw/simple.py b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gh"&gt;index 21c131a..f1a1675 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/hips/draw/simple.py&lt;/span&gt;
&lt;span class="gu"&gt;@@ -29,4 +29,4 @@ def hello(name: str) -&amp;gt; int:&lt;/span&gt;
         Meaning of life
     """
     print('Hello {}'.format(name))
&lt;span class="gd"&gt;-    return 42&lt;/span&gt;
&lt;span class="gi"&gt;+    return 43&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content></entry><entry><title>Fixing tile distortion issue in hips package</title><link href="https://adl1995.github.io/fixing-tile-distortion-issue-in-hips-package.html" rel="alternate"></link><published>2017-08-10T11:28:00+05:00</published><updated>2017-08-10T11:28:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2017-08-10:/fixing-tile-distortion-issue-in-hips-package.html</id><summary type="html">&lt;p&gt;As documented in the &lt;a href="http://hips.readthedocs.io/en/latest/drawing_algo.html#tile-distortion-issue"&gt;Tile distortion issue&lt;/a&gt; section, the previous technique for drawing HiPS tiles brings some astrometry offsets for distorted tiles.&lt;/p&gt;
&lt;p&gt;An example of such distortions is shown in the example below (uncheck “Activate deformations reduction algorithm” to view the astrometry offsets): &lt;a href="http://cds.unistra.fr/~boch/AL/test-reduce-deformations2.html"&gt;http://cds.unistra.fr/~boch/&lt;span class="caps"&gt;AL&lt;/span&gt;/test-reduce-deformations2 …&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;As documented in the &lt;a href="http://hips.readthedocs.io/en/latest/drawing_algo.html#tile-distortion-issue"&gt;Tile distortion issue&lt;/a&gt; section, the previous technique for drawing HiPS tiles brings some astrometry offsets for distorted tiles.&lt;/p&gt;
&lt;p&gt;An example of such distortions is shown in the example below (uncheck “Activate deformations reduction algorithm” to view the astrometry offsets): &lt;a href="http://cds.unistra.fr/~boch/AL/test-reduce-deformations2.html"&gt;http://cds.unistra.fr/~boch/&lt;span class="caps"&gt;AL&lt;/span&gt;/test-reduce-deformations2.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;To overcome this issue, the parent tile is divided into four children tiles if it meets the following two conditions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;One edge is greater than 300 pixels when projected&lt;/li&gt;
&lt;li&gt;Or, the ratio of smaller diagonal on larger diagonal is smaller than 0.7 and one of the diagonal is greater than 150 pixels when projected&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For handling these checks, a function &lt;code&gt;is_tile_distorted&lt;/code&gt; is introduced:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;is_tile_distorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;corners&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;tuple&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="sd"&gt;"""Is the tile with the given corners distorted?"""&lt;/span&gt;
    &lt;span class="n"&gt;edges&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;diagonals&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;measure_tile_lengths&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;corners&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;diagonal_ratio&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;min&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;diagonals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="nb"&gt;max&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;diagonals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="nb"&gt;max&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;edges&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;300&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt;
        &lt;span class="nb"&gt;max&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;diagonals&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt;
        &lt;span class="n"&gt;diagonal_ratio&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mf"&gt;0.7&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;measure_tile_lengths&lt;/code&gt; function computes the length of tile edges and diagonals by computing the euclidean distance between two points, its source code can be found &lt;a href="https://github.com/hipspy/hips/blob/master/hips/draw/paint.py#L254"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If a tile passes all the above checks, it is then split into four children tiles, which is achieved by the following property:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nd"&gt;@property&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;children&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'HipsTile'&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
&lt;span class="sd"&gt;"""Create four children tiles from parent tile."""&lt;/span&gt;
&lt;span class="n"&gt;w&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;//&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
   &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
   &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
   &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
   &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="n"&gt;tiles&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;idx&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;span class="n"&gt;meta&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;HipsTileMeta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
   &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;meta&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;meta&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ipix&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;idx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;meta&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;file_format&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;meta&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;tile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_numpy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;meta&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;idx&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;tiles&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tile&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;tiles&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The criteria for choosing the HiPS &lt;code&gt;order&lt;/code&gt; and &lt;code&gt;ipix&lt;/code&gt; for children tiles is mentioned in the &lt;a href="http://www.ivoa.net/documents/HiPS/20160623/WD-HiPS-1.0-20160623.pdf"&gt;HiPS &lt;span class="caps"&gt;IVOA&lt;/span&gt; paper&lt;/a&gt;, Appendix, page 31.&lt;/p&gt;
&lt;p&gt;A Jupyter notebook illustrating this functionality can be found &lt;a href="https://github.com/adl1995/HIPS-to-Py/blob/master/examples/Precise%20drawing-ICRS.ipynb"&gt;here&lt;/a&gt;. Currently, there is no recursion involved in tile splitting, so the parent tile is split only once. Therefore, the results can be improved further, a side-by-side comparison is shown using a &lt;span class="caps"&gt;GIF&lt;/span&gt; image:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Precise and simple drawing" src="https://adl1995.github.io/images/precise-simple-gamma.gif" style="width: 760px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;The red line connects five stars, of which the middle one is the &lt;a href="https://en.wikipedia.org/wiki/Gamma_Cassiopeiae"&gt;Gamma Cassiopeiae&lt;/a&gt;. This can be used to verfiy if the image is drawn correctly, by looking at the corner positions and confirming if they align correctly with the stars.&lt;/p&gt;</content></entry><entry><title>RGB tile drawing in hips package</title><link href="https://adl1995.github.io/rgb-tile-drawing-in-hips-package.html" rel="alternate"></link><published>2017-07-23T12:46:00+05:00</published><updated>2017-07-23T12:46:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2017-07-23:/rgb-tile-drawing-in-hips-package.html</id><summary type="html">&lt;p&gt;The &lt;code&gt;hips&lt;/code&gt; package now supports &lt;span class="caps"&gt;RGB&lt;/span&gt; tile drawing. To make this possible, the output image dimensions had to be altered according to the following configuration:&lt;/p&gt;
&lt;p&gt;The output image shape is two dimensional for grayscale, and three dimensional for color images:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;shape = (height, width)&lt;/code&gt; for &lt;span class="caps"&gt;FITS&lt;/span&gt; images with one grayscale channel …&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;The &lt;code&gt;hips&lt;/code&gt; package now supports &lt;span class="caps"&gt;RGB&lt;/span&gt; tile drawing. To make this possible, the output image dimensions had to be altered according to the following configuration:&lt;/p&gt;
&lt;p&gt;The output image shape is two dimensional for grayscale, and three dimensional for color images:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;shape = (height, width)&lt;/code&gt; for &lt;span class="caps"&gt;FITS&lt;/span&gt; images with one grayscale channel&lt;/li&gt;
&lt;li&gt;&lt;code&gt;shape = (height, width, 3)&lt;/code&gt; for &lt;span class="caps"&gt;JPG&lt;/span&gt; images with three &lt;span class="caps"&gt;RGB&lt;/span&gt; channels&lt;/li&gt;
&lt;li&gt;&lt;code&gt;shape = (height, width, 4)&lt;/code&gt; for &lt;span class="caps"&gt;PNG&lt;/span&gt; images with four &lt;span class="caps"&gt;RGBA&lt;/span&gt; channels&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In addition to this, in-case of &lt;span class="caps"&gt;JPG&lt;/span&gt; and &lt;span class="caps"&gt;PNG&lt;/span&gt; format, the tiles are flipped in the vertical direction, which leads to incorrect tile drawing using the previous technique. The figure below is taken from the &lt;a href="http://www.ivoa.net/documents/HiPS/20160623/WD-HiPS-1.0-20160623.pdf"&gt;hips paper&lt;/a&gt;, figure 6, which shows the inverted tiles.&lt;/p&gt;
&lt;p&gt;&lt;img alt="HiPS inverted tiles figure" src="https://adl1995.github.io/images/flipped-hips-tile.png" style="width: 655px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;To overcome this, the following function was introduced which handles the creation of tile corner pixel coordinates, which are used during projective transformation:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;tile_corner_pixel_coordinates&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;file_format&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ndarray&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="sd"&gt;"""Tile corner pixel coordinates for projective transform.&lt;/span&gt;

&lt;span class="sd"&gt;    The HiPS tile pixels (given by the NumPy array ``tile.data`` in our code)&lt;/span&gt;
&lt;span class="sd"&gt;    have a different orientation for FITS than for JPEG or PNG.&lt;/span&gt;
&lt;span class="sd"&gt;    This is noted in the HiPS spec (http://www.ivoa.net/documents/HiPS/20160623/index.html):&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;gt; Contrary to FITS convention, in JPG and PNG the lines of the pixel&lt;/span&gt;
&lt;span class="sd"&gt;    array are stored in top-&amp;gt;down direction.&lt;/span&gt;

&lt;span class="sd"&gt;    The order of corners below is chosen such that it matches the order&lt;/span&gt;
&lt;span class="sd"&gt;    of the pixel corner sky coordinates from ``healpix_pixel_corners``:&lt;/span&gt;

&lt;span class="sd"&gt;    - north&lt;/span&gt;
&lt;span class="sd"&gt;    - west&lt;/span&gt;
&lt;span class="sd"&gt;    - south&lt;/span&gt;
&lt;span class="sd"&gt;    - east&lt;/span&gt;

&lt;span class="sd"&gt;    which then gives correct results when used to compute the projective transform.&lt;/span&gt;
&lt;span class="sd"&gt;    """&lt;/span&gt;
    &lt;span class="n"&gt;w&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;width&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;file_format&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;'fits'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;corners&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;  &lt;span class="c1"&gt;# north&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;  &lt;span class="c1"&gt;# west&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;  &lt;span class="c1"&gt;# south&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;  &lt;span class="c1"&gt;# east&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;file_format&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;'jpg'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'png'&lt;/span&gt;&lt;span class="p"&gt;}:&lt;/span&gt;
        &lt;span class="n"&gt;corners&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;  &lt;span class="c1"&gt;# north&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;  &lt;span class="c1"&gt;# west&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;  &lt;span class="c1"&gt;# south&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;  &lt;span class="c1"&gt;# east&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;ValueError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s1"&gt;'Invalid file_format: {file_format}'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;corners&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As a result of this new update, the user can now draw &lt;span class="caps"&gt;RGB&lt;/span&gt; tiles. The following image was created from the &lt;code&gt;DSSColor&lt;/code&gt; survey using &lt;span class="caps"&gt;JPG&lt;/span&gt; file format. For this image, the FoV (field of view) was set to 50 degrees, so we get a nice large image:&lt;/p&gt;
&lt;p&gt;&lt;img alt="All sky image" src="https://adl1995.github.io/images/DSSColor-allsky-scaled.jpg" style="width: 760px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;However, there is still an issue which is yet to be fixed. Currently, we simply make full sky images for each projected tile and then sum them up, this leads to bright lines at tiles edges as evident from the image above. This is caused due to pixels being drawn and summed twice at the same location.&lt;/p&gt;</content></entry><entry><title>Parameterized testing using Pytest</title><link href="https://adl1995.github.io/parameterized-testing-using-pytest.html" rel="alternate"></link><published>2017-07-13T09:40:00+05:00</published><updated>2017-07-13T09:40:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2017-07-13:/parameterized-testing-using-pytest.html</id><summary type="html">&lt;p&gt;Pytest provides a feature for parameterized testing in Python. The built-in &lt;code&gt;pytest.mark.parametrize&lt;/code&gt; decorator enables parametrization of arguments for a test function. This allows the user to compare the values for input and output.&lt;/p&gt;
&lt;p&gt;Here is a typical example which shows its usage:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;get_hips_order_for_resolution_pars&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tile_width&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;512&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;resolution&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0 …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Pytest provides a feature for parameterized testing in Python. The built-in &lt;code&gt;pytest.mark.parametrize&lt;/code&gt; decorator enables parametrization of arguments for a test function. This allows the user to compare the values for input and output.&lt;/p&gt;
&lt;p&gt;Here is a typical example which shows its usage:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;get_hips_order_for_resolution_pars&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tile_width&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;512&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;resolution&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.01232&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;resolution_res&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.06395791924665553&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tile_width&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;resolution&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.0016022&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;resolution_res&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.003997369952915971&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tile_width&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;128&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;resolution&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.00009032&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;resolution_res&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.00012491781102862408&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="nd"&gt;@pytest.mark.parametrize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'pars'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;get_hips_order_for_resolution_pars&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;test_get_hips_order_for_resolution&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;hips_order&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;_get_hips_order_for_resolution&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'tile_width'&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'resolution'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="n"&gt;hips_order&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'order'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;hips_resolution&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;nside2resol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;order2nside&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hips_order&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;assert_allclose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hips_resolution&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'resolution_res'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Without the support of parameterized testing, the code had to be duplicated three times in this particular case. Additionally, parameterized testing allows users to see the expected values elegantly without running the tests. &lt;/p&gt;</content></entry><entry><title>Creating custom decorators in Python 3.6</title><link href="https://adl1995.github.io/creating-custom-decorators-in-python-36.html" rel="alternate"></link><published>2017-07-02T12:41:00+05:00</published><updated>2017-07-02T12:41:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2017-07-02:/creating-custom-decorators-in-python-36.html</id><summary type="html">&lt;p&gt;In the &lt;a href="http://hips.readthedocs.io"&gt;hips&lt;/a&gt; package, often data has to be fetched from remote servers, especially HiPS tiles. One way to cut back on the queries was by introducing the &lt;a href="github.com/hipspy/hips-extra"&gt;hips-extra&lt;/a&gt; repository. This contains HiPS tiles from various HiPS surveys. This allows us to quickly fetch tiles from local storage, which makes …&lt;/p&gt;</summary><content type="html">&lt;p&gt;In the &lt;a href="http://hips.readthedocs.io"&gt;hips&lt;/a&gt; package, often data has to be fetched from remote servers, especially HiPS tiles. One way to cut back on the queries was by introducing the &lt;a href="github.com/hipspy/hips-extra"&gt;hips-extra&lt;/a&gt; repository. This contains HiPS tiles from various HiPS surveys. This allows us to quickly fetch tiles from local storage, which makes the testing process less time-consuming.&lt;/p&gt;
&lt;p&gt;As &lt;a href="github.com/hipspy/hips-extra"&gt;hips-extra&lt;/a&gt; repository does not come with the standard &lt;a href="http://hips.readthedocs.io"&gt;hips&lt;/a&gt; package, user has to manually clone it. The availability of the package is checked using an environment variable. This can be set using:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;$export&lt;/span&gt; &lt;span class="nv"&gt;HIPS_EXTRA&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="se"&gt;\p&lt;/span&gt;ath&lt;span class="se"&gt;\t&lt;/span&gt;o&lt;span class="se"&gt;\h&lt;/span&gt;ips-extra
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In Python, the path can be retrieved using the &lt;code&gt;os&lt;/code&gt; module: &lt;code&gt;os.environ['HIPS_EXTRA']&lt;/code&gt;. Now, what if the user does not have &lt;a href="github.com/hipspy/hips-extra"&gt;hips-extra&lt;/a&gt; repository on their system. In this case, we don’t want to raise any errors, but to simply skip the test case. In order to do this, Python decorators become useful.&lt;/p&gt;
&lt;h3&gt;A brief overview on Python Decorators&lt;/h3&gt;
&lt;p&gt;Decorators provide a simple syntax for calling higher-order functions. By definition, a decorator is a function that takes another function and extends the behavior of the latter function without explicitly modifying it. Some of the most commonly used decorators are &lt;code&gt;@classmethod&lt;/code&gt;, &lt;code&gt;@staticmethod&lt;/code&gt;, and &lt;code&gt;@property&lt;/code&gt;. The decorators are written above a function header:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nd"&gt;@property&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;name&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Writing your own decorators&lt;/h3&gt;
&lt;p&gt;To write our decorators, we create a wrapper function around &lt;code&gt;pytest.mark.skipif&lt;/code&gt;. The &lt;a href="https://docs.pytest.org/en/latest/skipping.html#id1"&gt;documentation&lt;/a&gt; of this function can be viewed to get detailed information on how it works. The function below checks if the &lt;code&gt;HIPS_EXTRA&lt;/code&gt; environment variable is set on the user’s system, and if it is, it returns a True boolean.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pathlib&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Path&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;has_hips_extra&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="sd"&gt;"""Is hips-extra available? (`bool`)"""&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;'HIPS_EXTRA'&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'HIPS_EXTRA'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="s1"&gt;'datasets/samples/DSS2Red/properties'&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_file&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A separate function below makes use of the above function to check whether the package is available or not:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pytest&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;requires_hips_extra&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="sd"&gt;"""Decorator to mark tests requiring ``hips-extra`` data."""&lt;/span&gt;
    &lt;span class="n"&gt;skip_it&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;has_hips_extra&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;reason&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'No hips-extra data available.'&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;pytest&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mark&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;skipif&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;skip_it&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;reason&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;reason&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This decorator can now be used. An example illustrating its use is shown below. First, we import the function from its location and then we apply it to another function that uses data from &lt;a href="github.com/hipspy/hips-extra"&gt;hips-extra&lt;/a&gt; repository:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;hips.utils.testing&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;requires_hips_extra&lt;/span&gt;

&lt;span class="nd"&gt;@requires_hips_extra&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;test_draw_sky_image&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="o"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If the user’s &lt;code&gt;HIPS_EXTRA&lt;/code&gt; environment variable does not contain a valid path, the above test will be skipped.&lt;/p&gt;</content></entry><entry><title>HiPS tile drawing</title><link href="https://adl1995.github.io/hips-tile-drawing.html" rel="alternate"></link><published>2017-06-24T11:50:00+05:00</published><updated>2017-06-24T11:50:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2017-06-24:/hips-tile-drawing.html</id><summary type="html">&lt;p&gt;One of the major part of the &lt;a href="http://hips.readthedocs.io"&gt;hips&lt;/a&gt; project is being able to draw HiPS tiles onto a larger sky image. The most important part in this is using projective transformation for computing and drawing a HiPS tile at the correct location. The discussion below is for the tile containing …&lt;/p&gt;</summary><content type="html">&lt;p&gt;One of the major part of the &lt;a href="http://hips.readthedocs.io"&gt;hips&lt;/a&gt; project is being able to draw HiPS tiles onto a larger sky image. The most important part in this is using projective transformation for computing and drawing a HiPS tile at the correct location. The discussion below is for the tile containing the galactic center pixel values. To achieve this, several steps are involved.&lt;/p&gt;
&lt;h3&gt;Computing boundaries of a HiPS tile&lt;/h3&gt;
&lt;p&gt;A tile is defined by four corners, &lt;a href="http://hips.readthedocs.io"&gt;hips&lt;/a&gt; ~~contains a utility function named &lt;a href="http://hips.readthedocs.io/en/latest/api/hips.utils.boundaries.html#hips.utils.boundaries"&gt;hips.utils.boundaries&lt;/a&gt;~~ uses the &lt;a href="https://github.com/astropy/astropy-healpix/blob/3fcb80921f362e3620f9892e934d4f0f69b7bf21/astropy_healpix/high_level.py"&gt;astropy_healpix.HEALPix.boundaries_skycoord&lt;/a&gt; function which returns the angle (&lt;span class="math"&gt;\(\theta\)&lt;/span&gt; and &lt;span class="math"&gt;\(\phi\)&lt;/span&gt;) in radians wrapped inside &lt;a href="http://docs.astropy.org/en/stable/api/astropy.coordinates.SkyCoord.html"&gt;astropy.coordinates.SkyCoord&lt;/a&gt; class. This contains the four corners of a HiPS tile in the order (North, West, South and East). A snippet which computes the corners of a HiPS tile is provided below:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy.coordinates&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;SkyCoord&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;hips.utils&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;boundaries&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;theta&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;phi&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;boundaries&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nside&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;450&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;SkyCoord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ra&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;phi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dec&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;theta&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;unit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'radian'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'icrs'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SkyCoord&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ICRS&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ra&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dec&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;deg&lt;/span&gt;
&lt;span class="p"&gt;[(&lt;/span&gt; &lt;span class="mf"&gt;264.375&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;24.62431835&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="mf"&gt;258.75&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;30.&lt;/span&gt;        &lt;span class="p"&gt;),&lt;/span&gt;
 &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="mf"&gt;264.375&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;35.68533471&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="mf"&gt;270.&lt;/span&gt;   &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;30.&lt;/span&gt;        &lt;span class="p"&gt;)]&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;These are also referred to as HEALPix pixel corners. The returned latitude and longitude values (in degrees) are wrapped inside a list of tuples. The HiPS tile under discussion is shown below:&lt;/p&gt;
&lt;p&gt;&lt;img alt="HiPS tile" src="https://adl1995.github.io/images/hips_tile.png" style="width: 149px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h3&gt;Computing HEALPix pixel indices&lt;/h3&gt;
&lt;p&gt;Another important step is to know the HEALPix pixel indices which helps us in computing the boundaries for all the tiles. For this, &lt;a href="http://hips.readthedocs.io"&gt;hips&lt;/a&gt; provides a ~~&lt;a href="http://hips.readthedocs.io/en/latest/api/hips.utils.compute_healpix_pixel_indices.html#hips.utils.compute_healpix_pixel_indices"&gt;hips.utils.compute_healpix_pixel_indices&lt;/a&gt;~~ &lt;a href="https://github.com/hipspy/hips/blob/master/hips/utils/healpix.py#L61"&gt;hips.utils.healpix_pixels_in_sky_image&lt;/a&gt; function which takes in &lt;a href="http://hips.readthedocs.io/en/latest/api/hips.utils.WCSGeometry.html#hips.utils.WCSGeometry"&gt;WCSGeometry&lt;/a&gt; object, &lt;code&gt;order&lt;/code&gt;, and &lt;code&gt;healpix_frame&lt;/code&gt; of the HEALPix map as parameter.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy.coordinates&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;SkyCoord&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;healpy&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;hp&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;hips.utils&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;WCSGeometry&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;hips.utils&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;compute_healpix_pixel_indices&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;skycoord&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SkyCoord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;unit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"deg"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;wcs_geometry&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;WCSGeometry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;     &lt;span class="n"&gt;skydir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;skycoord&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;     &lt;span class="n"&gt;coordsys&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'CEL'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;projection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'AIT'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;     &lt;span class="n"&gt;cdelt&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;1.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;crpix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;1.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;1.&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;nside&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;order2nside&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;compute_healpix_pixel_indices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;wcs_geometry&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;nside&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;176&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;207&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;208&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;239&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;240&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;271&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;272&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The output array values are used as an input to the &lt;a href="http://hips.readthedocs.io/en/latest/api/hips.utils.boundaries.html#hips.utils.boundaries"&gt;boundaries&lt;/a&gt; function’s &lt;code&gt;pix&lt;/code&gt; parameter.&lt;/p&gt;
&lt;h3&gt;Applying projective transformation&lt;/h3&gt;
&lt;p&gt;After the tile corners are computed, &lt;a href="http://www.fen.bilkent.edu.tr/~franz/ag05/ag-07.pdf"&gt;projective transformation&lt;/a&gt; is applied to the image. For this, the &lt;a href="http://scikit-image.org/docs/dev/api/skimage.transform.html#skimage.transform.ProjectiveTransform"&gt;skimage.transform.ProjectiveTransform&lt;/a&gt; function is used. This takes in two parameters, namely &lt;code&gt;source&lt;/code&gt; and &lt;code&gt;destination&lt;/code&gt;. The destination array values are constant, since &lt;code&gt;hips_tile_width&lt;/code&gt; is always equal to &lt;code&gt;512&lt;/code&gt;.  In general,  the projective transform is given by a 3x3 matrix with 8 free parameters, however, in this case the &lt;code&gt;estimate&lt;/code&gt; method is called which takes in two 4x2 arrays i.e. 4 corners each given by a longitude and a latitude.&lt;/p&gt;
&lt;p&gt;The target position is calculated by multiplying with the given matrix i.e. the tile pixels, which produces the resulting image. Thus, a HiPS tile is given as the destination parameter, this is done because the transformation works in an inverse manner i.e. it starts with the pixel coordinates in the output image and computes the corresponding coordinates in the input image, and then applies interpolation in the input image to compute the output pixel values. &lt;/p&gt;
&lt;p&gt;Briefly, a HiPS tile is given as an input, and the output is the “normal” sky image.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;skimage&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;transform&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;tf&lt;/span&gt;
&lt;span class="n"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;zeros&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;all_sky&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;src&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;wcs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wcs_world2pix&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;corners&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;dst&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;([[&lt;/span&gt;&lt;span class="mi"&gt;511&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;511&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;511&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;511&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]])&lt;/span&gt;
&lt;span class="n"&gt;tform3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ProjectiveTransform&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;tform3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;estimate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dst&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;output&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;tf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;warp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tform3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;output_shape&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The resulting image is shown below:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Projective transformation" src="https://adl1995.github.io/images/transform.png" style="width: 462px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;The above image only shows a single tile drawn onto an empty all sky image. As it can be seen, there are still some issues to be figured out for the tile loading and drawing, for example, in this case, the same tile is always being drawn (that’s why one can’t see a sky image, just that pattern) and the handling of tiles at the “edge” of the sky image in this Aitoff projection. These issues will be resolved in the upcoming milestone.&lt;/p&gt;
&lt;p&gt;&lt;img alt="All sky" src="https://adl1995.github.io/images/transfomed.png" style="width: 712px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;The code for fetching a HiPS tile and drawing it using projective transformation can be found on this &lt;a href="https://github.com/adl1995/HIPS-to-Py/blob/master/examples/Affine%20and%20Projective%20transformation.ipynb"&gt;Jupyter notebook&lt;/a&gt;.&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content></entry><entry><title>Type annotations in Python 3.6 and using Mypy as a static type checker</title><link href="https://adl1995.github.io/type-annotations-in-python-36-and-using-mypy-as-a-static-type-checker.html" rel="alternate"></link><published>2017-06-11T12:58:00+05:00</published><updated>2017-06-11T12:58:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2017-06-11:/type-annotations-in-python-36-and-using-mypy-as-a-static-type-checker.html</id><summary type="html">&lt;p&gt;The main goal of type annotations is to open up Python code to easier static analysis and refactoring, potential runtime type checking, and (perhaps, in some contexts) code generation, by utilizing type information. These were introduced in &lt;a href="https://www.python.org/dev/peps/pep-0484"&gt;&lt;span class="caps"&gt;PEP&lt;/span&gt; 484&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In this regards, static type checking is the most important. It …&lt;/p&gt;</summary><content type="html">&lt;p&gt;The main goal of type annotations is to open up Python code to easier static analysis and refactoring, potential runtime type checking, and (perhaps, in some contexts) code generation, by utilizing type information. These were introduced in &lt;a href="https://www.python.org/dev/peps/pep-0484"&gt;&lt;span class="caps"&gt;PEP&lt;/span&gt; 484&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In this regards, static type checking is the most important. It allows support for off-line third-party type checkers, such as Mypy, which is introduced in a later section.&lt;/p&gt;
&lt;h3&gt;Purpose of annotations&lt;/h3&gt;
&lt;p&gt;The &lt;code&gt;typing&lt;/code&gt; module in Python 3.6 contains many definitions that are useful in statically typed code. For instance, the &lt;code&gt;Any&lt;/code&gt; type is used by default for every argument and return type of a function. This is all in regards to a checked function. If a function is to be ignored by a static type checker, the decorator &lt;code&gt;@no_type_check&lt;/code&gt; should be provided before the function header. This function will now be treated as having no type annotations.&lt;/p&gt;
&lt;p&gt;An example following the type annotations is shown below:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;scale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scalar&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;number&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;scalar&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;number&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This states that the expected type of the &lt;code&gt;scalar&lt;/code&gt; and &lt;code&gt;number&lt;/code&gt; argument is &lt;code&gt;int&lt;/code&gt; and &lt;code&gt;int&lt;/code&gt;, respectively. Analogically, the expected return type is also &lt;code&gt;int&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The acceptable type hints that may be used are: &lt;code&gt;None&lt;/code&gt;, &lt;code&gt;Any&lt;/code&gt;, &lt;code&gt;Union&lt;/code&gt;, &lt;code&gt;Tuple&lt;/code&gt;, &lt;code&gt;Callable&lt;/code&gt;, all types exported from &lt;code&gt;typing&lt;/code&gt; (e.g. &lt;code&gt;Sequence&lt;/code&gt; and &lt;code&gt;Dict&lt;/code&gt;), type variables, and type aliases. &lt;/p&gt;
&lt;h4&gt;Using type aliases&lt;/h4&gt;
&lt;p&gt;Type aliases can be defined by using simple variable assignments:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Temperature&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;float&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;forecast&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;temperature&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Temperature&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;day&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Creating your own types&lt;/h4&gt;
&lt;p&gt;In Python 3.5 a new function is introduced called &lt;code&gt;NewType&lt;/code&gt;. This allows the programmer to create distinct types:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;typing&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;NewType&lt;/span&gt;

&lt;span class="n"&gt;UserId&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;NewType&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'UserId'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;some_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;UserId&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;356&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Static type checking using Mypy&lt;/h3&gt;
&lt;p&gt;When a script is run with a standard Python interpreter, the type annotations are treated primarily as comments. Using &lt;code&gt;mypy&lt;/code&gt;, common code bugs can be found and it checks the code for proper return types etc. As &lt;code&gt;mypy&lt;/code&gt; is a static analyzer, it does not cause any overhead when running the program. A function without a type annotation is considered dynamically typed.&lt;/p&gt;
&lt;p&gt;Let’s run &lt;code&gt;mypy&lt;/code&gt; for checking a class method I wrote:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nd"&gt;@classmethod&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;parse_file_properties&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;cls&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;properties&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;OrderedDict&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;properties&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;properties&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;list_properties&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;property&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;properties&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;key_value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;property&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'='&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;list_properties&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;key_value&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;key_value&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;()))&lt;/span&gt;
        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;IndexError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="c1"&gt;# The case where a property contains comment or a blank line&lt;/span&gt;
            &lt;span class="k"&gt;pass&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;OrderedDict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;list_properties&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This function takes in a &lt;code&gt;=&lt;/code&gt; separated string, parses it using &lt;code&gt;split()&lt;/code&gt;, and returns it as an ordered dictionary. When I run &lt;code&gt;mypy&lt;/code&gt; from a terminal, issuing the command &lt;code&gt;python -m mypy hips/tiles&lt;/code&gt;, I get no error or warning, so the provided type annotations were correct.&lt;/p&gt;
&lt;p&gt;However, if I change the function header to:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;parse_file_properties&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;cls&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;properties&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;OrderedDict&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I get this error message:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;hips/tiles/description.py:61: error: “int” has no attribute “split”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The illustration below shows the basic workflow of static type checking:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Static type checking" src="https://adl1995.github.io/images/static_typing.png" style="width: 193px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;</content></entry><entry><title>An overview of Hierarchical Progressive Surveys (HiPS) and the HEALPix framework</title><link href="https://adl1995.github.io/an-overview-of-hierarchical-progressive-surveys-hips-and-the-healpix-framework.html" rel="alternate"></link><published>2017-05-31T19:39:00+05:00</published><updated>2017-05-31T19:39:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2017-05-31:/an-overview-of-hierarchical-progressive-surveys-hips-and-the-healpix-framework.html</id><summary type="html">&lt;p&gt;&lt;a href="https://www.aanda.org/articles/aa/pdf/2015/06/aa26075-15.pdf"&gt;HiPS scheme&lt;/a&gt; utilizes the HEALPix framework for mapping a sphere (in this case, part of a sky) and compiles / transforms it into &lt;a href="#hips-tiles"&gt;tiles&lt;/a&gt; and &lt;a href="#hips-pixels"&gt;pixels&lt;/a&gt; which contain the astronomical data. The HiPS scheme emphasizes on usability, and thus, it tries abstract the scientific details while preserving them. This can be …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a href="https://www.aanda.org/articles/aa/pdf/2015/06/aa26075-15.pdf"&gt;HiPS scheme&lt;/a&gt; utilizes the HEALPix framework for mapping a sphere (in this case, part of a sky) and compiles / transforms it into &lt;a href="#hips-tiles"&gt;tiles&lt;/a&gt; and &lt;a href="#hips-pixels"&gt;pixels&lt;/a&gt; which contain the astronomical data. The HiPS scheme emphasizes on usability, and thus, it tries abstract the scientific details while preserving them. This can be further built upon for statistical analysis of large datasets. A brief overview of HEALPix is given below before moving onto HiPS.&lt;/p&gt;
&lt;h3&gt;Introduction to HEALPix&lt;/h3&gt;
&lt;p&gt;HEALPix, an acronym of ‘Hierarchical Equal Area isoLatitude Pixelization of a sphere’, is a framework for discretizing high resolution data. It was devised at &lt;span class="caps"&gt;NASA&lt;/span&gt;’s &lt;a href="https://www.jpl.nasa.gov"&gt;Jet Propulsion Laboratory&lt;/a&gt;.  The software is available in C, C++, Fortran90, &lt;span class="caps"&gt;IDL&lt;/span&gt;, Java, and Python. The main features provided by the software are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pixel manipulation&lt;/li&gt;
&lt;li&gt;Spherical Harmonics Transforms&lt;/li&gt;
&lt;li&gt;Visualization&lt;/li&gt;
&lt;li&gt;Input / Output (supports &lt;span class="caps"&gt;FITS&lt;/span&gt; files)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In a nutshell, the pixelization procedure subdivides a spherical sphere in which each pixel is equidistant from the origin - meaning it covers the same surface area. This produces a HEALPix grid, whose interesting property is that pixels are distributed on lines of constant latitude. Due to this iso-latitude distribution of pixels the complexity for computing integrals over each harmonics is N&lt;sup&gt;1/2&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;HEALPix provides a standard format on how to store data in &lt;a href="https://en.wikipedia.org/wiki/FITS"&gt;&lt;span class="caps"&gt;FITS&lt;/span&gt;&lt;/a&gt; files.  There are numerous software packages that can work with HEALPix data. For this project, &lt;code&gt;healpy&lt;/code&gt; will be used which is built on the HEALPix C++ package. But there are others as well, such as &lt;a href="http://aladin.u-strasbg.fr/AladinLite"&gt;Aladin Lite&lt;/a&gt;. The main functionality required for this project is HEALPix pixel index to sky coordinate transformation (back and forth), and one or two methods to list HEALPix pixels in a given region of the sky (e.g. &lt;code&gt;query_disc&lt;/code&gt; from &lt;code&gt;healpy&lt;/code&gt;).&lt;/p&gt;
&lt;h4&gt;Pixel numbering schemes&lt;/h4&gt;
&lt;p&gt;HEALPix provides two numbering schemes for pixels, namely the &lt;strong&gt;&lt;span class="caps"&gt;RING&lt;/span&gt; scheme&lt;/strong&gt; and &lt;strong&gt;&lt;span class="caps"&gt;NESTED&lt;/span&gt; scheme&lt;/strong&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;span class="caps"&gt;RING&lt;/span&gt; scheme&lt;/strong&gt;
In this scheme the pixels are counted down from north to south along each iso-latitude ring.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;span class="caps"&gt;NESTED&lt;/span&gt; scheme&lt;/strong&gt;
 This scheme arranges the pixels into 12 tree structures with respect to their base-resolution pixels.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="HEALPix projection" src="https://adl1995.github.io/images/HEALPix_projection_SW.png" style="width: 760px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h3&gt;Introduction to HiPS&lt;/h3&gt;
&lt;p&gt;HiPS is the hierarchical tiling mechanism which allows one to access, visualize and browse seamlessly image, catalogue and cube data. The original HiPS paper can be found &lt;a href="https://arxiv.org/pdf/1505.02291.pdf"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;HiPS working&lt;/h3&gt;
&lt;p&gt;The multi-resolution representation of original images provides the basis for visualizing data in a progressive way, as the pixels that are required for a given view can be accessed through pre-computed HEALPix maps, and the nested pixel numbering scheme provides a simple hierarchical indexing system that encodes pixel inheritance across different orders.&lt;/p&gt;
&lt;p&gt;HiPS scheme groups pixels into different tiles. The general relationship between tiles and pixels is that a tile with &lt;code&gt;n-tile&lt;/code&gt; pixels along each side forms a HEALPix mesh of order k&lt;sup&gt;tile&lt;/sup&gt;. Tiles store map information from HEALPix. These tiles are presented as square arrays and it is possible to store them in different file formats. The files are organized into different directories. Here, tiles are used as files and tile orders are used for grouping data in directories, all following a naming convention. For more information on the method on file storage, &lt;a href="http://aladin.unistra.fr/hips/hipsdoc.pdf"&gt;this&lt;/a&gt; document can be viewed, authored by Pierre Fernique.&lt;/p&gt;
&lt;h3&gt;HiPS pixels&lt;/h3&gt;
&lt;p&gt;Using the header &lt;code&gt;hips_pixel_bitpix&lt;/code&gt; the HiPS pixels are stored in &lt;span class="caps"&gt;BITPIX&lt;/span&gt; code. &lt;code&gt;hips_pixel_bitpix&lt;/code&gt; refers to the data type used to store &lt;span class="caps"&gt;FITS&lt;/span&gt; tile (a value of 8 represents 8-bits integers, -32 represents simple floating points, and -64 represents double precision floating points).&lt;/p&gt;
&lt;p&gt;This is usually the same value as the &lt;span class="caps"&gt;BITPIX&lt;/span&gt; value of the original images (described in keyword &lt;code&gt;data_pixel_bitpix&lt;/code&gt;), but might be different, notably for HiPS built from heterogeneous origins.&lt;/p&gt;
&lt;p&gt;The &lt;span class="caps"&gt;BITPIX&lt;/span&gt; value is always present in the HiPS &lt;span class="caps"&gt;FITS&lt;/span&gt; tiles.&lt;/p&gt;
&lt;h3&gt;HiPS tiles&lt;/h3&gt;
&lt;p&gt;As it is cumbersome to transfer each pixel (essentially a file), HiPS scheme groups pixels into different tiles. The general relationship between the tiles and pixels is that a tile with &lt;em&gt;n&lt;/em&gt;-tile pixels along each
side forms a HEALPix mesh of order of &lt;em&gt;k&lt;/em&gt;-tile. A HiPS tile is show below.&lt;/p&gt;
&lt;p&gt;&lt;img alt="A HiPS tile" src="https://adl1995.github.io/images/hips-tile.jpg" style="width: 760px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h3&gt;HiPS images&lt;/h3&gt;
&lt;p&gt;The way HiPS represents images is by re-sampling them onto a HEALPix grid at the maximum desired order, say k&lt;sup&gt;max&lt;/sup&gt;. Then, it generates tile images for tile orders. When mosaicking / stitching images, the angular resolution is taken into account. There are various methods for filling the data region when stitching images and dealing with background differences. The k&lt;sup&gt;max&lt;/sup&gt; chosen earlier determines minimum pixel size which is near to the angular pixel size or the resolution of original data.&lt;/p&gt;
&lt;p&gt;Next important thing is whether to emphasize on &lt;code&gt;display quality&lt;/code&gt; or &lt;code&gt;photometric accuracy&lt;/code&gt;, which depends on the use case. Image encoding can be done either in &lt;strong&gt;&lt;span class="caps"&gt;FITS&lt;/span&gt;&lt;/strong&gt;, &lt;strong&gt;&lt;span class="caps"&gt;PNG&lt;/span&gt;&lt;/strong&gt;, or &lt;strong&gt;&lt;span class="caps"&gt;JPG&lt;/span&gt;&lt;/strong&gt; file format. For most cases it is enough to only generate &lt;span class="caps"&gt;FITS&lt;/span&gt; and &lt;span class="caps"&gt;PNG&lt;/span&gt; files. The lowest order pixel values correspond to a large area of the sky. The HiPS indexing structure takes care of mapping correct tiles onto a display.&lt;/p&gt;
&lt;p&gt;HiPS generation for huge amounts of data such as the Hubble Space Telescope requires planning of system growth.&lt;/p&gt;
&lt;h3&gt;HiPS catalogues&lt;/h3&gt;
&lt;p&gt;A HiPS catalogue contains the &lt;span class="caps"&gt;RA&lt;/span&gt; (right ascension) / &lt;span class="caps"&gt;DEC&lt;/span&gt; (declination) coordinates stored in a &lt;span class="caps"&gt;TSV&lt;/span&gt; file. The data is &lt;span class="caps"&gt;ASCII&lt;/span&gt; tab separated and is organized in various directories the same way as HiPS images.&lt;/p&gt;
&lt;h3&gt;Google Summer of Code 2017 project&lt;/h3&gt;
&lt;p&gt;I have been selected for creating this package as part of Google Summer of Code program, along with two mentors, &lt;a href="https://github.com/cdeil"&gt;Christoph Deil&lt;/a&gt; and  &lt;a href="https://github.com/tboch"&gt;Thomas Boch&lt;/a&gt;. My proposal application can be found &lt;a href="https://github.com/adl1995/HIPS-to-Py/blob/master/documents/application.md"&gt;here&lt;/a&gt;. The goal of this project is to design and create a Python client for Hierarchical Progressive Surveys (HiPS). The library will extend a low and high level &lt;span class="caps"&gt;API&lt;/span&gt; for exploring and creating &lt;span class="caps"&gt;WCS&lt;/span&gt; / HEALPix images. Currently, there are other clients built using HiPS, such as Aladin and Aladin Lite, but they are written in Java and JavaScript, respectively. Once the trivial functionality is complete, additional features such as measuring fluxes and overplotting multi-wavelength data will also be added. The code repository for this project can be found &lt;a href="https://github.com/hipspy/hips"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If anyone has any questions or suggestions regarding the package, they are encouraged to open issues on GitHub. If you want to help us build the package or add extra features onto it, please open up a pull request.&lt;/p&gt;
&lt;p&gt;The coding period is about to begin. My future blog posts will be based around this topic.&lt;/p&gt;</content></entry><entry><title>A comparison of response times using URLLib, GRequests, and asyncio</title><link href="https://adl1995.github.io/a-comparison-of-response-times-using-urllib-grequests-and-asyncio.html" rel="alternate"></link><published>2017-05-09T15:54:00+05:00</published><updated>2017-05-09T15:54:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2017-05-09:/a-comparison-of-response-times-using-urllib-grequests-and-asyncio.html</id><summary type="html">&lt;p&gt;For the &lt;a href="https://github.com/hipspy/hips"&gt;HiPS client&lt;/a&gt; multiple tiles have to be fetched for time efficiency. To achieve this, we create a separate thread for each outgoing request. Thus, requests are sent concurrently. A comparison is done utilizing Python’s &lt;code&gt;threading&lt;/code&gt; library. The elapsed time is calculated using the &lt;code&gt;time&lt;/code&gt; module. For fetching …&lt;/p&gt;</summary><content type="html">&lt;p&gt;For the &lt;a href="https://github.com/hipspy/hips"&gt;HiPS client&lt;/a&gt; multiple tiles have to be fetched for time efficiency. To achieve this, we create a separate thread for each outgoing request. Thus, requests are sent concurrently. A comparison is done utilizing Python’s &lt;code&gt;threading&lt;/code&gt; library. The elapsed time is calculated using the &lt;code&gt;time&lt;/code&gt; module. For fetching the tiles &lt;code&gt;urllib&lt;/code&gt;, &lt;code&gt;grequests&lt;/code&gt;, &lt;code&gt;aiohttp&lt;/code&gt;, and &lt;code&gt;asyncio&lt;/code&gt; packages are used. The HiPS survey chosen for this comparison is &lt;code&gt;alasky.u-strasbg.fr&lt;/code&gt;. &lt;/p&gt;
&lt;p&gt;For fetching 10 tiles, it takes the following time (in seconds):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Elapsed Time URLLib (without concurrency): 3.5430831909179688
Elapsed Time URLLib (with concurrency): 0.388397216796875
Elapsed Time URLLib (with aiohttp): 0.3900480270385742
Elapsed Time GRequests: 1.6238431930541992
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Similarly, for fetching 100 tiles, it takes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Elapsed Time URLLib (without concurrency): 37.7027428150177
Elapsed Time URLLib (with concurrency): 5.575664043426514
Elapsed Time URLLib (with aiohttp): 2.4697625637054443
Elapsed Time GRequests: 4.273705244064331
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The pros of &lt;code&gt;grequests&lt;/code&gt; is that it takes less time when large number of requests have to be sent. But &lt;code&gt;urllib&lt;/code&gt; (with threading) gives a better response time when requests are few.&lt;/p&gt;
&lt;p&gt;Using &lt;code&gt;aiohttp&lt;/code&gt; with &lt;code&gt;asyncio&lt;/code&gt; seems to be the best option. Its response time is almost 50% less than &lt;code&gt;grequests&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The source code for this comparison can be found &lt;a href="https://github.com/adl1995/HIPS-to-Py/blob/master/examples/fetch-tiles-threaded.py"&gt;here&lt;/a&gt;.&lt;/p&gt;</content></entry><entry><title>My First Article</title><link href="https://adl1995.github.io/my-first-article.html" rel="alternate"></link><published>2017-03-19T22:45:00+05:00</published><updated>2017-03-19T22:45:00+05:00</updated><author><name>Adeel Ahmad</name></author><id>tag:adl1995.github.io,2017-03-19:/my-first-article.html</id><summary type="html">&lt;p&gt;Hello World!&lt;/p&gt;
&lt;p&gt;This blog will be extensively used for posting GSoC updates, apart from other technical ramblings.&lt;/p&gt;</summary><content type="html">&lt;p&gt;Hello World!&lt;/p&gt;
&lt;p&gt;This blog will be extensively used for posting GSoC updates, apart from other technical ramblings.&lt;/p&gt;</content></entry></feed>